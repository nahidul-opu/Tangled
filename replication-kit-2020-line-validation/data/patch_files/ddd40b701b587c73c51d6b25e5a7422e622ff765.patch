From ddd40b701b587c73c51d6b25e5a7422e622ff765 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Thu, 19 Mar 2009 21:36:02 +0000
Subject: [PATCH] NET-259: Add fix for files with no spaces before the hard
 link count

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@756220 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/net/ftp/parser/UnixFTPEntryParser.java  |  2 +-
 src/site/xdoc/changes.xml                           |  2 +-
 .../net/ftp/parser/UnixFTPEntryParserTest.java      | 13 +++++++++++--
 3 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
index b698ef301..98e40d89f 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
@@ -83,7 +83,7 @@ public class UnixFTPEntryParser extends ConfigurableFTPFileEntryParserImpl
      */
     private static final String REGEX =
         "([bcdelfmpSs-])"
-        +"(((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-])))\\+?\\s+"
+        +"(((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-])))\\+?\\s*"
         + "(\\d+)\\s+"
         + "(?:(\\S+(?:\\s\\S+)*?)\\s+)?"                // owner name (optional spaces)
         + "(?:(\\S+(?:\\s\\S+)*)\\s+)?"                 // group name (optional spaces)
diff --git a/src/site/xdoc/changes.xml b/src/site/xdoc/changes.xml
index 549d55f8b..cccb7cecf 100644
--- a/src/site/xdoc/changes.xml
+++ b/src/site/xdoc/changes.xml
@@ -23,7 +23,7 @@ limitations under the License.
 	
 
 	<body>
-		<release version="2.0" date="" description="Java 5.0 release">
+		<release version="2.0" date="October 20, 2008" description="Java 5.0 release">
 			<action dev="rwinston" type="update">
 				Add null check in TelnetClient::disconnect().
 			</action>
diff --git a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
index 26046fe78..99923203c 100644
--- a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
+++ b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
@@ -174,8 +174,17 @@ public void testTrailingSpaces() {
 	public void testNameWIthPunctuation() {
 		FTPFile f = getParser().parseFTPEntry("drwx------ 4 maxm Domain Users 512 Oct 2 10:59 abc(test)123.pdf");
 		assertNotNull(f);
-		assertEquals(f.getName(), "abc(test)123.pdf");
-		
+		assertEquals(f.getName(), "abc(test)123.pdf");	
+	}
+
+	public void testNoSpacesBeforeFileSize() {
+		FTPFile f = getParser().parseFTPEntry("drwxr-x---+1464 chrism   chrism     41472 Feb 25 13:17 20090225");
+		assertNotNull(f);
+		assertEquals(f.getSize(), 41472);
+		assertEquals(f.getType(), FTPFile.DIRECTORY_TYPE);
+		assertEquals(f.getUser(), "chrism");
+		assertEquals(f.getGroup(), "chrism");
+		assertEquals(f.getHardLinkCount(), 1464);
 	}
 
     /**
