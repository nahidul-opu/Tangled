From 46600216975867189da464a18c901674f085184a Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Sun, 27 Oct 2013 17:43:14 +0000
Subject: [PATCH] COMPRESS-241 SevenZOutputFile#closeArchiveEntry throws
 XZException on Java8

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1536169 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                            |  4 ++++
 .../compress/archivers/sevenz/LZMA2Decoder.java    | 14 +-------------
 2 files changed, 5 insertions(+), 13 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 3afe3e60747..1dd173a7595 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -44,6 +44,10 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
     <release version="1.7" date="not released, yet"
              description="Release 1.7">
+      <action issue="COMPRESS-241" type="fix" date="2012-03-27">
+        SevenZOutputFile#closeArchiveEntry throws an exception when
+        using LZMA2 compression on Java8.
+      </action> 
     </release>
     <release version="1.6" date="2013-10-26"
              description="Release 1.6">
diff --git a/src/main/java/org/apache/commons/compress/archivers/sevenz/LZMA2Decoder.java b/src/main/java/org/apache/commons/compress/archivers/sevenz/LZMA2Decoder.java
index 101315589f7..d194c202cf9 100644
--- a/src/main/java/org/apache/commons/compress/archivers/sevenz/LZMA2Decoder.java
+++ b/src/main/java/org/apache/commons/compress/archivers/sevenz/LZMA2Decoder.java
@@ -52,19 +52,7 @@ OutputStream encode(final OutputStream out, final byte[] password)
         LZMA2Options options = new LZMA2Options();
         options.setDictSize(LZMA2Options.DICT_SIZE_DEFAULT);
         FinishableOutputStream wrapped = new FinishableWrapperOutputStream(out);
-        return new FinishOnCloseStream(options.getOutputStream(wrapped));
+        return options.getOutputStream(wrapped);
     }
 
-    private static class FinishOnCloseStream extends FilterOutputStream {
-
-        private FinishOnCloseStream(FinishableOutputStream out) {
-            super(out);
-        }
-
-        @Override
-        public void close() throws IOException {
-            ((FinishableOutputStream) out).finish();
-            super.close();
-        }
-    }
 }
