From 16d3d6c588e38b76f01081c1e8b1b3923cc226f8 Mon Sep 17 00:00:00 2001
From: ferdy <ferdy@unknown>
Date: Mon, 9 Jul 2012 12:53:52 +0000
Subject: [PATCH] GORA-146 HBaseStore does not properly set endkey

git-svn-id: https://svn.apache.org/repos/asf/gora/trunk@1359126 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                            |  2 ++
 .../java/org/apache/gora/hbase/store/HBaseStore.java   | 10 +++++-----
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 57154efdf..970c63489 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -6,6 +6,8 @@ Gora Change Log
 
 0.3 (trunk) Current Development:
 
+* GORA-146 HBaseStore does not properly set endkey (ferdy)
+
 * GORA-140 Requires some adjustments on dependency at gora-cassandra (kazk, lewismc)
 
 * GORA-138 gora-cassandra array type support: Double fix for GORA-81 Replace CassandraStore#addOrUpdateField with TypeInferringSerializer to take advantage of when the value is already of type ByteBuffer. (Kazuomi Kashii via lewismc)
diff --git a/gora-hbase/src/main/java/org/apache/gora/hbase/store/HBaseStore.java b/gora-hbase/src/main/java/org/apache/gora/hbase/store/HBaseStore.java
index 5e919bb1a..7cae7abb3 100644
--- a/gora-hbase/src/main/java/org/apache/gora/hbase/store/HBaseStore.java
+++ b/gora-hbase/src/main/java/org/apache/gora/hbase/store/HBaseStore.java
@@ -325,13 +325,13 @@ public List<PartitionQuery<K, T>> getPartitions(Query<K, T> query)
           (stopRow.length == 0 ||
               Bytes.compareTo(stopRow, keys.getFirst()[i]) > 0)) {
 
-        byte[] splitStart = (startRow.length == 0 ||
-          Bytes.compareTo(keys.getFirst()[i], startRow) >= 0) ?
+        byte[] splitStart = startRow.length == 0 || 
+            Bytes.compareTo(keys.getFirst()[i], startRow) >= 0 ? 
             keys.getFirst()[i] : startRow;
 
-        byte[] splitStop = (stopRow.length == 0 ||
-            Bytes.compareTo(keys.getSecond()[i], stopRow) <= 0) ?
-            keys.getSecond()[i] : stopRow;
+        byte[] splitStop = (stopRow.length == 0 || 
+            Bytes.compareTo(keys.getSecond()[i], stopRow) <= 0) && 
+            keys.getSecond()[i].length > 0 ? keys.getSecond()[i] : stopRow;
 
         K startKey = Arrays.equals(HConstants.EMPTY_START_ROW, splitStart) ?
             null : HBaseByteInterface.fromBytes(keyClass, splitStart);
