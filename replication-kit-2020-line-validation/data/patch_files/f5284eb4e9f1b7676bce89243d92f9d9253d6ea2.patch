From f5284eb4e9f1b7676bce89243d92f9d9253d6ea2 Mon Sep 17 00:00:00 2001
From: Thomas Vandahl <tv@apache.org>
Date: Sat, 31 Mar 2012 19:18:49 +0000
Subject: [PATCH] When issuing a shutDown() command, JCS fails to clean up the
 Queue Processor thread. fixes JCS-90

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/jcs/branches/generics-interface@1307881 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/jcs/engine/control/CompositeCache.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/jcs/engine/control/CompositeCache.java b/src/java/org/apache/jcs/engine/control/CompositeCache.java
index 6ac16d254..7bb2bcca9 100644
--- a/src/java/org/apache/jcs/engine/control/CompositeCache.java
+++ b/src/java/org/apache/jcs/engine/control/CompositeCache.java
@@ -1314,9 +1314,11 @@ public synchronized void dispose( boolean fromRemote )
         }
         alive = false;
 
+        // Now, shut down the event queue
+        elementEventQ.destroy();
+
         // Dispose of each auxiliary cache, Remote auxiliaries will be
         // skipped if 'fromRemote' is true.
-
         for ( int i = 0; i < auxCaches.length; i++ )
         {
             try
