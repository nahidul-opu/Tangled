From f5ebaa8b78649c6e0c12a463df9bdfed0575becf Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Tue, 31 Jul 2012 12:32:12 +0000
Subject: [PATCH] [VFS-435] FileSystemConfigBuilder does not use prefix for
 some system property lookups.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1367517 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/vfs2/FileSystemConfigBuilder.java | 43 ++++++++++++++-----
 src/changes/changes.xml                       |  3 ++
 2 files changed, 36 insertions(+), 10 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs2/FileSystemConfigBuilder.java b/core/src/main/java/org/apache/commons/vfs2/FileSystemConfigBuilder.java
index 5f242d6024..9ec3875fd1 100644
--- a/core/src/main/java/org/apache/commons/vfs2/FileSystemConfigBuilder.java
+++ b/core/src/main/java/org/apache/commons/vfs2/FileSystemConfigBuilder.java
@@ -86,6 +86,17 @@ protected Object getParam(FileSystemOptions opts, String name)
         return opts.getOption(getConfigClass(), name);
     }
 
+    /**
+     * Gets the system property for the given name.
+     * 
+     * @param name The name to lookup combined with the prefix.
+     * @return a system property.
+     */
+    private String getProperty(String name)
+    {
+        return System.getProperty(toPropertyKey(name));
+    }
+
     protected boolean hasParam(FileSystemOptions opts, String name)
     {
         return opts != null && opts.hasOption(getConfigClass(), name);
@@ -94,7 +105,7 @@ protected boolean hasParam(FileSystemOptions opts, String name)
     /** @since 2.0 */
     protected boolean hasObject(FileSystemOptions opts, String name)
     {
-        return hasParam(opts, name) || System.getProperties().containsKey(PREFIX + name);
+        return hasParam(opts, name) || System.getProperties().containsKey(toPropertyKey(name));
     }
 
     /** @since 2.0 */
@@ -115,7 +126,7 @@ protected Boolean getBoolean(FileSystemOptions opts, String name, Boolean defaul
         Boolean value = (Boolean) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(PREFIX + name);
+            String str = getProperty(name);
             if (str == null)
             {
                 return defaultValue;
@@ -143,7 +154,7 @@ protected Byte getByte(FileSystemOptions opts, String name, Byte defaultValue)
         Byte value = (Byte) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null)
             {
                 return defaultValue;
@@ -171,7 +182,7 @@ protected Character getCharacter(FileSystemOptions opts, String name, Character
         Character value = (Character) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null || str.length() <= 0)
             {
                 return defaultValue;
@@ -199,7 +210,7 @@ protected Double getDouble(FileSystemOptions opts, String name, Double defaultVa
         Double value = (Double) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null || str.length() <= 0)
             {
                 return defaultValue;
@@ -227,7 +238,7 @@ protected Float getFloat(FileSystemOptions opts, String name, Float defaultValue
         Float value = (Float) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null || str.length() <= 0)
             {
                 return defaultValue;
@@ -255,7 +266,7 @@ protected Integer getInteger(FileSystemOptions opts, String name, Integer defaul
         Integer value = (Integer) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null)
             {
                 return defaultValue;
@@ -283,7 +294,7 @@ protected Long getLong(FileSystemOptions opts, String name, Long defaultValue)
         Long value = (Long) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null)
             {
                 return defaultValue;
@@ -311,7 +322,7 @@ protected Short getShort(FileSystemOptions opts, String name, Short defaultValue
         Short value = (Short) getParam(opts, name);
         if (value == null)
         {
-            String str = System.getProperty(this.prefix + name);
+            String str = getProperty(name);
             if (str == null)
             {
                 return defaultValue;
@@ -333,7 +344,7 @@ protected String getString(FileSystemOptions opts, String name, String defaultVa
         String value = (String) getParam(opts, name);
         if (value == null)
         {
-            value = System.getProperty(this.prefix + name);
+            value = getProperty(name);
             if (value == null)
             {
                 return defaultValue;
@@ -343,4 +354,16 @@ protected String getString(FileSystemOptions opts, String name, String defaultVa
     }
 
     protected abstract Class<? extends FileSystem> getConfigClass();
+
+    /**
+     * Converts the given name into a System property key for this builder.
+     * 
+     * @param name a name to combine with the builder prefix.
+     * @return a System property key for this builder.
+     */
+    private String toPropertyKey(String name)
+    {
+        return this.prefix + name;
+    }
+
 }
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 32c9e5cda8..49a6408a2f 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="2.1" date="TBD" description="New features and bug fix release.">
+      <action issue="VFS-435" dev="ggregory" type="add" due-to="george scott">
+        FileSystemConfigBuilder does not use prefix for some system property lookups.
+      </action>
       <action issue="VFS-434" dev="ggregory" type="add" due-to="ggregory">
         FileSystemException should reuse IOException's chained exception.
       </action>
