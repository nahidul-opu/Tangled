From 992f1dc9b3a3b8516288278216e6bba643df6a14 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Sat, 12 May 2007 13:11:16 +0000
Subject: [PATCH] FIX: Configure fails when having httpclient in classpath
 without commons-logging (IVY-502)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/core/trunk@537410 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                              | 1 +
 src/java/org/apache/ivy/util/url/URLHandlerRegistry.java | 5 +++++
 2 files changed, 6 insertions(+)

diff --git a/CHANGES.txt b/CHANGES.txt
index b2930a503..6df96253b 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -51,6 +51,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 
 - IMPROVEMENT: Allow "main" parameters to be passed directly (instead of using -args flag) (IVY-480) (thanks to Archie Cobbs)
 
+- FIX: Configure fails when having httpclient in classpath without commons-logging (IVY-502)
 - FIX: packaging data not parsed in maven 2 pom (IVY-500) (thanks to Jeffrey Blatttman)
 - FIX: install ant task: requires default resolver in ivy settings (IVY-477)
 - FIX: Ant project reference lost from context on multiple ant calls in single thread (IVY-497) (thanks to Jaroslaw Wypychowski)
diff --git a/src/java/org/apache/ivy/util/url/URLHandlerRegistry.java b/src/java/org/apache/ivy/util/url/URLHandlerRegistry.java
index 06e306e21..434c7d181 100644
--- a/src/java/org/apache/ivy/util/url/URLHandlerRegistry.java
+++ b/src/java/org/apache/ivy/util/url/URLHandlerRegistry.java
@@ -50,6 +50,11 @@ public static URLHandler getHttp() {
         } catch (ClassNotFoundException e) {
             Message.verbose("jakarta commons httpclient not found: using jdk url handling");
             return new BasicURLHandler();
+		} catch (NoClassDefFoundError e) {
+			Message.verbose("error occurred while loading jakarta commons httpclient: " + e.getMessage());
+			Message.verbose("Using jdk url handling instead.");
+            //return new BasicURLHandler();
+			throw e;
         } catch (InstantiationException e) {
             Message.verbose("couldn't instantiate HttpClientHandler: using jdk url handling");
             return new BasicURLHandler();
