From 3f1a7c496cb915dd2f4205fe236f5b6a633dd4b8 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Mon, 25 Jul 2011 09:53:30 +0000
Subject: [PATCH] use long returning methods in Java5's Inflater/Deflater. 
 Addresses COMPRESS-129.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/branches/zip64@1150608 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/compress/archivers/zip/ZipArchiveInputStream.java | 2 +-
 .../compress/archivers/zip/ZipArchiveOutputStream.java        | 4 ++--
 .../org/apache/commons/compress/archivers/zip/ZipUtil.java    | 4 ++++
 3 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStream.java b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStream.java
index 09b008340e4..1185461d094 100644
--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStream.java
@@ -420,7 +420,7 @@ private void closeEntry() throws IOException {
 
             long inB;
             if (current.getMethod() == ZipArchiveOutputStream.DEFLATED) {
-                inB = inf.getTotalIn();
+                inB = inf.getBytesRead();
             } else {
                 inB = readBytesOfEntry;
             }
diff --git a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java
index 16daf275fa3..1371612fea5 100644
--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java
@@ -376,8 +376,8 @@ public void closeArchiveEntry() throws IOException {
                 deflate();
             }
 
-            entry.setSize(ZipUtil.adjustToLong(def.getTotalIn()));
-            entry.setCompressedSize(ZipUtil.adjustToLong(def.getTotalOut()));
+            entry.setSize(def.getBytesRead());
+            entry.setCompressedSize(def.getBytesWritten());
             entry.setCrc(realCrc);
 
             def.reset();
diff --git a/src/main/java/org/apache/commons/compress/archivers/zip/ZipUtil.java b/src/main/java/org/apache/commons/compress/archivers/zip/ZipUtil.java
index f8f769a99c7..a5e6cb2edbf 100644
--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipUtil.java
+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipUtil.java
@@ -69,6 +69,10 @@ public static byte[] toDosTime(long t) {
     /**
      * Assumes a negative integer really is a positive integer that
      * has wrapped around and re-creates the original value.
+     *
+     * <p>This methods is no longer used as of Apache Commons Compress
+     * 1.3</p>
+     *
      * @param i the value to treat as unsigned int.
      * @return the unsigned int as a long.
      */
