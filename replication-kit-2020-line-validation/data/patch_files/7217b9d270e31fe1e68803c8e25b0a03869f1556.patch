From 7217b9d270e31fe1e68803c8e25b0a03869f1556 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Wed, 9 Nov 2016 01:48:48 +0100
Subject: [PATCH] Fix NullPointerException in dependencytree with no
 dependencies (IVY-1539)

---
 doc/release-notes.html                        |  1 +
 .../org/apache/ivy/ant/IvyDependencyTree.java |  5 +++-
 .../apache/ivy/ant/IvyDependencyTreeTest.java |  7 +++++
 test/java/org/apache/ivy/ant/ivy-empty.xml    | 26 +++++++++++++++++++
 4 files changed, 38 insertions(+), 1 deletion(-)
 create mode 100644 test/java/org/apache/ivy/ant/ivy-empty.xml

diff --git a/doc/release-notes.html b/doc/release-notes.html
index 265edbaad..bb8d3e8bd 100644
--- a/doc/release-notes.html
+++ b/doc/release-notes.html
@@ -58,6 +58,7 @@ <h2>List of Changes in this Release</h2>
  
 List of changes since Ivy 2.4.0:
 
+- FIX: NullPointerException in dependencytree with no dependencies (IVY-1539)
 - FIX: checkIfChanged is not settable attribute for checkdepsupdate ant task (IVY-1549)
 - FIX: ArrayIndexOutOfBoundsException when using a p2 repository for dependencies (IVY-1504)
 - FIX: fixdeps remove transitive 'kept' dependencies
diff --git a/src/java/org/apache/ivy/ant/IvyDependencyTree.java b/src/java/org/apache/ivy/ant/IvyDependencyTree.java
index f7c9feed9..bb7c27979 100644
--- a/src/java/org/apache/ivy/ant/IvyDependencyTree.java
+++ b/src/java/org/apache/ivy/ant/IvyDependencyTree.java
@@ -49,7 +49,10 @@ public void doExecute() throws BuildException {
             IvyNode dependency = (IvyNode) iterator.next();
             populateDependencyTree(dependency, mrid, report);
         }
-        printDependencies((List) dependencies.get(mrid), 0);
+        List dependencyList = (List) dependencies.get(mrid);
+        if (dependencyList != null) {
+            printDependencies(dependencyList, 0);
+        }
     }
 
     private void printDependencies(List/* <IvyNode> */dependencyList, int indent) {
diff --git a/test/java/org/apache/ivy/ant/IvyDependencyTreeTest.java b/test/java/org/apache/ivy/ant/IvyDependencyTreeTest.java
index 0e85b2b09..adfe37c3f 100644
--- a/test/java/org/apache/ivy/ant/IvyDependencyTreeTest.java
+++ b/test/java/org/apache/ivy/ant/IvyDependencyTreeTest.java
@@ -51,6 +51,13 @@ public void testSimple() throws Exception {
         assertLogContaining("\\- org1#mod1.2;2.0");
     }
 
+    public void testEmpty() throws Exception {
+        dependencyTree.setFile(new File("test/java/org/apache/ivy/ant/ivy-empty.xml"));
+        dependencyTree.execute();
+        assertLogContaining("Dependency tree for apache-resolve-empty");
+        assertLogNotContaining("\\-");
+    }
+
     public void testWithResolveId() throws Exception {
         IvyResolve resolve = new IvyResolve();
         resolve.setProject(project);
diff --git a/test/java/org/apache/ivy/ant/ivy-empty.xml b/test/java/org/apache/ivy/ant/ivy-empty.xml
new file mode 100644
index 000000000..48c8759bd
--- /dev/null
+++ b/test/java/org/apache/ivy/ant/ivy-empty.xml
@@ -0,0 +1,26 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="apache"
+	       module="resolve-empty"
+	       revision="1.0"
+	       status="release"
+	/>
+	<dependencies />
+</ivy-module>
