From 94844e1f186b903cd24dfec334b2ae3ed25033a2 Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Wed, 28 Mar 2012 09:33:00 +0000
Subject: [PATCH] [SANTUARIO-306] - KeySelectors loop

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/1.4.x-fixes@1306226 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG.txt                                         | 1 +
 src_unitTests/javax/xml/crypto/test/KeySelectors.java | 4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG.txt b/CHANGELOG.txt
index 2d823a8f59..12603b0cbd 100644
--- a/CHANGELOG.txt
+++ b/CHANGELOG.txt
@@ -1,6 +1,7 @@
 Changelog for "Apache xml-security" <http://santuario.apache.org/>
 
 New in v.1.4.7-SNAPSHOT:
+    Fixed SANTUARIO-306 - KeySelectors loop
     Fixed SANTUARIO-301 - Missing KeyInfo element when encrypting multiple elements.
     Fixed SANTUARIO-299: StringIndexOutOfBoundsException is thrown during reference verification (if URI = "#")
     Fixed SANTUARIO-295: XMLDSig XPathFilter2Transform bug involving intersect filter
diff --git a/src_unitTests/javax/xml/crypto/test/KeySelectors.java b/src_unitTests/javax/xml/crypto/test/KeySelectors.java
index d493937f92..411b0cb886 100644
--- a/src_unitTests/javax/xml/crypto/test/KeySelectors.java
+++ b/src_unitTests/javax/xml/crypto/test/KeySelectors.java
@@ -100,7 +100,7 @@ public KeySelectorResult select(KeyInfo keyInfo,
 		    Object[] entries = xd.getContent().toArray();
 		    X509CRL crl = null;
 		    // Looking for CRL before finding certificates
-		    for (int i = 0; (i<entries.length&&crl != null); i++) {
+		    for (int i = 0; (i<entries.length&&crl == null); i++) {
 			if (entries[i] instanceof X509CRL) {
 			    crl = (X509CRL) entries[i];
 			}
@@ -293,7 +293,7 @@ public KeySelectorResult select(KeyInfo keyInfo,
 			}
 			return new SimpleKSResult(pk);
 		    } else if (xmlStructure instanceof RetrievalMethod) {
-			// Lookup the public key using the retrievel method.
+			// Lookup the public key using the retrieval method.
 			// NOTE: only X509Certificate type is supported.
 			RetrievalMethod rm = (RetrievalMethod) xmlStructure;
 			String type = rm.getType();
