From 8554a2c34a373fb94334c517d56a651fb331664d Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Mon, 25 Feb 2008 08:36:19 +0000
Subject: [PATCH] merge FIX for IVY-744 from trunk (r 630759)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/branches/2.0.0-beta2@630760 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                              | 4 +++-
 RELEASE_NOTES                                            | 2 ++
 .../plugins/parser/m2/PomModuleDescriptorBuilder.java    | 9 ++++-----
 3 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 620045371..2399b2483 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -21,7 +21,8 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 	Mirko Bulovic
 	Kristian Cibulskis
 	Andrea Bernardo Ciddio
-	Benjamin Francisoud
+	Danno Ferrin
+	Benjamin Francisoud	
 	Jacob Grydholt Jensen
 	Scott Goldstein
 	Pierre Hägnestrand
@@ -103,6 +104,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - FIX: Inherit depedencies defined in parent pom (IVY-683)
 - FIX: Incorrect ivy from maven pom generation when classifier are user (IVY-714) (thanks to Ruslan Shevchenko)
 - FIX: m2 incompatibility - IVY does not recognize property section(IVY-637)
+- FIX: Maven test scope not mapped to test conf (IVY-744) (thanks to Danno Ferrin)
 
 - TASK: Remove cache attribute on Ant tasks (IVY-685)
 
diff --git a/RELEASE_NOTES b/RELEASE_NOTES
index fc2caf8a3..bbd4347d4 100644
--- a/RELEASE_NOTES
+++ b/RELEASE_NOTES
@@ -160,6 +160,7 @@ long, but Ivy couldn't be what it is without you!
     Andrea Bernardo Ciddio
     Mikkel Bjerg
     Mirko Bulovic
+    Danno Ferrin
     Benjamin Francisoud
 	Nicolas Lalevée
     Markus M. May
@@ -216,6 +217,7 @@ List of changes since Ivy 2.0.0-beta1:
 - FIX: Inherit depedencies defined in parent pom (IVY-683)
 - FIX: Incorrect ivy from maven pom generation when classifier are user (IVY-714) (thanks to Ruslan Shevchenko)
 - FIX: m2 incompatibility - IVY does not recognize property section(IVY-637)
+- FIX: Maven test scope not mapped to test conf (IVY-744) (thanks to Danno Ferrin)
 
 - TASK: Remove cache attribute on Ant tasks (IVY-685)
 
diff --git a/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorBuilder.java b/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorBuilder.java
index 5fa9ca217..860fde296 100644
--- a/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorBuilder.java
+++ b/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorBuilder.java
@@ -146,15 +146,14 @@ public void addMappingConfs(DefaultDependencyDescriptor dd, boolean isOptional)
         });
         MAVEN2_CONF_MAPPING.put("test", new ConfMapper() {
             public void addMappingConfs(DefaultDependencyDescriptor dd, boolean isOptional) {
-                //optional/test doesn't make sense
-                dd.addDependencyConfiguration("runtime", "compile(*)");
-                dd.addDependencyConfiguration("runtime", "runtime(*)");
-                dd.addDependencyConfiguration("runtime", "master(*)");
+                //optional doesn't make sense in the test scope
+                dd.addDependencyConfiguration("test", "runtime(*)");
+                dd.addDependencyConfiguration("test", "master(*)");
             }
         });
         MAVEN2_CONF_MAPPING.put("system", new ConfMapper() {
             public void addMappingConfs(DefaultDependencyDescriptor dd, boolean isOptional) {
-                //optional/system doesn't make sense
+                //optional doesn't make sense in the system scope
                 dd.addDependencyConfiguration("system", "master(*)");
             }
         });
