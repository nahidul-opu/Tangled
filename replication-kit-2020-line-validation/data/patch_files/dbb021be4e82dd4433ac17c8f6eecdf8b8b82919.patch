From dbb021be4e82dd4433ac17c8f6eecdf8b8b82919 Mon Sep 17 00:00:00 2001
From: Maja Kabiljo <majakabiljo@fb.com>
Date: Fri, 14 Feb 2014 09:17:17 -0800
Subject: [PATCH] GIRAPH-853: Fix concurrency issue in GiraphMetrics
 (majakabiljo)

---
 CHANGELOG                                                     | 2 ++
 .../main/java/org/apache/giraph/metrics/GiraphMetrics.java    | 4 ++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG b/CHANGELOG
index 1c8729f2c..c01fa83fb 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,8 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-853: Fix concurrency issue in GiraphMetrics (majakabiljo)
+
   GIRAPH-840: Upgrade to netty 4 (pavanka via majakabiljo)
 
   GIRAPH-816: ByteArrayPartition not combining vertex edges (cmuchins via majakabiljo)
diff --git a/giraph-core/src/main/java/org/apache/giraph/metrics/GiraphMetrics.java b/giraph-core/src/main/java/org/apache/giraph/metrics/GiraphMetrics.java
index 10a2c1878..54d960461 100644
--- a/giraph-core/src/main/java/org/apache/giraph/metrics/GiraphMetrics.java
+++ b/giraph-core/src/main/java/org/apache/giraph/metrics/GiraphMetrics.java
@@ -119,7 +119,7 @@ public SuperstepMetricsRegistry perSuperstep() {
    *
    * @param observer SuperstepObserver to watch
    */
-  public void addSuperstepResetObserver(
+  public synchronized void addSuperstepResetObserver(
       ResetSuperstepMetricsObserver observer) {
     observers.add(observer);
   }
@@ -129,7 +129,7 @@ public void addSuperstepResetObserver(
    *
    * @param superstep long number of superstep
    */
-  public void resetSuperstepMetrics(long superstep) {
+  public synchronized void resetSuperstepMetrics(long superstep) {
     perSuperstep.setSuperstep(superstep);
     for (ResetSuperstepMetricsObserver observer : observers) {
       observer.newSuperstep(perSuperstep);
