From 62bf3b153b00c8d924edfee947c98e827fedf452 Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Tue, 15 Aug 2006 20:29:17 +0000
Subject: [PATCH] Updated DataConfiguration.getDateArray() to make use of the
 passed in format argument; fixes CONFIGURATION-220

git-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@431694 13f79535-47bb-0310-9956-ffa450edef68
---
 RELEASE-NOTES.txt                                  |  2 ++
 .../commons/configuration/DataConfiguration.java   |  2 +-
 .../configuration/TestDataConfiguration.java       | 14 ++++++++++++++
 xdocs/changes.xml                                  |  4 ++++
 4 files changed, 21 insertions(+), 1 deletion(-)

diff --git a/RELEASE-NOTES.txt b/RELEASE-NOTES.txt
index 9ff41bcb09..ccb13c5aab 100644
--- a/RELEASE-NOTES.txt
+++ b/RELEASE-NOTES.txt
@@ -25,6 +25,8 @@ A complete list of changes can be found below.
 CHANGES
 =======
 
+- DataConfiguration.getDateArray() used to ignore the format argument.
+  This was fixed. Fixes CONFIGURATION-220.
 - The dependency to servletapi was updated from version 2.3 to version 2.4, but
   version 2.3 will still work. Fixes CONFIGURATION-217.
 - A new class PropertiesConfigurationLayout was introduced whose task is to
diff --git a/src/java/org/apache/commons/configuration/DataConfiguration.java b/src/java/org/apache/commons/configuration/DataConfiguration.java
index 5bdf695903..cb3e08cdf5 100644
--- a/src/java/org/apache/commons/configuration/DataConfiguration.java
+++ b/src/java/org/apache/commons/configuration/DataConfiguration.java
@@ -1825,7 +1825,7 @@ public Date[] getDateArray(String key, Date[] defaultValue)
      */
     public Date[] getDateArray(String key, Date[] defaultValue, String format)
     {
-        List list = getDateList(key);
+        List list = getDateList(key, format);
         if (list.isEmpty())
         {
             return defaultValue;
diff --git a/src/test/org/apache/commons/configuration/TestDataConfiguration.java b/src/test/org/apache/commons/configuration/TestDataConfiguration.java
index 1488c8daf3..6cc611ad0f 100644
--- a/src/test/org/apache/commons/configuration/TestDataConfiguration.java
+++ b/src/test/org/apache/commons/configuration/TestDataConfiguration.java
@@ -1320,6 +1320,20 @@ public void testGetDateArray() throws Exception
         ArrayAssert.assertEquals(new Date[] { }, conf.getDateArray("empty"));
     }
 
+    public void testGetDateArrayWithFormat() throws Exception
+    {
+        DateFormat format = new SimpleDateFormat("MM/dd/yyyy");
+        Date date1 = format.parse("01/01/2004");
+        Date date2 = format.parse("12/31/2004");
+        Date[] expected = new Date[]
+        { date1, date2 };
+
+        conf.addProperty("date.format", "01/01/2004");
+        conf.addProperty("date.format", "12/31/2004");
+        ArrayAssert.assertEquals("Wrong dates with format", expected, conf
+                .getDateArray("date.format", "MM/dd/yyyy"));
+    }
+
     public void testGetDateList() throws Exception
     {
         DateFormat format = new SimpleDateFormat("yyyy-MM-dd");
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index 67362587db..6c346a0107 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -23,6 +23,10 @@
   <body>
 
     <release version="1.3-rc2" date="in SVN">
+      <action dev="oheger" type="update" issue="CONFIGURATION-220">
+        DataConfiguration.getDateArray() used to ignore the format argument.
+        This was fixed.
+      </action>
       <action dev="oheger" type="update" issue="CONFIGURATION-219">
         PropertiesConfiguration now defines its own clone() method to handle
         the associated PropertiesConfigurationLayout object correctly.
