From 66d3c8ee3a43653f15dc47f75cd15da2cce3c2f8 Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Sat, 23 Jan 2010 16:40:23 +0000
Subject: [PATCH] [CONFIGURATION-403] Ported fix for XMLConfiguration.load() to
 XMLConfigurationSource.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/branches/configuration2_experimental@902439 13f79535-47bb-0310-9956-ffa450edef68
---
 .../base/impl/XMLConfigurationSource.java           |  2 +-
 .../base/impl/TestXMLConfigurationSource.java       | 13 +++++++++++++
 2 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/configuration2/base/impl/XMLConfigurationSource.java b/src/main/java/org/apache/commons/configuration2/base/impl/XMLConfigurationSource.java
index 42bb70a62e..ce815ed328 100644
--- a/src/main/java/org/apache/commons/configuration2/base/impl/XMLConfigurationSource.java
+++ b/src/main/java/org/apache/commons/configuration2/base/impl/XMLConfigurationSource.java
@@ -766,7 +766,7 @@ else if (w3cNode instanceof Text)
         {
             text = text.trim();
         }
-        if (text.length() > 0 || !hasChildren(node))
+        if (text.length() > 0 || (!hasChildren(node) && node != getRootNode()))
         {
             node.setValue(text);
         }
diff --git a/src/test/java/org/apache/commons/configuration2/base/impl/TestXMLConfigurationSource.java b/src/test/java/org/apache/commons/configuration2/base/impl/TestXMLConfigurationSource.java
index 0d0b461320..788415d5d0 100644
--- a/src/test/java/org/apache/commons/configuration2/base/impl/TestXMLConfigurationSource.java
+++ b/src/test/java/org/apache/commons/configuration2/base/impl/TestXMLConfigurationSource.java
@@ -1124,4 +1124,17 @@ public void testInitCopyNull()
         conf = new ConfigurationImpl<ConfigurationNode>(source);
         assertTrue("Not empty", conf.isEmpty());
     }
+
+    /**
+     * Tests whether an empty configuration that was saved and reloaded is still
+     * considered empty.
+     */
+    @Test
+    public void testIsEmptyAfterReload() throws ConfigurationException
+    {
+        source.clear();
+        assertTrue("Not empty", conf.isEmpty());
+        Configuration<ConfigurationNode> conf2 = reload();
+        assertTrue("Not empty after reload", conf2.isEmpty());
+    }
 }
