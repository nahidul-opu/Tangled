From c0485f0cf1b45168f34d199b088d24da6ab907e0 Mon Sep 17 00:00:00 2001
From: Mark Thomas <markt@apache.org>
Date: Tue, 27 Oct 2009 13:28:48 +0000
Subject: [PATCH] Complete the fix for DBCP-265 I noticed this gap when writing
 the Javadoc for DelegatingDatabaseMetaData Test case to follow

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/dbcp/trunk@830170 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/commons/dbcp/DelegatingConnection.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/java/org/apache/commons/dbcp/DelegatingConnection.java b/src/java/org/apache/commons/dbcp/DelegatingConnection.java
index 1ef40a9f91..cd41bd5008 100644
--- a/src/java/org/apache/commons/dbcp/DelegatingConnection.java
+++ b/src/java/org/apache/commons/dbcp/DelegatingConnection.java
@@ -33,6 +33,7 @@
 import java.sql.ClientInfoStatus;
 import java.sql.Clob;
 import java.sql.NClob;
+import java.sql.ResultSet;
 import java.sql.SQLClientInfoException;
 import java.sql.SQLXML;
 import java.sql.Struct;
@@ -419,6 +420,10 @@ protected void passivate() throws SQLException {
                     Object trace = traceIter.next();
                     if (trace instanceof Statement) {
                         ((Statement) trace).close();
+                    } else if (trace instanceof ResultSet) {
+                        // DBCP-265: Need to close the result sets that are
+                        // generated via DatabaseMetaData
+                        ((ResultSet) trace).close();
                     }
                 }
                 clearTrace();
