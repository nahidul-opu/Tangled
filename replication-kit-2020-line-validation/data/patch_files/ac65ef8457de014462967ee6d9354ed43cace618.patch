From ac65ef8457de014462967ee6d9354ed43cace618 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Wed, 12 Dec 2012 12:25:05 +0000
Subject: [PATCH] NET-492 FTPClient.printWorkingDirectory() incorrectly parses
 certain valid PWD command results

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1420638 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/commons/net/ftp/FTPClient.java   | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClient.java b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
index 11a5793e1..a29018a23 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClient.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
@@ -498,8 +498,16 @@ private void __initDefaults()
     private static String __parsePathname(String reply)
     {
         String param = reply.substring(REPLY_CODE_LEN + 1);
-        if (param.startsWith("\"") && param.endsWith("\"")) {
-            return param.substring(1, param.length()-1).replace("\"\"", "\"");            
+        if (param.startsWith("\"")) {
+            int end;
+            if (param.endsWith("\"")) {
+                end = param.length()-1;
+            } else { // perhaps there's a trailing comment
+                end=param.lastIndexOf("\" "); // find start of comment (assume it does not contain ")
+            }
+            if (end != -1) { // It was a match
+                return param.substring(1, end).replace("\"\"", "\"");            
+            }
         }
         // malformed reply, return all after reply code and space
         return param;
