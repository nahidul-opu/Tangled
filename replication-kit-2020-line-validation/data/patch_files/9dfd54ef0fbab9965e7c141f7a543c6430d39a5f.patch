From 9dfd54ef0fbab9965e7c141f7a543c6430d39a5f Mon Sep 17 00:00:00 2001
From: Luc Maisonobe <luc@apache.org>
Date: Sun, 5 Jun 2011 15:59:26 +0000
Subject: [PATCH] Fixed tricube function implementation in Loess interpolation.

JIRA: MATH-504

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/math/trunk@1132439 13f79535-47bb-0310-9956-ffa450edef68
---
 .../math/analysis/interpolation/LoessInterpolator.java    | 8 ++++++--
 src/site/xdoc/changes.xml                                 | 3 +++
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/commons/math/analysis/interpolation/LoessInterpolator.java b/src/main/java/org/apache/commons/math/analysis/interpolation/LoessInterpolator.java
index b98e995691..384102190e 100644
--- a/src/main/java/org/apache/commons/math/analysis/interpolation/LoessInterpolator.java
+++ b/src/main/java/org/apache/commons/math/analysis/interpolation/LoessInterpolator.java
@@ -427,10 +427,14 @@ private static int nextNonzero(final double[] weights, final int i) {
      * weight function
      *
      * @param x Argument.
-     * @return <code>(1 - |x|<sup>3</sup>)<sup>3</sup></code>.
+     * @return <code>(1 - |x|<sup>3</sup>)<sup>3</sup></code> for |x| &lt; 1, 0 otherwise.
      */
     private static double tricube(final double x) {
-        final double tmp = 1 - x * x * x;
+        final double absX = FastMath.abs(x);
+        if (absX >= 1.0) {
+            return 0.0;
+        }
+        final double tmp = 1 - absX * absX * absX;
         return tmp * tmp * tmp;
     }
 
diff --git a/src/site/xdoc/changes.xml b/src/site/xdoc/changes.xml
index 1ee5a98a74..102c446f44 100644
--- a/src/site/xdoc/changes.xml
+++ b/src/site/xdoc/changes.xml
@@ -52,6 +52,9 @@ The <action> type attribute can be add,update,fix,remove.
     If the output is not quite correct, check for invisible trailing spaces!
      -->
     <release version="3.0" date="TBD" description="TBD">
+      <action dev="luc" type="fix" issue="MATH-504" due-to="X. B.">
+        Fixed tricube function implementation in Loess interpolator.
+      </action>
       <action dev="luc" type="fix" issue="MATH-568" due-to="Christoph M. Friedrich">
         Fixed documentation of statistics examples.
       </action>
