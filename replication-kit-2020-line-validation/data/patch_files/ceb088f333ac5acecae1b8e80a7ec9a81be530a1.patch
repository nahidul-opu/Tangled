From ceb088f333ac5acecae1b8e80a7ec9a81be530a1 Mon Sep 17 00:00:00 2001
From: Simone Tripodi <simonetripodi@apache.org>
Date: Wed, 20 Jun 2012 12:21:40 +0000
Subject: [PATCH] [DIGESTER-165] BinderClassLoader does not override
 getResource - patch provided by Dirk Schaube

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/digester/trunk@1352055 13f79535-47bb-0310-9956-ffa450edef68
---
 .../digester3/binder/BinderClassLoader.java   |  7 ++----
 .../binder/BinderClassLoaderTestCase.java     | 24 +++++++++++++++++++
 2 files changed, 26 insertions(+), 5 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/digester3/binder/BinderClassLoader.java b/core/src/main/java/org/apache/commons/digester3/binder/BinderClassLoader.java
index 6750cf85f..4f13550f5 100644
--- a/core/src/main/java/org/apache/commons/digester3/binder/BinderClassLoader.java
+++ b/core/src/main/java/org/apache/commons/digester3/binder/BinderClassLoader.java
@@ -65,17 +65,14 @@ public BinderClassLoader run()
         return action.run();
     }
 
-    private final ClassLoader adaptedClassLoader;
-
     private BinderClassLoader( ClassLoader adaptedClassLoader )
     {
         super( adaptedClassLoader );
-        this.adaptedClassLoader = adaptedClassLoader;
     }
 
     public ClassLoader getAdaptedClassLoader()
     {
-        return adaptedClassLoader;
+        return getParent();
     }
 
     /**
@@ -89,7 +86,7 @@ protected synchronized Class<?> loadClass( String name, boolean resolve )
         {
             return PRIMITIVE_TYPES.get( name );
         }
-        return adaptedClassLoader.loadClass( name );
+        return getParent().loadClass( name );
     }
 
 }
diff --git a/core/src/test/java/org/apache/commons/digester3/binder/BinderClassLoaderTestCase.java b/core/src/test/java/org/apache/commons/digester3/binder/BinderClassLoaderTestCase.java
index 602305a3a..e2f2a1ab7 100644
--- a/core/src/test/java/org/apache/commons/digester3/binder/BinderClassLoaderTestCase.java
+++ b/core/src/test/java/org/apache/commons/digester3/binder/BinderClassLoaderTestCase.java
@@ -21,6 +21,9 @@
 
 import static org.apache.commons.digester3.binder.BinderClassLoader.createBinderClassLoader;
 import static org.junit.Assert.assertSame;
+import static org.junit.Assert.assertNotNull;
+
+import java.net.URL;
 
 import org.junit.Test;
 
@@ -95,4 +98,25 @@ private void typeFound( String name, Class<?> expected )
         assertSame( expected, actual );
     }
 
+    @Test
+    public void testGetResource()
+    {
+        ClassLoader clToAdapt = new ClassLoader()
+        {
+
+            @Override
+            public URL getResource( String name )
+            {
+                if ( "xxx".equals( name ) )
+                {
+                    return super.getResource( "org/apache/commons/digester3/binder/BinderClassLoaderTestCase.class" );
+                }
+                return super.getResource( name );
+            }
+
+        };
+        ClassLoader binderCl = createBinderClassLoader( clToAdapt );
+        assertNotNull( binderCl.getResource( "xxx" ) );
+    }
+
 }
