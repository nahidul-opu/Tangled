From 31232d340b3570c74a44fe7f3bf454ee51d2cffb Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Tue, 3 Jul 2012 20:38:40 +0000
Subject: [PATCH] [VFS-426] HTTP URL query string not part of cache key

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1356923 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs2/provider/AbstractFileName.java    | 2 +-
 .../vfs2/provider/http/test/HttpFilesCacheTestCase.java       | 4 ++--
 src/changes/changes.xml                                       | 3 +++
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileName.java b/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileName.java
index 15b2902405..b29a807b45 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileName.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileName.java
@@ -255,7 +255,7 @@ private String getKey()
     {
         if (key == null)
         {
-            key = createURI(true, true);
+            key = getURI();
         }
         return key;
     }
diff --git a/core/src/test/java/org/apache/commons/vfs2/provider/http/test/HttpFilesCacheTestCase.java b/core/src/test/java/org/apache/commons/vfs2/provider/http/test/HttpFilesCacheTestCase.java
index fe759f5c27..bdd2ba3996 100644
--- a/core/src/test/java/org/apache/commons/vfs2/provider/http/test/HttpFilesCacheTestCase.java
+++ b/core/src/test/java/org/apache/commons/vfs2/provider/http/test/HttpFilesCacheTestCase.java
@@ -50,9 +50,9 @@ public void testQueryStringUrls() throws FileSystemException
         Assert.assertEquals(noQueryStringUrl, noQueryFile.getURL().toExternalForm());
 
         final FileObject queryFile = fileSystemManager.resolveFile(queryStringUrl);
-        // Assert.assertEquals(queryStringUrl, queryFile.getURL().toExternalForm()); // fails for VFS-426
+        Assert.assertEquals(queryStringUrl, queryFile.getURL().toExternalForm()); // failed for VFS-426
 
         final FileObject queryFile2 = fileSystemManager.resolveFile(queryStringUrl2);
-        // Assert.assertEquals(queryStringUrl2, queryFile2.getURL().toExternalForm()); // fails for VFS-426
+        Assert.assertEquals(queryStringUrl2, queryFile2.getURL().toExternalForm()); // failed for VFS-426
     }
 }
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 1e881e6f80..e5dac0f2fb 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="2.1" date="TBD" description="New features and bug fix release.">
+      <action issue="VFS-426" dev="ggregory" type="add" due-to="daniel.bergholm">
+        HTTP URL query string not part of cache key.
+      </action>
       <action issue="VFS-425" dev="ggregory" type="add" due-to="ggregory">
         Add API FileObject.isExecutable().
       </action>
