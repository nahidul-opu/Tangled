From 94a668c31c96167b86bdd722ebb62eebd6ad1108 Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Fri, 16 Mar 2012 19:55:04 +0000
Subject: [PATCH] [CONFIGURATION-477] PropertyListConfiguration now supports
 C-style comments.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1301722 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml               |  4 ++++
 src/main/javacc/PropertyListParser.jj | 10 ++++++++++
 src/test/resources/test.plist         | 17 +++++++++++++++++
 3 files changed, 31 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 150d0e3261..0eb65d788a 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -31,6 +31,10 @@
         Variable substitution in configuration sources declared in a definition
         file for DefaultConfigurationBuilder now works across multiple sources.
       </action>
+      <action dev="oheger" type="fix" issue="CONFIGURATION-477">
+        PropertyListConfiguration now can deal with C-style comments in plist
+        configuration files. Both block and single-line comments are supported.
+      </action>
     </release>
 
     <release version="1.8" date="2012-02-04"
diff --git a/src/main/javacc/PropertyListParser.jj b/src/main/javacc/PropertyListParser.jj
index 88215510e8..eaf1567570 100644
--- a/src/main/javacc/PropertyListParser.jj
+++ b/src/main/javacc/PropertyListParser.jj
@@ -115,6 +115,16 @@ PARSER_END(PropertyListParser)
 
 SKIP : { " " | "\t" | "\n" | "\r" }
 
+// Handle comments
+MORE : { "/*": IN_COMMENT }
+< IN_COMMENT > MORE : { <  ~[] > }
+< IN_COMMENT > SKIP : { "*/": DEFAULT } 
+
+MORE : { "//": IN_SINGLE_LINE_COMMENT }
+< IN_SINGLE_LINE_COMMENT > SPECIAL_TOKEN : {
+    < SINGLE_LINE_COMMENT: "\n"|"\r"|"\r\n" > : DEFAULT }
+< IN_SINGLE_LINE_COMMENT > MORE : { <  ~[] > } 
+
 TOKEN : { <ARRAY_BEGIN     : "(" > }
 TOKEN : { <ARRAY_END       : ")" > }
 TOKEN : { <ARRAY_SEPARATOR : "," > }
diff --git a/src/test/resources/test.plist b/src/test/resources/test.plist
index b60bfd0d85..60a2a76039 100644
--- a/src/test/resources/test.plist
+++ b/src/test/resources/test.plist
@@ -1,9 +1,26 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
 {
     simple-string = string1;
     quoted-string = "string2";
     quoted-string2 = "this is a string";
     "complex-string" = "this is a \"complex\" string {(=,;)}";
 
+    // This is a test single-line comment
     array = ( "value1", "value2", "value3" );
 
     empty-array = ();
