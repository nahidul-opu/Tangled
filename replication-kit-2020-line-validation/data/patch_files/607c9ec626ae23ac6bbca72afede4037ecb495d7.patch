From 607c9ec626ae23ac6bbca72afede4037ecb495d7 Mon Sep 17 00:00:00 2001
From: Sebastien Brisard <celestin@apache.org>
Date: Thu, 12 Jul 2012 13:31:45 +0000
Subject: [PATCH] MATH-812: fixed a bug in RealVector.outerProduct(RealVector).
 Now loops through *all* entries of the vectors.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/math/trunk@1360668 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/math3/linear/RealVector.java      | 23 +++++++------------
 1 file changed, 8 insertions(+), 15 deletions(-)

diff --git a/src/main/java/org/apache/commons/math3/linear/RealVector.java b/src/main/java/org/apache/commons/math3/linear/RealVector.java
index 89611c34c6..f05ea4d773 100644
--- a/src/main/java/org/apache/commons/math3/linear/RealVector.java
+++ b/src/main/java/org/apache/commons/math3/linear/RealVector.java
@@ -642,27 +642,20 @@ public RealVector mapDivideToSelf(double d){
      * @return the matrix outer product between this instance and {@code v}.
      */
     public RealMatrix outerProduct(RealVector v) {
-        RealMatrix product;
+        final int m = this.getDimension();
+        final int n = v.getDimension();
+        final RealMatrix product;
         if (v instanceof SparseRealVector || this instanceof SparseRealVector) {
-            product = new OpenMapRealMatrix(this.getDimension(),
-                                            v.getDimension());
+            product = new OpenMapRealMatrix(m, n);
         } else {
-            product = new Array2DRowRealMatrix(this.getDimension(),
-                                               v.getDimension());
+            product = new Array2DRowRealMatrix(m, n);
         }
-        Iterator<Entry> thisIt = sparseIterator();
-        while (thisIt.hasNext()) {
-            final Entry thisE = thisIt.next();
-            Iterator<Entry> otherIt = v.sparseIterator();
-            while (otherIt.hasNext()) {
-                final Entry otherE = otherIt.next();
-                product.setEntry(thisE.getIndex(), otherE.getIndex(),
-                                 thisE.getValue() * otherE.getValue());
+        for (int i = 0; i < m; i++) {
+            for (int j = 0; j < n; j++) {
+                product.setEntry(i, j, this.getEntry(i) * v.getEntry(j));
             }
         }
-
         return product;
-
     }
 
     /**
