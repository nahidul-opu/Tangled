From d0eb1d1dd1d9aed27c433d78a76962340fcbfc1d Mon Sep 17 00:00:00 2001
From: Nicolas Lalevee <hibou@apache.org>
Date: Wed, 15 Aug 2012 11:33:32 +0000
Subject: [PATCH] IVY-1344: fix setting the branch attribute (Thanks to Ales
 Nosek)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@1373340 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                      | 2 ++
 src/java/org/apache/ivy/ant/IvyBuildNumber.java  | 2 +-
 src/java/org/apache/ivy/ant/IvyFindRevision.java | 2 +-
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 2e2169a40..edd670902 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -83,6 +83,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 	Stephen Nesbitt
 	Joshua Nichols
 	Bernard Niset
+	Ales Nosek
 	David Maplesden
 	Glen Marchesani
 	Phil Messenger
@@ -134,6 +135,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - FIX: ivy.xml extends feature complains about Windows filesystem path (IVY-1359) (thanks to Mitch Gitman and Jean-Louis Boudart)
 - FIX: buildlist task chokes on absolute path to parent Ivy module (IVY-1364) (thanks to Mitch Gitman and Jean-Louis Boudart)
 - FIX: The ignore circular dependency strategy is clobbering the warn strategy (IVY-1353) (Thanks to Carl Quinn)
+- FIX: Buildnumber and IvyFindRevision Ant tasks should honour defaultBranch setting (IVY-1344) (Thanks to Ales Nosek)
 
 - NEW: Support Conditional Setting of a Property (IVY-1367)
 
diff --git a/src/java/org/apache/ivy/ant/IvyBuildNumber.java b/src/java/org/apache/ivy/ant/IvyBuildNumber.java
index ac1324d5e..9928e161f 100644
--- a/src/java/org/apache/ivy/ant/IvyBuildNumber.java
+++ b/src/java/org/apache/ivy/ant/IvyBuildNumber.java
@@ -147,7 +147,7 @@ public void doExecute() throws BuildException {
         Ivy ivy = getIvyInstance();
         IvySettings settings = ivy.getSettings();
         if (branch == null) {
-            settings.getDefaultBranch(new ModuleId(organisation, module));
+            branch = settings.getDefaultBranch(new ModuleId(organisation, module));
         }
         if (revision == null || revision.length() == 0) {
             revision = "latest.integration";
diff --git a/src/java/org/apache/ivy/ant/IvyFindRevision.java b/src/java/org/apache/ivy/ant/IvyFindRevision.java
index 965df5f3f..32171cf66 100644
--- a/src/java/org/apache/ivy/ant/IvyFindRevision.java
+++ b/src/java/org/apache/ivy/ant/IvyFindRevision.java
@@ -93,7 +93,7 @@ public void doExecute() throws BuildException {
         Ivy ivy = getIvyInstance();
         IvySettings settings = ivy.getSettings();
         if (branch == null) {
-            settings.getDefaultBranch(new ModuleId(organisation, module));
+            branch = settings.getDefaultBranch(new ModuleId(organisation, module));
         }
         ResolvedModuleRevision rmr = ivy.findModule(ModuleRevisionId.newInstance(organisation,
             module, branch, revision));
