From 1abfc887d786a9c765a0afd8ba379ee41af72247 Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Wed, 16 Jan 2013 10:36:32 +0000
Subject: [PATCH] [SANTUARIO-351] - Removing ThreadLocals as per the first
 commit

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/1.5.x-fixes@1433887 13f79535-47bb-0310-9956-ffa450edef68
---
 .../xml/security/utils/UnsyncBufferedOutputStream.java    | 8 +-------
 .../xml/security/utils/UnsyncByteArrayOutputStream.java   | 8 +-------
 2 files changed, 2 insertions(+), 14 deletions(-)

diff --git a/src/main/java/org/apache/xml/security/utils/UnsyncBufferedOutputStream.java b/src/main/java/org/apache/xml/security/utils/UnsyncBufferedOutputStream.java
index aa9cd6369d..b27293a0a6 100644
--- a/src/main/java/org/apache/xml/security/utils/UnsyncBufferedOutputStream.java
+++ b/src/main/java/org/apache/xml/security/utils/UnsyncBufferedOutputStream.java
@@ -27,12 +27,6 @@
  */
 public class UnsyncBufferedOutputStream extends OutputStream {
     static final int size = 8*1024;
-    private static ThreadLocal<byte[]> bufCache = new ThreadLocal<byte[]>() {
-        @Override
-        protected synchronized byte[] initialValue() {
-            return new byte[size];
-        }
-    };
     
     private int pointer = 0;
     private final OutputStream out;
@@ -44,7 +38,7 @@ protected synchronized byte[] initialValue() {
      * @param out the outputstream to buffer
      */
     public UnsyncBufferedOutputStream(OutputStream out) {
-        buf = (byte[])bufCache.get();
+        buf = new byte[size];
         this.out = out;
     }
 
diff --git a/src/main/java/org/apache/xml/security/utils/UnsyncByteArrayOutputStream.java b/src/main/java/org/apache/xml/security/utils/UnsyncByteArrayOutputStream.java
index 2467b577b2..e5eb7d84b6 100644
--- a/src/main/java/org/apache/xml/security/utils/UnsyncByteArrayOutputStream.java
+++ b/src/main/java/org/apache/xml/security/utils/UnsyncByteArrayOutputStream.java
@@ -28,19 +28,13 @@
 public class UnsyncByteArrayOutputStream extends OutputStream  {	
 
     private static final int INITIAL_SIZE = 8192;
-    private static ThreadLocal<byte[]> bufCache = new ThreadLocal<byte[]>() {
-        @Override
-        protected synchronized byte[] initialValue() {
-            return new byte[INITIAL_SIZE];
-        }
-    };
 
     private byte[] buf;
     private int size = INITIAL_SIZE;
     private int pos = 0;
 
     public UnsyncByteArrayOutputStream() {
-        buf = (byte[])bufCache.get();
+        buf = new byte[INITIAL_SIZE];
     }
 
     public void write(byte[] arg0) {
