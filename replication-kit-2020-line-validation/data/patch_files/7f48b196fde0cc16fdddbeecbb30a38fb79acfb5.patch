From 7f48b196fde0cc16fdddbeecbb30a38fb79acfb5 Mon Sep 17 00:00:00 2001
From: Niall Pemberton <niallp@apache.org>
Date: Sun, 9 Jan 2011 02:41:34 +0000
Subject: [PATCH] Port LANG-645 to LANG 2.x Branch - fix the FastDateFormat to
 properly include the locale when formatting a Date

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/lang/branches/LANG_2_X@1056869 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/lang/time/FastDateFormat.java |  2 +-
 .../apache/commons/lang/time/FastDateFormatTest.java | 12 ++++++++++++
 2 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/lang/time/FastDateFormat.java b/src/main/java/org/apache/commons/lang/time/FastDateFormat.java
index 61a9a8dcd27..b778d920a42 100644
--- a/src/main/java/org/apache/commons/lang/time/FastDateFormat.java
+++ b/src/main/java/org/apache/commons/lang/time/FastDateFormat.java
@@ -815,7 +815,7 @@ public String format(long millis) {
      * @return the formatted string
      */
     public String format(Date date) {
-        Calendar c = new GregorianCalendar(mTimeZone);
+        Calendar c = new GregorianCalendar(mTimeZone, mLocale);
         c.setTime(date);
         return applyRules(c, new StringBuffer(mMaxLengthEstimate)).toString();
     }
diff --git a/src/test/java/org/apache/commons/lang/time/FastDateFormatTest.java b/src/test/java/org/apache/commons/lang/time/FastDateFormatTest.java
index 8d52f0067f7..d2e5202dff2 100644
--- a/src/test/java/org/apache/commons/lang/time/FastDateFormatTest.java
+++ b/src/test/java/org/apache/commons/lang/time/FastDateFormatTest.java
@@ -322,4 +322,16 @@ public void testLang538() {
         FastDateFormat format = FastDateFormat.getInstance("yyyy-MM-dd'T'HH:mm:ss.SSS'Z'", TimeZone.getTimeZone("GMT"));
         assertEquals("dateTime", dateTime, format.format(cal));
     }
+
+    public void testLang645() {
+        Locale locale = new Locale("sv", "SE");
+
+        Calendar cal = Calendar.getInstance();
+        cal.set(2010, 0, 1, 12, 0, 0);
+        Date d = cal.getTime();
+
+        FastDateFormat fdf = FastDateFormat.getInstance("EEEE', week 'ww", locale);
+
+        assertEquals("fredag, week 53", fdf.format(d));
+    }
 }
