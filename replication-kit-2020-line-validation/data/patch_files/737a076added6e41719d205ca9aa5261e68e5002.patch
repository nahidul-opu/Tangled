From 737a076added6e41719d205ca9aa5261e68e5002 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Sat, 14 Jul 2012 13:57:34 +0000
Subject: [PATCH] NET-456 TelnetClient hangs when reader-thread startup is
 delayed.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1361549 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                        | 3 +++
 .../java/org/apache/commons/net/telnet/TelnetInputStream.java  | 3 +--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 7296b8359..c3f8a1cf3 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -65,6 +65,9 @@ The <action> type attribute can be add,update,fix,remove.
         <release version="3.2" date="TBA" description="
 TBA
         ">
+            <action issue="NET-456" dev="sebb" type="fix">
+            TelnetClient hangs when reader-thread startup is delayed.
+            </action>
             <action issue="NET-449" dev="sebb" type="fix">
             listFiles bug with folder that begins with "-". Clarify Javadoc.
             </action>
diff --git a/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java b/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java
index c489dd433..d90e5c6e0 100644
--- a/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java
+++ b/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java
@@ -108,6 +108,7 @@ void _start()
         __thread.setPriority(priority);
         __thread.setDaemon(true);
         __thread.start();
+        __threaded = true; // tell _processChar that we are running threaded
     }
 
 
@@ -596,8 +597,6 @@ public void run()
     {
         int ch;
 
-        __threaded = true; // tell _processChar that we are running threaded
-
         try
         {
 _outerLoop:
