From 469cf4d886f9a184168ba2d179899a600725d4c4 Mon Sep 17 00:00:00 2001
From: Roel Spilker <r.spilker@gmail.com>
Date: Fri, 6 Oct 2017 00:50:23 +0200
Subject: [PATCH] Let parseName stop at first NUL

Fixes COMPRESS-421
---
 .../apache/commons/compress/archivers/tar/TarUtils.java   | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarUtils.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarUtils.java
index d132d9d0b84..ec5b7670cb8 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarUtils.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarUtils.java
@@ -290,12 +290,8 @@ public static String parseName(final byte[] buffer, final int offset,
                                    final ZipEncoding encoding)
         throws IOException {
 
-        int len = length;
-        for (; len > 0; len--) {
-            if (buffer[offset + len - 1] != 0) {
-                break;
-            }
-        }
+        int len = 0;
+        for (int i = offset; len < length && buffer[i] != 0; i++, len++);
         if (len > 0) {
             final byte[] b = new byte[len];
             System.arraycopy(buffer, offset, b, 0, len);
