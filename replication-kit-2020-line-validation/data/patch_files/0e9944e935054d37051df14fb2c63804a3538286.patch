From 0e9944e935054d37051df14fb2c63804a3538286 Mon Sep 17 00:00:00 2001
From: Thomas Vandahl <tv@apache.org>
Date: Wed, 25 Sep 2013 08:07:47 +0000
Subject: [PATCH] JCS-108: Fix return value of BlockDisk.write(long, byte[])

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/jcs/trunk@1526126 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                        | 3 +++
 .../org/apache/commons/jcs/auxiliary/disk/block/BlockDisk.java | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 10be778de..d49b7136f 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -20,6 +20,9 @@
 	</properties>
 	<body>
 		<release version="2.0" date="unreleased" description="JDK 1.5 based major release">
+            <action dev="tv" type="fix" issue="JCS-108" due-to="Xiong LIU">
+                Fix return value of BlockDisk.write(long, byte[])
+            </action>
             <action dev="tv" type="update">
                 Change package to org.apache.commons.jcs, groupId to org.apache.commons,
                 artifactId to commons-jcs and version to 2.0-SNAPSHOT
diff --git a/src/java/org/apache/commons/jcs/auxiliary/disk/block/BlockDisk.java b/src/java/org/apache/commons/jcs/auxiliary/disk/block/BlockDisk.java
index e46024eed..b73803c72 100644
--- a/src/java/org/apache/commons/jcs/auxiliary/disk/block/BlockDisk.java
+++ b/src/java/org/apache/commons/jcs/auxiliary/disk/block/BlockDisk.java
@@ -252,7 +252,7 @@ private boolean write( long position, byte[] data )
         int written = fc.write(buffer, position);
         fc.force(true);
 
-        return written == data.length;
+        return written == data.length + HEADER_SIZE_BYTES;
     }
 
     /**
