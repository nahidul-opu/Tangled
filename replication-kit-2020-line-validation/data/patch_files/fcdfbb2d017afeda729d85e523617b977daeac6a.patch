From fcdfbb2d017afeda729d85e523617b977daeac6a Mon Sep 17 00:00:00 2001
From: Avery Ching <aching@apache.org>
Date: Mon, 20 Feb 2012 17:26:11 +0000
Subject: [PATCH] GIRAPH-150: PageRankBenchmark accesses wrong conf after
 GiraphJob is created (aching).

git-svn-id: https://svn.apache.org/repos/asf/incubator/giraph/trunk@1291382 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG                                                 | 3 +++
 .../org/apache/giraph/benchmark/PageRankBenchmark.java    | 8 +++++---
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/CHANGELOG b/CHANGELOG
index 561d6500a..10a850b98 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,9 @@
 Giraph Change Log
 
 Release 0.2.0 - unreleased
+
+  GIRAPH-150: PageRankBenchmark accesses wrong conf after GiraphJob is
+  created (aching).
  
   GIRAPH-40: Added checkstyle for enforcement of code conventions.
   All Giraph source files now pass checkstyle. (aching)
diff --git a/src/main/java/org/apache/giraph/benchmark/PageRankBenchmark.java b/src/main/java/org/apache/giraph/benchmark/PageRankBenchmark.java
index 0e7612278..8c81a51db 100644
--- a/src/main/java/org/apache/giraph/benchmark/PageRankBenchmark.java
+++ b/src/main/java/org/apache/giraph/benchmark/PageRankBenchmark.java
@@ -124,7 +124,8 @@ public final int run(final String[] args) throws Exception {
     } else {
       job.setVertexClass(PageRankBenchmark.class);
     }
-    LOG.info("Using class " + BspUtils.getVertexClass(getConf()).getName());
+    LOG.info("Using class " +
+        BspUtils.getVertexClass(job.getConfiguration()).getName());
     job.setVertexInputFormatClass(PseudoRandomVertexInputFormat.class);
     job.setWorkerConfiguration(workers, workers, 100.0f);
     job.getConfiguration().setLong(
@@ -142,8 +143,9 @@ public final int run(final String[] args) throws Exception {
       isVerbose = true;
     }
     if (cmd.hasOption('s')) {
-      getConf().setInt(PageRankComputation.SUPERSTEP_COUNT,
-                       Integer.parseInt(cmd.getOptionValue('s')));
+      job.getConfiguration().setInt(
+          PageRankComputation.SUPERSTEP_COUNT,
+          Integer.parseInt(cmd.getOptionValue('s')));
     }
     if (job.run(isVerbose)) {
       return 0;
