From 432543da69b1667e5d92186551b50b7ab9ec1307 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 23 Feb 2012 01:30:56 +0000
Subject: [PATCH] COMPRESS-131 ArrayOutOfBounds while decompressing bz2. Added
 test case - code already seems to have been fixed.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1292613 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                       |   3 +++
 .../compress/compressors/BZip2TestCase.java   |  21 ++++++++++++++++++
 src/test/resources/COMPRESS-131.bz2           | Bin 0 -> 340 bytes
 3 files changed, 24 insertions(+)
 create mode 100644 src/test/resources/COMPRESS-131.bz2

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index b7350c63a22..6447861ccdf 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -46,6 +46,9 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
     <release version="1.4" date="unreleased"
              description="Release 1.4">
+      <action issue="COMPRESS-131" type="update" date="2012-02-23">
+        ArrayOutOfBounds while decompressing bz2. Added test case - code already seems to have been fixed.
+      </action> 
       <action issue="COMPRESS-178" type="fix" date="2012-02-23">
         TarArchiveInputStream throws IllegalArgumentException instead of IOException
       </action> 
diff --git a/src/test/java/org/apache/commons/compress/compressors/BZip2TestCase.java b/src/test/java/org/apache/commons/compress/compressors/BZip2TestCase.java
index 9c58b783c30..3dd689ee3a5 100644
--- a/src/test/java/org/apache/commons/compress/compressors/BZip2TestCase.java
+++ b/src/test/java/org/apache/commons/compress/compressors/BZip2TestCase.java
@@ -104,4 +104,25 @@ public void testConcatenatedStreamsReadFully() throws Exception {
             is.close();
         }
     }
+
+    public void testCOMPRESS131() throws Exception {
+        final File input = getFile("COMPRESS-131.bz2");
+        final InputStream is = new FileInputStream(input);
+        try {
+            final CompressorInputStream in =
+                new BZip2CompressorInputStream(is, true);
+            try {
+                int l = 0;
+                while(in.read() != -1) {
+                    l++;
+                }
+                assertEquals(539, l);
+            } finally {
+                in.close();
+            }
+        } finally {
+            is.close();
+        }
+    }
+    
 }
diff --git a/src/test/resources/COMPRESS-131.bz2 b/src/test/resources/COMPRESS-131.bz2
new file mode 100644
index 0000000000000000000000000000000000000000..b8db6101222f0932cde325e091941799b9146925
GIT binary patch
literal 340
zcmV-a0jvH(T4*^jL0KkKS;l~ZKL7w(-+)9APy_sTy(iy5zUTkoFabMdRuYIxeyQa>
zP3cFer|74W84VgeMo%fHsPYL-B-KAkXQ@3*jiE6y83B=q@|rXmRBTW*F*F%4ngb?}
zP+&%A2n0AmzzHb?C@vOTc6zXs5a5DmQLpyprSL<~NTwnsMb~IKk)5mUc7X{UE>KP-
zFu4h08b{t)kJEr@jhj@m0J?#!U_Lk7`BR1%s86lUM<~fH)q<k&sq1Ns%DYkK`3=c+
z?=DB2HJ9(dvzXDklskigVbPc>IUDQ@q)k1Sv!s$x&H_&agp}yCYfO03f9K$AmJwB+
zk`S)xM4YPzqpA{xh{bnkLIz`^5m8SXl?2@#)s8$JU|^^oR{k3bTJYBi_l86frb19x
m*DFTbu!%@0<3*NHA()lT0wQG<nQERp#oUoj6eKaAAdkQw#Fi!i

literal 0
HcmV?d00001

