From 8376ecf5e6ff140f3836c51a910b89504e1c3300 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Wed, 23 Mar 2011 11:06:43 +0000
Subject: [PATCH] COMPRESS-127 Calling close() on inputStream returned by
 CompressorStreamFactory.createCompressorInputStream() does not close the
 underlying input stream

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1084536 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                |  4 ++++
 .../compressors/gzip/GzipCompressorInputStream.java    | 10 ++++++++++
 2 files changed, 14 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 2805554598b..c209a6ff528 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -45,6 +45,10 @@ The <action> type attribute can be add,update,fix,remove.
   </properties>
   <body>
     <release version="1.2" date="as in SVN" description="Release 1.2">
+      <action issue="COMPRESS-127" type="fix" date="2011-03-23">
+        Calling close() on inputStream returned by CompressorStreamFactory.createCompressorInputStream()
+        does not close the underlying input stream.
+      </action> 
       <action issue="COMPRESS-122" type="add" date="2010-10-29">
         TarArchiveEntry provides access to the flags that determine
         whether it is an archived symbolic link, pipe or other
diff --git a/src/main/java/org/apache/commons/compress/compressors/gzip/GzipCompressorInputStream.java b/src/main/java/org/apache/commons/compress/compressors/gzip/GzipCompressorInputStream.java
index 05f32492830..2671095319d 100644
--- a/src/main/java/org/apache/commons/compress/compressors/gzip/GzipCompressorInputStream.java
+++ b/src/main/java/org/apache/commons/compress/compressors/gzip/GzipCompressorInputStream.java
@@ -100,4 +100,14 @@ public static boolean matches(byte[] signature, int length) {
         return true;
     }
     
+    /**
+     * Closes the input stream (unless it is System.in).
+     * 
+     * @since 1.2
+     */
+    public void close() throws IOException {
+        if (this.in != System.in) {
+            this.in.close();
+        }
+    }
 }
