From a5eca568368b287f875149133a7ff6029b07aad8 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Tue, 22 Mar 2016 18:14:07 +0100
Subject: [PATCH] COMPRESS-344 accept NUL as terminator for GNU extended names

---
 src/changes/changes.xml                                       | 4 ++++
 .../commons/compress/archivers/ar/ArArchiveInputStream.java   | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index d9929f6f490..8efd3d3753e 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -44,6 +44,10 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
     <release version="1.11" date="not released, yet"
              description="Release 1.11">
+      <action issue="COMPRESS-344" type="fix" date="2016-03-22">
+        ArArchiveInputStream can now read GNU extended names that are
+        terminated with a NUL byte rather than a linefeed.
+      </action>
       <action issue="COMPRESS-341" type="add" date="2016-03-20">
         New method SevenZFile.getEntries can be used to list the
         contents of a 7z archive.
diff --git a/src/main/java/org/apache/commons/compress/archivers/ar/ArArchiveInputStream.java b/src/main/java/org/apache/commons/compress/archivers/ar/ArArchiveInputStream.java
index 79bcceb3c55..6298bc3f225 100644
--- a/src/main/java/org/apache/commons/compress/archivers/ar/ArArchiveInputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/ar/ArArchiveInputStream.java
@@ -177,7 +177,7 @@ private String getExtendedName(int offset) throws IOException{
             throw new IOException("Cannot process GNU long filename as no // record was found");
         }
         for(int i=offset; i < namebuffer.length; i++){
-            if (namebuffer[i]=='\012'){
+            if (namebuffer[i] == '\012' || namebuffer[i] == 0){
                 if (namebuffer[i-1]=='/') {
                     i--; // drop trailing /
                 }
