From 535c0c34334862d47ad339a99d0933e5eba76ae0 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Fri, 27 Jan 2006 07:53:09 +0000
Subject: [PATCH] FIX bug with spaces in organisation modules or revisions
 IVY-157

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/trunk@484190 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                    | 2 ++
 src/java/fr/jayasoft/ivy/ModuleId.java         | 7 ++++---
 src/java/fr/jayasoft/ivy/ModuleRevisionId.java | 6 ++++--
 3 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 3adbaa682..0f124ce26 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -1,3 +1,5 @@
+- FIX: bug when an organisation or module or revision contains a space (IVY-157)
+- slight modification of xsd in attempt to fix IVY-156
 - IMPROVE: add regexp management in the install ant task (IVY-154)
 
    version 1.3-RC1 - 2006-01-25
diff --git a/src/java/fr/jayasoft/ivy/ModuleId.java b/src/java/fr/jayasoft/ivy/ModuleId.java
index fb59a46b6..44a4bf4d5 100644
--- a/src/java/fr/jayasoft/ivy/ModuleId.java
+++ b/src/java/fr/jayasoft/ivy/ModuleId.java
@@ -11,6 +11,7 @@
  *
  */
 public class ModuleId {
+    static final String ENCODE_SEPARATOR = ":#@#:";
     private String _organisation;
     private String _name;
     private int _hash;
@@ -52,12 +53,12 @@ public String toString() {
     }
 
     public String encodeToString() {
-        return getOrganisation() + " "+getName();
+        return getOrganisation() + ENCODE_SEPARATOR + getName();
     }
     public static ModuleId decode(String encoded) {
-        String[] parts = encoded.split(" ");
+        String[] parts = encoded.split(ENCODE_SEPARATOR);
         if (parts.length != 2) {
-            throw new IllegalArgumentException("badly encoded module revision id: '"+encoded+"'");
+            throw new IllegalArgumentException("badly encoded module id: '"+encoded+"'");
         }
         return new ModuleId(parts[0], parts[1]);
     }
diff --git a/src/java/fr/jayasoft/ivy/ModuleRevisionId.java b/src/java/fr/jayasoft/ivy/ModuleRevisionId.java
index 92b53366e..951e088df 100644
--- a/src/java/fr/jayasoft/ivy/ModuleRevisionId.java
+++ b/src/java/fr/jayasoft/ivy/ModuleRevisionId.java
@@ -11,6 +11,8 @@
  *
  */
 public class ModuleRevisionId {
+    private static final String ENCODE_SEPARATOR = ModuleId.ENCODE_SEPARATOR;
+    
     public static ModuleRevisionId newInstance(String organisation, String name, String revision) {
         return new ModuleRevisionId(new ModuleId(organisation, name), revision);
     }
@@ -95,10 +97,10 @@ public static boolean isExactRevision(String revision) {
         return !revision.startsWith("latest.") && !revision.endsWith("+");
     }
     public String encodeToString() {
-        return getOrganisation() + " "+getName()+ " "+getRevision();
+        return getOrganisation() + ENCODE_SEPARATOR+getName()+ ENCODE_SEPARATOR+getRevision();
     }
     public static ModuleRevisionId decode(String encoded) {
-        String[] parts = encoded.split(" ");
+        String[] parts = encoded.split(ENCODE_SEPARATOR);
         if (parts.length != 3) {
             throw new IllegalArgumentException("badly encoded module revision id: '"+encoded+"'");
         }
