From 12cd61925c37177a82d2adc76f6475e662030e12 Mon Sep 17 00:00:00 2001
From: Niall Pemberton <niallp@apache.org>
Date: Tue, 4 Aug 2009 21:32:47 +0000
Subject: [PATCH] BEANUTILS-351 FloatLocaleConverter cannot parse 0 - thanks to
 Lucian Chirita

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/beanutils/trunk@800988 13f79535-47bb-0310-9956-ffa450edef68
---
 .../locale/converters/FloatLocaleConverter.java   |  2 +-
 .../converters/FloatLocaleConverterTestCase.java  | 15 +++++++++++++++
 2 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/commons/beanutils/locale/converters/FloatLocaleConverter.java b/src/java/org/apache/commons/beanutils/locale/converters/FloatLocaleConverter.java
index a32f37d4b..357e74b72 100644
--- a/src/java/org/apache/commons/beanutils/locale/converters/FloatLocaleConverter.java
+++ b/src/java/org/apache/commons/beanutils/locale/converters/FloatLocaleConverter.java
@@ -218,7 +218,7 @@ protected Object parse(Object value, String pattern) throws ParseException {
       final Number parsed = (Number) super.parse(value, pattern);
       double doubleValue = parsed.doubleValue();
       double posDouble = (doubleValue >= (double)0) ? doubleValue : (doubleValue * (double)-1);
-      if (posDouble < Float.MIN_VALUE || posDouble > Float.MAX_VALUE) {
+      if (posDouble != 0 && posDouble < Float.MIN_VALUE || posDouble > Float.MAX_VALUE) {
           throw new ConversionException("Supplied number is not of type Float: "+parsed);
       }
       return new Float(parsed.floatValue()); // unlike superclass it returns Float type
diff --git a/src/test/org/apache/commons/beanutils/locale/converters/FloatLocaleConverterTestCase.java b/src/test/org/apache/commons/beanutils/locale/converters/FloatLocaleConverterTestCase.java
index a0069c3af..530c8fede 100644
--- a/src/test/org/apache/commons/beanutils/locale/converters/FloatLocaleConverterTestCase.java
+++ b/src/test/org/apache/commons/beanutils/locale/converters/FloatLocaleConverterTestCase.java
@@ -18,7 +18,10 @@
 package org.apache.commons.beanutils.locale.converters;
 
 import java.text.DecimalFormat;
+import java.util.Locale;
+
 import org.apache.commons.beanutils.ConversionException;
+import org.apache.commons.beanutils.locale.LocaleConvertUtils;
 
 /**
  * Test Case for the FloatLocaleConverter class.
@@ -303,6 +306,18 @@ public void testFloatLimits() {
         }
     }
 
+    /**
+     * Test parsing zero - see BEANUTILS-351
+     */
+    public void testParseZero() {
+        try {
+            Object result = LocaleConvertUtils.convert("0", Float.class, Locale.US, null);
+            assertEquals(new Float(0), result);
+        } catch (ConversionException e) {
+            fail("Zero threw ConversionException: " + e);
+        }
+        
+    }
 
 
 }
