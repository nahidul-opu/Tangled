From c8cdd97e568cb25d21374fcb4b6f5cc2660ba3a5 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 7 Apr 2008 10:09:40 +0000
Subject: [PATCH] NET-211 - setLenient() does not work across a year boundary

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@645441 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/net/ftp/parser/FTPTimestampParserImpl.java | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java b/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
index 572425e1c..61781f5fd 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
@@ -99,6 +99,11 @@ public Calendar parseTimestamp(String timestampStr, Calendar serverTime) throws
 
 		Date parsed = null;
 		if (recentDateFormat != null) {
+            if (lenientFutureDates) {
+                // add a day to "now" so that "slop" doesn't cause a date 
+                // slightly in the future to roll back a full year.  (Bug 35181)
+                now.add(Calendar.DATE, 1);
+            }    
 			parsed = recentDateFormat.parse(timestampStr, pp);
 		}
 		if (parsed != null && pp.getIndex() == timestampStr.length()) 
@@ -106,11 +111,6 @@ public Calendar parseTimestamp(String timestampStr, Calendar serverTime) throws
 			working.setTime(parsed);
 			working.set(Calendar.YEAR, now.get(Calendar.YEAR));
 
-			if (lenientFutureDates) {
-				// add a day to "now" so that "slop" doesn't cause a date 
-				// slightly in the future to roll back a full year.  (Bug 35181)
-				now.add(Calendar.DATE, 1);
-			}    
 			if (working.after(now)) {
 				working.add(Calendar.YEAR, -1);
 			}
