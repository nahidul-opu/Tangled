From 895ffae05ffa20b661e0d189d03beb9d20eea165 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Fri, 15 Oct 2010 09:06:06 +0000
Subject: [PATCH] NET-341 FTPClient.remoteAppend(String filename) uses STOR
 instead of APPE

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1022863 13f79535-47bb-0310-9956-ffa450edef68
---
 RELEASE-NOTES.txt                                      | 10 ++++++++--
 src/changes/changes.xml                                |  7 +++++++
 .../java/org/apache/commons/net/ftp/FTPClient.java     |  2 +-
 3 files changed, 16 insertions(+), 3 deletions(-)

diff --git a/RELEASE-NOTES.txt b/RELEASE-NOTES.txt
index 6dabb0c95..2c7d65d78 100644
--- a/RELEASE-NOTES.txt
+++ b/RELEASE-NOTES.txt
@@ -1,9 +1,9 @@
 
-              Apache Commons Net 2.1 RELEASE NOTES
+              Apache Commons Net 2.2-SNAPSHOT RELEASE NOTES
 
 This is primarily a maintenance release, but it also includes new features and enhancements.
 
-Users of version 2.0 are encouraged to upgrade to 2.1, as this release includes some important bug fixes.
+Users of version 2.0 are encouraged to upgrade to 2.2, as this release includes some important bug fixes.
 
 See the detailed list of changes below for full description of all bug fixes and enhancements.
 
@@ -12,6 +12,9 @@ See the detailed list of changes below for full description of all bug fixes and
 Changes in this version include:
 
 New features:
+o NET-338:  ftp.FTPClient.initiateListParsing(String parserKey, String pathname) 
+            can call createFileEntryParser with null systemName. 
+            Fix this by adding getSystemType() which does not return null, and deprecating getSystemName(). 
 o NET-244:  Add support for FTPFileFilter filters. New classes FTPFileFilter, FTPFileFilters, new methods:
             FTPListParseEngine#getFiles(FTPFileFilter filter)
             FTPClient.listFiles(String pathname, FTPFileFilter filter) 
@@ -20,6 +23,9 @@ o NET-263:  SubnetUtils / SubNetInfo toString() implementations
 o Javadoc fixes, improvements, and refactoring. 
 
 Fixed Bugs:
+o NET-341:  FTPClient.remoteAppend(String filename) uses STOR instead of APPE 
+o NET-339:  Incorrect parsing of timestamp on Windows CE
+            Fix parsing to allow for new-style DOS listing using 24hr clock rather than AM/PM 
 o NET-313:  Optionally enable EPSV with IPv4; Only send EPRT with IPv6.
             Fix incorrect port used with EPRT. Allow activeMaxPort == activeMinPort in getActivePort() method. 
 o NET-328:  FromNetASCIIInputStream.read(byte[], int, int) may change length passed to superclass if not doing conversion 
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 4cfa56535..961ac7bff 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -61,6 +61,13 @@ This is primarily a maintenance release, but it also includes new features and e
  
   TO BE COMPLETED
 ">
+            <action issue="NET-341" dev="sebb" type="fix">
+            FTPClient.remoteAppend(String filename) uses STOR instead of APPE
+            </action>
+            <action issue="NET-339" dev="sebb" type="fix">
+            Incorrect parsing of timestamp on Windows CE
+            Fix parsing to allow for new-style DOS listing using 24hr clock rather than AM/PM
+            </action>
             <action issue="NET-338" dev="sebb" type="add">
             ftp.FTPClient.initiateListParsing(String parserKey, String pathname) 
             can call createFileEntryParser with null systemName. 
diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClient.java b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
index 349e79798..86c9f2df8 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClient.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
@@ -1353,7 +1353,7 @@ public boolean remoteAppend(String filename) throws IOException
     {
         if (__dataConnectionMode == ACTIVE_REMOTE_DATA_CONNECTION_MODE ||
                 __dataConnectionMode == PASSIVE_REMOTE_DATA_CONNECTION_MODE)
-            return FTPReply.isPositivePreliminary(stor(filename));
+            return FTPReply.isPositivePreliminary(appe(filename));
         return false;
     }
 
