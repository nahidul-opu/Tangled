From 480475a51776bfb20d9515978b7803ca14b0dd05 Mon Sep 17 00:00:00 2001
From: Sergey Edunov <edunov@fb.com>
Date: Thu, 18 Dec 2014 17:43:43 -0800
Subject: [PATCH] GIRAPH-973 Edge trimming no longer works before superstep 0

---
 .../main/java/org/apache/giraph/edge/AbstractEdgeStore.java   | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/giraph-core/src/main/java/org/apache/giraph/edge/AbstractEdgeStore.java b/giraph-core/src/main/java/org/apache/giraph/edge/AbstractEdgeStore.java
index dc7a5b4a2..5d1570714 100644
--- a/giraph-core/src/main/java/org/apache/giraph/edge/AbstractEdgeStore.java
+++ b/giraph-core/src/main/java/org/apache/giraph/edge/AbstractEdgeStore.java
@@ -26,6 +26,7 @@
 import org.apache.giraph.partition.Partition;
 import org.apache.giraph.utils.CallableFactory;
 import org.apache.giraph.utils.ProgressableUtils;
+import org.apache.giraph.utils.Trimmable;
 import org.apache.giraph.utils.VertexIdEdgeIterator;
 import org.apache.giraph.utils.VertexIdEdges;
 import org.apache.hadoop.io.Writable;
@@ -245,6 +246,9 @@ public Void call() throws Exception {
                       vertex.addEdge(edge);
                     }
                   }
+                  if (vertex instanceof Trimmable) {
+                    ((Trimmable) vertex).trim();
+                  }
                   // Some Partition implementations (e.g. ByteArrayPartition)
                   // require us to put back the vertex after modifying it.
                   partition.saveVertex(vertex);
