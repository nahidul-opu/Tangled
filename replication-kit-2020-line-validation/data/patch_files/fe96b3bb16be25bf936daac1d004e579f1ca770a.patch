From fe96b3bb16be25bf936daac1d004e579f1ca770a Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Sun, 19 Aug 2012 15:58:20 +0000
Subject: [PATCH] FIX: Memory leak and infinite loop in ModuleId.java
 (IVY-1362) (merged from trunk)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/branches/2.3.x@1374779 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                          | 1 +
 src/java/org/apache/ivy/core/module/id/ModuleId.java | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 771f64330..d664f9c75 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -129,6 +129,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 	
    2.3.x
 =====================================
+- FIX: Memory leak and infinite loop in ModuleId.java (IVY-1362)
 - FIX: NullPointerExeption in AbstractOSGiResolver (IVY-1343) (thanks to Thomas Kurpick)
 - FIX: Delivered ivy descriptor inconsistent with resolve report / retrieve and other post-resolve actions (IVY-1300) (thanks to Ed Burcher)
 - FIX: The Updatesite resolver is downloading Eclipse features instead of Eclipse bundle/plugin
diff --git a/src/java/org/apache/ivy/core/module/id/ModuleId.java b/src/java/org/apache/ivy/core/module/id/ModuleId.java
index b55af1fda..b0a54099a 100644
--- a/src/java/org/apache/ivy/core/module/id/ModuleId.java
+++ b/src/java/org/apache/ivy/core/module/id/ModuleId.java
@@ -59,7 +59,7 @@ public static ModuleId newInstance(String org, String name) {
      *            the module id to return
      * @return a unit instance of the given module id.
      */
-    public static ModuleId intern(ModuleId moduleId) {
+    public static synchronized ModuleId intern(ModuleId moduleId) {
         ModuleId r = (ModuleId) CACHE.get(moduleId);
         if (r == null) {
             r = moduleId;
