From 95b491e43ad9bf459f281158d9c152cc3b291dcb Mon Sep 17 00:00:00 2001
From: Jakob Glen Homan <jghoman@apache.org>
Date: Thu, 1 Sep 2011 01:19:41 +0000
Subject: [PATCH] GIRAPH-24: Job-level statistics reports one superstep greater
 than workers. (jghoman)

git-svn-id: https://svn.apache.org/repos/asf/incubator/giraph/trunk@1163886 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG                                                   | 3 +++
 src/main/java/org/apache/giraph/graph/BspServiceMaster.java | 4 +++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index 8be06d595..d4d0674a2 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -2,6 +2,9 @@ Giraph Change Log
 
 Release 0.70.0 - unreleased
 
+  GIRAPH-24. Job-level statistics reports one superstep greater than 
+  workers. (jghoman)
+  
   GIRAPH-18. Refactor BspServiceWorker::loadVertices(). (jghoman)
   
   GIRAPH-14. Support for the Facebook Hadoop branch. (aching)
diff --git a/src/main/java/org/apache/giraph/graph/BspServiceMaster.java b/src/main/java/org/apache/giraph/graph/BspServiceMaster.java
index dcfcf4333..4f3497814 100644
--- a/src/main/java/org/apache/giraph/graph/BspServiceMaster.java
+++ b/src/main/java/org/apache/giraph/graph/BspServiceMaster.java
@@ -1779,7 +1779,9 @@ public SuperstepState coordinateSuperstep() throws
             }
         }
         incrCachedSuperstep();
-        superstepCounter.increment(1);
+        if(getSuperstep() > 0) {  // counter starts at zero, so no need to incr
+            superstepCounter.increment(1);
+        }
         try {
             if ((globalInfoObject.getLong(JSONOBJ_FINISHED_VERTICES_KEY) ==
                     globalInfoObject.getLong(JSONOBJ_NUM_VERTICES_KEY)) &&
