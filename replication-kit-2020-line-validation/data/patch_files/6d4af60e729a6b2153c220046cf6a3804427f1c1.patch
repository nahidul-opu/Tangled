From 6d4af60e729a6b2153c220046cf6a3804427f1c1 Mon Sep 17 00:00:00 2001
From: Maja Kabiljo <majakabiljo@fb.com>
Date: Fri, 1 Aug 2014 11:46:52 -0700
Subject: [PATCH] GIRAPH-936: AsyncMessageStoreWrapper threads are not
 daemonized (edunov via majakabiljo)

---
 CHANGELOG                                                       | 2 ++
 .../giraph/comm/messages/queue/AsyncMessageStoreWrapper.java    | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index dbb134ad8..3c8e15525 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,8 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-936: AsyncMessageStoreWrapper threads are not daemonized (edunov via majakabiljo)
+
   GIRAPH-934: Allow having state in aggregators (ikabiljo via majakabiljo)
 
   GIRAPH-932: Adding .arcconfig to GIRAPH for Arcanist support (aching)
diff --git a/giraph-core/src/main/java/org/apache/giraph/comm/messages/queue/AsyncMessageStoreWrapper.java b/giraph-core/src/main/java/org/apache/giraph/comm/messages/queue/AsyncMessageStoreWrapper.java
index a62834f1c..252ee39ac 100644
--- a/giraph-core/src/main/java/org/apache/giraph/comm/messages/queue/AsyncMessageStoreWrapper.java
+++ b/giraph-core/src/main/java/org/apache/giraph/comm/messages/queue/AsyncMessageStoreWrapper.java
@@ -60,7 +60,7 @@ public final class AsyncMessageStoreWrapper<I extends WritableComparable,
   /** Executor that processes messages in background */
   private static final ExecutorService EXECUTOR_SERVICE =
       Executors.newCachedThreadPool(
-          new ThreadFactoryBuilder()
+          new ThreadFactoryBuilder().setDaemon(true)
               .setNameFormat("AsyncMessageStoreWrapper-%d").build());
 
   /** Number of threads that will process messages in background */
