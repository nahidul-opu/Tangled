From ce2badf02e266a84e2485f1793f13bf722c29306 Mon Sep 17 00:00:00 2001
From: Phil Steitz <phil.steitz@gmail.com>
Date: Mon, 9 Mar 2015 12:37:57 -0700
Subject: [PATCH] Corrected the fix for MATH-1208.

---
 .../commons/math4/random/EmpiricalDistribution.java       | 6 +++++-
 .../commons/math4/random/EmpiricalDistributionTest.java   | 8 ++++----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/src/main/java/org/apache/commons/math4/random/EmpiricalDistribution.java b/src/main/java/org/apache/commons/math4/random/EmpiricalDistribution.java
index 61bb65b771..685c08b9cb 100644
--- a/src/main/java/org/apache/commons/math4/random/EmpiricalDistribution.java
+++ b/src/main/java/org/apache/commons/math4/random/EmpiricalDistribution.java
@@ -610,7 +610,11 @@ public double cumulativeProbability(double x) {
         final double pB = pB(binIndex);
         final RealDistribution kernel = k(x);
         if (kernel instanceof ConstantRealDistribution) {
-            return pBminus + pB;
+            if (x < kernel.getNumericalMean()) {
+                return pBminus;
+            } else {
+                return pBminus + pB;
+            }
         }
         final double[] binBounds = getUpperBounds();
         final double kB = kB(binIndex);
diff --git a/src/test/java/org/apache/commons/math4/random/EmpiricalDistributionTest.java b/src/test/java/org/apache/commons/math4/random/EmpiricalDistributionTest.java
index 47a6185bcf..6f3871112b 100644
--- a/src/test/java/org/apache/commons/math4/random/EmpiricalDistributionTest.java
+++ b/src/test/java/org/apache/commons/math4/random/EmpiricalDistributionTest.java
@@ -446,7 +446,7 @@ public void testNoBinVariance() {
         Assert.assertEquals(0.5, dist.cumulativeProbability(0), Double.MIN_VALUE);
         Assert.assertEquals(1.0, dist.cumulativeProbability(1), Double.MIN_VALUE);
         Assert.assertEquals(0.5, dist.cumulativeProbability(0.5), Double.MIN_VALUE);
-        Assert.assertEquals(1.0, dist.cumulativeProbability(0.7), Double.MIN_VALUE);
+        Assert.assertEquals(0.5, dist.cumulativeProbability(0.7), Double.MIN_VALUE);
     }
     
     /**
@@ -486,11 +486,11 @@ public void testKernelOverrideConstant() {
             Assert.assertTrue(Arrays.binarySearch(values, dist.sample()) >= 0);
         }
         final double tol = 10E-12;
-        Assert.assertEquals(0.2, dist.cumulativeProbability(1), tol);
+        Assert.assertEquals(0.0, dist.cumulativeProbability(1), tol);
         Assert.assertEquals(0.2, dist.cumulativeProbability(2), tol);
-        Assert.assertEquals(0.8, dist.cumulativeProbability(10), tol);
+        Assert.assertEquals(0.6, dist.cumulativeProbability(10), tol);
         Assert.assertEquals(0.8, dist.cumulativeProbability(12), tol);
-        Assert.assertEquals(1.0, dist.cumulativeProbability(13), tol);
+        Assert.assertEquals(0.8, dist.cumulativeProbability(13), tol);
         Assert.assertEquals(1.0, dist.cumulativeProbability(15), tol);
 
         Assert.assertEquals(2.0, dist.inverseCumulativeProbability(0.1), tol);
