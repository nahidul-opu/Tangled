From 9325fa9869c2604172576f89311308915ebb416d Mon Sep 17 00:00:00 2001
From: Maja Kabiljo <majakabiljo@fb.com>
Date: Mon, 3 Feb 2014 09:30:17 -0800
Subject: [PATCH] GIRAPH-839: NettyWorkerAggregatorRequestProcessor tries to
 reuse request objects (pavanka via majakabiljo)

---
 CHANGELOG                                                   | 3 +++
 .../comm/netty/NettyWorkerAggregatorRequestProcessor.java   | 6 +++---
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/CHANGELOG b/CHANGELOG
index e21a29168..cef754e60 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,9 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-839: NettyWorkerAggregatorRequestProcessor tries to reuse request objects 
+  (pavanka via majakabiljo)
+
   GIRAPH-835: org.apache.giraph.hive.input.CheckInputTest Fails because JobProgressTracker
   doesn't check null (akila via majakabiljo)
 
diff --git a/giraph-core/src/main/java/org/apache/giraph/comm/netty/NettyWorkerAggregatorRequestProcessor.java b/giraph-core/src/main/java/org/apache/giraph/comm/netty/NettyWorkerAggregatorRequestProcessor.java
index 798e09c99..8b5f29306 100644
--- a/giraph-core/src/main/java/org/apache/giraph/comm/netty/NettyWorkerAggregatorRequestProcessor.java
+++ b/giraph-core/src/main/java/org/apache/giraph/comm/netty/NettyWorkerAggregatorRequestProcessor.java
@@ -124,11 +124,11 @@ public void sendAggregatedValuesToMaster(
   public void distributeAggregators(
       Iterable<byte[]> aggregatorDataList) throws IOException {
     for (byte[] aggregatorData : aggregatorDataList) {
-      SendAggregatorsToWorkerRequest request =
-          new SendAggregatorsToWorkerRequest(aggregatorData,
-              serviceWorker.getWorkerInfo().getTaskId());
       for (WorkerInfo worker : serviceWorker.getWorkerInfoList()) {
         if (!isThisWorker(worker)) {
+          SendAggregatorsToWorkerRequest request =
+              new SendAggregatorsToWorkerRequest(aggregatorData,
+                  serviceWorker.getWorkerInfo().getTaskId());
           workerClient.sendWritableRequest(worker.getTaskId(), request);
         }
         progressable.progress();
