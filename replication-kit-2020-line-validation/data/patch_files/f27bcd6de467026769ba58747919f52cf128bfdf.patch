From f27bcd6de467026769ba58747919f52cf128bfdf Mon Sep 17 00:00:00 2001
From: Colm O hEigeartaigh <coheigea@apache.org>
Date: Mon, 21 Nov 2016 11:24:01 +0000
Subject: [PATCH] SANTUARIO-457 - Marshaller:sendAttributeToWriter broken by
 Attr without namespace.  - Thanks to asolano for the patch.

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/2.0.x-fixes@1770650 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/jcp/xml/dsig/internal/dom/Marshaller.java | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/jcp/xml/dsig/internal/dom/Marshaller.java b/src/main/java/org/apache/jcp/xml/dsig/internal/dom/Marshaller.java
index 86a1424ac0..37141f02b5 100644
--- a/src/main/java/org/apache/jcp/xml/dsig/internal/dom/Marshaller.java
+++ b/src/main/java/org/apache/jcp/xml/dsig/internal/dom/Marshaller.java
@@ -334,8 +334,13 @@ private static void sendAttributeToWriter(XmlWriter xwriter, Attr attr) {
                     attr.getLocalName(), attr.getTextContent());
         }
         else {
-            xwriter.writeAttribute(attr.getPrefix(), attr.getNamespaceURI(),
-                    attr.getLocalName(), attr.getTextContent());
+            if (attr.getNamespaceURI() == null && attr.getLocalName() == null) {
+                // Level 1 DOM attribute
+                xwriter.writeAttribute(null, null, attr.getName(), attr.getTextContent());
+            } else {
+                xwriter.writeAttribute(attr.getPrefix(), attr.getNamespaceURI(), attr.getLocalName(),
+                                       attr.getTextContent());
+            }
         }
     }
 
