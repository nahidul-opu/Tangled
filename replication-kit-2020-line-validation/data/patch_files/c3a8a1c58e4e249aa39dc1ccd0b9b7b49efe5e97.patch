From c3a8a1c58e4e249aa39dc1ccd0b9b7b49efe5e97 Mon Sep 17 00:00:00 2001
From: Torsten Curdt <tcurdt@apache.org>
Date: Fri, 27 Mar 2009 21:08:27 +0000
Subject: [PATCH] tracked down the problem of
 https://issues.apache.org/jira/browse/COMPRESS-11

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@759352 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/compress/archivers/ArTestCase.java    | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/src/test/java/org/apache/commons/compress/archivers/ArTestCase.java b/src/test/java/org/apache/commons/compress/archivers/ArTestCase.java
index 93744caf8e6..70fa51a318f 100644
--- a/src/test/java/org/apache/commons/compress/archivers/ArTestCase.java
+++ b/src/test/java/org/apache/commons/compress/archivers/ArTestCase.java
@@ -107,10 +107,16 @@ public void testArDelete() throws Exception {
 			out.close();
 		}
 		
+		assertEquals(282, output.length());
+		
 		final File output2 = new File(dir, "bla2.ar");		
 
+		int copied = 0;
+		int deleted = 0;
+
 		{
 			// remove all but one file
+
 			final InputStream is = new FileInputStream(output);
 			final OutputStream os = new FileOutputStream(output2);
 			final ArchiveOutputStream aos = new ArchiveStreamFactory().createArchiveOutputStream("ar", os);
@@ -124,8 +130,11 @@ public void testArDelete() throws Exception {
 				if ("test1.xml".equals(entry.getName())) {
 					aos.putArchiveEntry(entry);
 					IOUtils.copy(ais, aos);
+					aos.closeArchiveEntry();
+					copied++;
 				} else {
 			        IOUtils.copy(ais, new ByteArrayOutputStream());
+			        deleted++;
 				}
 			
 			}
@@ -135,7 +144,11 @@ public void testArDelete() throws Exception {
 			os.close();			
 		}
 
+		assertEquals(1, copied);
+		assertEquals(1, deleted);
+		assertEquals(144, output2.length());
 		
+		long files = 0;
 		long sum = 0;
 
 		{
@@ -150,11 +163,13 @@ public void testArDelete() throws Exception {
 		        IOUtils.copy(ais, new ByteArrayOutputStream());
 		        
 		        sum +=  entry.getLength();
+		        files++;
 			}
 			ais.close();
 			is.close();			
 		}
 
+		assertEquals(1, files);
 		assertEquals(76, sum);
 		
 	}
