From f052896ac6ece2b36c36706604780dbda90b7f41 Mon Sep 17 00:00:00 2001
From: "Bruno P. Kinoshita" <kinow@apache.org>
Date: Wed, 9 Aug 2017 01:50:36 +0000
Subject: [PATCH] VFS-189: fail with exception if base filename is null

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1804480 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/vfs2/impl/DefaultFileSystemManager.java |  5 ++++-
 .../impl/test/DefaultFileSystemManagerTest.java     | 13 +++++++++++++
 2 files changed, 17 insertions(+), 1 deletion(-)

diff --git a/core/src/main/java/org/apache/commons/vfs2/impl/DefaultFileSystemManager.java b/core/src/main/java/org/apache/commons/vfs2/impl/DefaultFileSystemManager.java
index 166da43551..a1a0ef9e60 100644
--- a/core/src/main/java/org/apache/commons/vfs2/impl/DefaultFileSystemManager.java
+++ b/core/src/main/java/org/apache/commons/vfs2/impl/DefaultFileSystemManager.java
@@ -862,8 +862,11 @@ public FileName resolveName(final FileName root, final String path)
     public FileName resolveName(final FileName base, final String name,
             final NameScope scope) throws FileSystemException
     {
+        if (base == null) {
+            throw new FileSystemException("Invalid base filename.");
+        }
         final FileName realBase;
-        if (base != null && VFS.isUriStyle() && base.isFile())
+        if (VFS.isUriStyle() && base.isFile())
         {
             realBase = base.getParent();
         }
diff --git a/core/src/test/java/org/apache/commons/vfs2/impl/test/DefaultFileSystemManagerTest.java b/core/src/test/java/org/apache/commons/vfs2/impl/test/DefaultFileSystemManagerTest.java
index 0159b05eec..282f70ef1f 100644
--- a/core/src/test/java/org/apache/commons/vfs2/impl/test/DefaultFileSystemManagerTest.java
+++ b/core/src/test/java/org/apache/commons/vfs2/impl/test/DefaultFileSystemManagerTest.java
@@ -18,6 +18,7 @@
 
 import java.io.File;
 
+import org.apache.commons.vfs2.FileName;
 import org.apache.commons.vfs2.FileObject;
 import org.apache.commons.vfs2.FileSystemException;
 import org.apache.commons.vfs2.VFS;
@@ -56,4 +57,16 @@ public void testResolveFileObjectNullAbsolute() throws FileSystemException
         final String absolute = new File("/").getAbsoluteFile().toURI().toString();
         VFS.getManager().resolveFile((FileObject) null, absolute);
     }
+
+    /**
+     * If the base name is {@code null}, the file system manager should fail
+     * throwing a FileSystemException.
+     *
+     * @see VFS-189
+     */
+    @Test(expected = FileSystemException.class)
+    public void testResolveFileNameNull() throws FileSystemException
+    {
+        VFS.getManager().resolveName((FileName) null, "../");
+    }
 }
