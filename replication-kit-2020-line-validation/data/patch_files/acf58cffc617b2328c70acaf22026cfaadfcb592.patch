From acf58cffc617b2328c70acaf22026cfaadfcb592 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Sat, 11 Jun 2016 01:09:00 +0000
Subject: [PATCH] NET-594 TelnetClient._closeOutputStream unhandled exception
 from FilterOutputStream.close

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1747830 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                           |  3 +++
 .../apache/commons/net/telnet/TelnetClient.java   | 15 +++++++++------
 2 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 0ca0f59e1..1396c3a00 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -64,6 +64,9 @@ The <action> type attribute can be add,update,fix,remove.
 
     <body>
         <release version="3.6" date="TBA" description="">
+            <action issue="NET-594" type="fix" dev="sebb" due-to="Brad Worrral">
+            TelnetClient._closeOutputStream unhandled exception from FilterOutputStream.close
+            </action>
             <action issue="NET-592" type="fix" dev="sebb" due-to="Mark Ford">
             plainSocket in FTPSClient is never closed
             </action>
diff --git a/src/main/java/org/apache/commons/net/telnet/TelnetClient.java b/src/main/java/org/apache/commons/net/telnet/TelnetClient.java
index 3ad8d0665..053ec6918 100644
--- a/src/main/java/org/apache/commons/net/telnet/TelnetClient.java
+++ b/src/main/java/org/apache/commons/net/telnet/TelnetClient.java
@@ -117,13 +117,16 @@ protected void _connectAction_() throws IOException
     @Override
     public void disconnect() throws IOException
     {
-        if (__input != null) {
-            __input.close();
+        try {
+            if (__input != null) {
+                __input.close();
+            }
+            if (__output != null) {
+                __output.close();
+            }
+        } finally { // NET-594
+            super.disconnect();
         }
-        if (__output != null) {
-            __output.close();
-        }
-        super.disconnect();
     }
 
     /***
