From 006d0566af0726b8ca5bdb07e28c4065b95238b6 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 31 Oct 2013 18:32:51 +0000
Subject: [PATCH] DBCP-403 DelegatingStatement.close() fails with NPE if
 statement is null

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/dbcp/trunk@1537577 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                    | 3 +++
 src/java/org/apache/commons/dbcp2/DelegatingStatement.java | 4 +++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index b22b3f237d..0a9ae99d65 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -46,6 +46,9 @@ The <action> type attribute can be add,update,fix,remove.
       <action issue="DBCP-154" dev="markt" type="fix">
         Log validation failures of poolable connections.
       </action>
+      <action issue="DBCP-403" dev="sebb" type="fix">
+        DelegatingStatement.close() fails with NPE if statement is null
+      </action>
       <action issue="DBCP-322" dev="sebb" type="fix">
         CPDSConnectionFactory.validateObject(Object) ignores Throwable.
       </action>
diff --git a/src/java/org/apache/commons/dbcp2/DelegatingStatement.java b/src/java/org/apache/commons/dbcp2/DelegatingStatement.java
index 61f19dff37..540766fb1a 100644
--- a/src/java/org/apache/commons/dbcp2/DelegatingStatement.java
+++ b/src/java/org/apache/commons/dbcp2/DelegatingStatement.java
@@ -175,7 +175,9 @@ public void close() throws SQLException {
                     clearTrace();
                 }
         
-                _stmt.close();
+                if (_stmt != null) {
+                	_stmt.close();
+                }
             }
             catch (SQLException e) {
                 handleException(e);
