From 2468492a1aef370c66a6636f976543212371405a Mon Sep 17 00:00:00 2001
From: Thomas Vandahl <tv@apache.org>
Date: Mon, 22 Sep 2014 15:11:41 +0000
Subject: [PATCH] Fix JCS-136: OutOfMemoryError when using compressing
 serializer

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/jcs/trunk@1626803 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/jcs/utils/zip/CompressionUtil.java     | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/commons-jcs-core/src/main/java/org/apache/commons/jcs/utils/zip/CompressionUtil.java b/commons-jcs-core/src/main/java/org/apache/commons/jcs/utils/zip/CompressionUtil.java
index 23eb18c68..93f05fa34 100644
--- a/commons-jcs-core/src/main/java/org/apache/commons/jcs/utils/zip/CompressionUtil.java
+++ b/commons-jcs-core/src/main/java/org/apache/commons/jcs/utils/zip/CompressionUtil.java
@@ -93,6 +93,8 @@ public static byte[] decompressByteArray( final byte[] input, final int bufferLe
             log.error( "Problem decompressing.", ex );
         }
 
+        decompressor.end();
+
         try
         {
             baos.close();
@@ -150,6 +152,8 @@ public static byte[] compressByteArray( byte[] input, int bufferLength )
             bos.write( buf, 0, count );
         }
 
+        // JCS-136 ( Details here : http://www.devguli.com/blog/eng/java-deflater-and-outofmemoryerror/ )
+        compressor.end();
         bos.close();
 
         // Get the compressed data
