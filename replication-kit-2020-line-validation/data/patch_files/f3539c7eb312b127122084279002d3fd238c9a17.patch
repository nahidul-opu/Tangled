From f3539c7eb312b127122084279002d3fd238c9a17 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Mon, 29 Sep 2008 22:47:12 +0000
Subject: [PATCH] FIX: StackOverflow when using ivy:settings with
 "ivy.instance" as id (IVY-924)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@700296 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                     | 1 +
 src/java/org/apache/ivy/ant/IvyAntSettings.java | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 0903759d2..c81b9c330 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -89,6 +89,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - FIX: Properties needed to parse version in POM (IVY-914) (thanks to Tom Widmer)
 - FIX: build.xml: checkstyle + checkstyle-report dont work together (IVY-919)
 - FIX: Maven packaging of "pom" should add a "jar" artifact if present (IVY-920)
+- FIX: StackOverflow when using ivy:settings with "ivy.instance" as id (IVY-924)
 
    2.0.0-rc1
 =====================================
diff --git a/src/java/org/apache/ivy/ant/IvyAntSettings.java b/src/java/org/apache/ivy/ant/IvyAntSettings.java
index 12c539b46..01d71c071 100644
--- a/src/java/org/apache/ivy/ant/IvyAntSettings.java
+++ b/src/java/org/apache/ivy/ant/IvyAntSettings.java
@@ -178,7 +178,7 @@ public void setUsername(String aUserName) {
     public void setProject(Project p) {
         super.setProject(p);
         
-        if ("ivy.instance".equals(id) && getProject().getReference(id) == null) {
+        if ("ivy.instance".equals(id) && getProject().getReferences().get(id) == null) {
             // register ourselfs as default settings, just in case the id attribute is not set
             getProject().addReference("ivy.instance", this);
             autoRegistered = true;
