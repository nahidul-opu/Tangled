From 92d8176168551c5da5f7ecdbb5607a6f01f90a11 Mon Sep 17 00:00:00 2001
From: Rahul Akolkar <rahul@apache.org>
Date: Tue, 4 Dec 2007 03:26:00 +0000
Subject: [PATCH] Safer way to create contexts, suggested as part of SCXML-54
 Patch by Mike Tillberg <mtillberg at comcast dot net>

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/scxml/trunk@600775 13f79535-47bb-0310-9956-ffa450edef68
---
 src/test/java/org/apache/commons/scxml/SCXMLTestHelper.java | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/test/java/org/apache/commons/scxml/SCXMLTestHelper.java b/src/test/java/org/apache/commons/scxml/SCXMLTestHelper.java
index 77025c397..3efa1b505 100644
--- a/src/test/java/org/apache/commons/scxml/SCXMLTestHelper.java
+++ b/src/test/java/org/apache/commons/scxml/SCXMLTestHelper.java
@@ -33,7 +33,6 @@
 import org.apache.commons.logging.LogFactory;
 import org.apache.commons.scxml.env.SimpleDispatcher;
 import org.apache.commons.scxml.env.Tracer;
-import org.apache.commons.scxml.env.jexl.JexlContext;
 import org.apache.commons.scxml.env.jexl.JexlEvaluator;
 import org.apache.commons.scxml.io.SCXMLDigester;
 import org.apache.commons.scxml.io.SCXMLParser;
@@ -138,8 +137,8 @@ public static SCXMLExecutor getExecutor(SCXML scxml) {
 
     public static SCXMLExecutor getExecutor(SCXML scxml,
             SCXMLSemantics semantics) {
-        Context context = new JexlContext();
         Evaluator evaluator = new JexlEvaluator();
+        Context context = evaluator.newContext(null);
         EventDispatcher ed = new SimpleDispatcher();
         Tracer trc = new Tracer();
         return getExecutor(context, evaluator, scxml, ed, trc, semantics);
@@ -148,7 +147,8 @@ public static SCXMLExecutor getExecutor(SCXML scxml,
     public static SCXMLExecutor getExecutor(Evaluator evaluator, SCXML scxml) {
         EventDispatcher ed = new SimpleDispatcher();
         Tracer trc = new Tracer();
-        Context context = new JexlContext();
+        Assert.assertNotNull("Null evaluator", evaluator);
+        Context context = evaluator.newContext(null);
         return getExecutor(context, evaluator, scxml, ed, trc);
     }
 
