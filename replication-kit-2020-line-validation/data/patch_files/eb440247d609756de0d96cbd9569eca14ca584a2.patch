From eb440247d609756de0d96cbd9569eca14ca584a2 Mon Sep 17 00:00:00 2001
From: Thomas Vandahl <tv@apache.org>
Date: Sun, 25 Aug 2013 11:03:41 +0000
Subject: [PATCH] Fix for JCS-95: Map region names to valid file names.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/jcs/trunk@1517269 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                        | 3 +++
 .../org/apache/jcs/auxiliary/disk/block/BlockDiskCache.java    | 3 ++-
 .../apache/jcs/auxiliary/disk/indexed/IndexedDiskCache.java    | 3 ++-
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 8a3531fbe..a1123a530 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -20,6 +20,9 @@
 	</properties>
 	<body>
 		<release version="2.0" date="unreleased" description="JDK 1.5 based major release">
+            <action dev="tv" type="fix" issue="JCS-95" due-to="Nicolas Gomez Navarrete">
+                Map region names to valid file names.
+            </action>
             <action dev="tv" type="fix" issue="JCS-106" due-to="Johannes Weberhofer">
                 Bad comparison of int with Long.MAX_VALUE.
             </action>
diff --git a/src/java/org/apache/jcs/auxiliary/disk/block/BlockDiskCache.java b/src/java/org/apache/jcs/auxiliary/disk/block/BlockDiskCache.java
index eb9195ed5..4cbf13ef7 100644
--- a/src/java/org/apache/jcs/auxiliary/disk/block/BlockDiskCache.java
+++ b/src/java/org/apache/jcs/auxiliary/disk/block/BlockDiskCache.java
@@ -117,7 +117,8 @@ public BlockDiskCache( BlockDiskCacheAttributes cacheAttributes, IElementSeriali
             log.info( logCacheName + "Constructing BlockDiskCache with attributes " + cacheAttributes );
         }
 
-        this.fileName = getCacheName();
+        // Make a clean file name
+        this.fileName = getCacheName().replaceAll("[^a-zA-Z0-9-_\\.]", "_");
         String rootDirName = cacheAttributes.getDiskPath();
         this.rootDirectory = new File( rootDirName );
         this.rootDirectory.mkdirs();
diff --git a/src/java/org/apache/jcs/auxiliary/disk/indexed/IndexedDiskCache.java b/src/java/org/apache/jcs/auxiliary/disk/indexed/IndexedDiskCache.java
index 96ef51064..5b650c67c 100644
--- a/src/java/org/apache/jcs/auxiliary/disk/indexed/IndexedDiskCache.java
+++ b/src/java/org/apache/jcs/auxiliary/disk/indexed/IndexedDiskCache.java
@@ -169,7 +169,8 @@ public IndexedDiskCache( IndexedDiskCacheAttributes cattr, IElementSerializer el
         this.isRealTimeOptimizationEnabled = cattr.getOptimizeAtRemoveCount() > 0;
         this.isShutdownOptimizationEnabled = cattr.isOptimizeOnShutdown();
         this.logCacheName = "Region [" + getCacheName() + "] ";
-        this.fileName = getCacheName();
+        // Make a clean file name
+        this.fileName = getCacheName().replaceAll("[^a-zA-Z0-9-_\\.]", "_");
 
         try
         {
