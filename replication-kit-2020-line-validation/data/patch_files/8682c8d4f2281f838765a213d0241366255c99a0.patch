From 8682c8d4f2281f838765a213d0241366255c99a0 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Tue, 9 Jun 2015 04:18:23 +0000
Subject: [PATCH] COMPRESS-317 ArrayIndexOutOfBoundsException in
 ZipArchiveEntry#getMergedFields

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1684309 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                    | 7 ++++++-
 .../commons/compress/archivers/zip/ZipArchiveEntry.java    | 2 +-
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 1d198775d33..716a11040f4 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -54,8 +54,13 @@ breaks backwards compatibility for code which used the old package.
 This also changes the superclass of ZCompressorInputStream.    
 ">
 
+      <action issue="COMPRESS-317" type="fix" date="2015-06-09"
+              due-to="Lucas Werkmeister">
+        ArrayIndexOutOfBoundsException when ZIP extra fields are read
+        and the entry contains an UnparseableExtraField.
+      </action>
       <action issue="COMPRESS-316" type="add" date="2015-05-23"
-              due-to=""Nick Burch">
+              due-to="Nick Burch">
         CompressorStreamFactory can now auto-detect DEFLATE streams
         with ZLIB header.
       </action>
diff --git a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveEntry.java b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveEntry.java
index 6ee9dbbd5cc..1eab30cb6b0 100644
--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveEntry.java
+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveEntry.java
@@ -377,7 +377,7 @@ private ZipExtraField[] copyOf(ZipExtraField[] src, int length) {
 
     private ZipExtraField[] getMergedFields() {
         final ZipExtraField[] zipExtraFields = copyOf(extraFields, extraFields.length + 1);
-        zipExtraFields[zipExtraFields.length] = unparseableExtra;
+        zipExtraFields[extraFields.length] = unparseableExtra;
         return zipExtraFields;
     }
 
