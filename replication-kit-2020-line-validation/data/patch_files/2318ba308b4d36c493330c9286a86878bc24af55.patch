From 2318ba308b4d36c493330c9286a86878bc24af55 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Tue, 30 Jun 2009 07:25:44 +0000
Subject: [PATCH] clear block after write to avoid garbage in the final block
 if it isn't full.  COMPRESS-81.  Merge from Ant.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@789597 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                | 10 +++++++---
 .../commons/compress/archivers/tar/TarBuffer.java      |  1 +
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 87e8f8c6412..a503b61923d 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -20,11 +20,15 @@
 <document>
   <properties>
     <title>commons-compress</title>
-    <author>Stefan Bodewig</author>
   </properties>
   <body>
-    <release version="1.0" date="as in SVN" description="First Public Release">
-      <action dev="all" type="add">
+    <release version="1.1" date="as in SVN" description="Release 1.1">
+      <action issue="COMPRESS-81" type="fix" date="2009-06-30">
+        TarOutputStream can leave garbage at the end of the archive
+      </action>
+    </release>
+    <release version="1.0" date="2009-05-21" description="First Public Release">
+      <action dev="all" type="add" date="2009-05-21">
         Initial release
       </action>
       <action dev="sgoeschl" type="fix">
diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java
index cfeee0bd4f9..3b57affe2fa 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java
@@ -373,6 +373,7 @@ private void writeBlock() throws IOException {
 
         currRecIdx = 0;
         currBlkIdx++;
+        Arrays.fill(blockBuffer, (byte) 0);
     }
 
     /**
