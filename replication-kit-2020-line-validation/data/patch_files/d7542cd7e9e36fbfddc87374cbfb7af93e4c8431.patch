From d7542cd7e9e36fbfddc87374cbfb7af93e4c8431 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Wed, 17 Sep 2008 07:07:47 +0000
Subject: [PATCH] merge IVY-905 fix from trunk (696013:696031)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/branches/2.0.x@696178 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/ivy/util/FileResolver.java     |  2 +-
 .../org/apache/ivy/util/ConfiguratorTest.java | 25 +++++++++++++++++++
 2 files changed, 26 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/ivy/util/FileResolver.java b/src/java/org/apache/ivy/util/FileResolver.java
index 22520e747..4d646ec53 100644
--- a/src/java/org/apache/ivy/util/FileResolver.java
+++ b/src/java/org/apache/ivy/util/FileResolver.java
@@ -22,7 +22,7 @@
 public interface FileResolver {
     public static final FileResolver DEFAULT = new FileResolver() {
         public File resolveFile(String path, String filename) {
-            return new File(filename);
+            return new File(path);
         }
     };
     
diff --git a/test/java/org/apache/ivy/util/ConfiguratorTest.java b/test/java/org/apache/ivy/util/ConfiguratorTest.java
index c4f7936fa..c68d4faf7 100644
--- a/test/java/org/apache/ivy/util/ConfiguratorTest.java
+++ b/test/java/org/apache/ivy/util/ConfiguratorTest.java
@@ -17,6 +17,7 @@
  */
 package org.apache.ivy.util;
 
+import java.io.File;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.Map;
@@ -27,6 +28,19 @@
  *
  */
 public class ConfiguratorTest extends TestCase {
+    
+    public static class FileTester {
+        private File file;
+        
+        public void setFile(File file) {
+            this.file = file;
+        }
+        
+        public File getFile() {
+            return file;
+        }
+    }
+    
     public static class City {
         private List _housings = new ArrayList();
 
@@ -357,4 +371,15 @@ public void testMacro() throws Exception {
         assertEquals(20, ((Room) ((Housing) city.getHousings().get(1)).getRooms().get(2))
                 .getSurface());
     }
+    
+    public void testFileAttribute() {
+        FileTester root = new FileTester();
+        _conf.setRoot(root);
+        _conf.setAttribute("file", "path/to/file.txt");
+        
+        String filePath = root.getFile().getPath();
+        filePath = filePath.replace('\\', '/');
+        
+        assertEquals("path/to/file.txt", filePath);
+    }
 }
