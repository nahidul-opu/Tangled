From 49ac3477d6d18eee53d40d0d0488a319f07c634b Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Tue, 14 Feb 2012 23:18:51 +0000
Subject: [PATCH] FIX: NullPointerException when providing empty password to
 <credentials> (IVY-1335)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@1244267 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                            | 1 +
 src/java/org/apache/ivy/util/url/IvyAuthenticator.java | 3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index cb79caa77..5403b0281 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -139,6 +139,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: ivy:retrieve can now convert 'dotted'-organisation names into a directory tree.
 - IMPROVEMENT: ivy:retrieve now accepts a nested mapper type.
 
+- FIX: NullPointerException when providing empty password to <credentials> (IVY-1335)
 - FIX: [originalname] not expanded for source and javadoc types during publish in ivy:install (IVY-1324)
 - FIX: cannot resolve from repositories that return HTTP 204 in response to an HTTP HEAD request (IVY-1328)
 - FIX: extra attributes lost from info when ivy file is merged with parent (IVY-1206)
diff --git a/src/java/org/apache/ivy/util/url/IvyAuthenticator.java b/src/java/org/apache/ivy/util/url/IvyAuthenticator.java
index 606416995..c18525366 100644
--- a/src/java/org/apache/ivy/util/url/IvyAuthenticator.java
+++ b/src/java/org/apache/ivy/util/url/IvyAuthenticator.java
@@ -94,7 +94,8 @@ protected PasswordAuthentication getPasswordAuthentication() {
                     + Credentials.buildKey(getRequestingPrompt(), getRequestingHost()) + "' c='" + c
                     + "'");
             if (c != null) {
-                result = new PasswordAuthentication(c.getUserName(), c.getPasswd().toCharArray());
+                final String password = c.getPasswd() == null ? "" : c.getPasswd();
+                result = new PasswordAuthentication(c.getUserName(), password.toCharArray());
             }
         }
         
