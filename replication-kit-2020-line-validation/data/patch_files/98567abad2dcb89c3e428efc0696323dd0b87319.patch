From 98567abad2dcb89c3e428efc0696323dd0b87319 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Tue, 6 Jul 2010 21:40:30 +0000
Subject: [PATCH] FIX: Ivy info/extends/extendsType attribute is misspelled by
 XmlModuleDescriptorWriter (IVY-1203) (thanks to Jason Trump)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@961020 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                   |  1 +
 .../parser/xml/XmlModuleDescriptorWriter.java |  2 +-
 .../xml/XmlModuleDescriptorWriterTest.java    | 15 +++++++
 .../plugins/parser/xml/test-write-extends.xml | 44 +++++++++++++++++++
 4 files changed, 61 insertions(+), 1 deletion(-)
 create mode 100644 test/java/org/apache/ivy/plugins/parser/xml/test-write-extends.xml

diff --git a/CHANGES.txt b/CHANGES.txt
index 3f0b26648..f5530162e 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -108,6 +108,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 	
    trunk
 =====================================
+- FIX: Ivy info/extends/extendsType attribute is misspelled by XmlModuleDescriptorWriter (IVY-1203) (thanks to Jason Trump)
 
    2.2.0-rc1
 =====================================
diff --git a/src/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriter.java b/src/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriter.java
index 914bcdebb..720fc3e5f 100644
--- a/src/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriter.java
+++ b/src/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriter.java
@@ -476,7 +476,7 @@ private static void printInfoTag(ModuleDescriptor md, PrintWriter out) {
                 if (location != null) {
                     out.print(" location=\"" + XMLHelper.escape(location) + "\"");
                 }
-                out.print(" extendTypes=\"" + StringUtils.join(parent.getExtendsTypes(), ",") + "\"");
+                out.print(" extendType=\"" + StringUtils.join(parent.getExtendsTypes(), ",") + "\"");
                 out.println("/>");
             }
             License[] licenses = md.getLicenses();
diff --git a/test/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriterTest.java b/test/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriterTest.java
index 6de57f4d3..6b5e48a19 100644
--- a/test/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriterTest.java
+++ b/test/java/org/apache/ivy/plugins/parser/xml/XmlModuleDescriptorWriterTest.java
@@ -26,6 +26,7 @@
 
 import junit.framework.TestCase;
 
+import org.apache.ivy.Ivy;
 import org.apache.ivy.core.module.descriptor.DefaultModuleDescriptor;
 import org.apache.ivy.core.module.descriptor.ModuleDescriptor;
 import org.apache.ivy.core.module.id.ModuleRevisionId;
@@ -106,6 +107,20 @@ public void testFull() throws Exception {
         assertEquals(expected, wrote);
     }
 
+	public void testExtends() throws Exception {
+		ModuleDescriptor md = XmlModuleDescriptorParser.getInstance().parseDescriptor(
+		    new IvySettings(), XmlModuleDescriptorWriterTest.class.getResource("test-extends-all.xml"), false);
+		XmlModuleDescriptorWriter.write(md, LICENSE, dest);
+
+		assertTrue(dest.exists());
+		String wrote = FileUtil.readEntirely(new BufferedReader(new FileReader(dest)))
+				.replaceAll("\r\n?", "\n");
+		String expected = readEntirely("test-write-extends.xml")
+				.replaceAll("\r\n?", "\n")
+				.replaceAll("working@localhost", Ivy.getWorkingRevision());
+		assertEquals(expected, wrote);
+	}
+
     private String readEntirely(String resource) throws IOException {
         return FileUtil.readEntirely(new BufferedReader(new InputStreamReader(
                 XmlModuleDescriptorWriterTest.class.getResource(resource).openStream())));
diff --git a/test/java/org/apache/ivy/plugins/parser/xml/test-write-extends.xml b/test/java/org/apache/ivy/plugins/parser/xml/test-write-extends.xml
new file mode 100644
index 000000000..95b5c993e
--- /dev/null
+++ b/test/java/org/apache/ivy/plugins/parser/xml/test-write-extends.xml
@@ -0,0 +1,44 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="2.2">
+	<info organisation="myorg"
+		module="mymodule"
+		revision="working@localhost"
+		status="integration"
+		publication="20091206000000"
+	>
+		<extends organisation="myorg" module="myparent" revision="myrev" location="test-extends-parent.xml" extendType="all"/>
+		<description>
+		Parent module description.
+		</description>
+	</info>
+	<configurations>
+		<conf name="default" visibility="public"/>
+		<conf name="conf1" visibility="public"/>
+		<conf name="conf2" visibility="private"/>
+	</configurations>
+	<publications>
+		<artifact name="mymodule" type="jar" ext="jar" conf="default,conf1,conf2"/>
+	</publications>
+	<dependencies>
+		<dependency org="myorg" name="mymodule1" rev="1.0" conf="default->default"/>
+		<dependency org="myorg" name="mymodule2" rev="2.0" conf="conf1->conf1;conf2->conf2"/>
+	</dependencies>
+</ivy-module>
