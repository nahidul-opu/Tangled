From b08ebfc2aac20bd7129ebb579a5a315f6d0e9e9e Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Mon, 26 May 2008 19:59:30 +0000
Subject: [PATCH] FIX: An empty exclusion tag results in an
 IllegalArgumentException (IVY-821)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@660286 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                                 | 1 +
 src/java/org/apache/ivy/plugins/parser/m2/PomReader.java    | 6 ++++--
 .../org/apache/ivy/plugins/parser/m2/test-exclusion.pom     | 3 +++
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 6ad80e14f..d48349125 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -81,6 +81,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Change allownomd and skipbuildwithoutivy into a more semantically correct name (IVY-297)
 - IMPROVEMENT: Smarter determination if an expression is exact or not for RegexpPatternMatcher and GlobPatternMatcher
 
+- FIX: An empty exclusion tag results in an IllegalArgumentException (IVY-821)
 - FIX: Maven scope defined in POM dependencyManagement section not honoured (IVY-811)
 - FIX: SFTPRepository incorrectly calculates last modified time for resources (IVY-815)
 - FIX: Filesystem resolver does not evaluate [branch] token when publishing (IVY-814)
diff --git a/src/java/org/apache/ivy/plugins/parser/m2/PomReader.java b/src/java/org/apache/ivy/plugins/parser/m2/PomReader.java
index 2a7d68c27..e568cb373 100644
--- a/src/java/org/apache/ivy/plugins/parser/m2/PomReader.java
+++ b/src/java/org/apache/ivy/plugins/parser/m2/PomReader.java
@@ -345,8 +345,10 @@ public boolean isOptional() {
                     Node node = childs.item(i);
                     if (node instanceof Element && EXCLUSION.equals(node.getNodeName())) {
                         String groupId = getFirstChildText((Element) node, GROUP_ID);
-                        String arteficatId = getFirstChildText((Element) node, ARTIFACT_ID);
-                        exclusions.add(ModuleId.newInstance(groupId, arteficatId));
+                        String artifactId = getFirstChildText((Element) node, ARTIFACT_ID);
+                        if ((groupId != null) && (artifactId != null)) {
+                            exclusions.add(ModuleId.newInstance(groupId, artifactId));
+                        }
                     }
                 }
             }
diff --git a/test/java/org/apache/ivy/plugins/parser/m2/test-exclusion.pom b/test/java/org/apache/ivy/plugins/parser/m2/test-exclusion.pom
index ae2b61e3a..3ec4752bc 100644
--- a/test/java/org/apache/ivy/plugins/parser/m2/test-exclusion.pom
+++ b/test/java/org/apache/ivy/plugins/parser/m2/test-exclusion.pom
@@ -53,6 +53,9 @@
       <groupId>cglib</groupId>
       <artifactId>cglib</artifactId>
       <version>2.0.2</version>
+      <exclusions>
+        <exclusion />
+      </exclusions>
     </dependency>
   </dependencies>
 </project>
