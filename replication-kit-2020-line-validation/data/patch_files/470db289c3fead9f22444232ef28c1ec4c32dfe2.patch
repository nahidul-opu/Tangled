From 470db289c3fead9f22444232ef28c1ec4c32dfe2 Mon Sep 17 00:00:00 2001
From: Jochen Wiedmann <jochen@apache.org>
Date: Tue, 1 Mar 2011 22:35:01 +0000
Subject: [PATCH] PR: COLLECTIONS-334 Synchronizing access to locks in
 StaticBucketMap.size()

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/collections/branches/COLLECTIONS_3_2_BRANCH@1076039 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/collections/map/StaticBucketMap.java   | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/commons/collections/map/StaticBucketMap.java b/src/java/org/apache/commons/collections/map/StaticBucketMap.java
index 4a130c3f64..1a0d379d8b 100644
--- a/src/java/org/apache/commons/collections/map/StaticBucketMap.java
+++ b/src/java/org/apache/commons/collections/map/StaticBucketMap.java
@@ -182,7 +182,9 @@ public int size() {
         int cnt = 0;
 
         for (int i = 0; i < buckets.length; i++) {
-            cnt += locks[i].size;
+            synchronized(locks[i]) {
+                cnt += locks[i].size;
+            }
         }
         return cnt;
     }
