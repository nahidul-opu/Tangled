From 60aa99da6e9ee79f1691f986760d4505ee37f00e Mon Sep 17 00:00:00 2001
From: Damjan Jovanovic <damjan@apache.org>
Date: Mon, 21 Oct 2013 18:06:52 +0000
Subject: [PATCH] Fix an NPE regression in TIFF image reading.

Jira issue key: IMAGING-113




git-svn-id: https://svn.apache.org/repos/asf/commons/proper/imaging/trunk@1534297 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                        | 3 +++
 .../apache/commons/imaging/formats/tiff/TiffImageParser.java   | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index a4b54d3a8..f3d31f5ba 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -46,6 +46,9 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
 
     <release version="1.0" date="TBA" description="TBA">
+      <action issue="IMAGING-113" dev="damjan" type="fix">
+        Cannot read multipage tiff.
+      </action>
       <action issue="IMAGING-108" dev="damjan" type="fix">
         JPEG EOI marker could not be found at expected location.
       </action>
diff --git a/src/main/java/org/apache/commons/imaging/formats/tiff/TiffImageParser.java b/src/main/java/org/apache/commons/imaging/formats/tiff/TiffImageParser.java
index aa0368859..4b717110a 100644
--- a/src/main/java/org/apache/commons/imaging/formats/tiff/TiffImageParser.java
+++ b/src/main/java/org/apache/commons/imaging/formats/tiff/TiffImageParser.java
@@ -509,6 +509,9 @@ private Integer getIntegerParameter(
             final String key, final Map<String, Object>params)
             throws ImageReadException
     {
+        if (params == null) {
+            return null;
+        }
        
         if(!params.containsKey(key)) {
             return null;
