From e38356616c8577e24c47c5d1501bf55f92109d2f Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Mon, 15 Aug 2011 19:52:26 +0000
Subject: [PATCH] [CONFIGURATION-460] Added a test case to verify that
 reloading works for nested combined configurations.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1157970 13f79535-47bb-0310-9956-ffa450edef68
---
 .../TestCombinedConfiguration.java            | 26 +++++++++++++++++++
 1 file changed, 26 insertions(+)

diff --git a/src/test/org/apache/commons/configuration/TestCombinedConfiguration.java b/src/test/org/apache/commons/configuration/TestCombinedConfiguration.java
index cbe23f79d2..afaf6b083f 100644
--- a/src/test/org/apache/commons/configuration/TestCombinedConfiguration.java
+++ b/src/test/org/apache/commons/configuration/TestCombinedConfiguration.java
@@ -511,6 +511,32 @@ public void testReloadingSubnodeConfig() throws IOException,
         assertEquals("Reload not detected", 1, sub.getInt("xmlReload"));
     }
 
+    /**
+     * Tests whether reloading works for a combined configuration nested in
+     * another combined configuration.
+     */
+    public void testReloadingNestedCC() throws IOException,
+            ConfigurationException
+    {
+        config.setForceReloadCheck(true);
+        File testXmlFile =
+                writeReloadFile(RELOAD_XML_NAME, RELOAD_XML_CONTENT, 0);
+        File testPropsFile =
+                writeReloadFile(RELOAD_PROPS_NAME, RELOAD_PROPS_CONTENT, 0);
+        XMLConfiguration c1 = new XMLConfiguration(testXmlFile);
+        c1.setReloadingStrategy(new FileAlwaysReloadingStrategy());
+        PropertiesConfiguration c2 = new PropertiesConfiguration(testPropsFile);
+        c2.setReloadingStrategy(new FileAlwaysReloadingStrategy());
+        config.addConfiguration(c2);
+        CombinedConfiguration cc2 = new CombinedConfiguration();
+        cc2.setForceReloadCheck(true);
+        cc2.addConfiguration(c1);
+        config.addConfiguration(cc2);
+        assertEquals("Wrong xml reload value", 0, config.getInt("xmlReload"));
+        writeReloadFile(RELOAD_XML_NAME, RELOAD_XML_CONTENT, 1);
+        assertEquals("XML reload not detected", 1, config.getInt("xmlReload"));
+    }
+
     /**
      * Prepares a test of the getSource() method.
      */
