From 1e4034bf41b21852d674e1cc0b845df1feda793f Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 10 May 2010 14:12:34 +0000
Subject: [PATCH] COMPRESS-107 - recognise Ant tar files

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@942746 13f79535-47bb-0310-9956-ffa450edef68
---
 .../archivers/tar/TarArchiveInputStream.java  | 19 ++++++++++++++-----
 1 file changed, 14 insertions(+), 5 deletions(-)

diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java
index 816f7e33bb3..582d4509747 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java
@@ -326,27 +326,36 @@ public static boolean matches(byte[] signature, int length) {
             return false;
         }
 
-        if (ArchiveUtils.matchAsciiBuffer(TarConstants.MAGIC_POSIX, 
+        if (ArchiveUtils.matchAsciiBuffer(TarConstants.MAGIC_POSIX,
                 signature, TarConstants.MAGIC_OFFSET, TarConstants.MAGICLEN)
             &&
-            ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_POSIX, 
+            ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_POSIX,
                 signature, TarConstants.VERSION_OFFSET, TarConstants.VERSIONLEN)
                 ){
             return true;
         }
-        if (ArchiveUtils.matchAsciiBuffer(TarConstants.MAGIC_GNU, 
+        if (ArchiveUtils.matchAsciiBuffer(TarConstants.MAGIC_GNU,
                 signature, TarConstants.MAGIC_OFFSET, TarConstants.MAGICLEN)
             &&
             (
-             ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_GNU_SPACE, 
+             ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_GNU_SPACE,
                 signature, TarConstants.VERSION_OFFSET, TarConstants.VERSIONLEN)
             ||
-            ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_GNU_ZERO, 
+            ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_GNU_ZERO,
                 signature, TarConstants.VERSION_OFFSET, TarConstants.VERSIONLEN)
             )
                 ){
             return true;
         }
+        // COMPRESS-107 - recognise Ant tar files
+        if (ArchiveUtils.matchAsciiBuffer(TarConstants.MAGIC_ANT,
+                signature, TarConstants.MAGIC_OFFSET, TarConstants.MAGICLEN)
+            &&
+            ArchiveUtils.matchAsciiBuffer(TarConstants.VERSION_ANT,
+                signature, TarConstants.VERSION_OFFSET, TarConstants.VERSIONLEN)
+                ){
+            return true;
+        }
         return false;
     }
 
