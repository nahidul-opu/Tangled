From 1eb9dbb7fd336b1e8a160977722b570354040798 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Tue, 26 Oct 2010 09:44:59 +0000
Subject: [PATCH] write all buffered data to the stream in
 TarArchiveOutputStream#finish.  COMPRESS-119

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1027427 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                    | 7 ++++++-
 .../compress/archivers/tar/TarArchiveOutputStream.java     | 1 +
 .../apache/commons/compress/archivers/tar/TarBuffer.java   | 2 +-
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index aef63eacf1d..0d32019233c 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -44,7 +44,12 @@ The <action> type attribute can be add,update,fix,remove.
     <title>commons-compress</title>
   </properties>
   <body>
-    <release version="1.1" date="as in SVN" description="Release 1.1">
+    <release version="1.2" date="as in SVN" description="Release 1.2">
+      <action issue="COMPRESS-119" type="fix" date="2010-10-26">
+        TarArchiveOutputStream#finish now writes all buffered data ot the stream
+      </action> 
+    </release>
+    <release version="1.1" date="2010-08-13" description="Release 1.1">
       <action issue="COMPRESS-72" type="fix" date="2010-06-02">
        Move acknowledgements from NOTICE to README
       </action> 
diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveOutputStream.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveOutputStream.java
index 0db3c56afd6..bda7ad59df6 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveOutputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveOutputStream.java
@@ -123,6 +123,7 @@ public void finish() throws IOException {
         }
         writeEOFRecord();
         writeEOFRecord();
+        buffer.flushBlock();
         finished = true;
     }
 
diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java
index 3b57affe2fa..14f1e2993f0 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarBuffer.java
@@ -379,7 +379,7 @@ private void writeBlock() throws IOException {
     /**
      * Flush the current data block if it has any data in it.
      */
-    private void flushBlock() throws IOException {
+    void flushBlock() throws IOException {
         if (outStream == null) {
             throw new IOException("writing to an input buffer");
         }
