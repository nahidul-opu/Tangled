From c1ae99e7dd9f1a2ad0623202ea179b1ae8f8d8da Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Fri, 28 Mar 2014 05:04:45 +0000
Subject: [PATCH] COMPRESS-270 reading PAX headers may fail on unbuffered
 InputStreams

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1582594 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/compress/archivers/tar/TarArchiveInputStream.java   | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java
index 2f4ce6eabc7..d79eb8aaf62 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStream.java
@@ -418,7 +418,7 @@ Map<String, String> parsePaxHeaders(InputStream i) throws IOException {
                             String keyword = coll.toString(CharsetNames.UTF_8);
                             // Get rest of entry
                             byte[] rest = new byte[len - read];
-                            int got = i.read(rest);
+                            int got = IOUtils.readFully(i, rest);
                             if (got != len - read){
                                 throw new IOException("Failed to read "
                                                       + "Paxheader. Expected "
