From f700aeba3e2f05c8bd4618354be9b3f17707252a Mon Sep 17 00:00:00 2001
From: Gilles Sadowski <erans@apache.org>
Date: Fri, 27 Apr 2012 23:30:41 +0000
Subject: [PATCH] MATH-782 Location of user-defined convergence check.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/math/trunk@1331635 13f79535-47bb-0310-9956-ffa450edef68
---
 .../univariate/BrentOptimizer.java            | 20 +++++++++----------
 1 file changed, 10 insertions(+), 10 deletions(-)

diff --git a/src/main/java/org/apache/commons/math3/optimization/univariate/BrentOptimizer.java b/src/main/java/org/apache/commons/math3/optimization/univariate/BrentOptimizer.java
index 15a498c525..ee2227cdb4 100644
--- a/src/main/java/org/apache/commons/math3/optimization/univariate/BrentOptimizer.java
+++ b/src/main/java/org/apache/commons/math3/optimization/univariate/BrentOptimizer.java
@@ -220,6 +220,16 @@ protected UnivariatePointValuePair doOptimize() {
                     fu = -fu;
                 }
 
+                // User-defined convergence checker.
+                previous = current;
+                current = new UnivariatePointValuePair(u, isMinim ? fu : -fu);
+
+                if (checker != null) {
+                    if (checker.converged(iter, previous, current)) {
+                        return current;
+                    }
+                }
+
                 // Update a, b, v, w and x.
                 if (fu <= fx) {
                     if (u < x) {
@@ -233,16 +243,6 @@ protected UnivariatePointValuePair doOptimize() {
                     fw = fx;
                     x = u;
                     fx = fu;
-
-                    // User-defined convergence checker.
-                    previous = current;
-                    current = new UnivariatePointValuePair(x, isMinim ? fx : -fx);
-
-                    if (checker != null) {
-                        if (checker.converged(iter, previous, current)) {
-                            return current;
-                        }
-                    }
                 } else {
                     if (u < x) {
                         a = u;
