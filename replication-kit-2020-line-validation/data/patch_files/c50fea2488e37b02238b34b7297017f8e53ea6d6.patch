From c50fea2488e37b02238b34b7297017f8e53ea6d6 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Wed, 7 Mar 2007 16:44:02 +0000
Subject: [PATCH] FIX: bad timestamps were causing tests with latest-time to
 fail for IVY-407

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/core/trunk@515638 13f79535-47bb-0310-9956-ffa450edef68
---
 .../conflict/LatestConflictManagerTest.java      | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/test/java/org/apache/ivy/plugins/conflict/LatestConflictManagerTest.java b/test/java/org/apache/ivy/plugins/conflict/LatestConflictManagerTest.java
index 37bfced09..d7ec5cde0 100644
--- a/test/java/org/apache/ivy/plugins/conflict/LatestConflictManagerTest.java
+++ b/test/java/org/apache/ivy/plugins/conflict/LatestConflictManagerTest.java
@@ -89,6 +89,14 @@ public void testLatestTime1() throws Exception {
 		ivy = new Ivy();
 		ivy.configure(LatestConflictManagerTest.class
 				.getResource("ivyconf-latest-time.xml"));
+    	ivy.getSettings().setVariable("ivy.log.conflict.resolution", "true", true);
+
+    	// set timestamps, because svn is not preserving this information, 
+    	// and the latest time strategy is relying on it
+    	long time = System.currentTimeMillis() - 10000;
+    	new File("test/repositories/1/org1/mod1.2/jars/mod1.2-2.0.jar").setLastModified(time);
+    	new File("test/repositories/1/org1/mod1.2/jars/mod1.2-2.2.jar").setLastModified(time+2000);
+
         ResolveReport report =
             ivy.resolve( LatestConflictManagerTest.class.getResource( "ivy-latest-time-1.xml" ), 
             		getResolveOptions() );
@@ -110,6 +118,14 @@ public void testLatestTime2() throws Exception {
 		ivy = new Ivy();
 		ivy.configure(LatestConflictManagerTest.class
 				.getResource("ivyconf-latest-time.xml"));
+    	ivy.getSettings().setVariable("ivy.log.conflict.resolution", "true", true);
+
+    	// set timestamps, because svn is not preserving this information, 
+    	// and the latest time strategy is relying on it
+    	long time = System.currentTimeMillis() - 10000;
+    	new File("test/repositories/1/org1/mod1.2/jars/mod1.2-2.0.jar").setLastModified(time);
+    	new File("test/repositories/1/org1/mod1.2/jars/mod1.2-2.2.jar").setLastModified(time+2000);
+
         ResolveReport report =
             ivy.resolve( LatestConflictManagerTest.class.getResource( "ivy-latest-time-2.xml" ), 
             		getResolveOptions() );
