From ebfa9238effab582f48400c371a4b8c07e8d3bf3 Mon Sep 17 00:00:00 2001
From: Bernd Eckenfels <ecki@apache.org>
Date: Mon, 17 Nov 2014 22:12:13 +0000
Subject: [PATCH] [VFS-142] Remove instead of null out FileContentThreadData

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1640242 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs2/provider/DefaultFileContent.java   | 2 +-
 src/changes/changes.xml                                        | 3 +++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/DefaultFileContent.java b/core/src/main/java/org/apache/commons/vfs2/provider/DefaultFileContent.java
index fb406712dd..8f291e7935 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/DefaultFileContent.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/DefaultFileContent.java
@@ -525,7 +525,7 @@ public void close() throws FileSystemException
         }
         finally
         {
-            threadData.set(null);
+            threadData.remove();
         }
     }
 
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index aab6ffcd81..7d6c817650 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -26,6 +26,9 @@
 <!--       <action issue="VFS-443" dev="ggregory" type="update" due-to="nickallen"> -->
 <!--        [Local] Need an easy way to convert from a FileObject to a File. -->
 <!--       </action> -->
+      <action issue="VFS-142" dev="ecki" type="fix" due-to="Ryan Boettcher">
+       Use ThreadLocal.remove() to clean out FileContentThreadData objects.
+      </action>
       <action issue="VFS-545" dev="ecki" type="fix">
        Make DefaultFilesCache remove reference to filesystem when it is cleared (closed).
       </action>
