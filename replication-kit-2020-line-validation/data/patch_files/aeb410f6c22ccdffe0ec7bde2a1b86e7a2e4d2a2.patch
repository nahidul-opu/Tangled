From aeb410f6c22ccdffe0ec7bde2a1b86e7a2e4d2a2 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Fri, 13 Feb 2009 11:39:48 +0000
Subject: [PATCH] FIX: Ivy retrieve does not honor validate="false" from
 ivysettings (IVY-992)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@744087 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                         |  1 +
 src/java/org/apache/ivy/ant/IvyPostResolveTask.java |  2 +-
 test/java/org/apache/ivy/ant/IvyRetrieveTest.java   | 10 ++++++++++
 3 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 15d414340..f86d4c5db 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -95,6 +95,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Error message is not clear when specifying an invalid value for checksums (IVY-977)
 - IMPROVEMENT: catch AccessControlException on System.getProperties() (IVY-1015)
 
+- FIX: Ivy retrieve does not honor validate="false" from ivysettings (IVY-992)
 - FIX: Snapshot issues when using ibiblio resolver with m2compatible is false (IVY-1028)
 - FIX: Ivy Standalone hangs after publishing to SSH resolver (IVY-1009)
 - FIX: overwrite='false' completely prevents publishing into url repositories (IVY-1007)
diff --git a/src/java/org/apache/ivy/ant/IvyPostResolveTask.java b/src/java/org/apache/ivy/ant/IvyPostResolveTask.java
index dcca7c435..acc57f267 100644
--- a/src/java/org/apache/ivy/ant/IvyPostResolveTask.java
+++ b/src/java/org/apache/ivy/ant/IvyPostResolveTask.java
@@ -288,7 +288,7 @@ protected IvyResolve createResolve(boolean haltOnFailure, boolean useOrigin) {
         resolve.setProject(getProject());
         resolve.setHaltonfailure(haltOnFailure);
         resolve.setUseOrigin(useOrigin);
-        resolve.setValidate(isValidate());
+        resolve.setValidate(doValidate(getSettings()));
         resolve.setKeep(isKeep());
         resolve.setRefresh(isRefresh());
         resolve.setLog(getLog());
diff --git a/test/java/org/apache/ivy/ant/IvyRetrieveTest.java b/test/java/org/apache/ivy/ant/IvyRetrieveTest.java
index 84e544057..cc421a6ad 100644
--- a/test/java/org/apache/ivy/ant/IvyRetrieveTest.java
+++ b/test/java/org/apache/ivy/ant/IvyRetrieveTest.java
@@ -80,6 +80,16 @@ public void testRetrievePrivateWithWildcard() throws Exception {
             "mod3.2", "jar", "jar", "private")).exists());
     }
 
+    public void testValidateInIvySettings() throws Exception {
+        // cfr IVY-992
+        project.setProperty("ivy.dep.file", "test/java/org/apache/ivy/ant/ivy-latest-extra.xml");
+        retrieve.getSettings().setValidate(false);
+        retrieve.execute();
+        
+        assertTrue(new File(IvyPatternHelper.substitute(RETRIEVE_PATTERN, "org1", "mod1.2", "2.2",
+            "mod1.2", "jar", "jar", "default")).exists());
+    }
+    
     public void testInline() throws Exception {
         // we first resolve another ivy file
         IvyResolve resolve = new IvyResolve();
