From adfaf3ba4254d38ef80aeb5bc6fd0df6fe98380a Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Sat, 22 Mar 2014 02:09:14 +0000
Subject: [PATCH] NET-529 SubnetUtils throws exception on valid input

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1580123 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                        |  3 +++
 .../apache/commons/net/util/SubnetUtils.java   |  3 ---
 .../apache/commons/net/SubnetUtilsTest.java    | 18 ------------------
 3 files changed, 3 insertions(+), 21 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 5129b5d9f..32b4651b6 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -65,6 +65,9 @@ The <action> type attribute can be add,update,fix,remove.
         <release version="3.4" date="2014-01-??" description="
 This is mainly a bug-fix release. See further details below.
         ">
+            <action issue="NET-529" type="fix" dev="sebb" due-to="Putinas Piliponis">
+            SubnetUtils throws exception on valid input
+            </action>
             <action issue="NET-527" type="add" dev="sebb" due-to="jason mathews">
             Add SimpleNTPServer as example and for testing
             </action>
diff --git a/src/main/java/org/apache/commons/net/util/SubnetUtils.java b/src/main/java/org/apache/commons/net/util/SubnetUtils.java
index 36ab0bb79..1fd7b7c87 100644
--- a/src/main/java/org/apache/commons/net/util/SubnetUtils.java
+++ b/src/main/java/org/apache/commons/net/util/SubnetUtils.java
@@ -255,9 +255,6 @@ private void calculate(String mask) {
 
             /* Create a binary netmask from the number of bits specification /x */
             int cidrPart = rangeCheck(Integer.parseInt(matcher.group(5)), 0, NBITS);
-            if (cidrPart == 0 && address != 0) {
-                throw new IllegalArgumentException("Cannot have /0 cidr with non-zero address");
-            }
             for (int j = 0; j < cidrPart; ++j) {
                 netmask |= (1 << 31 - j);
             }
diff --git a/src/test/java/org/apache/commons/net/SubnetUtilsTest.java b/src/test/java/org/apache/commons/net/SubnetUtilsTest.java
index a797b5a36..2aaa3c3ef 100644
--- a/src/test/java/org/apache/commons/net/SubnetUtilsTest.java
+++ b/src/test/java/org/apache/commons/net/SubnetUtilsTest.java
@@ -201,16 +201,6 @@ public void testInvalidMasks() {
             fail("Should have thrown IllegalArgumentException");
         } catch (IllegalArgumentException expected) {
         }
-        try {
-            new SubnetUtils("192.168.0.1/0");
-            fail("Should have thrown IllegalArgumentException");
-        } catch (IllegalArgumentException expected) {
-        }
-        try {
-            new SubnetUtils("192.168.0.1", "0.0.0.0");
-            fail("Should have thrown IllegalArgumentException");
-        } catch (IllegalArgumentException expected) {
-        }
     }
 
     public void testNET428_31() throws Exception {
@@ -305,14 +295,6 @@ public void testZeroAddressAndCidr() {
         new SubnetUtils("0.0.0.0/0");
     }
 
-    public void testZeroNetmaskBits() {
-        try {
-            new SubnetUtils("192.168.0.1/0");
-            fail("Mask /0 should have generated an IllegalArgumentException");
-        } catch (IllegalArgumentException expected) {
-        }
-    }
-
     public void testNET521() {
         SubnetUtils utils;
         SubnetInfo info;
