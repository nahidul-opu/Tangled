From 73ec9c125fc4cafada4434b02d603d41e092b675 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Thu, 17 Mar 2016 10:31:34 +0100
Subject: [PATCH] COMPRESS-343 try to free native memory even if close fails

---
 .../commons/compress/archivers/sevenz/Coders.java  | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/src/main/java/org/apache/commons/compress/archivers/sevenz/Coders.java b/src/main/java/org/apache/commons/compress/archivers/sevenz/Coders.java
index f67acccb600..06802e4e735 100644
--- a/src/main/java/org/apache/commons/compress/archivers/sevenz/Coders.java
+++ b/src/main/java/org/apache/commons/compress/archivers/sevenz/Coders.java
@@ -175,8 +175,11 @@ public int read(byte[] b) throws IOException {
 
                 @Override
                 public void close() throws IOException {
-                    inflaterInputStream.close();
-                    inflater.end();
+                    try {
+                        inflaterInputStream.close();
+                    } finally {
+                        inflater.end();
+                    }
                 }
             };
         }
@@ -203,8 +206,11 @@ public void write(byte[] b, int off, int len) throws IOException {
 
                 @Override
                 public void close() throws IOException {
-                    deflaterOutputStream.close();
-                    deflater.end();
+                    try {
+                        deflaterOutputStream.close();
+                    } finally {
+                        deflater.end();
+                    }
                 }
             };
         }
