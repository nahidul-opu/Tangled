From 8c5a4a7bafc3685d433ee277fad060e8b046e920 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Thu, 28 Feb 2013 22:50:44 +0000
Subject: [PATCH] FIX: Parsing publication date in Ant tasks not thread-safe
 (IVY-1412)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@1451412 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                              |  1 +
 src/java/org/apache/ivy/ant/IvyTask.java | 12 ++++--------
 2 files changed, 5 insertions(+), 8 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 30a405a4f..3e7e301de 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -143,6 +143,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: add support for source bundles from p2 repositories
 - IMPROVEMENT: add support for source URI from OBR repositories
 
+- FIX: Parsing publication date in Ant tasks not thread-safe (IVY-1412)
 - FIX: NullPointerException when using httpclient and server doesn't return content-type header (IVY-1400) (thanks to Frederic Riviere)
 - FIX: Properly handle evicted nodes in ResolveReport
 
diff --git a/src/java/org/apache/ivy/ant/IvyTask.java b/src/java/org/apache/ivy/ant/IvyTask.java
index fc683982a..338168085 100644
--- a/src/java/org/apache/ivy/ant/IvyTask.java
+++ b/src/java/org/apache/ivy/ant/IvyTask.java
@@ -17,8 +17,6 @@
  */
 package org.apache.ivy.ant;
 
-import java.text.DateFormat;
-import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.Locale;
 
@@ -27,6 +25,7 @@
 import org.apache.ivy.core.module.descriptor.ModuleDescriptor;
 import org.apache.ivy.core.report.ResolveReport;
 import org.apache.ivy.core.settings.IvySettings;
+import org.apache.ivy.util.DateUtil;
 import org.apache.ivy.util.Message;
 import org.apache.ivy.util.StringUtils;
 import org.apache.tools.ant.BuildException;
@@ -184,19 +183,16 @@ protected String mergeConfs(String[] conf) {
         return StringUtils.join(conf, ", ");
     }
 
-    private static final DateFormat DATE_FORMAT = new SimpleDateFormat("yyyyMMddHHmmss");
-
     protected static Date getPubDate(String date, Date def) {
         if (date != null) {
             if ("now".equals(date.toLowerCase(Locale.US))) {
                 return new Date();
             }
             try {
-                return DATE_FORMAT.parse(date);
+                return DateUtil.parse(date);
             } catch (Exception ex) {
-                throw new BuildException(
-                        "publication date provided in bad format. should be yyyyMMddHHmmss and not "
-                                + date);
+                throw new BuildException("Publication date provided in bad format. Should be '" 
+                                + DateUtil.DATE_FORMAT_PATTERN + "' and not '" + date + "'!");
             }
         } else {
             return def;
