From d800c7e47c66b6b80ed19c7fb2b27d0b8b987b40 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Mon, 21 Dec 2009 23:07:00 +0000
Subject: [PATCH] FIX: Ivy does not close URL connection to ivy-report.xsl
 properly (IVY-1152)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@893024 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                           | 1 +
 src/java/org/apache/ivy/util/url/BasicURLHandler.java | 8 +-------
 2 files changed, 2 insertions(+), 7 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index b3b730224..c3d9a7ed5 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -102,6 +102,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Trace a message when a property file referenced from the settings doesn't exixts (IVY-1074)
 - IMPROVEMENT: use defaultconf in combination with defaultconfmapping (IVY-1135) (thanks to Jon Schneider)
 
+- FIX: Ivy does not close URL connection to ivy-report.xsl properly (IVY-1152)
 - FIX: Artifact report throws NPE when artifact is not in cache (IVY-1150) (thanks to Steve Jones)
 - FIX: resolve fails for transitive relocated maven modules when the type of the dependency was set to 'jar'
 - FIX: optional dependencies, sources and javadocs aren't resolved when a maven module is relocated
diff --git a/src/java/org/apache/ivy/util/url/BasicURLHandler.java b/src/java/org/apache/ivy/util/url/BasicURLHandler.java
index 25b362250..215faed72 100644
--- a/src/java/org/apache/ivy/util/url/BasicURLHandler.java
+++ b/src/java/org/apache/ivy/util/url/BasicURLHandler.java
@@ -215,13 +215,7 @@ private void disconnect(URLConnection con) {
             }
             
             ((HttpURLConnection) con).disconnect();
-        } else if (con != null
-                && "sun.net.www.protocol.file.FileURLConnection".equals(con.getClass().getName())) {
-            // ugly fix for a sun jre bug:
-            // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4257700
-            //
-            // getting header info on the fileurlconnection opens the connection,
-            // which opens a file input stream without closing it.
+        } else if (con != null) {
             try {
                 con.getInputStream().close();
             } catch (IOException e) {
