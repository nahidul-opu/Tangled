From fb7aae4c64f7d2bf6dced00c49c3ffc428b2d572 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Fri, 5 Oct 2018 19:36:40 +0000
Subject: [PATCH] NET-614 IMAP fails to quote/encode mailbox names More
 commands with mailbox name parameters

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1842972 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/net/imap/IMAP.java     |  2 +-
 .../apache/commons/net/imap/IMAPClient.java   | 24 +++++++++----------
 2 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/imap/IMAP.java b/src/main/java/org/apache/commons/net/imap/IMAP.java
index 0c17012b1..272a53452 100644
--- a/src/main/java/org/apache/commons/net/imap/IMAP.java
+++ b/src/main/java/org/apache/commons/net/imap/IMAP.java
@@ -480,7 +480,7 @@ protected String generateCommandID()
      * @param input the value to be quoted, may be null
      * @return the quoted value
      */
-    static String quoteString(String input) {
+    static String quoteMailboxName(String input) {
         if (input == null) { // Don't throw NPE here
             return null;
         }
diff --git a/src/main/java/org/apache/commons/net/imap/IMAPClient.java b/src/main/java/org/apache/commons/net/imap/IMAPClient.java
index 1d4e60e87..fd243a36e 100644
--- a/src/main/java/org/apache/commons/net/imap/IMAPClient.java
+++ b/src/main/java/org/apache/commons/net/imap/IMAPClient.java
@@ -112,7 +112,7 @@ public boolean login(String username, String password) throws IOException
      */
     public boolean select(String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.SELECT, mailboxName);
+        return doCommand (IMAPCommand.SELECT, quoteMailboxName(mailboxName));
     }
 
     /**
@@ -123,7 +123,7 @@ public boolean select(String mailboxName) throws IOException
      */
     public boolean examine(String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.EXAMINE, mailboxName);
+        return doCommand (IMAPCommand.EXAMINE, quoteMailboxName(mailboxName));
     }
 
     /**
@@ -134,7 +134,7 @@ public boolean examine(String mailboxName) throws IOException
      */
     public boolean create(String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.CREATE, mailboxName);
+        return doCommand (IMAPCommand.CREATE, quoteMailboxName(mailboxName));
     }
 
     /**
@@ -145,7 +145,7 @@ public boolean create(String mailboxName) throws IOException
      */
     public boolean delete(String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.DELETE, mailboxName);
+        return doCommand (IMAPCommand.DELETE, quoteMailboxName(mailboxName));
     }
 
     /**
@@ -157,7 +157,7 @@ public boolean delete(String mailboxName) throws IOException
      */
     public boolean rename(String oldMailboxName, String newMailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.RENAME, oldMailboxName + " " + newMailboxName);
+        return doCommand (IMAPCommand.RENAME, quoteMailboxName(oldMailboxName) + " " + quoteMailboxName(newMailboxName));
     }
 
     /**
@@ -168,7 +168,7 @@ public boolean rename(String oldMailboxName, String newMailboxName) throws IOExc
      */
     public boolean subscribe(String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.SUBSCRIBE, mailboxName);
+        return doCommand (IMAPCommand.SUBSCRIBE, quoteMailboxName(mailboxName));
     }
 
     /**
@@ -179,7 +179,7 @@ public boolean subscribe(String mailboxName) throws IOException
      */
     public boolean unsubscribe(String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.UNSUBSCRIBE, mailboxName);
+        return doCommand (IMAPCommand.UNSUBSCRIBE, quoteMailboxName(mailboxName));
     }
 
     /**
@@ -196,7 +196,7 @@ public boolean unsubscribe(String mailboxName) throws IOException
      */
     public boolean list(String refName, String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.LIST, quoteString(refName) + " " + quoteString(mailboxName));
+        return doCommand (IMAPCommand.LIST, quoteMailboxName(refName) + " " + quoteMailboxName(mailboxName));
     }
 
     /**
@@ -209,7 +209,7 @@ public boolean list(String refName, String mailboxName) throws IOException
      */
     public boolean lsub(String refName, String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.LSUB, quoteString(refName) + " " + quoteString(mailboxName));
+        return doCommand (IMAPCommand.LSUB, quoteMailboxName(refName) + " " + quoteMailboxName(mailboxName));
     }
 
     /**
@@ -226,7 +226,7 @@ public boolean status(String mailboxName, String[] itemNames) throws IOException
         }
 
         StringBuilder sb = new StringBuilder();
-        sb.append(mailboxName);
+        sb.append(quoteMailboxName(mailboxName));
 
         sb.append(" (");
         for ( int i = 0; i < itemNames.length; i++ )
@@ -253,7 +253,7 @@ public boolean status(String mailboxName, String[] itemNames) throws IOException
      */
     public boolean append(String mailboxName, String flags, String datetime, String message) throws IOException
     {
-        StringBuilder args = new StringBuilder(mailboxName);
+        StringBuilder args = new StringBuilder(quoteMailboxName(mailboxName));
         if (flags != null) {
             args.append(" ").append(flags);
         }
@@ -417,7 +417,7 @@ public boolean store(String sequenceSet, String itemNames, String itemValues)
      */
     public boolean copy(String sequenceSet, String mailboxName) throws IOException
     {
-        return doCommand (IMAPCommand.COPY, sequenceSet + " " + mailboxName);
+        return doCommand (IMAPCommand.COPY, sequenceSet + " " + quoteMailboxName(mailboxName));
     }
 
     /**
