From 4a2cc4f5da0fbf9552d2b35aa457de64c47626b9 Mon Sep 17 00:00:00 2001
From: "Bruno P. Kinoshita" <kinow@apache.org>
Date: Sun, 14 Dec 2014 18:22:06 +0000
Subject: [PATCH] LANG-1073 Read wrong component type of array in add in
 ArrayUtils

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/lang/trunk@1645483 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                | 1 +
 src/main/java/org/apache/commons/lang3/ArrayUtils.java | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 9d52137aa61..061542a4c4d 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -22,6 +22,7 @@
   <body>
 
   <release version="3.4" date="tba" description="tba">
+    <action issue="LANG-1073" type="fix" dev="kinow" due-to="haiyang li">Read wrong component type of array in add in ArrayUtils</action>
     <action issue="LANG-1077" type="fix" dev="kinow" due-to="haiyang li">StringUtils.ordinalIndexOf("aaaaaa", "aa", 2) != 3 in StringUtils</action>
     <action issue="LANG-1072" type="fix" dev="sebb" due-to="haiyang li">Duplicated "0x" check in createBigInteger in NumberUtils</action>
     <action issue="LANG-1064" type="fix" dev="djones" due-to="B.J. Herbison">StringUtils.abbreviate description doesn't agree with the examples</action>
diff --git a/src/main/java/org/apache/commons/lang3/ArrayUtils.java b/src/main/java/org/apache/commons/lang3/ArrayUtils.java
index 644c0b88086..3d3b76b646a 100644
--- a/src/main/java/org/apache/commons/lang3/ArrayUtils.java
+++ b/src/main/java/org/apache/commons/lang3/ArrayUtils.java
@@ -4008,7 +4008,7 @@ public static double[] addAll(final double[] array1, final double... array2) {
     public static <T> T[] add(final T[] array, final T element) {
         Class<?> type;
         if (array != null){
-            type = array.getClass();
+            type = array.getClass().getComponentType();
         } else if (element != null) {
             type = element.getClass();
         } else {
