From ccb0bba48e88c4a66f2d8111437aa314df4fbad1 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 18 Apr 2011 22:40:24 +0000
Subject: [PATCH] VALIDATOR-294 NPE in CodeValidator.validate(null) if RE is
 null but min or max are not -1

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/validator/trunk@1094799 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/validator/routines/CodeValidator.java    |  8 ++++++--
 .../validator/routines/CodeValidatorTest.java        | 12 ++++++++++++
 2 files changed, 18 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/commons/validator/routines/CodeValidator.java b/src/main/java/org/apache/commons/validator/routines/CodeValidator.java
index d9de79450..311113010 100644
--- a/src/main/java/org/apache/commons/validator/routines/CodeValidator.java
+++ b/src/main/java/org/apache/commons/validator/routines/CodeValidator.java
@@ -213,8 +213,12 @@ public boolean isValid(String input) {
      */
     public Object validate(String input) {
 
-        String code = (input == null ? null : input.trim());
-        if (code != null && code.length() == 0) {
+        if (input == null) {
+            return null;
+        }
+
+        String code = input.trim();
+        if (code.length() == 0) {
             return null;
         }
 
diff --git a/src/test/java/org/apache/commons/validator/routines/CodeValidatorTest.java b/src/test/java/org/apache/commons/validator/routines/CodeValidatorTest.java
index f2a86059b..b9f192cb6 100644
--- a/src/test/java/org/apache/commons/validator/routines/CodeValidatorTest.java
+++ b/src/test/java/org/apache/commons/validator/routines/CodeValidatorTest.java
@@ -195,6 +195,18 @@ public void testNoInput() {
         assertEquals("Trimmed",      "A",  validator.validate(" A  "));
     }
 
+    public void testValidator294_1() {
+        CodeValidator validator = new CodeValidator((String)null, 0, -1, (CheckDigit)null);
+        assertEquals("Null",         null, validator.validate(null));
+        validator = new CodeValidator((String)null, -1, 0, (CheckDigit)null);
+        assertEquals("Null",         null, validator.validate(null));
+    }
+
+    public void testValidator294_2() {
+        CodeValidator validator = new CodeValidator((String)null, -1, 0, (CheckDigit)null);
+        assertEquals("Null",         null, validator.validate(null));
+    }
+
     /**
      * Test Regular Expression.
      */
