From 8bc2bf074a3f448b17069bad07d842f40abd1ff6 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Thu, 4 Jan 2007 22:38:49 +0000
Subject: [PATCH] FIX: IOException during publish causes NullPointerException
 (IVY-371)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/trunk@492785 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                                 | 2 ++
 src/java/fr/jayasoft/ivy/repository/AbstractRepository.java | 4 ----
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 0f1a0dd20..6c6241c5e 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -10,6 +10,8 @@ for detailed view of each issue, please consult http://jira.jayasoft.org/
 - IMPROVE: Please typedef CacheResolver as "cache" for us (IVY-359)
 - IMPROVE: ivy:retrieve should be able to create symlinks (IVY-353) (thanks to John Williams)
 
+- FIX: IOException during publish causes NullPointerException (IVY-371)
+
    version 1.4.1 - 2006-11-09
 =====================================
 - IMPROVE: ability to rebuild all dependent projects from a leaf (IVY-101)
diff --git a/src/java/fr/jayasoft/ivy/repository/AbstractRepository.java b/src/java/fr/jayasoft/ivy/repository/AbstractRepository.java
index fabe3a059..9000223cf 100644
--- a/src/java/fr/jayasoft/ivy/repository/AbstractRepository.java
+++ b/src/java/fr/jayasoft/ivy/repository/AbstractRepository.java
@@ -65,7 +65,6 @@ protected void fireTransferCompleted() {
         	_evt.setTotalLengthSet(true);
         }
         fireTransferEvent(_evt);
-        _evt = null;
     }
     
     protected void fireTransferCompleted(long totalLength) {
@@ -73,20 +72,17 @@ protected void fireTransferCompleted(long totalLength) {
         _evt.setTotalLength(totalLength);
         _evt.setTotalLengthSet(true);
         fireTransferEvent(_evt);
-        _evt = null;
     }
     
     protected void fireTransferError() {
         _evt.setEventType(TransferEvent.TRANSFER_ERROR);
         fireTransferEvent(_evt);
-        _evt = null;
     }
     
     protected void fireTransferError(Exception ex) {
         _evt.setEventType(TransferEvent.TRANSFER_ERROR);
         _evt.setException(ex);
         fireTransferEvent(_evt);
-        _evt = null;
     }
     
     protected void fireTransferEvent(TransferEvent evt) {
