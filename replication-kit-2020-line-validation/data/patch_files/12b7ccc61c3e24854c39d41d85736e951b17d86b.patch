From 12b7ccc61c3e24854c39d41d85736e951b17d86b Mon Sep 17 00:00:00 2001
From: Rodrigo Agerri <ragerri@apache.org>
Date: Thu, 16 Oct 2014 20:33:51 +0000
Subject: [PATCH] OPENNLP-721 fixing xpath expression in GeneratorFactory

git-svn-id: https://svn.apache.org/repos/asf/opennlp/trunk@1632434 13f79535-47bb-0310-9956-ffa450edef68
---
 .../opennlp/tools/util/featuregen/GeneratorFactory.java    | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/opennlp-tools/src/main/java/opennlp/tools/util/featuregen/GeneratorFactory.java b/opennlp-tools/src/main/java/opennlp/tools/util/featuregen/GeneratorFactory.java
index 3500f0ed7..5d69fc9ed 100644
--- a/opennlp-tools/src/main/java/opennlp/tools/util/featuregen/GeneratorFactory.java
+++ b/opennlp-tools/src/main/java/opennlp/tools/util/featuregen/GeneratorFactory.java
@@ -31,6 +31,7 @@
 import javax.xml.parsers.ParserConfigurationException;
 import javax.xml.xpath.XPath;
 import javax.xml.xpath.XPathConstants;
+import javax.xml.xpath.XPathExpression;
 import javax.xml.xpath.XPathExpressionException;
 import javax.xml.xpath.XPathFactory;
 
@@ -599,7 +600,6 @@ private static org.w3c.dom.Document createDOM(InputStream xmlDescriptorIn)
     } catch (SAXException e) {
       throw new InvalidFormatException("Descriptor is not valid XML!", e);
     }
-
     return xmlDescriptorDOM;
   }
 
@@ -640,10 +640,12 @@ public static Map<String, ArtifactSerializer<?>> extractCustomArtifactSerializer
     org.w3c.dom.Document xmlDescriptorDOM = createDOM(xmlDescriptorIn);
 
     XPath xPath = XPathFactory.newInstance().newXPath();
+    
 
     NodeList customElements;
     try {
-      customElements = (NodeList) xPath.evaluate("custom", xmlDescriptorDOM.getDocumentElement(), XPathConstants.NODESET);
+      XPathExpression exp = xPath.compile("//custom");
+      customElements = (NodeList) exp.evaluate(xmlDescriptorDOM.getDocumentElement(), XPathConstants.NODESET);
     } catch (XPathExpressionException e) {
       throw new IllegalStateException("The hard coded XPath expression should always be valid!");
     }
@@ -663,7 +665,6 @@ public static Map<String, ArtifactSerializer<?>> extractCustomArtifactSerializer
         }
       }
     }
-
     return mapping;
   }
 }
