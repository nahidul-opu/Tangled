From 17959f838d049c87de800ce848d01b3dcdffd19c Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 7 Apr 2008 02:07:03 +0000
Subject: [PATCH] Test case for NET-211

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@645341 13f79535-47bb-0310-9956-ffa450edef68
---
 .../parser/FTPTimestampParserImplTest.java    | 26 ++++++++++++++++++-
 1 file changed, 25 insertions(+), 1 deletion(-)

diff --git a/src/test/org/apache/commons/net/ftp/parser/FTPTimestampParserImplTest.java b/src/test/org/apache/commons/net/ftp/parser/FTPTimestampParserImplTest.java
index ce0ad0562..a0bae3c70 100644
--- a/src/test/org/apache/commons/net/ftp/parser/FTPTimestampParserImplTest.java
+++ b/src/test/org/apache/commons/net/ftp/parser/FTPTimestampParserImplTest.java
@@ -138,7 +138,7 @@ public void testParseTimestampAcrossTimeZones() {
 			// the only difference should be the two hours
 			// difference, no rolling back a year should occur.
 			assertEquals("no.rollback.because.of.time.zones",
-				(long)TWO_HOURS_OF_MILLISECONDS, 
+				TWO_HOURS_OF_MILLISECONDS, 
 				cal.getTime().getTime() - parsed.getTime().getTime());
 		} catch (ParseException e){
 			fail("Unable to parse " + fmtTimePlusOneHour);
@@ -227,7 +227,15 @@ public void testParser() {
      * Check how short date is interpreted at a given time
      */
     private void checkShortParse(String msg, Calendar now, Calendar input) throws ParseException {
+        checkShortParse(msg, now, input, false);
+    }
+
+    /*
+     * Check how short date is interpreted at a given time
+     */
+    private void checkShortParse(String msg, Calendar now, Calendar input, boolean lenient) throws ParseException {
         FTPTimestampParserImpl parser = new FTPTimestampParserImpl();
+        parser.setLenientFutureDates(lenient);
         Format shortFormat = parser.getRecentDateFormat(); // It's expecting this format
         Format longFormat = new SimpleDateFormat("yyyy-MM-dd hh:mm");
         
@@ -327,6 +335,22 @@ public void testFeb29NonLeapYear(){
         }
     }
 
+    public void testParseDec31Lenient() throws Exception {
+        GregorianCalendar now = new GregorianCalendar(2007, Calendar.DECEMBER, 30, 12, 0);
+        checkShortParse("2007-12-30",now,now); // should always work
+        GregorianCalendar target = (GregorianCalendar) now.clone();
+        target.add(Calendar.DAY_OF_YEAR, +1); // tomorrow
+        checkShortParse("2007-12-31",now,target, true);
+    }
+
+    public void testParseJan01Lenient() throws Exception {
+        GregorianCalendar now = new GregorianCalendar(2007, Calendar.DECEMBER, 31, 12, 0);
+        checkShortParse("2007-12-31",now,now); // should always work
+        GregorianCalendar target = (GregorianCalendar) now.clone();
+        target.add(Calendar.DAY_OF_YEAR, +1); // tomorrow
+        checkShortParse("2008-1-1",now,target, true);
+    }
+
     /**
      * Method suite.
      *
