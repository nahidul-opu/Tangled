From 03b4f61f142fad60772c19be96253c45b4ad27ab Mon Sep 17 00:00:00 2001
From: Thomas Neidhart <tn@apache.org>
Date: Thu, 16 May 2013 21:09:07 +0000
Subject: [PATCH] [LANG-887] Use the cache in FastDateParser correctly.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/lang/trunk@1483568 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                         | 1 +
 src/main/java/org/apache/commons/lang3/time/FastDateParser.java | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index ce51d08c977..3c6f46d9639 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -22,6 +22,7 @@
   <body>
 
   <release version="3.2" date="TBA" description="Next release">
+    <action issue="LANG-887" type="fix">FastDateFormat does not use the locale specific cache correctly</action>
     <action issue="LANG-884" type="update">Simplify FastDateFormat; eliminate boxing</action>
     <action issue="LANG-882" type="update">LookupTranslator now works with implementations of CharSequence other than String</action>
     <action issue="LANG-754" type="fix">ClassUtils.getShortName(String) will now only do a reverse lookup for array types</action>  
diff --git a/src/main/java/org/apache/commons/lang3/time/FastDateParser.java b/src/main/java/org/apache/commons/lang3/time/FastDateParser.java
index 8fa03289b50..b9bb413b5ad 100644
--- a/src/main/java/org/apache/commons/lang3/time/FastDateParser.java
+++ b/src/main/java/org/apache/commons/lang3/time/FastDateParser.java
@@ -497,7 +497,7 @@ private static ConcurrentMap<Locale, Strategy> getCache(final int field) {
      */
     private Strategy getLocaleSpecificStrategy(final int field, final Calendar definingCalendar) {
         final ConcurrentMap<Locale,Strategy> cache = getCache(field);
-        Strategy strategy= cache.get(Integer.valueOf(field));
+        Strategy strategy= cache.get(locale);
         if(strategy==null) {
             strategy= field==Calendar.ZONE_OFFSET
                     ? new TimeZoneStrategy(locale)
