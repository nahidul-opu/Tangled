From 1fa1b9ec8b48e6a3e69a2629b051927bd70305c8 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Tue, 5 Apr 2011 21:54:24 +0000
Subject: [PATCH] NET-401 FTP class uses BufferedReader for control channel,
 which does not follow the standard. Changed reader to CRLFLineReader.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1089258 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                           | 4 ++++
 src/main/java/org/apache/commons/net/ftp/FTP.java | 3 ++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 05e576253..3a9af476c 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -67,6 +67,10 @@ This release is binary-compatible with 2.2, but there are some minor changes to
   - ftp.FTPSClient ctors no longer throw NoSuchAlgorithmException
   All users are recommended to upgrade.
 ">
+            <action issue="NET-401" dev="sebb" type="fix">
+            FTP class uses BufferedReader for control channel, which does not follow the standard.
+            Changed reader to CRLFLineReader.
+            </action>
             <action issue="NET-331" dev="sebb" type="update">
             AS400 file timestamp format is wrong. Workround exists.
             </action>
diff --git a/src/main/java/org/apache/commons/net/ftp/FTP.java b/src/main/java/org/apache/commons/net/ftp/FTP.java
index a9810e83a..7e7b3e0b3 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTP.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTP.java
@@ -31,6 +31,7 @@
 import org.apache.commons.net.MalformedServerReplyException;
 import org.apache.commons.net.ProtocolCommandSupport;
 import org.apache.commons.net.SocketClient;
+import org.apache.commons.net.io.CRLFLineReader;
 
 /***
  * FTP provides the basic the functionality necessary to implement your
@@ -369,7 +370,7 @@ protected void _connectAction_() throws IOException
     {
         super._connectAction_(); // sets up _input_ and _output_
         _controlInput_ =
-            new BufferedReader(new InputStreamReader(_input_, getControlEncoding()));
+            new CRLFLineReader(new InputStreamReader(_input_, getControlEncoding()));
         _controlOutput_ =
             new BufferedWriter(new OutputStreamWriter(_output_, getControlEncoding()));
         if (connectTimeout > 0) { // NET-385
