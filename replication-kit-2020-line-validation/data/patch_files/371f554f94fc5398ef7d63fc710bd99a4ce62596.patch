From 371f554f94fc5398ef7d63fc710bd99a4ce62596 Mon Sep 17 00:00:00 2001
From: Roman Shaposhnik <rvs@apache.org>
Date: Tue, 15 Oct 2013 16:28:18 -0700
Subject: [PATCH] GIRAPH-782. giraph script can't find GIRAPH_ENV_DIR when
 called via $PATH

---
 bin/giraph           | 2 +-
 bin/giraph-admin     | 2 +-
 bin/giraph-env       | 2 +-
 bin/halt-application | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/bin/giraph b/bin/giraph
index bc4f5dcc2..e1b0fe9d6 100755
--- a/bin/giraph
+++ b/bin/giraph
@@ -23,7 +23,7 @@ if [ $# = 0 ]; then
 fi
 
 # locate and run the giraph-env script to populate env vars, classpath, etc.
-GIRAPH_ENV_DIR="$( cd -P "$( dirname "$0" )" && pwd )"
+GIRAPH_ENV_DIR="$( cd -P "$( dirname "${BASH_SOURCE:-0}" )" && pwd )"
 source $GIRAPH_ENV_DIR/giraph-env
 
 exec "$HADOOP_HOME/bin/hadoop" --config $HADOOP_CONF_DIR jar $JAR $CLASS $HADOOP_PROPERTIES -libjars $GIRAPH_JARS  "$@"
diff --git a/bin/giraph-admin b/bin/giraph-admin
index 827c289da..1c43778da 100644
--- a/bin/giraph-admin
+++ b/bin/giraph-admin
@@ -24,7 +24,7 @@ if [ $# = 0 ]; then
   exit 1
 fi
 
-GIRAPH_ENV_DIR="$( cd -P "$( dirname "$0" )" && pwd )"
+GIRAPH_ENV_DIR="$( cd -P "$( dirname "${BASH_SOURCE:-0}" )" && pwd )"
 source $GIRAPH_ENV_DIR/giraph-env
 
 # run the ZK cleaner?
diff --git a/bin/giraph-env b/bin/giraph-env
index 46852a691..9352d1569 100644
--- a/bin/giraph-env
+++ b/bin/giraph-env
@@ -15,7 +15,7 @@
 
 
 # resolve links - $0 may be a softlink
-THIS="$0"
+THIS="${BASH_SOURCE:-0}"
 while [ -h "$THIS" ]; do
   ls=`ls -ld "$THIS"`
   link=`expr "$ls" : '.*-> \(.*\)$'`
diff --git a/bin/halt-application b/bin/halt-application
index 0526661c8..e71177fda 100644
--- a/bin/halt-application
+++ b/bin/halt-application
@@ -15,7 +15,7 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-GIRAPH_ENV_DIR="$( cd -P "$( dirname "$0" )" && pwd )"
+GIRAPH_ENV_DIR="$( cd -P "$( dirname "${BASH_SOURCE:-0}" )" && pwd )"
 source $GIRAPH_ENV_DIR/giraph-env
 
 CLASS=org.apache.giraph.zk.ZooKeeperNodeCreator
