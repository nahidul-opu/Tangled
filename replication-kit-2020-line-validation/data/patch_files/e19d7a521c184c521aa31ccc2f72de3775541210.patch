From e19d7a521c184c521aa31ccc2f72de3775541210 Mon Sep 17 00:00:00 2001
From: Mario Ivankovits <imario@apache.org>
Date: Fri, 10 Aug 2007 18:34:26 +0000
Subject: [PATCH] =?UTF-8?q?VFS-172:=20allow=20to=20refresh=20the=20interna?=
 =?UTF-8?q?l=20state=20data.=20Thanks=20to=20J=C3=B6rg=20Schaible=20for=20?=
 =?UTF-8?q?the=20patch!?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@564714 13f79535-47bb-0310-9956-ffa450edef68
---
 .../vfs/provider/sftp/SftpFileObject.java     | 32 +++++++++++++++++++
 1 file changed, 32 insertions(+)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java b/core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java
index 14436e25c8..1ea77d07df 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java
@@ -56,6 +56,8 @@ public class SftpFileObject extends AbstractFileObject implements FileObject
 	private SftpATTRS attrs;
 	private final String relPath;
 
+	private boolean inRefresh;
+
 	protected SftpFileObject(final FileName name,
 			final SftpFileSystem fileSystem) throws FileSystemException
 	{
@@ -65,6 +67,36 @@ protected SftpFileObject(final FileName name,
 				name));
 	}
 
+	protected void doDetach() throws Exception
+	{
+		attrs = null;
+	}
+
+	public void refresh() throws FileSystemException
+	{
+		if (!inRefresh)
+		{
+			try
+			{
+				inRefresh = true;
+				super.refresh();
+				try
+				{
+					attrs = null;
+					getType();
+				}
+				catch (IOException e)
+				{
+					throw new FileSystemException(e);
+				}
+			}
+			finally
+			{
+				inRefresh = false;
+			}
+		}
+	}
+
 	/**
 	 * Determines the type of this file, returns null if the file does not
 	 * exist.
