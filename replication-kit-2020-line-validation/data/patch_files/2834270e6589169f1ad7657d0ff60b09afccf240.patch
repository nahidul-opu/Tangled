From 2834270e6589169f1ad7657d0ff60b09afccf240 Mon Sep 17 00:00:00 2001
From: Rahul Akolkar <rahul@apache.org>
Date: Tue, 18 Nov 2008 23:29:59 +0000
Subject: [PATCH] Improved serialization of <send> Patch thanks to Ingmar
 Kliche <ingmar dot kliche at googlemail dot> SCXML-83

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/scxml/trunk@718767 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/scxml/io/SCXMLSerializer.java     | 35 +++++++++++++------
 .../commons/scxml/io/SCXMLSerializerTest.java | 13 +++++++
 2 files changed, 38 insertions(+), 10 deletions(-)

diff --git a/src/main/java/org/apache/commons/scxml/io/SCXMLSerializer.java b/src/main/java/org/apache/commons/scxml/io/SCXMLSerializer.java
index e4da4ac12..6bc66810b 100644
--- a/src/main/java/org/apache/commons/scxml/io/SCXMLSerializer.java
+++ b/src/main/java/org/apache/commons/scxml/io/SCXMLSerializer.java
@@ -497,16 +497,31 @@ public static boolean serializeActions(final StringBuffer b, final List l,
      */
     public static void serializeSend(final StringBuffer b,
             final Send send, final String indent) {
-        b.append(indent).append("<send sendid=\"")
-            .append(send.getSendid()).append("\" target=\"")
-            .append(send.getTarget()).append("\" targetType=\"")
-            .append(send.getTargettype()).append("\" namelist=\"")
-            .append(send.getNamelist()).append("\" delay=\"")
-            .append(send.getDelay()).append("\" event=\"")
-            .append(send.getEvent()).append("\" hints=\"")
-            .append(send.getHints()).append("\">\n")
-            .append(getBodyContent(send))
-            .append(indent).append("</send>\n");
+        b.append(indent).append("<send");
+        if (send.getSendid() != null) {
+            b.append(" sendid=\"").append(send.getSendid()).append("\"");
+        }
+        if (send.getTarget() != null) {
+            b.append(" target=\"").append(send.getTarget()).append("\"");
+        }
+        if (send.getTargettype() != null) {
+            b.append(" targetType=\"").append(send.getTargettype()).append("\"");
+        }
+        if (send.getNamelist() != null) {
+            b.append(" namelist=\"").append(send.getNamelist()).append("\"");
+        }
+        if (send.getDelay() != null) {
+            b.append(" delay=\"").append(send.getDelay()).append("\"");
+        }
+        if (send.getEvent() != null) {
+            b.append(" event=\"").append(send.getEvent()).append("\"");
+        }
+        if (send.getHints() != null) {
+            b.append(" hints=\"").append(send.getHints()).append("\"");
+        }
+        b.append(">\n");
+        b.append(getBodyContent(send));
+        b.append(indent).append("</send>\n");
     }
 
     /**
diff --git a/src/test/java/org/apache/commons/scxml/io/SCXMLSerializerTest.java b/src/test/java/org/apache/commons/scxml/io/SCXMLSerializerTest.java
index d352e8d59..08251d363 100644
--- a/src/test/java/org/apache/commons/scxml/io/SCXMLSerializerTest.java
+++ b/src/test/java/org/apache/commons/scxml/io/SCXMLSerializerTest.java
@@ -92,6 +92,19 @@ public void testSerializeSend() {
         assertEquals(assertValue.toString(), returnValue.toString());
     }
 
+    public void testSerializeSendEmptyAttributes() {
+        // test a <send event="foo"/>, i.e.most attributes are empty
+        Send send = new Send();
+        send.setEvent("foo");
+
+        String assertValue = " <send event=\"foo\">\n </send>\n";
+
+        StringBuffer returnValue = new StringBuffer();
+        SCXMLSerializer.serializeSend(returnValue, send, " ");
+
+        assertEquals(assertValue.toString(), returnValue.toString());
+    }
+
     public void testSerializeActionsListNull() {
         TransitionTarget target = new State();
         target.setId("1");
