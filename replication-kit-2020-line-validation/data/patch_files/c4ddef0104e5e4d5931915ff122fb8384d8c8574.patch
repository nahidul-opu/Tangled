From c4ddef0104e5e4d5931915ff122fb8384d8c8574 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Thu, 22 May 2008 21:40:17 +0000
Subject: [PATCH] Added junit test for IVY-811

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@659266 13f79535-47bb-0310-9956-ffa450edef68
---
 .../m2/PomModuleDescriptorParserTest.java     | 19 ++++++-
 .../m2/test-dependencyMgt-with-scope.pom      | 52 +++++++++++++++++++
 2 files changed, 70 insertions(+), 1 deletion(-)
 create mode 100644 test/java/org/apache/ivy/plugins/parser/m2/test-dependencyMgt-with-scope.pom

diff --git a/test/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParserTest.java b/test/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParserTest.java
index 402fc45f1..133e2b8e2 100644
--- a/test/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParserTest.java
+++ b/test/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParserTest.java
@@ -495,7 +495,24 @@ public void testDependencyManagment() throws ParseException, IOException {
             dds[0].getDependencyRevisionId());
         assertEquals("There is no special artifact when there is no classifier", 
                      0, dds[0].getAllDependencyArtifacts().length);
-        
+    }
+    
+    public void testDependencyManagmentWithScope() throws ParseException, IOException {
+        ModuleDescriptor md = PomModuleDescriptorParser.getInstance().parseDescriptor(
+            settings, getClass().getResource("test-dependencyMgt-with-scope.pom"), false);
+        assertNotNull(md);
+        assertEquals(ModuleRevisionId.newInstance("org.apache", "test-depMgt", "1.1"), 
+                md.getModuleRevisionId());
+
+        DependencyDescriptor[] dds = md.getDependencies();
+        assertNotNull(dds);
+        assertEquals(1, dds.length);
+        assertEquals(ModuleRevisionId.newInstance("commons-logging", "commons-logging", "1.0.4"),
+            dds[0].getDependencyRevisionId());
+        assertEquals("There is no special artifact when there is no classifier", 
+                     0, dds[0].getAllDependencyArtifacts().length);
+        assertEquals("The number of configurations is incorrect", 1, dds[0].getModuleConfigurations().length);
+        assertEquals("The configuration must be test", "test", dds[0].getModuleConfigurations()[0]);
     }
     
     public void testParentDependencyMgt() throws ParseException, IOException {        
diff --git a/test/java/org/apache/ivy/plugins/parser/m2/test-dependencyMgt-with-scope.pom b/test/java/org/apache/ivy/plugins/parser/m2/test-dependencyMgt-with-scope.pom
new file mode 100644
index 000000000..e8a1ce4b1
--- /dev/null
+++ b/test/java/org/apache/ivy/plugins/parser/m2/test-dependencyMgt-with-scope.pom
@@ -0,0 +1,52 @@
+<?xml version="1.0"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<project>
+  <modelVersion>4.0.0</modelVersion>
+  <groupId>org.apache</groupId>
+  <artifactId>test-depMgt</artifactId>
+  <name>Test Module for Ivy M2 parsing</name>
+  <version>1.1</version>
+  <url>http://ivy.jayasoft.org/</url>
+  <organization>
+    <name>Jayasoft</name>
+    <url>http://www.jayasoft.org/</url>
+  </organization>
+  <dependencyManagement>
+    <dependencies>
+      <dependency>
+        <groupId>commons-logging</groupId>
+        <artifactId>commons-logging</artifactId>
+        <version>1.0.4</version>
+        <scope>test</scope>
+      </dependency>
+      <dependency>
+          <groupId>commons-collection</groupId>
+          <artifactId>commons-collection</artifactId>
+          <version>1.0.5</version>
+      </dependency>
+    </dependencies>
+  </dependencyManagement>
+  <dependencies>
+    <dependency>
+      <groupId>commons-logging</groupId>
+      <artifactId>commons-logging</artifactId>
+    </dependency>
+  </dependencies>
+</project>
