From d9406824aeba0e977c0692971a6dbb2e62823886 Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Tue, 26 Apr 2016 23:55:15 +0000
Subject: [PATCH] [IO-502] Exceptions are suppressed incorrectly when copying
 files. Fix NPEs due to the patch.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1741122 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/io/FileSystemUtils.java  | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/src/main/java/org/apache/commons/io/FileSystemUtils.java b/src/main/java/org/apache/commons/io/FileSystemUtils.java
index ee52f1e35f7..d4fbea67c10 100644
--- a/src/main/java/org/apache/commons/io/FileSystemUtils.java
+++ b/src/main/java/org/apache/commons/io/FileSystemUtils.java
@@ -510,6 +510,23 @@ List<String> performCommand(final String[] cmdAttribs, final int max, final long
                         "Command line did not return any info " +
                         "for command " + Arrays.asList(cmdAttribs));
             }
+
+            inr.close();
+            inr = null;
+
+            in.close();
+            in = null;
+
+            if (out != null) {
+                out.close();
+                out = null;
+            }
+
+            if (err != null) {
+                err.close();
+                err = null;
+            }
+
             return lines;
 
         } catch (final InterruptedException ex) {
