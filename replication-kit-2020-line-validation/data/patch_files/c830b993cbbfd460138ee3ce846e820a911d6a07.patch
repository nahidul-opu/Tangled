From c830b993cbbfd460138ee3ce846e820a911d6a07 Mon Sep 17 00:00:00 2001
From: Mario Ivankovits <imario@apache.org>
Date: Mon, 14 May 2007 05:54:12 +0000
Subject: [PATCH] VFS-134: fixed memory leaks - Thanks to Adam Heath for the
 patch

git-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/vfs/trunk@537715 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs/provider/DefaultFileContent.java    | 2 +-
 .../org/apache/commons/vfs/provider/FileContentThreadData.java | 3 +--
 2 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/DefaultFileContent.java b/core/src/main/java/org/apache/commons/vfs/provider/DefaultFileContent.java
index 9a7ceae0a7..08886918b6 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/DefaultFileContent.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/DefaultFileContent.java
@@ -571,7 +571,7 @@ protected void onClose() throws IOException
             }
             finally
             {
-                endRandomAccess(content);
+                endRandomAccess(this);
             }
         }
     }
diff --git a/core/src/main/java/org/apache/commons/vfs/provider/FileContentThreadData.java b/core/src/main/java/org/apache/commons/vfs/provider/FileContentThreadData.java
index f7048d955c..f96eedbf6e 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/FileContentThreadData.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/FileContentThreadData.java
@@ -19,7 +19,6 @@
 import org.apache.commons.vfs.FileSystemException;
 import org.apache.commons.vfs.RandomAccessContent;
 
-import java.io.IOException;
 import java.io.InputStream;
 import java.util.ArrayList;
 
@@ -82,7 +81,7 @@ public Object removeInstr(int pos)
 
     public void removeInstr(InputStream instr)
     {
-        this.instrs.remove(instr);
+        this.rastrs.remove(instr);
     }
 
 	public Object removeRastr(int pos)
