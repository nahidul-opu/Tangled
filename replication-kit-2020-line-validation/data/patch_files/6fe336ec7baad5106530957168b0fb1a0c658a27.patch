From 6fe336ec7baad5106530957168b0fb1a0c658a27 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Wed, 26 Mar 2008 22:44:06 +0000
Subject: [PATCH] Added junit tests for IVY-771.

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@641617 13f79535-47bb-0310-9956-ffa450edef68
---
 ivy.xml                                       |  2 +
 .../ivy/ant/IvyAntSettingsBuildFile.xml       | 37 +++++++++++++++
 .../ivy/ant/IvyAntSettingsBuildFileTest.java  | 45 +++++++++++++++++++
 3 files changed, 84 insertions(+)
 create mode 100644 test/java/org/apache/ivy/ant/IvyAntSettingsBuildFile.xml
 create mode 100644 test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java

diff --git a/ivy.xml b/ivy.xml
index 6fd3ed1e8..92b1842cb 100644
--- a/ivy.xml
+++ b/ivy.xml
@@ -50,6 +50,8 @@
 		<!-- Test dependencies -->
 		<dependency org="junit" name="junit" rev="3.8.2" conf="test->default" />
 		<dependency org="commons-lang" name="commons-lang" rev="[1.0,3.0[" conf="test->default" />
+		<dependency org="org.apache.ant" name="ant-testutil" rev="1.7.0" conf="test->default" transitive="false" />
+	    <dependency org="ant" name="ant-launcher" rev="1.6" conf="test->default" transitive="false"/>
 		
 		<!-- This dependency is necessary for having validation in junit tests when running with JDK1.4 -->
 		<dependency org="xerces" name="xercesImpl" rev="2.6.2" conf="test->default" />
diff --git a/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFile.xml b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFile.xml
new file mode 100644
index 000000000..7ec7c40ea
--- /dev/null
+++ b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFile.xml
@@ -0,0 +1,37 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<project xmlns:ivy="antlib:org.apache.ivy.ant" basedir="../../../../../..">
+  <target name="setUp">
+    <property name="ivy.cache.repository" value="build/cache" />
+  </target>
+
+  <target name="tearDown">
+  	<delete dir="build/cache" />
+  </target>
+
+  <target name="testOverrideNotSpecified">
+  	<ivy:settings id="test1" file="test/repositories/ivysettings.xml" />
+  	<ivy:resolve settingsRef="test1" file="test/java/org/apache/ivy/ant/ivy-simple.xml" />
+  </target>
+
+  <target name="testOverrideSetToFalse">
+  	<ivy:settings id="test2" file="test/repositories/ivysettings.xml" override="false" />
+  	<ivy:resolve settingsRef="test2" file="test/java/org/apache/ivy/ant/ivy-simple.xml" />
+  </target>
+</project>
\ No newline at end of file
diff --git a/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java
new file mode 100644
index 000000000..c51252db8
--- /dev/null
+++ b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java
@@ -0,0 +1,45 @@
+/*
+ *  Licensed to the Apache Software Foundation (ASF) under one or more
+ *  contributor license agreements.  See the NOTICE file distributed with
+ *  this work for additional information regarding copyright ownership.
+ *  The ASF licenses this file to You under the Apache License, Version 2.0
+ *  (the "License"); you may not use this file except in compliance with
+ *  the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ *
+ */
+package org.apache.ivy.ant;
+
+import org.apache.ivy.core.report.ResolveReport;
+import org.apache.tools.ant.BuildFileTest;
+
+public class IvyAntSettingsBuildFileTest extends BuildFileTest {
+    
+    protected void setUp() throws Exception {
+        configureProject("test/java/org/apache/ivy/ant/IvyAntSettingsBuildFile.xml");
+    }
+    
+    public void testOverrideNotSpecified() {
+        executeTarget("testOverrideNotSpecified");
+        ResolveReport report = (ResolveReport) getProject().getReference("ivy.resolved.report");
+        assertNotNull(report);
+        assertFalse(report.hasError());
+        assertEquals(1, report.getDependencies().size());
+    }
+    
+    public void testOverrideSetToFalse() {
+        executeTarget("testOverrideSetToFalse");
+        ResolveReport report = (ResolveReport) getProject().getReference("ivy.resolved.report");
+        assertNotNull(report);
+        assertFalse(report.hasError());
+        assertEquals(1, report.getDependencies().size());
+    }
+
+}
