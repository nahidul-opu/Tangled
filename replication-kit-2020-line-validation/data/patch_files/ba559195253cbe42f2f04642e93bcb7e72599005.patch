From ba559195253cbe42f2f04642e93bcb7e72599005 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 16 Feb 2017 13:38:33 +0000
Subject: [PATCH] VALIDATOR-420 Query params validator shouldn't accept
 whitespaces

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/validator/trunk@1783203 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                    | 3 +++
 .../apache/commons/validator/routines/UrlValidator.java    | 2 +-
 .../commons/validator/routines/UrlValidatorTest.java       | 7 +++++++
 3 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index f9ff6d9d4..43cea4a0f 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -98,6 +98,9 @@ The dependencies for Validator have not changed since the 1.4 release.
 For the current list of dependencies, please see
 http://commons.apache.org/validator/dependencies.html
   ">
+    <action issue="VALIDATOR-420" type="fix" dev="sebb" due-to="Marcin Gasior">
+    Query params validator shouldn't accept whitespaces
+    </action>
     <action issue="VALIDATOR-419" type="fix" dev="sebb" due-to="Denis Iskhakov">
     Invalid IPv6 addresses that are IPv4-mapped pass InetAddressValidator validation
     </action>
diff --git a/src/main/java/org/apache/commons/validator/routines/UrlValidator.java b/src/main/java/org/apache/commons/validator/routines/UrlValidator.java
index d76491238..312c8e872 100644
--- a/src/main/java/org/apache/commons/validator/routines/UrlValidator.java
+++ b/src/main/java/org/apache/commons/validator/routines/UrlValidator.java
@@ -168,7 +168,7 @@ public class UrlValidator implements Serializable {
     private static final String PATH_REGEX = "^(/[-\\w:@&?=+,.!/~*'%$_;\\(\\)]*)?$";
     private static final Pattern PATH_PATTERN = Pattern.compile(PATH_REGEX);
 
-    private static final String QUERY_REGEX = "^(.*)$";
+    private static final String QUERY_REGEX = "^(\\S*)$";
     private static final Pattern QUERY_PATTERN = Pattern.compile(QUERY_REGEX);
 
     /**
diff --git a/src/test/java/org/apache/commons/validator/routines/UrlValidatorTest.java b/src/test/java/org/apache/commons/validator/routines/UrlValidatorTest.java
index 7ee659436..9e48e07d7 100644
--- a/src/test/java/org/apache/commons/validator/routines/UrlValidatorTest.java
+++ b/src/test/java/org/apache/commons/validator/routines/UrlValidatorTest.java
@@ -491,6 +491,13 @@ public void testValidator380() {
        assertTrue(validator.isValid("http://www.apache.org:/path"));
    }
 
+   public void testValidator420() {
+       UrlValidator validator = new UrlValidator();
+       assertFalse(validator.isValid("http://example.com/serach?address=Main Avenue"));
+       assertTrue(validator.isValid("http://example.com/serach?address=Main%20Avenue"));
+       assertTrue(validator.isValid("http://example.com/serach?address=Main+Avenue"));
+   }
+
    //-------------------- Test data for creating a composite URL
    /**
     * The data given below approximates the 4 parts of a URL
