From c4af057cf8f77666b082418efc91ea201d150469 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Thu, 20 Mar 2008 22:57:59 +0000
Subject: [PATCH] FIX: ivy:settings fails when override is not set to 'true'
 (IVY-771)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@639496 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                     | 1 +
 src/java/org/apache/ivy/ant/IvyAntSettings.java | 3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 7b769c5be..8913ced7c 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -73,6 +73,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Parse description and home page from poms (IVY-767)
 - IMPROVEMENT: Smarter determination if an expression is exact or not for RegexpPatternMatcher and GlobPatternMatcher
 
+- FIX: ivy:settings fails when override is not set to 'true' (IVY-771)
 - FIX: NPE when specifying both resolveId and inline in an Ivy:Resolve (IVY-776)
 - FIX: repreport task not working against a repository structured by branches (IVY-716)
 - FIX: Ivy reports a conflict when the same file is supposed to be retrieved at the same location twice (or more) (IVY-743)
diff --git a/src/java/org/apache/ivy/ant/IvyAntSettings.java b/src/java/org/apache/ivy/ant/IvyAntSettings.java
index cfaa37585..f1b7083fc 100644
--- a/src/java/org/apache/ivy/ant/IvyAntSettings.java
+++ b/src/java/org/apache/ivy/ant/IvyAntSettings.java
@@ -253,7 +253,8 @@ public Ivy getConfiguredIvyInstance() {
 
     public void execute() throws BuildException {
         if (!OVERRIDE_TRUE.equals(override)) {
-            if (getProject().getReference(id) != null) {
+            Object otherRef = getProject().getReference(id);
+            if ((otherRef != null) && (otherRef != this)) {
                 if (OVERRIDE_FALSE.equals(override)) {
                     verbose("a settings definition is already available for " + id + ": skipping");
                     return;
