From 30a64f3b93544c704614e2fd24a9cffdaa2f63f2 Mon Sep 17 00:00:00 2001
From: "James W. Carman" <jcarman@apache.org>
Date: Sat, 24 May 2008 12:53:57 +0000
Subject: [PATCH] VFS-196: FTP Provider Does Not Support Symbolic Links
 Correctly

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/branches/vfs-1-trunk@659811 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs/provider/ftp/FtpFileObject.java | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java b/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java
index 8e0526ccb5..1745c5bdb1 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java
@@ -24,6 +24,9 @@
 import org.apache.commons.vfs.FileSystemException;
 import org.apache.commons.vfs.FileType;
 import org.apache.commons.vfs.RandomAccessContent;
+import org.apache.commons.vfs.FileSystemManager;
+import org.apache.commons.vfs.VFS;
+import org.apache.commons.vfs.FileUtil;
 import org.apache.commons.vfs.provider.AbstractFileObject;
 import org.apache.commons.vfs.provider.UriParser;
 import org.apache.commons.vfs.util.Messages;
@@ -35,6 +38,7 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.io.File;
 import java.util.Calendar;
 import java.util.Collections;
 import java.util.Iterator;
@@ -125,7 +129,8 @@ private void doGetChildren() throws IOException
 		final FtpClient client = ftpFs.getClient();
 		try
 		{
-			final FTPFile[] tmpChildren = client.listFiles(relPath);
+            final String path = fileInfo != null && fileInfo.isSymbolicLink() ? getFileSystem().getFileSystemManager().resolveName(getParent().getName(), fileInfo.getLink() ).getPath() : relPath;
+            final FTPFile[] tmpChildren = client.listFiles(path);
 			if (tmpChildren == null || tmpChildren.length == 0)
 			{
 				children = EMPTY_FTP_FILE_MAP;
