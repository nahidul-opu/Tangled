From e602a4253164f8e7520d155ab5fd418a6110515e Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Fri, 28 Jul 2006 07:05:24 +0000
Subject: [PATCH] FIX: VFS Resolve fails when trying to resolve a + version
 (IVY-237)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/trunk@484405 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                      |  1 +
 .../jayasoft/ivy/repository/vfs/VfsResource.java | 16 ++++++++++++----
 2 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 229d197e3..0b17a0393 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -78,6 +78,7 @@ Changes:
   - IMPROVE: add sort of 'fallback'-mapping to the defaultconfmapping attribute (IVY-215)
   - IMPROVE: artifact origin is not included in the default report (IVY-251)
 
+  - FIX: VFS Resolve fails when trying to resolve a + version (IVY-237)
   - FIX: report Ant-task doesn't use outputpattern for generating graphml reports (IVY-246)
   - FIX: report Ant-task doesn't call init() on the internal XSLTProcess (IVY-248)
   - FIX: value of confmappingoverride from imported configurations is lost when writing Ivy file (IVY-239)
diff --git a/src/java/fr/jayasoft/ivy/repository/vfs/VfsResource.java b/src/java/fr/jayasoft/ivy/repository/vfs/VfsResource.java
index 278d917d2..afae0e99c 100644
--- a/src/java/fr/jayasoft/ivy/repository/vfs/VfsResource.java
+++ b/src/java/fr/jayasoft/ivy/repository/vfs/VfsResource.java
@@ -1,7 +1,7 @@
 /**
  * This file is subject to the licence found in LICENCE.TXT in the root directory of the project.
  * Copyright Jayasoft 2005 - All rights reserved
-
+ *
  * VFS implementation of the Resource interface
  * 
  * @author glen
@@ -43,8 +43,7 @@ public VfsResource(String vfsURI, FileSystemManager fsManager) throws IOExceptio
 		}
 
  		try {
- 			_content = _resourceImpl.getContent();
-			_isAvailable = _content != null;
+			_isAvailable = _resourceImpl.exists();
  		} catch (FileSystemException e) {
  			Message.verbose(e.getLocalizedMessage());
 		}
@@ -74,7 +73,16 @@ public List getChildren() {
     	return list;
     }
     
-    public FileContent getContent() {
+    public FileContent getContent() throws IOException {
+    	if ((_content == null) && _isAvailable) {
+ 			try {
+				_content = _resourceImpl.getContent();
+			} catch (FileSystemException e) {
+				IOException error = new IOException(e.getLocalizedMessage());
+				error.initCause(e);
+	 			throw error;
+			}
+    	}
     	return _content;
     }
     
