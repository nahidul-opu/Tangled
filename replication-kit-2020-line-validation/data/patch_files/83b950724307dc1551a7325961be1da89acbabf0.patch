From 83b950724307dc1551a7325961be1da89acbabf0 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 24 Aug 2015 13:04:12 +0000
Subject: [PATCH] NET-582 SimpleSMTPHeader does not allow for missing To: field

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1697379 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                       |  3 ++
 .../commons/net/smtp/SimpleSMTPHeader.java    | 28 +++++++++++--------
 2 files changed, 20 insertions(+), 11 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 03d0888b6..3373a9588 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -73,6 +73,9 @@ This is mainly a bug-fix release. See further details below.
   This is the inverse of the IMAPImportMbox example added previously
         ">
         
+            <action issue="NET-582" type="fix" dev="sebb">
+            SimpleSMTPHeader does not allow for missing To: field
+            </action>
             <action issue="NET-580" type="fix" dev="sebb" due-to="Simon Arlott">
             SMTPClient.sendSimpleMessage() silently ignores failed recipients
             Update Javadoc
diff --git a/src/main/java/org/apache/commons/net/smtp/SimpleSMTPHeader.java b/src/main/java/org/apache/commons/net/smtp/SimpleSMTPHeader.java
index 834cb5727..195568ad8 100644
--- a/src/main/java/org/apache/commons/net/smtp/SimpleSMTPHeader.java
+++ b/src/main/java/org/apache/commons/net/smtp/SimpleSMTPHeader.java
@@ -47,7 +47,9 @@
 
 public class SimpleSMTPHeader
 {
-    private final String __subject, __from, __to;
+    private final String __subject;
+    private final String __from;
+    private final String __to;
     private final StringBuffer __headerFields;
     private StringBuffer __cc;
 
@@ -57,13 +59,19 @@ public class SimpleSMTPHeader
      * <p>
      * @param from  The value of the <code>From:</code> header field.  This
      *              should be the sender's email address.
+     *              Must not be null.
      * @param to    The value of the <code>To:</code> header field.  This
      *              should be the recipient's email address.
+     *              May be null
      * @param subject  The value of the <code>Subject:</code> header field.
      *              This should be the subject of the message.
+     *              May be null
      ***/
     public SimpleSMTPHeader(String from, String to, String subject)
     {
+        if (from == null) {
+            throw new IllegalArgumentException("From cannot be null");
+        }
         __to = to;
         __from = from;
         __subject = subject;
@@ -126,25 +134,23 @@ public String toString()
             header.append(__headerFields.toString());
         }
 
-        header.append("From: ");
-        header.append(__from);
-        header.append("\nTo: ");
-        header.append(__to);
+        header.append("From: ").append(__from).append("\n");
+
+        if (__to != null) {
+            header.append("To: ").append(__to).append("\n");
+        }
 
         if (__cc != null)
         {
-            header.append("\nCc: ");
-            header.append(__cc.toString());
+            header.append("Cc: ").append(__cc.toString()).append("\n");
         }
 
         if (__subject != null)
         {
-            header.append("\nSubject: ");
-            header.append(__subject);
+            header.append("Subject: ").append(__subject).append("\n");
         }
 
-        header.append('\n');
-        header.append('\n');
+        header.append('\n'); // end of headers; body follows
 
         return header.toString();
     }
