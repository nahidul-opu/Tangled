From 251c542162e563fef81954fd373cafcc31f24824 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Sat, 1 Mar 2008 12:41:17 +0000
Subject: [PATCH] Add isLeapYear() check (NET-188)

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@632584 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/net/ftp/parser/FTPTimestampParserImpl.java      | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java b/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
index 6dfdbbd89..6f7d1afd2 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
@@ -23,6 +23,7 @@
 import java.text.SimpleDateFormat;
 import java.util.Calendar;
 import java.util.Date;
+import java.util.GregorianCalendar;
 import java.util.TimeZone;
 
 import org.apache.commons.net.ftp.Configurable;
@@ -99,8 +100,9 @@ public Calendar parseTimestamp(String timestampStr) throws ParseException {
 			// to cope with short-date leap year strings.
 			// e.g. Java's DateFormatter will assume that "Feb 29 12:00" refers to 
 			// Feb 29 1970 (an invalid date) rather than a potentially valid leap year date.
-			// TODO This is a HORRENDOUS hack. Remove at first opportunity.
-			if (recentDateFormat != null) {
+			// This is pretty bad hack to work around the deficiencies of the JDK date/time classes.
+			if (recentDateFormat != null && 
+					new GregorianCalendar().isLeapYear(now.get(Calendar.YEAR))) {
 				pp = new ParsePosition(0);
 				int year = Calendar.getInstance().get(Calendar.YEAR);
 				String timeStampStrPlusYear = timestampStr + " " + year;
