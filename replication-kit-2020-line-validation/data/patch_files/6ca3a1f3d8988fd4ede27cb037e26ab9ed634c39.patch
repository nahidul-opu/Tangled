From 6ca3a1f3d8988fd4ede27cb037e26ab9ed634c39 Mon Sep 17 00:00:00 2001
From: Ralph Goers <rgoers@apache.org>
Date: Sun, 25 Sep 2011 06:16:23 +0000
Subject: [PATCH] Fix VFS-359 - Don't delete a RamFileObject if it is open

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1175302 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs2/provider/ram/RamFileObject.java   | 4 ++++
 src/changes/changes.xml                                       | 3 +++
 2 files changed, 7 insertions(+)

diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileObject.java b/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileObject.java
index 7d1f3b4cd8..37136f17b3 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileObject.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileObject.java
@@ -135,6 +135,10 @@ protected OutputStream doGetOutputStream(boolean bAppend) throws Exception
     @Override
     protected void doDelete() throws Exception
     {
+
+        if (this.isContentOpen()) {
+            throw new FileSystemException(this.getName() + " cannot be deleted while the file is openg");
+        }
         fs.delete(this);
     }
 
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 4479661063..57b03cbdcf 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="2.1" date="TBD" description="">
+      <action issue="VFS-359" dev="rgoers" type="fix" due-to="Miroslav Pokorny">
+        Don't delete a RamFileObject if it is open.
+      </action>
       <action issue="VFS-352" dev="rgoers" type="fix">
         ZipFileSystem now uses an internal Map as a cache for all the files in the zip archive.
       </action>
