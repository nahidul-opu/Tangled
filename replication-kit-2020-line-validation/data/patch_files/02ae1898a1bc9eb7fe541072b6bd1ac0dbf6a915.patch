From 02ae1898a1bc9eb7fe541072b6bd1ac0dbf6a915 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Fri, 15 Apr 2016 19:07:04 +0000
Subject: [PATCH] NET-583 FTPClient.getReplyString() returns wrong value after
 connect()

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1739351 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                 | 3 +++
 src/main/java/org/apache/commons/net/ftp/FTPClient.java | 1 +
 2 files changed, 4 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 8f9ec306c..6f0b777cc 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -74,6 +74,9 @@ This is mainly a bug-fix release. See further details below.
   Notable additions:
   The IMAP examples can now get password from console, stdin or an environment variable.
         ">
+            <action issue="NET-583" type="fix" dev="sebb" due-to="Holger Rehn">
+            FTPClient.getReplyString() returns wrong value after connect()
+            </action>
             <action type="add" dev="sebb">
             Alternative password input methods for IMAP examples
             </action>
diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClient.java b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
index c86bb3898..413af48c4 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClient.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
@@ -983,6 +983,7 @@ protected void _connectAction_(Reader socketIsReader) throws IOException
             _replyLines.clear();
             _replyLines.addAll(oldReplyLines);
             _replyCode = oldReplyCode;
+            _newReplyString = true;
         }
     }
 
