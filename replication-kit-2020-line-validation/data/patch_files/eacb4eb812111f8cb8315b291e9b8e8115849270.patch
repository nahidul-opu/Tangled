From eacb4eb812111f8cb8315b291e9b8e8115849270 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Tue, 19 Feb 2008 22:30:06 +0000
Subject: [PATCH] Add fix for owner name containing spaces (NET-170)

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@629252 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/net/ftp/parser/UnixFTPEntryParser.java  | 10 ++--------
 .../net/ftp/parser/UnixFTPEntryParserTest.java      | 13 +++++++++++++
 2 files changed, 15 insertions(+), 8 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
index e582ae2fa..6b947786d 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
@@ -33,12 +33,6 @@
  */
 public class UnixFTPEntryParser extends ConfigurableFTPFileEntryParserImpl
 {
-    /**
-     * months abbreviations looked for by this parser.  Also used
-     * to determine which month is matched by the parser
-     */
-    private static final String DEFAULT_MONTHS =
-        "(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)";
     
     static final String DEFAULT_DATE_FORMAT 
 		= "MMM d yyyy"; //Nov 9 2001
@@ -91,8 +85,8 @@ public class UnixFTPEntryParser extends ConfigurableFTPFileEntryParserImpl
         "([bcdelfmpSs-])"
         +"(((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-]))((r|-)(w|-)([xsStTL-])))\\+?\\s+"
         + "(\\d+)\\s+"
-        + "(\\S+)\\s+"
-        + "(?:(\\S+(?:\\s\\S+)*)\\s+)?"
+        + "(?:(\\S+(?:\\s\\S+)*)\\s+)?"					// owner name (optional spaces)
+        + "(?:(\\S+(?:\\s\\S+)*)\\s+)?" // group name (optional spaces)
         + "(\\d+)\\s+"
         
         /*
diff --git a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
index 04e5a900f..bb294adb4 100644
--- a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
+++ b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
@@ -138,6 +138,19 @@ public void testNumericDateFormat()
 	protected FTPFileEntryParser getParser() {
 		return (new UnixFTPEntryParser());
 	}
+	
+	public void testOwnerNameWithSpaces() {
+		FTPFile f = getParser().parseFTPEntry("drwxr-xr-x   2 john smith     group         4096 Mar  2 15:13 zxbox");
+		assertNotNull(f);
+		assertEquals("john smith", f.getUser());
+	}
+	
+	public void testOwnerANdGroupNameWithSpaces() {
+		FTPFile f = getParser().parseFTPEntry("drwxr-xr-x   2 john smith     test group         4096 Mar  2 15:13 zxbox");
+		assertNotNull(f);
+		assertEquals("john smith", f.getUser());
+		assertEquals("test group", f.getGroup());
+	}
 
 	/**
 	 * @see org.apache.commons.net.ftp.parser.FTPParseTestFramework#testParseFieldsOnDirectory()
