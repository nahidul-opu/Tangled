From 7f6a33d94efdfa9f1db4bd71da6ddff10aace45e Mon Sep 17 00:00:00 2001
From: Dionysios Logothetis <dlogothetis@gmail.com>
Date: Fri, 21 Sep 2018 10:24:28 -0700
Subject: [PATCH] GIRAPH-1201

closes #84
---
 .../java/org/apache/giraph/master/BspServiceMaster.java   | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/giraph-core/src/main/java/org/apache/giraph/master/BspServiceMaster.java b/giraph-core/src/main/java/org/apache/giraph/master/BspServiceMaster.java
index a95a19c1b..dac898ebb 100644
--- a/giraph-core/src/main/java/org/apache/giraph/master/BspServiceMaster.java
+++ b/giraph-core/src/main/java/org/apache/giraph/master/BspServiceMaster.java
@@ -1379,9 +1379,15 @@ private boolean barrierOnWorkerList(String finishedWorkerPath,
 
       // Wait for a signal or timeout
       boolean eventTriggered = event.waitMsecs(eventLoopTimeout);
+
+      // If the event was triggered, we reset it. In the next loop run, we will
+      // read ZK to get the new hosts.
+      if (eventTriggered) {
+        event.reset();
+      }
+
       long elapsedTimeSinceRegularRunMsec = System.currentTimeMillis() -
           lastRegularRunTimeMsec;
-      event.reset();
       getContext().progress();
 
       if (eventTriggered ||
