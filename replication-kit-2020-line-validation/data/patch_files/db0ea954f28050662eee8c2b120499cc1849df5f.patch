From db0ea954f28050662eee8c2b120499cc1849df5f Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Wed, 27 Nov 2013 05:35:26 +0000
Subject: [PATCH] COMPRESS-244 might overflow a 32bit int in
 SevenZFile#readUint64 - based on patch by Nico Kruber

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1545928 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                       | 4 ++++
 .../apache/commons/compress/archivers/sevenz/SevenZFile.java  | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 1dd173a7595..7beddd57af6 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -48,6 +48,10 @@ The <action> type attribute can be add,update,fix,remove.
         SevenZOutputFile#closeArchiveEntry throws an exception when
         using LZMA2 compression on Java8.
       </action> 
+      <action issue="COMPRESS-244" type="fix" date="2013-11-27"
+              due-to="Nico Kruber">
+        7z reading of big 64bit values could be wrong.
+      </action> 
     </release>
     <release version="1.6" date="2013-10-26"
              description="Release 1.6">
diff --git a/src/main/java/org/apache/commons/compress/archivers/sevenz/SevenZFile.java b/src/main/java/org/apache/commons/compress/archivers/sevenz/SevenZFile.java
index d32ab855a46..fbdbcf44bce 100644
--- a/src/main/java/org/apache/commons/compress/archivers/sevenz/SevenZFile.java
+++ b/src/main/java/org/apache/commons/compress/archivers/sevenz/SevenZFile.java
@@ -895,7 +895,7 @@ public int read(byte[] b, int off, int len) throws IOException {
     }
     
     private static long readUint64(final DataInput in) throws IOException {
-        int firstByte = in.readUnsignedByte();
+        long firstByte = in.readUnsignedByte();
         int mask = 0x80;
         long value = 0;
         for (int i = 0; i < 8; i++) {
