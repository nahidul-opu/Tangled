From 65e1c9c38becbee2f84d822cd65fd7dbce42b903 Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Wed, 17 Aug 2016 00:50:57 +0000
Subject: [PATCH] [IO-512] ThresholdingOutputStream.thresholdReached() results
 in FileNotFoundException.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1756570 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                        | 3 +++
 .../org/apache/commons/io/output/DeferredFileOutputStream.java | 2 ++
 2 files changed, 5 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 65a43f8b227..8413010f91b 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -52,6 +52,9 @@ The <action> type attribute can be add,update,fix,remove.
       </action>
     </release>
     <release version="2.6" date="2016-MM-DD" description="New features and bug fixes.">
+      <action issue="IO-512" dev="ggregory" type="fix" due-to="Ralf Hauser">
+        ThresholdingOutputStream.thresholdReached() results in FileNotFoundException.
+      </action>
       <action issue="IO-511" dev="britter" type="fix" due-to="Ahmet Celik">
         After a few unit tests, a few newly created directories not cleaned completely.
       </action>
diff --git a/src/main/java/org/apache/commons/io/output/DeferredFileOutputStream.java b/src/main/java/org/apache/commons/io/output/DeferredFileOutputStream.java
index 866cf58bd2a..a7456994b34 100644
--- a/src/main/java/org/apache/commons/io/output/DeferredFileOutputStream.java
+++ b/src/main/java/org/apache/commons/io/output/DeferredFileOutputStream.java
@@ -22,6 +22,7 @@
 import java.io.IOException;
 import java.io.OutputStream;
 
+import org.apache.commons.io.FileUtils;
 import org.apache.commons.io.IOUtils;
 
 
@@ -176,6 +177,7 @@ protected void thresholdReached() throws IOException
         if (prefix != null) {
             outputFile = File.createTempFile(prefix, suffix, directory);
         }
+        FileUtils.forceMkdirParent(outputFile);
         final FileOutputStream fos = new FileOutputStream(outputFile);
         try {
             memoryOutputStream.writeTo(fos);
