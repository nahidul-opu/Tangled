From e08fbb9e9adffc54c5ad87ddfd57b590e65ef862 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 3 Jul 2017 15:38:05 +0000
Subject: [PATCH] NET-639 - MVSFTPEntryParser.preParse - MVS, z/OS - allow for
 merged Ext/Used fields

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1800686 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                       | 3 +++
 .../org/apache/commons/net/ftp/parser/MVSFTPEntryParser.java  | 3 ++-
 .../apache/commons/net/ftp/parser/MVSFTPEntryParserTest.java  | 4 +++-
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 54e7c0af3..155d3a40b 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -74,6 +74,9 @@ This is mainly a bug-fix release. See further details below.
  The examples are not part of the public API, so this does not affect compatibility.
 
 ">
+            <action issue="NET-639" type="fix" dev="sebb" due-to=" Alexander Eller">
+            MVSFTPEntryParser.preParse - MVS, z/OS - allow for merged Ext/Used fields
+            </action>
             <action issue="NET-636" type="fix" dev="sebb">
             examples should be in org.apache.commons.net subpackage
             </action>
diff --git a/src/main/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParser.java b/src/main/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParser.java
index cb24f3727..88203b6d3 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParser.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParser.java
@@ -66,7 +66,8 @@ public class MVSFTPEntryParser extends ConfigurableFTPFileEntryParserImpl {
             "\\S+\\s+" + // unit - ignored
             "\\S+\\s+" + // access date - ignored
             "\\S+\\s+" + // extents -ignored
-            "\\S+\\s+" + // used - ignored
+            // If the values are too large, the fields may be merged (NET-639)
+            "(?:\\S+\\s+)?" + // used - ignored
             "[FV]\\S*\\s+" + // recfm - must start with F or V
             "\\S+\\s+" + // logical record length -ignored
             "\\S+\\s+" + // block size - ignored
diff --git a/src/test/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParserTest.java b/src/test/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParserTest.java
index e0c9f4429..be9fd4dc3 100644
--- a/src/test/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParserTest.java
+++ b/src/test/java/org/apache/commons/net/ftp/parser/MVSFTPEntryParserTest.java
@@ -42,7 +42,9 @@ public class MVSFTPEntryParserTest extends FTPParseTestFramework {
             "PSMLC6 3390   2005/04/05  1    1  VB   27994 27998  PS    file7.O.BU",
             "FPFS49 3390   2004/06/23  1    1  FB     128  6144  PO-E  INCOMING.RPTBM026.D061704",
             "FPFS41 3390   2004/06/23  1    1  FB     128  6144  PS    INCOMING.RPTBM056.D061704",
-            "FPFS25 3390   2004/06/23  1    1  FB     128  6144  PS    INCOMING.WTM204.D061704", };
+            "FPFS25 3390   2004/06/23  1    1  FB     128  6144  PS    INCOMING.WTM204.D061704",
+            "PEX26F 3390   2017/07/03  115807  FB   29600 29600  PS    INCOMING.FIN.D170630.T160630",
+        };
 
     private static final String[] goodsamplesMemberList = {
             /* Note, if the string begins with SAVE, the parsed entry is stored in the List saveftpfiles */
