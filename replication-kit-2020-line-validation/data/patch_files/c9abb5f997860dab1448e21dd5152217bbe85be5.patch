From c9abb5f997860dab1448e21dd5152217bbe85be5 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Wed, 8 Nov 2006 20:00:05 +0000
Subject: [PATCH] partial fix for IVY-338 (make sure that at least the streams
 to the properties files are closed)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/trunk@484581 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/fr/jayasoft/ivy/Ivy.java | 22 ++++++++++++++++------
 1 file changed, 16 insertions(+), 6 deletions(-)

diff --git a/src/java/fr/jayasoft/ivy/Ivy.java b/src/java/fr/jayasoft/ivy/Ivy.java
index ba805feb9..405e2d0b8 100644
--- a/src/java/fr/jayasoft/ivy/Ivy.java
+++ b/src/java/fr/jayasoft/ivy/Ivy.java
@@ -442,18 +442,28 @@ public void loadProperties(URL url) throws IOException {
         loadProperties(url, true);
     }
     public void loadProperties(URL url, boolean overwrite) throws IOException {
-        Properties properties = new Properties();
-        properties.load(url.openStream());
-        addAllVariables(properties, overwrite);
+        loadProperties(url.openStream(), overwrite);
     }
     public void loadProperties(File file) throws IOException {
         loadProperties(file, true);
     }
     
     public void loadProperties(File file, boolean overwrite) throws IOException {
-        Properties properties = new Properties();
-        properties.load(new FileInputStream(file));
-        addAllVariables(properties, overwrite);
+        loadProperties(new FileInputStream(file), overwrite);
+    }
+    
+    private void loadProperties(InputStream stream, boolean overwrite) throws IOException {
+    	try {
+	        Properties properties = new Properties();
+	        properties.load(stream);
+	        addAllVariables(properties, overwrite);
+    	} finally {
+    		if (stream != null) {
+    			try {
+    				stream.close();
+    			} catch (IOException e) {}
+    		}
+    	}
     }
     
     public void setVariable(String varName, String value) {
