From 4f5f20d528c4154681038532fb0bca3f75b6e9d4 Mon Sep 17 00:00:00 2001
From: Jason Baldridge <jbaldrid@apache.org>
Date: Mon, 6 Jun 2011 21:13:39 +0000
Subject: [PATCH] Two loops for normalization now one.
 https://issues.apache.org/jira/browse/OPENNLP-154

git-svn-id: https://svn.apache.org/repos/asf/incubator/opennlp/trunk@1132774 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/opennlp/perceptron/PerceptronModel.java   | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/opennlp-maxent/src/main/java/opennlp/perceptron/PerceptronModel.java b/opennlp-maxent/src/main/java/opennlp/perceptron/PerceptronModel.java
index cd0b15629..0df200d73 100644
--- a/opennlp-maxent/src/main/java/opennlp/perceptron/PerceptronModel.java
+++ b/opennlp-maxent/src/main/java/opennlp/perceptron/PerceptronModel.java
@@ -106,12 +106,18 @@ public static double[] eval(int[] context, float[] values, double[] prior, EvalP
           maxPrior = Math.abs(prior[oid]);
       }
       
-      for (int oid = 0; oid < numOutcomes; oid++)
-        prior[oid] = Math.exp(prior[oid]/maxPrior);
-
       double normal = 0.0;
-      for (int oid = 0; oid < numOutcomes; oid++)
+      for (int oid = 0; oid < numOutcomes; oid++) {
+        prior[oid] = Math.exp(prior[oid]/maxPrior);
         normal += prior[oid];
+      }
+
+      //for (int oid = 0; oid < numOutcomes; oid++)
+      //  prior[oid] = Math.exp(prior[oid]/maxPrior);
+      //
+      //double normal = 0.0;
+      //for (int oid = 0; oid < numOutcomes; oid++)
+      //  normal += prior[oid];
 
       for (int oid = 0; oid < numOutcomes; oid++)
         prior[oid] /= normal;
