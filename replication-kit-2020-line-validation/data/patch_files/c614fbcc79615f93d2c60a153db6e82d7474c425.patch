From c614fbcc79615f93d2c60a153db6e82d7474c425 Mon Sep 17 00:00:00 2001
From: "Bruno P. Kinoshita" <kinow@apache.org>
Date: Thu, 4 Jan 2018 22:15:08 +1300
Subject: [PATCH] LANG-1374: fix logic in isJsonArray method of
 JsonToStringStyle

---
 src/changes/changes.xml                       |  1 +
 .../commons/lang3/builder/ToStringStyle.java  |  2 +-
 .../lang3/builder/JsonToStringStyleTest.java  | 20 +++++++++++++++++++
 3 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 4a68f8cc4bf..a5e43011fdf 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -46,6 +46,7 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
 
   <release version="3.8" date="2017-MM-DD" description="New features and bug fixes. Requires Java 7, supports Java 8, 9, 10.">
+    <action issue="LANG-1374" type="fix" dev="kinow" due-to="Jaswanth Bala">Parsing Json Array failed</action>
     <action issue="LANG-1371" type="fix" dev="pschumacher" due-to="Dmitry Ovchinnikov">Fix TypeUtils#parameterize to work correctly with narrower-typed array</action>
     <action issue="LANG-1370" type="fix" dev="kinow" due-to="Andre Dieb">Fix EventCountCircuitBreaker increment batch</action>
     <action issue="LANG-1367" type="update" dev="ggregory" due-to="Gary Gregory">ObjectUtils.identityToString(Object) and friends should allocate builders and buffers with a size</action>
diff --git a/src/main/java/org/apache/commons/lang3/builder/ToStringStyle.java b/src/main/java/org/apache/commons/lang3/builder/ToStringStyle.java
index e24aa3100ae..36fe8677d5e 100644
--- a/src/main/java/org/apache/commons/lang3/builder/ToStringStyle.java
+++ b/src/main/java/org/apache/commons/lang3/builder/ToStringStyle.java
@@ -2591,7 +2591,7 @@ protected void appendDetail(final StringBuffer buffer, final String fieldName, f
 
         private boolean isJsonArray(final String valueAsString) {
             return valueAsString.startsWith(getArrayStart())
-                    && valueAsString.startsWith(getArrayEnd());
+                    && valueAsString.endsWith(getArrayEnd());
         }
 
         private boolean isJsonObject(final String valueAsString) {
diff --git a/src/test/java/org/apache/commons/lang3/builder/JsonToStringStyleTest.java b/src/test/java/org/apache/commons/lang3/builder/JsonToStringStyleTest.java
index 6f76cfecfdd..d6bbc646c3b 100644
--- a/src/test/java/org/apache/commons/lang3/builder/JsonToStringStyleTest.java
+++ b/src/test/java/org/apache/commons/lang3/builder/JsonToStringStyleTest.java
@@ -358,6 +358,26 @@ public void testLongArrayArray() {
         }
     }
 
+    @Test
+    public void testArray() {
+        final Person p = new Person();
+        p.name = "Jane Doe";
+        p.age = 25;
+        p.smoker = true;
+
+        assertEquals(
+                "{\"name\":\"Jane Doe\",\"age\":25,\"smoker\":true,\"groups\":['admin', 'manager', 'user']}",
+                new ToStringBuilder(p).append("name", p.name)
+                        .append("age", p.age).append("smoker", p.smoker)
+                        .append("groups", new Object() {
+                            @Override
+                            public String toString() {
+                                return "['admin', 'manager', 'user']";
+                            }
+                        })
+                        .toString());
+    }
+
     /**
      * An object with nested object structures used to test {@link ToStringStyle.JsonToStringStyle}.
      *
