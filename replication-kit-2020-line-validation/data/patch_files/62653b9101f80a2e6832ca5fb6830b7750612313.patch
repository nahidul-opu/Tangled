From 62653b9101f80a2e6832ca5fb6830b7750612313 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Tue, 2 Nov 2010 19:01:11 +0000
Subject: [PATCH] VFS-326 Multi-threading issues - fix inter-thread
 communication issues

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1030176 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/commons/vfs/cache/SoftRefFilesCache.java    | 2 +-
 .../java/org/apache/commons/vfs/impl/DefaultFileMonitor.java    | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/cache/SoftRefFilesCache.java b/core/src/main/java/org/apache/commons/vfs/cache/SoftRefFilesCache.java
index a0fbbad8f8..fcfd00b7a1 100644
--- a/core/src/main/java/org/apache/commons/vfs/cache/SoftRefFilesCache.java
+++ b/core/src/main/java/org/apache/commons/vfs/cache/SoftRefFilesCache.java
@@ -62,7 +62,7 @@ public class SoftRefFilesCache extends AbstractFilesCache
      */
     private final class SoftRefReleaseThread extends Thread
     {
-        private boolean requestEnd;
+        private volatile boolean requestEnd; // used for inter-thread communication
 
         private SoftRefReleaseThread()
         {
diff --git a/core/src/main/java/org/apache/commons/vfs/impl/DefaultFileMonitor.java b/core/src/main/java/org/apache/commons/vfs/impl/DefaultFileMonitor.java
index 94230a24b2..e2accd8284 100644
--- a/core/src/main/java/org/apache/commons/vfs/impl/DefaultFileMonitor.java
+++ b/core/src/main/java/org/apache/commons/vfs/impl/DefaultFileMonitor.java
@@ -111,7 +111,7 @@ public class DefaultFileMonitor implements Runnable, FileMonitor
     /**
      * A flag used to determine if the monitor thread should be running.
      */
-    private boolean shouldRun = true;
+    private volatile boolean shouldRun = true; // used for inter-thread communication
 
     /**
      * A flag used to determine if adding files to be monitored should be recursive.
