From 4360f78a803e60d7857be0c64b94f40867d11c79 Mon Sep 17 00:00:00 2001
From: Mario Ivankovits <imario@apache.org>
Date: Tue, 19 Jun 2007 07:58:51 +0000
Subject: [PATCH] VFS-98: synchronized against filesystem to avoid lock

git-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/vfs/trunk@548639 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs/provider/ftp/FtpFileSystem.java | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileSystem.java b/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileSystem.java
index 52114bc2fc..ff4b468906 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileSystem.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileSystem.java
@@ -47,7 +47,6 @@ public class FtpFileSystem
 
     // An idle client
     private FtpClient idleClient;
-    private final Object idleClientSync = new Object();
 
     protected FtpFileSystem(final GenericFileName rootName, final FtpClient ftpClient, final FileSystemOptions fileSystemOptions)
     {
@@ -101,12 +100,12 @@ private void closeConnection(final FtpClient client)
      */
     public FtpClient getClient() throws FileSystemException
     {
-        synchronized (idleClientSync)
+        synchronized (this)
             {
                 if (idleClient == null || !idleClient.isConnected())
                 {
 					idleClient = null;
-					
+
 					FtpClient ftpClient = new FTPClientWrapper((GenericFileName) getRoot().getName(), getFileSystemOptions());
                     return ftpClient;
                     /*
@@ -134,7 +133,7 @@ public FtpClient getClient() throws FileSystemException
      */
     public void putClient(final FtpClient client)
     {
-        synchronized (idleClientSync)
+        synchronized (this)
             {
                 if (idleClient == null)
                 {
