From 26866a5a7b1bd8b84dad772344b35b47ae3f27ba Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Tue, 16 Dec 2008 21:32:39 +0000
Subject: [PATCH] FIX: Files with non-latin symbols fail to download (IVY-962)
 (merged from trunk)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/branches/2.0.x@727157 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                              | 1 +
 src/java/org/apache/ivy/util/url/AbstractURLHandler.java | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 81f1a0bfd..755231a72 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -91,6 +91,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - FIX: NullPointerException when resolving module wihout revision in the pattern (IVY-980)
 - FIX: IO problem while parsing ivy file (Resetting to invalid mark) (IVY-975)
 - FIX: Cannot parse maven2 poms containing an UTF-8 BOM
+- FIX: Files with non-latin symbols fail to download (IVY-962)
 
    2.0.0-rc2
 =====================================
diff --git a/src/java/org/apache/ivy/util/url/AbstractURLHandler.java b/src/java/org/apache/ivy/util/url/AbstractURLHandler.java
index e8e0090ab..6a0678e51 100644
--- a/src/java/org/apache/ivy/util/url/AbstractURLHandler.java
+++ b/src/java/org/apache/ivy/util/url/AbstractURLHandler.java
@@ -97,7 +97,7 @@ protected String normalizeToString(URL url) throws IOException {
             
             // it is possible that the original url was already (partial) escaped,
             // so we must unescape all '%' followed by 2 hexadecimals...
-            String uriString = uri.toString();
+            String uriString = uri.toASCIIString();
             
             // manually escape the '+' character
             uriString = uriString.replaceAll("\\+", "%2B");
