From 3752cfbf7fb39193ed2bce69d4b7889548ee4c62 Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Wed, 20 Apr 2011 09:36:27 +0000
Subject: [PATCH] [SANTUARIO-253] - Fix for thread-safety issue in
 ResourceResolver.

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/1.4.x-fixes@1095339 13f79535-47bb-0310-9956-ffa450edef68
---
 .../utils/resolver/ResourceResolver.java      | 23 ++-----------------
 1 file changed, 2 insertions(+), 21 deletions(-)

diff --git a/src/org/apache/xml/security/utils/resolver/ResourceResolver.java b/src/org/apache/xml/security/utils/resolver/ResourceResolver.java
index 59177be3af..36839ca53d 100644
--- a/src/org/apache/xml/security/utils/resolver/ResourceResolver.java
+++ b/src/org/apache/xml/security/utils/resolver/ResourceResolver.java
@@ -48,13 +48,10 @@ public class ResourceResolver {
     static org.apache.commons.logging.Log log = 
         org.apache.commons.logging.LogFactory.getLog(ResourceResolver.class.getName());
 
-   /** Field _alreadyInitialized */
-   static boolean _alreadyInitialized = false;
-
    /** these are the system-wide resolvers */
-   static List _resolverVector = null;
+   private static List _resolverVector = new ArrayList(10);
    
-   static boolean allThreadSafeInList=true;
+   private static boolean allThreadSafeInList=true;
 
    /** Field transformSpi */
    protected ResourceResolverSpi _resolverSpi = null;
@@ -113,17 +110,6 @@ public static final ResourceResolver getInstance(Attr uri, String BaseURI)
          	log.debug("check resolvability by class " + resolver._resolverSpi.getClass().getName());
 
          if ((resolver != null) && resolverTmp.canResolve(uri, BaseURI)) {
-        	 if (i!=0) {
-            	 //update resolver.
-        		 //System.out.println("Swaping");
-        		 List resolverVector=(List)((ArrayList)_resolverVector).clone();
-        		 resolverVector.remove(i);
-        		 resolverVector.add(0,resolver);        		 
-        		 _resolverVector=resolverVector;        		 
-        	 } else {
-        		 //System.out.println("hitting");
-        	 }
-        	 
             return resolverTmp;
          }
       }
@@ -180,11 +166,6 @@ public static final ResourceResolver getInstance(
     * The init() function is called by org.apache.xml.security.Init.init()
     */
    public static void init() {
-
-      if (!ResourceResolver._alreadyInitialized) {
-         ResourceResolver._resolverVector = new ArrayList(10);
-         _alreadyInitialized = true;
-      }
    }
 
     /**
