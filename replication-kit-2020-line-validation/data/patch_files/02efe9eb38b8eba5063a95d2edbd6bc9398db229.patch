From 02efe9eb38b8eba5063a95d2edbd6bc9398db229 Mon Sep 17 00:00:00 2001
From: Nicolas Lalevee <hibou@apache.org>
Date: Wed, 13 Jul 2011 08:52:57 +0000
Subject: [PATCH] IVY-1304:  - make the buildobr Ant task generate OBR XML that
 is not compatible with Felix bundlerepository

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@1145911 13f79535-47bb-0310-9956-ffa450edef68
---
 .../apache/ivy/osgi/obr/xml/OBRXMLWriter.java | 24 ++++++++++++-------
 1 file changed, 16 insertions(+), 8 deletions(-)

diff --git a/src/java/org/apache/ivy/osgi/obr/xml/OBRXMLWriter.java b/src/java/org/apache/ivy/osgi/obr/xml/OBRXMLWriter.java
index b1ce293af..bf9842605 100644
--- a/src/java/org/apache/ivy/osgi/obr/xml/OBRXMLWriter.java
+++ b/src/java/org/apache/ivy/osgi/obr/xml/OBRXMLWriter.java
@@ -225,21 +225,29 @@ private static void appendVersion(StringBuffer filter, VersionRange v) {
         filter.append("(&");
         Version start = v.getStartVersion();
         if (start != null) {
-            filter.append("(version>");
             if (!v.isStartExclusive()) {
-                filter.append('=');
+                filter.append("(version>=");
+                filter.append(start.toString());
+                filter.append(')');
+            } else {
+                filter.append("(!");
+                filter.append("(version<=");
+                filter.append(start.toString());
+                filter.append("))");
             }
-            filter.append(start.toString());
-            filter.append(')');
         }
         Version end = v.getEndVersion();
         if (end != null) {
-            filter.append("(version<");
             if (!v.isEndExclusive()) {
-                filter.append('=');
+                filter.append("(version<=");
+                filter.append(end.toString());
+                filter.append(')');
+            } else {
+                filter.append("(!");
+                filter.append("(version>=");
+                filter.append(end.toString());
+                filter.append("))");
             }
-            filter.append(end.toString());
-            filter.append(')');
         }
     }
 
