From ac5fc2cacdea64878aa0bb9c0c397d45caff9f63 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Wed, 4 Feb 2009 21:12:06 +0000
Subject: [PATCH] FIX: overwrite='false' completely prevents publishing into
 url repositories (IVY-1007)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@740887 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                                  | 1 +
 .../org/apache/ivy/plugins/repository/url/URLRepository.java | 5 ++---
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index bfff39f4f..077b1279a 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -94,6 +94,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Error message is not clear when specifying an invalid value for checksums (IVY-977)
 - IMPROVEMENT: catch AccessControlException on System.getProperties() (IVY-1015)
 
+- FIX: overwrite='false' completely prevents publishing into url repositories (IVY-1007)
 - FIX: Fixed broken logo link in ivy-report.xsl (IVY-1024) (thanks to Carlton Brown)
 - FIX: Support for opensll sha1 and md5 checksum (IVY-1006)
 - FIX: TTL does not work as expected (IVY-1012)
diff --git a/src/java/org/apache/ivy/plugins/repository/url/URLRepository.java b/src/java/org/apache/ivy/plugins/repository/url/URLRepository.java
index 3aefdd689..238490b8a 100644
--- a/src/java/org/apache/ivy/plugins/repository/url/URLRepository.java
+++ b/src/java/org/apache/ivy/plugins/repository/url/URLRepository.java
@@ -71,9 +71,8 @@ public void get(String source, File destination) throws IOException {
     }
 
     public void put(File source, String destination, boolean overwrite) throws IOException {
-        if (!overwrite) {
-            throw new UnsupportedOperationException(
-                    "URL repository do not support append operations at the moment");
+        if (!overwrite && getResource(destination).exists()) {
+            throw new IOException("destination file exists and overwrite == false");
         }
 
         fireTransferInitiated(getResource(destination), TransferEvent.REQUEST_PUT);
