From 854899e5db38fa14e7be56c1f850c35387d4df06 Mon Sep 17 00:00:00 2001
From: Lewis John McGibbney <lewis.mcgibbney@gmail.com>
Date: Fri, 16 Sep 2016 12:01:58 -0700
Subject: [PATCH] GORA-493 Unclosed DataInputBuffer in IOUtils#deserialize()

---
 gora-core/src/main/java/org/apache/gora/util/IOUtils.java | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/gora-core/src/main/java/org/apache/gora/util/IOUtils.java b/gora-core/src/main/java/org/apache/gora/util/IOUtils.java
index 1e81e8da6..2dd246763 100644
--- a/gora-core/src/main/java/org/apache/gora/util/IOUtils.java
+++ b/gora-core/src/main/java/org/apache/gora/util/IOUtils.java
@@ -248,9 +248,10 @@ public static<T> T deserialize(Configuration conf, DataInput in
    * @throws ClassNotFoundException */
   public static<T> T deserialize(Configuration conf, byte[] in
       , T obj) throws IOException, ClassNotFoundException {
-    DataInputBuffer buffer = new DataInputBuffer();
-    buffer.reset(in, in.length);
-    return deserialize(conf, buffer, obj);
+    try (DataInputBuffer buffer = new DataInputBuffer()) {
+      buffer.reset(in, in.length);
+      return deserialize(conf, buffer, obj);
+    }
   }
 
   /**
