From e66d8cd80c0fd29925050aec9ff96095617dd076 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Alfonso=20Nishikawa=20Mu=C3=B1umer?=
 <alfonso.nishikawa@gmail.com>
Date: Thu, 11 Jan 2018 08:40:20 -0100
Subject: [PATCH] Tests for GORA-421, fixing setDirty()

---
 .../persistency/impl/TestPersistentBase.java     | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/gora-core/src/test/java/org/apache/gora/persistency/impl/TestPersistentBase.java b/gora-core/src/test/java/org/apache/gora/persistency/impl/TestPersistentBase.java
index cae635b3c..1a9374e4a 100644
--- a/gora-core/src/test/java/org/apache/gora/persistency/impl/TestPersistentBase.java
+++ b/gora-core/src/test/java/org/apache/gora/persistency/impl/TestPersistentBase.java
@@ -153,4 +153,20 @@ public void testClone() throws Exception {
     
     assertEquals(employee, Employee.newBuilder(employee).build());
   }
+  
+  /**
+   * Test that #setDirty() sets all the shallow fields dirty.
+   * GORA-421
+   */
+  @Test
+  public void testSetDirty() {
+    WebPage page = WebPage.newBuilder().build();
+    assertEquals("Expected the new Persistent instance to not be dirty.", false, page.isDirty()) ;
+    page.setDirty();
+    
+    // Assert each field is dirty
+    for (Field field : page.getSchema().getFields()) {
+      assertEquals("The field " + field.name() + " is not dirty.", true, page.isDirty(field.name()));
+    }
+  }
 }
