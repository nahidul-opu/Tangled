From 9de4928a1860c043a8aec6a7bdf150650a33632f Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Sun, 11 Jul 2010 23:15:47 +0000
Subject: [PATCH] NET-328 FromNetASCIIInputStream.read(byte[], int, int) may
 change length passed to superclass if not doing conversion

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@963161 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/net/io/FromNetASCIIInputStream.java | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java b/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java
index fd3fd0e51..923bc4b38 100644
--- a/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java
+++ b/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java
@@ -156,11 +156,14 @@ public int read(byte buffer[]) throws IOException
     @Override
     public int read(byte buffer[], int offset, int length) throws IOException
     {
-        int ch, off;
+        if (_noConversionRequired)
+            return super.read(buffer, offset, length);
 
         if (length < 1)
             return 0;
 
+        int ch, off;
+
         ch = available();
 
         __length = (length > ch ? ch : length);
@@ -169,8 +172,6 @@ public int read(byte buffer[], int offset, int length) throws IOException
         if (__length < 1)
             __length = 1;
 
-        if (_noConversionRequired)
-            return super.read(buffer, offset, __length);
 
         if ((ch = __read()) == -1)
             return -1;
