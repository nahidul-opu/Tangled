From 108fa9a93c2cd126a138f8813390e197d0a3584e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rn=20Kottmann?= <joern@apache.org>
Date: Mon, 15 May 2017 16:04:58 +0200
Subject: [PATCH] OPENNLP-1059 Set model version before creating the POS Model

---
 .../opennlp/tools/util/model/POSModelSerializer.java   | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/opennlp-tools/src/main/java/opennlp/tools/util/model/POSModelSerializer.java b/opennlp-tools/src/main/java/opennlp/tools/util/model/POSModelSerializer.java
index a82319c99..5fe365acf 100644
--- a/opennlp-tools/src/main/java/opennlp/tools/util/model/POSModelSerializer.java
+++ b/opennlp-tools/src/main/java/opennlp/tools/util/model/POSModelSerializer.java
@@ -20,6 +20,8 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.util.HashMap;
+import java.util.Map;
 
 import opennlp.tools.ml.BeamSearch;
 import opennlp.tools.postag.POSModel;
@@ -36,8 +38,14 @@ public POSModel create(InputStream in) throws IOException {
     Version version = posModel.getVersion();
     if (version.getMajor() == 1 && version.getMinor() == 5) {
       if (posModel.getManifestProperty(BeamSearch.BEAM_SIZE_PARAMETER) == null) {
+        Map<String, String> manifestInfoEntries = new HashMap<>();
+
+        // The version in the model must be correct or otherwise version
+        // dependent code branches in other places fail
+        manifestInfoEntries.put("OpenNLP-Version", "1.5.0");
+
         posModel = new POSModel(posModel.getLanguage(), posModel.getPosModel(), 10,
-            null, posModel.getFactory());
+            manifestInfoEntries, posModel.getFactory());
       }
     }
 
