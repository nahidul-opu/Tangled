From fc4b28286916378bbcfd6143e1f8457446f53295 Mon Sep 17 00:00:00 2001
From: "James W. Carman" <jcarman@apache.org>
Date: Sat, 24 May 2008 12:52:50 +0000
Subject: [PATCH] VFS-196: FTP Provider Does Not Support Symbolic Links
 Correctly

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@659810 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/vfs/provider/ftp/FtpFileObject.java  | 16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java b/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java
index 1da2d83c6e..8ff9c87427 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java
@@ -24,6 +24,9 @@
 import org.apache.commons.vfs.FileSystemException;
 import org.apache.commons.vfs.FileType;
 import org.apache.commons.vfs.RandomAccessContent;
+import org.apache.commons.vfs.FileSystemManager;
+import org.apache.commons.vfs.VFS;
+import org.apache.commons.vfs.FileUtil;
 import org.apache.commons.vfs.provider.AbstractFileObject;
 import org.apache.commons.vfs.provider.UriParser;
 import org.apache.commons.vfs.util.Messages;
@@ -133,12 +136,9 @@ private void doGetChildren() throws IOException
 		final FtpClient client = ftpFs.getClient();
 		try
 		{
-            final FTPFile[] tmpChildren = client.listFiles(relPath);
-            if (tmpChildren == null)
-            {
-                children = null;
-            }
-            else if (tmpChildren.length == 0)
+            final String path = fileInfo != null && fileInfo.isSymbolicLink() ? getFileSystem().getFileSystemManager().resolveName(getParent().getName(), fileInfo.getLink() ).getPath() : relPath;
+            final FTPFile[] tmpChildren = client.listFiles(path);
+			if (tmpChildren == null || tmpChildren.length == 0)
 			{
 				children = EMPTY_FTP_FILE_MAP;
 			}
@@ -230,7 +230,7 @@ public void refresh() throws FileSystemException
                 {
                     this.fileInfo = null;
                 }
-                
+
                 /* VFS-210
                 try
 				{
@@ -394,7 +394,7 @@ public FileObject[] getChildren() throws FileSystemException
 			 * if if this file has C children, P parents, there will be (C * P)
 			 * listings made with (C * (P + 1)) refreshes, when there should
 			 * really only be 1 listing and C refreshes. */
-			
+
 			this.inRefresh = true;
 			return super.getChildren();
 		}
