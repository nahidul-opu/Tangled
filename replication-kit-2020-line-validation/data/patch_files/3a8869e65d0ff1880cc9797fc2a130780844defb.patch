From 3a8869e65d0ff1880cc9797fc2a130780844defb Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Wed, 9 Nov 2011 22:45:41 +0000
Subject: [PATCH] [VFS-382] SFTP getChildren() does not fail when called on a
 file.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1200015 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/vfs2/provider/sftp/SftpFileObject.java       | 4 ++++
 src/changes/changes.xml                                  | 9 +++++++++
 2 files changed, 13 insertions(+)

diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java b/core/src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java
index 3653afae65..af8407c414 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java
@@ -300,6 +300,10 @@ protected void doRename(FileObject newfile) throws Exception
     @Override
     protected FileObject[] doListChildrenResolved() throws Exception
     {
+        // should not require a round-trip because type is already set.
+        if (this.isFile()) {
+            return null;
+        }
         // List the contents of the folder
         Vector<?> vector = null;
         final ChannelSftp channel = fileSystem.getChannel();
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index cc354d8b5d..93c6e2dabd 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,12 @@
 
   <body>
     <release version="2.1" date="TBD" description="">
+      <action issue="VFS-382" dev="ggregory" type="fix">
+        SFTP getChildren() does not fail when called on a file.
+      </action>
+      <action issue="VFS-381" dev="ggregory" type="add">
+        Iterate over a FileObject using the Java "foreach" statement, to provide all descendents of a FileObject.
+      </action>
       <action issue="VFS-380" dev="ggregory" type="fix">
         FTP connect.error message used instead of SFTP connect.error message.
       </action>
@@ -47,6 +53,9 @@
       <action issue="VFS-372" dev="ggregory" type="add">
         Add constructors FileDepthSelector() and FileDepthSelector(int).
       </action>
+      <action issue="VFS-371" dev="ggregory" type="add">
+        Add FileObject API deleteAll().
+      </action>
       <action issue="VFS-370" dev="ggregory" type="add">
         Add a FileExtensionSelector class.
       </action>
