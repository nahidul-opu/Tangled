From c65ef9d7f1a985cc2edf754f77498654891ee553 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Fri, 15 Aug 2008 18:08:07 +0000
Subject: [PATCH] NET-230 - ParserInitializationException when connecting to a
 Unix FTP server: comparison string must be upper case

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@686298 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/commons/net/ftp/FTPClientConfig.java  | 5 ++++-
 src/site/xdoc/changes.xml                                 | 3 +++
 .../ftp/parser/DefaultFTPFileEntryParserFactoryTest.java  | 8 ++++++++
 3 files changed, 15 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java b/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java
index 5730f8751..eb8f6ca51 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java
@@ -190,9 +190,12 @@ public class FTPClientConfig
      * This may happen if the ftpd in question was compiled without system
      * information.
      *
+     * NET-230 - Updated to be UPPERCASE so that the check done in
+     * createFileEntryParser will succeed.
+     *
      * @since 1.5
      */
-    public static final String SYST_L8 = "Type: L8";
+    public static final String SYST_L8 = "TYPE: L8";
     
     /**
      * Identifier by which an Netware-based ftp server is known throughout
diff --git a/src/site/xdoc/changes.xml b/src/site/xdoc/changes.xml
index 3c8207b66..b3d244282 100644
--- a/src/site/xdoc/changes.xml
+++ b/src/site/xdoc/changes.xml
@@ -167,6 +167,9 @@ limitations under the License.
             </action>
             <action dev="sebb" type="fix" issue="NET-223">
                 the data connection socket is not closed when an IOException occurred
+            </action>
+            <action dev="sebb" type="fix" issue="NET-230">
+                ParserInitializationException when connecting to a Unix FTP server: comparison string must be upper case
             </action>
 		</release>	
 
diff --git a/src/test/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactoryTest.java b/src/test/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactoryTest.java
index a515c1e0d..cfaf521e6 100644
--- a/src/test/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactoryTest.java
+++ b/src/test/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactoryTest.java
@@ -62,6 +62,14 @@ public void testDefaultParserFactory() throws Exception {
         parser = factory.createFileEntryParser("OS/400");
         assertTrue(parser instanceof CompositeFileEntryParser);
 
+        parser = factory.createFileEntryParser("AS/400");
+        assertTrue(parser instanceof CompositeFileEntryParser);
+
+        // Added test to make sure it handles the Unix systems that were
+        // compiled with OS as "UNKNOWN". This test validates that the
+        // check is case-insensitive.
+        parser = factory.createFileEntryParser("UNKNOWN Type: L8");
+
         try {
             parser = factory.createFileEntryParser("OS2FTPFileEntryParser");
             fail("Exception should have been thrown. \"OS2FTPFileEntryParser\" is not a recognized key");
