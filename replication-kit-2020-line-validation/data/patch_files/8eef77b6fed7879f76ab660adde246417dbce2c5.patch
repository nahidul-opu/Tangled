From 8eef77b6fed7879f76ab660adde246417dbce2c5 Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Thu, 23 Sep 2010 20:27:53 +0000
Subject: [PATCH] FIX: ApacheURLLister doesn't handle some truncated linknames
 properly (IVY-1232) (thanks to John Tinetti)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@1000609 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                           | 2 ++
 src/java/org/apache/ivy/util/url/ApacheURLLister.java | 5 +++++
 2 files changed, 7 insertions(+)

diff --git a/CHANGES.txt b/CHANGES.txt
index dd4f37947..9147c2881 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -98,6 +98,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 	John Shields
 	Simon Steiner
 	Johan Stuyts
+	John Tinetti
 	Jason Trump
 	Tjeerd Verhagen
 	Richard Vowles
@@ -128,6 +129,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: ivy:makepom now accepts a list of configurations to include (IVY-1005) (thanks to Jesper Pedersen)
 - IMPROVEMENT: ivy:makepom can generate a <description> element in the pom (IVY-1215) (thanks to Jesper Pedersen)
 
+- FIX: ApacheURLLister doesn't handle some truncated linknames properly (IVY-1232) (thanks to John Tinetti)
 - FIX: Ivy cannot handle Maven pom with parents depending back on theirselfs (IVY-1225)
 - FIX: OutOfMemoryError when uploading large files using commons-httpclient (IVY-1197) (thanks to Torkild U. Resheim)
 - FIX: artifactreport ant task doesn't honor log attribute (IVY-1212)
diff --git a/src/java/org/apache/ivy/util/url/ApacheURLLister.java b/src/java/org/apache/ivy/util/url/ApacheURLLister.java
index 8ffc72f89..e15d37b02 100644
--- a/src/java/org/apache/ivy/util/url/ApacheURLLister.java
+++ b/src/java/org/apache/ivy/util/url/ApacheURLLister.java
@@ -163,6 +163,11 @@ public List retrieveListing(URL url, boolean includeFiles, boolean includeDirect
                 if (!href.startsWith(text.substring(0, text.length() - 3))) {
                     continue;
                 }
+            } else if (text.endsWith("..&gt;")) {
+                // text is probably truncated, we can only check if the href starts with text
+                if (!href.startsWith(text.substring(0, text.length() - 6))) {
+                    continue;
+                }
             } else {
                 // text is not truncated, so it must match the url after stripping optional
                 // trailing slashes
