From a1514c5cd6342571464ad686d14474101c97960d Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Thu, 10 May 2007 21:38:50 +0000
Subject: [PATCH] FIX on pop implementation (IVY-497) (thanks to Jaroslaw
 Wypychowski)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/core/trunk@537003 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/ivy/core/IvyContext.java | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/ivy/core/IvyContext.java b/src/java/org/apache/ivy/core/IvyContext.java
index 4489082c6..489b1467b 100644
--- a/src/java/org/apache/ivy/core/IvyContext.java
+++ b/src/java/org/apache/ivy/core/IvyContext.java
@@ -183,9 +183,10 @@ public boolean pop(String key, Object expectedValue){
 		synchronized(_contextMap){
 			Object o=_contextMap.get(key);
 			if(o==null) return false;
-			if(!o.equals(expectedValue)) return false;
 			if(o instanceof List){
 				if(((List)o).size()==0) return false;
+				Object top=((List)o).get(0);
+				if(!top.equals(expectedValue)) return false;				
 				((List)o).remove(0);
 				return true;
 			} else {
