From 4dcf99ae012fe5d15656967832dc0fb0bec35b10 Mon Sep 17 00:00:00 2001
From: Niall Pemberton <niallp@apache.org>
Date: Thu, 5 Aug 2010 00:18:19 +0000
Subject: [PATCH] IO-240 ensure cvsFilter and svnFilter are only created once.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@982437 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/io/filefilter/FileFilterUtils.java     | 14 ++++----------
 1 file changed, 4 insertions(+), 10 deletions(-)

diff --git a/src/java/org/apache/commons/io/filefilter/FileFilterUtils.java b/src/java/org/apache/commons/io/filefilter/FileFilterUtils.java
index de70bba1699..5cad05e78c8 100644
--- a/src/java/org/apache/commons/io/filefilter/FileFilterUtils.java
+++ b/src/java/org/apache/commons/io/filefilter/FileFilterUtils.java
@@ -380,10 +380,12 @@ public static IOFileFilter magicNumberFileFilter(byte[] magicNumber, long offset
 
     //-----------------------------------------------------------------------
     /* Constructed on demand and then cached */
-    private static IOFileFilter cvsFilter;
+    private static final IOFileFilter cvsFilter = notFileFilter(
+            andFileFilter(directoryFileFilter(), nameFileFilter("CVS")));;
 
     /* Constructed on demand and then cached */
-    private static IOFileFilter svnFilter;
+    private static final IOFileFilter svnFilter = svnFilter = notFileFilter(
+            andFileFilter(directoryFileFilter(), nameFileFilter(".svn")));
 
     /**
      * Decorates a filter to make it ignore CVS directories.
@@ -395,10 +397,6 @@ public static IOFileFilter magicNumberFileFilter(byte[] magicNumber, long offset
      * @since Commons IO 1.1 (method existed but had bug in 1.0)
      */
     public static IOFileFilter makeCVSAware(IOFileFilter filter) {
-        if (cvsFilter == null) {
-            cvsFilter = notFileFilter(
-                andFileFilter(directoryFileFilter(), nameFileFilter("CVS")));
-        }
         if (filter == null) {
             return cvsFilter;
         } else {
@@ -416,10 +414,6 @@ public static IOFileFilter makeCVSAware(IOFileFilter filter) {
      * @since Commons IO 1.1
      */
     public static IOFileFilter makeSVNAware(IOFileFilter filter) {
-        if (svnFilter == null) {
-            svnFilter = notFileFilter(
-                andFileFilter(directoryFileFilter(), nameFileFilter(".svn")));
-        }
         if (filter == null) {
             return svnFilter;
         } else {
