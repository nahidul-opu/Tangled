From c14844ebdf83b82066216c5ca431e0c377c0e0fc Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Mon, 22 Sep 2014 09:08:35 +0000
Subject: [PATCH] [SANTUARIO-399] - XMLCipher fails to declare signature
 namespace on xenc:EncryptionMethod/ds:DigestMethod elements

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/1.5.x-fixes@1626705 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/xml/security/encryption/XMLCipher.java   | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/main/java/org/apache/xml/security/encryption/XMLCipher.java b/src/main/java/org/apache/xml/security/encryption/XMLCipher.java
index d34122c100..970e71034b 100644
--- a/src/main/java/org/apache/xml/security/encryption/XMLCipher.java
+++ b/src/main/java/org/apache/xml/security/encryption/XMLCipher.java
@@ -3200,6 +3200,11 @@ Element toElement() {
                     Element digestElement = 
                         XMLUtils.createElementInSignatureSpace(contextDocument, Constants._TAG_DIGESTMETHOD);
                     digestElement.setAttributeNS(null, "Algorithm", digestAlgorithm);
+                    digestElement.setAttributeNS(
+                        Constants.NamespaceSpecNS,
+                        "xmlns:" + ElementProxy.getDefaultPrefix(Constants.SignatureSpecNS),
+                        Constants.SignatureSpecNS
+                    );
                     result.appendChild(digestElement);
                 }
                 if (mgfAlgorithm != null) {
