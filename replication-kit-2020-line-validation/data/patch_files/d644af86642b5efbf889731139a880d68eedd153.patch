From d644af86642b5efbf889731139a880d68eedd153 Mon Sep 17 00:00:00 2001
From: Maja Kabiljo <majakabiljo@fb.com>
Date: Thu, 10 Oct 2013 12:51:38 -0700
Subject: [PATCH] GIRAPH-777: Fix bug from GIRAPH-775 (majakabiljo)

---
 CHANGELOG                                                      | 2 ++
 .../apache/giraph/comm/requests/SendWorkerVerticesRequest.java | 3 ++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index ec91f33da..18d956c13 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,8 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-777: Fix bug from GIRAPH-775 (majakabiljo)
+
   GIRAPH-776: Update Giraph to use HiveIO 0.18 (gmalewicz via majakabiljo)
 
   GIRAPH-775: Vertex value combiner (aching)
diff --git a/giraph-core/src/main/java/org/apache/giraph/comm/requests/SendWorkerVerticesRequest.java b/giraph-core/src/main/java/org/apache/giraph/comm/requests/SendWorkerVerticesRequest.java
index 386e0ee9c..69fae8300 100644
--- a/giraph-core/src/main/java/org/apache/giraph/comm/requests/SendWorkerVerticesRequest.java
+++ b/giraph-core/src/main/java/org/apache/giraph/comm/requests/SendWorkerVerticesRequest.java
@@ -115,7 +115,8 @@ public void doRequest(ServerData<I, V, E> serverData) {
 
   @Override
   public int getSerializedSize() {
-    int size = 0;
+    // 4 for number of partitions
+    int size = super.getSerializedSize() + 4;
     PairList<Integer, ExtendedDataOutput>.Iterator iterator =
         workerPartitions.getIterator();
     while (iterator.hasNext()) {
