From 34108c93341bbdc9e9d82cb131797e5d1b884725 Mon Sep 17 00:00:00 2001
From: Avery Ching <aching@apache.org>
Date: Wed, 31 Oct 2012 02:49:11 +0000
Subject: [PATCH] GIRAPH-393: Number of input split threads should always be >=
 1 (aching)

git-svn-id: https://svn.apache.org/repos/asf/giraph/trunk@1403957 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG                                                      | 3 +++
 .../main/java/org/apache/giraph/graph/BspServiceWorker.java    | 3 ++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index 9f6c32704..d26460085 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,9 @@
 Giraph Change Log
 
 Release 0.2.0 - unreleased
+  GIRAPH-393: Number of input split threads should always be >= 1
+  (aching)
+
   GIRAPH-388: Improve the way we keep outgoing messages (majakabiljo
   via aching).
 
diff --git a/giraph/src/main/java/org/apache/giraph/graph/BspServiceWorker.java b/giraph/src/main/java/org/apache/giraph/graph/BspServiceWorker.java
index 194833c2c..4ec6d1737 100644
--- a/giraph/src/main/java/org/apache/giraph/graph/BspServiceWorker.java
+++ b/giraph/src/main/java/org/apache/giraph/graph/BspServiceWorker.java
@@ -216,7 +216,8 @@ private VertexEdgeCount loadVertices()
         INPUT_SUPERSTEP, 0, 0, getContext(), getGraphMapper(),
         null);
     int maxInputSplitThreads =
-        inputSplitPathList.size() / getConfiguration().getMaxWorkers();
+        Math.max(
+            inputSplitPathList.size() / getConfiguration().getMaxWorkers(), 1);
     int numThreads =
         Math.min(getConfiguration().getNumInputSplitsThreads(),
             maxInputSplitThreads);
