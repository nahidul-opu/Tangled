From 416ace7a7bfa726487b6b3583363379c8ba580f2 Mon Sep 17 00:00:00 2001
From: Avery Ching <aching@apache.org>
Date: Fri, 31 Aug 2012 18:34:17 +0000
Subject: [PATCH] GIRAPH-319: Receiving two responses for a request causes an
 exception. (apresta via aching)

git-svn-id: https://svn.apache.org/repos/asf/giraph/trunk@1379545 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG                                              |  4 ++++
 .../comm/netty/handler/ResponseClientHandler.java      | 10 +++++-----
 src/main/java/org/apache/giraph/graph/GiraphJob.java   |  2 +-
 3 files changed, 10 insertions(+), 6 deletions(-)

diff --git a/CHANGELOG b/CHANGELOG
index 58b6759da..b4e98818a 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,10 @@
 Giraph Change Log
 
 Release 0.2.0 - unreleased
+
+  GIRAPH-319: Receiving two responses for a request causes an
+  exception. (apresta via aching)
+
   GIRAPH-291: PredicateLock should have a constructor to take in a
   custom waiting time and additional testing (aching via ereisman)
 
diff --git a/src/main/java/org/apache/giraph/comm/netty/handler/ResponseClientHandler.java b/src/main/java/org/apache/giraph/comm/netty/handler/ResponseClientHandler.java
index c1c2574d2..b9bd9ca7b 100644
--- a/src/main/java/org/apache/giraph/comm/netty/handler/ResponseClientHandler.java
+++ b/src/main/java/org/apache/giraph/comm/netty/handler/ResponseClientHandler.java
@@ -18,9 +18,6 @@
 
 package org.apache.giraph.comm.netty.handler;
 
-import java.io.IOException;
-import java.util.concurrent.ConcurrentMap;
-
 import org.apache.giraph.graph.GiraphJob;
 import org.apache.hadoop.conf.Configuration;
 import org.apache.log4j.Logger;
@@ -32,6 +29,9 @@
 import org.jboss.netty.channel.MessageEvent;
 import org.jboss.netty.channel.SimpleChannelUpstreamHandler;
 
+import java.io.IOException;
+import java.util.concurrent.ConcurrentMap;
+
 /**
  * Generic handler of responses.
  */
@@ -108,8 +108,8 @@ public void messageReceived(
     RequestInfo requestInfo = workerIdOutstandingRequestMap.remove(
         new ClientRequestId(senderId, requestId));
     if (requestInfo == null) {
-      throw new IllegalStateException("messageReceived: Impossible to " +
-          "have a non-registered requestId " + requestId);
+      LOG.info("messageReceived: Already received response for request id = " +
+          requestId);
     } else {
       if (LOG.isDebugEnabled()) {
         LOG.debug("messageReceived: Processed request id = " + requestId +
diff --git a/src/main/java/org/apache/giraph/graph/GiraphJob.java b/src/main/java/org/apache/giraph/graph/GiraphJob.java
index 5bcc12a3d..e95d03799 100644
--- a/src/main/java/org/apache/giraph/graph/GiraphJob.java
+++ b/src/main/java/org/apache/giraph/graph/GiraphJob.java
@@ -203,7 +203,7 @@ public class GiraphJob {
   public static final String MAX_REQUEST_MILLISECONDS =
       "giraph.maxRequestMilliseconds";
   /** Maximum number of milliseconds for a request to complete */
-  public static final int MAX_REQUEST_MILLISECONDS_DEFAULT = 60 * 1000;
+  public static final int MAX_REQUEST_MILLISECONDS_DEFAULT =  600 * 1000;
 
   /** Netty max connection failures */
   public static final String NETTY_MAX_CONNECTION_FAILURES =
