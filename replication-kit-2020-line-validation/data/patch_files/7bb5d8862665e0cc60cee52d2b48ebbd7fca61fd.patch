From 7bb5d8862665e0cc60cee52d2b48ebbd7fca61fd Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Thu, 8 Oct 2009 12:07:19 +0000
Subject: [PATCH] properly indicate "oldgnu" mode for long file name entries in
 tar.  COMPRESS-86

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@823139 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                      | 5 +++++
 .../commons/compress/archivers/tar/TarArchiveEntry.java      | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index adcc70b3e40..9b0be1fea7a 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,11 @@
   </properties>
   <body>
     <release version="1.1" date="as in SVN" description="Release 1.1">
+      <action type="fix" issue="COMPRESS-86" date="2009-10-08">
+        Tar archive entries holding the file name for names longer
+        than 100 characters in GNU longfile mode didn't properly
+        specify they'd be using the "oldgnu" extension.
+      </action>
       <action type="add" date="2009-08-25">
         A new constructor of TarArchiveEntry can create entries with
         names that start with slashes - the default is to strip
diff --git a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveEntry.java b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveEntry.java
index a7a31396d1c..79967c90bbd 100644
--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveEntry.java
+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveEntry.java
@@ -210,6 +210,10 @@ public TarArchiveEntry(String name, boolean preserveLeadingSlashes) {
     public TarArchiveEntry(String name, byte linkFlag) {
         this(name);
         this.linkFlag = linkFlag;
+        if (linkFlag == LF_GNUTYPE_LONGNAME) {
+            magic = MAGIC_GNU;
+            version = VERSION_GNU_SPACE;
+        }
     }
 
     /**
