From e456eb315f83516e2eed8338519c577b61e80c61 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rn=20Kottmann?= <joern@apache.org>
Date: Mon, 28 Apr 2014 13:06:01 +0000
Subject: [PATCH] OPENNLP-677 Now headrules serializer for 1.5.x models is
 mapped correctly

git-svn-id: https://svn.apache.org/repos/asf/opennlp/trunk@1590621 13f79535-47bb-0310-9956-ffa450edef68
---
 .../opennlp/tools/parser/ParserModel.java     | 25 +++++++++++++++++++
 1 file changed, 25 insertions(+)

diff --git a/opennlp-tools/src/main/java/opennlp/tools/parser/ParserModel.java b/opennlp-tools/src/main/java/opennlp/tools/parser/ParserModel.java
index 1cf2babf7..0d0bb821e 100644
--- a/opennlp-tools/src/main/java/opennlp/tools/parser/ParserModel.java
+++ b/opennlp-tools/src/main/java/opennlp/tools/parser/ParserModel.java
@@ -69,6 +69,21 @@ public void serialize(ChunkerModel artifact, OutputStream out)
     }
   }
   
+  private static class HeadRulesSerializer implements
+      ArtifactSerializer<opennlp.tools.parser.lang.en.HeadRules> {
+
+    public opennlp.tools.parser.lang.en.HeadRules create(InputStream in)
+        throws IOException, InvalidFormatException {
+      return new opennlp.tools.parser.lang.en.HeadRules(new BufferedReader(
+          new InputStreamReader(in, "UTF-8")));
+    }
+
+    public void serialize(opennlp.tools.parser.lang.en.HeadRules artifact,
+        OutputStream out) throws IOException {
+      artifact.serialize(new OutputStreamWriter(out, "UTF-8"));
+    }
+  }
+  
   private static final String COMPONENT_NAME = "Parser";
   
   private static final String BUILD_MODEL_ENTRY_NAME = "build.model";
@@ -154,6 +169,16 @@ protected void createArtifactSerializers(
 
     super.createArtifactSerializers(serializers);
     
+    // In 1.6.x the headrules artifact is serialized with the new API
+    // which uses the Serializeable interface
+    // This change is not backward compatible with the 1.5.x models.
+    // In order to laod 1.5.x model the English headrules serializer must be
+    // put on the serializer map.
+    
+    if (getVersion().getMajor() == 1 && getVersion().getMinor() == 5) {
+    	serializers.put("headrules", new HeadRulesSerializer());
+    }
+    
     serializers.put("postagger", new POSModelSerializer());
     serializers.put("chunker", new ChunkerModelSerializer());
   }
