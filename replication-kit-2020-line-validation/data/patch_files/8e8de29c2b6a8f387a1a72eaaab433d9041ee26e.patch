From 8e8de29c2b6a8f387a1a72eaaab433d9041ee26e Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Sun, 23 Jul 2017 16:33:33 +0200
Subject: [PATCH] COMPRESS-417 add test

---
 .../tar/TarArchiveInputStreamTest.java          |  12 ++++++++++++
 src/test/resources/COMPRESS-417.tar             | Bin 0 -> 10240 bytes
 2 files changed, 12 insertions(+)
 create mode 100644 src/test/resources/COMPRESS-417.tar

diff --git a/src/test/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStreamTest.java b/src/test/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStreamTest.java
index e73982d18f7..f16d58401a4 100644
--- a/src/test/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStreamTest.java
+++ b/src/test/java/org/apache/commons/compress/archivers/tar/TarArchiveInputStreamTest.java
@@ -337,6 +337,18 @@ public void testGetAndSetOfPaxEntry() throws Exception {
         }
     }
 
+    /**
+     * @link "https://issues.apache.org/jira/browse/COMPRESS-417"
+     */
+    @Test
+    public void skipsDevNumbersWhenEntryIsNoDevice() throws Exception {
+        try (TarArchiveInputStream is = getTestStream("/COMPRESS-417.tar")) {
+            assertEquals("test1.xml", is.getNextTarEntry().getName());
+            assertEquals("test2.xml", is.getNextTarEntry().getName());
+            assertNull(is.getNextTarEntry());
+        }
+    }
+
     private TarArchiveInputStream getTestStream(final String name) {
         return new TarArchiveInputStream(
                 TarArchiveInputStreamTest.class.getResourceAsStream(name));
diff --git a/src/test/resources/COMPRESS-417.tar b/src/test/resources/COMPRESS-417.tar
new file mode 100644
index 0000000000000000000000000000000000000000..807683b022e6e98521e00ac2c38cf6c3bb58c440
GIT binary patch
literal 10240
zcmeH{-*1~R5XX64r2Y@yQ=bYpm>-*5S80gUR$GYLyzHqWV75#IB23ctzn@K1lhH}j
z9;ylL?gj39XZ!eYzE;SV*gv+V^>&7p1(aI)83z6@PbCpTU5nt51U~fxH?S~q!yvE_
ze!G(To%ga$8-%Pj+c$aJ>%+G{#q(MYmyE$@SL)xRgJ|TYuFxeqCpJF6;%5`~K2Bz<
zFUvW~>Z%f1tKw4Y1DAD%ZsybYW2>4ePutYdFS@BFmq(i*WvM)y@S~y7&(?ug6d}gG
zN2wouSo>j4LeGoV0SzOshzjcA>^EDgola^{73sZ|b{AjI9+%1eiWA=@%;|lTa+5r)
z7SqpjPO$CL$fnpPM5P+tWX{Ytuby{;>%EvW5KVF{c4hs%Or?CPo17PEDFt%|s>$9<
z(eQM)lg)uSonu1%0gH4icq|SV@%8Dsoovz{ZeyMh{PlLBzCk-Ca+j~OxY?-R%IhZ0
zN@0Ijik)|oopjPMt~m9%W_@x$oqd`=b_jJ3@b=rLV$LhMTfm&YC3J(FxVmA+a0~w5
z8ud+e|Ly!&<NnqBcm1)=|B<%P-_QT8*i>q?tDF6fl|nSg=`Q_?4EKGcod9J60U!Vb
wfB+Bx0zd!=00AHX1b_e#00KY&2mk>f00e*l5C8%|00;m9AOHk_z?cdA1V&@^zW@LL

literal 0
HcmV?d00001

