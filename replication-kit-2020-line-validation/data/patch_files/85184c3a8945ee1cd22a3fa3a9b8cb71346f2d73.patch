From 85184c3a8945ee1cd22a3fa3a9b8cb71346f2d73 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Tue, 20 Dec 2016 15:39:50 +0100
Subject: [PATCH] COMPRESS-377 properly close StreamCompressor

---
 src/changes/changes.xml                                       | 4 ++++
 .../compress/archivers/zip/ScatterZipOutputStream.java        | 1 +
 2 files changed, 5 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 82f8c969c0d..14e8df1a709 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -90,6 +90,10 @@ The <action> type attribute can be add,update,fix,remove.
         ZipArchiveInputStream now throws an Exception if it encounters
         a broken ZIP archive rather than signaling end-of-archive.
       </action>
+      <action issue="COMPRESS-377" type="fix" date="2016-12-20">
+        ScatterZipOutputStream didn't close the StreamCompressor
+        causing a potential resource leak.
+      </action>
     </release>
     <release version="1.12" date="2016-06-21"
              description="Release 1.12 - API compatible to 1.11 but requires Java 6 at runtime.
diff --git a/src/main/java/org/apache/commons/compress/archivers/zip/ScatterZipOutputStream.java b/src/main/java/org/apache/commons/compress/archivers/zip/ScatterZipOutputStream.java
index 7c10d378e07..7e3bae0ce2a 100644
--- a/src/main/java/org/apache/commons/compress/archivers/zip/ScatterZipOutputStream.java
+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ScatterZipOutputStream.java
@@ -125,6 +125,7 @@ public void writeTo(final ZipArchiveOutputStream target) throws IOException {
     @Override
     public void close() throws IOException {
         backingStore.close();
+        streamCompressor.close();
     }
 
     /**
