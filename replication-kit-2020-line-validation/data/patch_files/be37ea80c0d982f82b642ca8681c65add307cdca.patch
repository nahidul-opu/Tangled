From be37ea80c0d982f82b642ca8681c65add307cdca Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Sun, 28 Jun 2009 22:41:09 +0000
Subject: [PATCH] FIX: [originalname] not expanded during retrieve when module
 descriptor contains extra attributes (IVY-1096)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@789166 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java b/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java
index f568cc8e6..7ad7f31f0 100644
--- a/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java
+++ b/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java
@@ -304,8 +304,9 @@ public Map determineArtifactsToCopy(ModuleRevisionId mrid, String destFilePatter
                     continue; // skip this artifact, the filter didn't accept it!
                 }
 
-                String destFileName = IvyPatternHelper.substitute(
-                                        destPattern, artifact.getArtifact(), conf);
+                String destFileName = IvyPatternHelper.substitute(destPattern, 
+                        artifact.getArtifact().getModuleRevisionId(), artifact.getArtifact(), 
+                        conf, artifact.getArtifactOrigin());
 
                 Set dest = (Set) artifactsToCopy.get(artifact);
                 if (dest == null) {
