From cc6c943bc6764ff944d33421d0c0ab48ef5c09e4 Mon Sep 17 00:00:00 2001
From: William Colen <colen@apache.org>
Date: Tue, 13 Mar 2012 16:48:55 +0000
Subject: [PATCH] OPENNLP-466: Added JUnit that tries to reproduce the issue,
 but could not reproduce the error.

git-svn-id: https://svn.apache.org/repos/asf/opennlp/trunk@1300236 13f79535-47bb-0310-9956-ffa450edef68
---
 .../TokenNameFinderCrossValidatorTest.java    | 40 ++++++++++++++++++-
 1 file changed, 38 insertions(+), 2 deletions(-)

diff --git a/opennlp-tools/src/test/java/opennlp/tools/namefind/TokenNameFinderCrossValidatorTest.java b/opennlp-tools/src/test/java/opennlp/tools/namefind/TokenNameFinderCrossValidatorTest.java
index a7eedcf01..718bc9707 100644
--- a/opennlp-tools/src/test/java/opennlp/tools/namefind/TokenNameFinderCrossValidatorTest.java
+++ b/opennlp-tools/src/test/java/opennlp/tools/namefind/TokenNameFinderCrossValidatorTest.java
@@ -17,10 +17,14 @@
 
 package opennlp.tools.namefind;
 
-import static org.junit.Assert.assertNotNull;
+import static org.junit.Assert.*;
 
+import java.io.ByteArrayOutputStream;
 import java.io.FileInputStream;
+import java.util.Collections;
+import java.util.Map;
 
+import opennlp.tools.cmdline.namefind.NameEvaluationErrorListener;
 import opennlp.tools.util.ObjectStream;
 import opennlp.tools.util.PlainTextByLineStream;
 import opennlp.tools.util.TrainingParameters;
@@ -34,6 +38,9 @@ public class TokenNameFinderCrossValidatorTest {
   private final String TYPE = "default";
 
   @Test
+  /**
+   * Test that reproduces jira OPENNLP-463
+   */
   public void testWithNullResources() throws Exception {
 
     FileInputStream sampleDataIn = new FileInputStream(getClass()
@@ -49,8 +56,37 @@ public void testWithNullResources() throws Exception {
     TokenNameFinderCrossValidator cv = new TokenNameFinderCrossValidator("en",
         TYPE, mlParams, null, null);
 
-    cv.evaluate(sampleStream, 1);
+    cv.evaluate(sampleStream, 2);
 
     assertNotNull(cv.getFMeasure());
   }
+  
+  @Test
+  /**
+   * Test that tries to reproduce jira OPENNLP-466
+   */
+  public void testWithNameEvaluationErrorListener() throws Exception {
+
+    FileInputStream sampleDataIn = new FileInputStream(getClass()
+        .getClassLoader()
+        .getResource("opennlp/tools/namefind/AnnotatedSentences.txt").getFile());
+    ObjectStream<NameSample> sampleStream = new NameSampleDataStream(
+        new PlainTextByLineStream(sampleDataIn.getChannel(), "ISO-8859-1"));
+
+    TrainingParameters mlParams = ModelUtil.createTrainingParameters(70, 1);
+    mlParams.put(TrainingParameters.ALGORITHM_PARAM,
+        ModelType.MAXENT.toString());
+    
+    ByteArrayOutputStream out = new ByteArrayOutputStream();
+    NameEvaluationErrorListener listener = new NameEvaluationErrorListener(out); 
+
+    Map<String, Object> resources = Collections.emptyMap();
+    TokenNameFinderCrossValidator cv = new TokenNameFinderCrossValidator("en",
+        TYPE, mlParams, null, resources, listener);
+
+    cv.evaluate(sampleStream, 2);
+    
+    assertTrue(out.size() > 0);
+    assertNotNull(cv.getFMeasure());
+  }
 }
