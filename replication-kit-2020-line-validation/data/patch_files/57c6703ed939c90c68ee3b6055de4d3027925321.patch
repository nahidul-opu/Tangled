From 57c6703ed939c90c68ee3b6055de4d3027925321 Mon Sep 17 00:00:00 2001
From: Colm O hEigeartaigh <coheigea@apache.org>
Date: Wed, 14 Oct 2015 15:03:50 +0000
Subject: [PATCH] [SANTUARIO-431] - Invalid return value of
 getTextCharacters(...)

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/trunk@1708616 13f79535-47bb-0310-9956-ffa450edef68
---
 .../xml/security/stax/impl/XMLSecurityStreamReader.java   | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/main/java/org/apache/xml/security/stax/impl/XMLSecurityStreamReader.java b/src/main/java/org/apache/xml/security/stax/impl/XMLSecurityStreamReader.java
index 52461db7ce..a13a4846c1 100644
--- a/src/main/java/org/apache/xml/security/stax/impl/XMLSecurityStreamReader.java
+++ b/src/main/java/org/apache/xml/security/stax/impl/XMLSecurityStreamReader.java
@@ -448,18 +448,18 @@ public int getTextCharacters(int sourceStart, char[] target, int targetStart, in
         switch (xmlSecEvent.getEventType()) {
             case ENTITY_REFERENCE:
                 ((EntityReference) xmlSecEvent).getDeclaration().getReplacementText().getChars(sourceStart, sourceStart + length, target, targetStart);
-                return sourceStart + length;
+                return length;
             case DTD:
                 ((DTD) xmlSecEvent).getDocumentTypeDeclaration().getChars(sourceStart, sourceStart + length, target, targetStart);
-                return sourceStart + length;
+                return length;
             case COMMENT:
                 ((Comment) xmlSecEvent).getText().getChars(sourceStart, sourceStart + length, target, targetStart);
-                return sourceStart + length;
+                return length;
             case CDATA:
             case SPACE:
             case CHARACTERS:
                 xmlSecEvent.asCharacters().getData().getChars(sourceStart, sourceStart + length, target, targetStart);
-                return sourceStart + length;
+                return length;
             default:
                 throw new IllegalStateException("Current state not TEXT");
         }
