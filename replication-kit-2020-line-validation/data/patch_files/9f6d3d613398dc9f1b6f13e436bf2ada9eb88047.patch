From 9f6d3d613398dc9f1b6f13e436bf2ada9eb88047 Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Wed, 28 Mar 2012 09:29:57 +0000
Subject: [PATCH] [SANTUARIO-306] - KeySelectors loop

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/trunk@1306225 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG.txt                                         | 1 +
 src/test/java/javax/xml/crypto/test/KeySelectors.java | 4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG.txt b/CHANGELOG.txt
index 96fc4c815d..af2581c16f 100644
--- a/CHANGELOG.txt
+++ b/CHANGELOG.txt
@@ -1,6 +1,7 @@
 Changelog for "Apache xml-security" <http://santuario.apache.org/>
 
 New in v1.5.2-SNAPSHOT:
+    Fixed SANTUARIO-306 - KeySelectors loop
     Fixed SANTUARIO-304 - No way to distinguish DataReference from a KeyReference when iterating a ReferenceList
     Fixed SANTUARIO-302 - Need API to martial an independent ReferenceList.
     Fixed SANTUARIO-301 - Missing KeyInfo element when encrypting multiple elements.
diff --git a/src/test/java/javax/xml/crypto/test/KeySelectors.java b/src/test/java/javax/xml/crypto/test/KeySelectors.java
index b4d5a52c8a..17f6f9fef2 100644
--- a/src/test/java/javax/xml/crypto/test/KeySelectors.java
+++ b/src/test/java/javax/xml/crypto/test/KeySelectors.java
@@ -103,7 +103,7 @@ public KeySelectorResult select(KeyInfo keyInfo,
                     Object[] entries = xd.getContent().toArray();
                     X509CRL crl = null;
                     // Looking for CRL before finding certificates
-                    for (int i = 0; (i < entries.length && crl != null); i++) {
+                    for (int i = 0; (i < entries.length && crl == null); i++) {
                         if (entries[i] instanceof X509CRL) {
                             crl = (X509CRL) entries[i];
                         }
@@ -281,7 +281,7 @@ public KeySelectorResult select(KeyInfo keyInfo,
                         }
                         return new SimpleKSResult(pk);
                     } else if (xmlStructure instanceof RetrievalMethod) {
-                        // Lookup the public key using the retrievel method.
+                        // Lookup the public key using the retrieval method.
                         // NOTE: only X509Certificate type is supported.
                         RetrievalMethod rm = (RetrievalMethod) xmlStructure;
                         String type = rm.getType();
