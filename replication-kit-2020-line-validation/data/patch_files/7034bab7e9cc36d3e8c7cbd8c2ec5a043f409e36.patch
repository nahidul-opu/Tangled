From 7034bab7e9cc36d3e8c7cbd8c2ec5a043f409e36 Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Sat, 30 Jul 2011 09:58:58 +0000
Subject: [PATCH] [CONFIGURATION-452] Documentation updates.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1152440 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml               |  4 +++
 src/site/xdoc/userguide/howto_xml.xml | 43 +++++++++++++++++++++++++++
 2 files changed, 47 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 637a97e7d7..b121a3de39 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,10 @@
 
   <body>
     <release version="1.7" date="in SVN" description="">
+      <action dev="oheger" type="add" issue="CONFIGURATION-452">
+        XPathExpressionEngine now provides better support for the setProperty()
+        method.
+      </action>
       <action dev="oheger" type="add" issue="CONFIGURATION-448">
         The parsing of ini files has been improved for property definitions
         containing multiple separator characters.
diff --git a/src/site/xdoc/userguide/howto_xml.xml b/src/site/xdoc/userguide/howto_xml.xml
index 12bc647ca4..409cea8e45 100644
--- a/src/site/xdoc/userguide/howto_xml.xml
+++ b/src/site/xdoc/userguide/howto_xml.xml
@@ -919,6 +919,49 @@ config.addProperty("tables/table[last()]/fields field/name", "startDate");
                 (<code>fields/field/name</code>), then to the newly created
                 elements further children are added.
             </p>
+            <p>
+                There is one gotcha with these keys described so far: they do
+                not work with the <code>setProperty()</code> method! This is
+                because <code>setProperty()</code> has to check whether the
+                passed in key already exists; therefore it needs a key which can
+                be interpreted by query methods. If you want to use
+                <code>setProperty()</code>, you can pass in regular keys (i.e.
+                without a whitespace separator). The method then tries to figure
+                out which part of the key already exists in the configuration
+                and adds new nodes as necessary. In principle such regular keys
+                can also be used with <code>addProperty()</code>. However, they
+                do not contain sufficient information to decide where new nodes
+                should be added.
+            </p>
+            <p>
+                To make this clearer let's go back to the example with the
+                tables. Consider that there is a configuration which already
+                contains information about some database tables. In order to add
+                a new table element in the configuration
+                <code>addProperty()</code> could be used as follows:
+            </p>
+            <source><![CDATA[
+config.addProperty("tables/table/name", "documents");
+         ]]></source>
+            <p>
+                In the configuration a <code>&lt;tables&gt;</code> element
+                already exists, also <code>&lt;table&gt;</code> and
+                <code>&lt;name&gt;</code> elements. How should the expression
+                engine know where new node structures are to be added? The
+                solution to this problem is to provide this information in the
+                key by stating:
+            </p>
+            <source><![CDATA[
+config.addProperty("tables table/name", "documents");
+         ]]></source>
+            <p>
+                Now it is clear that new nodes should be added as children of
+                the  <code>&lt;tables&gt;</code> element. More information about
+                keys and how they play together with <code>addProperty()</code>
+                and <code>setProperty()</code> can be found in the Javadocs for
+                <a href="../apidocs/org/apache/commons/configuration/tree/xpath/XPathExpressionEngine.html">
+                <code>XPathExpressionEngine</code></a>.
+            </p>
             <p>
                 <em>Note:</em> XPATH support is implemented through
                 <a href="http://commons.apache.org/jxpath">Commons JXPath</a>.
