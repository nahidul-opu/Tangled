From c1d5da98ca97ad36ce3ffdb249df08f85f9929b9 Mon Sep 17 00:00:00 2001
From: Mario Ivankovits <imario@apache.org>
Date: Mon, 2 Oct 2006 19:51:02 +0000
Subject: [PATCH] VFS-82: fixed CCE

git-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/vfs/trunk@452184 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs/provider/AbstractFileObject.java | 4 ++--
 .../org/apache/commons/vfs/provider/local/LocalFile.java    | 6 ++++--
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java b/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java
index 5f094829cb..a00d31ec91 100644
--- a/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java
+++ b/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java
@@ -745,7 +745,7 @@ public int delete(final FileSelector selector) throws FileSystemException
         final int count = files.size();
         for (int i = 0; i < count; i++)
         {
-            final AbstractFileObject file = (AbstractFileObject) files.get(i);
+            final AbstractFileObject file = FileObjectUtils.getAbstractFileObject((FileObject) files.get(i));
             // file.attach();
 
             // If the file is a folder, make sure all its children have been deleted
@@ -936,7 +936,7 @@ public void moveTo(FileObject destFile) throws FileSystemException
                 attach();
                 doRename(destFile);
 
-                ((AbstractFileObject) destFile).handleCreate(getType());
+                (FileObjectUtils.getAbstractFileObject(destFile)).handleCreate(getType());
 
                 destFile.close(); // now the destFile is no longer imaginary. force reattach.
 
diff --git a/src/java/org/apache/commons/vfs/provider/local/LocalFile.java b/src/java/org/apache/commons/vfs/provider/local/LocalFile.java
index ebb8e67f25..2a3ecb3e7d 100644
--- a/src/java/org/apache/commons/vfs/provider/local/LocalFile.java
+++ b/src/java/org/apache/commons/vfs/provider/local/LocalFile.java
@@ -133,9 +133,11 @@ protected void doDelete()
     /**
      * rename this file
      */
-    protected void doRename(FileObject newfile) throws Exception
+    protected void doRename(final FileObject newfile) throws Exception
     {
-        if (!file.renameTo(((LocalFile) newfile).getLocalFile()))
+        LocalFile newLocalFile = (LocalFile) FileObjectUtils.getAbstractFileObject(newfile);
+
+        if (!file.renameTo(newLocalFile.getLocalFile()))
         {
             throw new FileSystemException("vfs.provider.local/rename-file.error",
                 new String[]{file.toString(), newfile.toString()});
