From 5cebd22021946f3485a0605e77438aad8e787371 Mon Sep 17 00:00:00 2001
From: William Colen <colen@apache.org>
Date: Tue, 26 Jul 2011 13:48:39 +0000
Subject: [PATCH] OPENNLP-238 Advance all sequences if couldn't find a valid
 one.

git-svn-id: https://svn.apache.org/repos/asf/incubator/opennlp/trunk@1151095 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/opennlp/tools/util/BeamSearch.java   | 22 +++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/opennlp-tools/src/main/java/opennlp/tools/util/BeamSearch.java b/opennlp-tools/src/main/java/opennlp/tools/util/BeamSearch.java
index 2745392af..0a6271aa3 100644
--- a/opennlp-tools/src/main/java/opennlp/tools/util/BeamSearch.java
+++ b/opennlp-tools/src/main/java/opennlp/tools/util/BeamSearch.java
@@ -167,6 +167,28 @@ public Sequence[] bestSequences(int numSequences, T[] sequence, Object[] additio
             }
           }
         }
+        
+        if (next.size() == 0) {// no valid sequences yet, advance all first "size"
+          for (int p = 0; p < scores.length; p++) {
+            if (scores[p] < min)
+              continue; // only advance first "size" outcomes
+            String out = model.getOutcome(p);
+            Sequence ns = new Sequence(top, out, scores[p]);
+            if (ns.getScore() > minSequenceScore) {
+              next.add(ns);
+            }
+          }
+        }
+
+        if (next.size() == 0) {// no valid sequences yet, advance all
+          for (int p = 0; p < scores.length; p++) {
+            String out = model.getOutcome(p);
+            Sequence ns = new Sequence(top, out, scores[p]);
+            if (ns.getScore() > minSequenceScore) {
+              next.add(ns);
+            }
+          }
+        }
       }
 
       //    make prev = next; and re-init next (we reuse existing prev set once we clear it)
