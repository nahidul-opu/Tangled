From 82e9af9c68aa353a19c2b005838458563425660e Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Tue, 10 Jun 2008 10:47:20 +0000
Subject: [PATCH] FIX: NPE in AbstractResolver.exists() if a resource cannot be
 found  (IVY-831)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@666058 13f79535-47bb-0310-9956-ffa450edef68
---
 .../ivy/plugins/resolver/AbstractResolver.java |  9 +++++++++
 .../plugins/resolver/DependencyResolver.java   | 18 ++++++++++++++++++
 2 files changed, 27 insertions(+)

diff --git a/src/java/org/apache/ivy/plugins/resolver/AbstractResolver.java b/src/java/org/apache/ivy/plugins/resolver/AbstractResolver.java
index 9c6256409..3400e12b3 100644
--- a/src/java/org/apache/ivy/plugins/resolver/AbstractResolver.java
+++ b/src/java/org/apache/ivy/plugins/resolver/AbstractResolver.java
@@ -193,6 +193,15 @@ public String getTypeName() {
      */
     public boolean exists(Artifact artifact) {
         DownloadReport dr = download(new Artifact[] {artifact}, new DownloadOptions());
+        if (dr == null) {
+            /*
+             * according to IVY-831, it seems that this actually happen sometime, while the contract
+             * of DependencyResolver says that it should never return null
+             */
+            throw new IllegalStateException(
+                "null download report returned by " + getName() 
+                + " when trying to download " + artifact);
+        }
         ArtifactDownloadReport adr = dr.getArtifactReport(artifact);
         return adr.getDownloadStatus() != DownloadStatus.FAILED;
     }
diff --git a/src/java/org/apache/ivy/plugins/resolver/DependencyResolver.java b/src/java/org/apache/ivy/plugins/resolver/DependencyResolver.java
index ba15fc936..ab727c490 100644
--- a/src/java/org/apache/ivy/plugins/resolver/DependencyResolver.java
+++ b/src/java/org/apache/ivy/plugins/resolver/DependencyResolver.java
@@ -70,6 +70,24 @@ ResolvedModuleRevision getDependency(DependencyDescriptor dd, ResolveData data)
      */
     ResolvedResource findIvyFileRef(DependencyDescriptor dd, ResolveData data);
 
+    /**
+     * Download artifacts with specified DownloadOptions.
+     * <p>
+     * The resolver will always make a best effort, and do not stop when an artifact is not
+     * available. It rather continue to attempt to download other requested artifacts, and report
+     * what has been done in the returned DownloadReport.
+     * </p>
+     * <p>
+     * The returned DownloadReport is never <code>null</code>, and always contain an
+     * {@link ArtifactDownloadReport} for each requested Artifact.
+     * </p>
+     * 
+     * @param artifacts
+     *            an array of artifacts to download
+     * @param options
+     *            options to apply for this download
+     * @return a DownloadReport with details about each Artifact download.
+     */
     DownloadReport download(Artifact[] artifacts, DownloadOptions options);
 
     boolean exists(Artifact artifact);
