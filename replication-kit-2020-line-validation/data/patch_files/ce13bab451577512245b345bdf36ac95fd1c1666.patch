From ce13bab451577512245b345bdf36ac95fd1c1666 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Mon, 7 Apr 2008 09:52:44 +0000
Subject: [PATCH] NET-211 - setLenient() does not work across a year boundary

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@645433 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/net/ftp/parser/FTPTimestampParserImpl.java | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java b/src/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
index 20f137b62..d40cd00e0 100644
--- a/src/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
+++ b/src/java/org/apache/commons/net/ftp/parser/FTPTimestampParserImpl.java
@@ -100,6 +100,11 @@ public Calendar parseTimestamp(String timestampStr, Calendar serverTime) throws
 		Date parsed = null;
 		String timeStampStrPlusYear="";
 		if (recentDateFormat != null) {
+            if (lenientFutureDates) {
+                // add a day to "now" so that "slop" doesn't cause a date 
+                // slightly in the future to roll back a full year.  (Bug 35181)
+                now.add(Calendar.DATE, 1);
+            }    
             // Temporarily add the current year to the short date time
             // to cope with short-date leap year strings.
             // e.g. Java's DateFormatter will assume that "Feb 29 12:00" refers to 
@@ -118,11 +123,6 @@ public Calendar parseTimestamp(String timestampStr, Calendar serverTime) throws
 			working.setTime(parsed);
 			working.set(Calendar.YEAR, now.get(Calendar.YEAR));
 
-			if (lenientFutureDates) {
-				// add a day to "now" so that "slop" doesn't cause a date 
-				// slightly in the future to roll back a full year.  (Bug 35181)
-				now.add(Calendar.DATE, 1);
-			}    
 			if (working.after(now)) {
 				working.add(Calendar.YEAR, -1);
 			}
