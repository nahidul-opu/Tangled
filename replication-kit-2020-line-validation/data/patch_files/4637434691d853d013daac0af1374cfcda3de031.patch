From 4637434691d853d013daac0af1374cfcda3de031 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Tue, 8 Mar 2011 23:35:21 +0000
Subject: [PATCH] NET-185 Possible NPE in Threader.java

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1079601 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                 | 3 +++
 src/main/java/org/apache/commons/net/nntp/Threader.java | 7 ++++---
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index e01d61e8a..6e120890d 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -57,6 +57,9 @@ The <action> type attribute can be add,update,fix,remove.
 
     <body>
         <release version="3.0" date="TBA" description="TBA">
+            <action issue="NET-185" dev="sebb" type="fix">
+            Possible NPE in Threader.java
+            </action>
             <action issue="NET-364" dev="sebb" type="fix">
             nntp.Article is very inefficient and incorrect.
             </action>
diff --git a/src/main/java/org/apache/commons/net/nntp/Threader.java b/src/main/java/org/apache/commons/net/nntp/Threader.java
index e75fc52d5..c991aa28c 100644
--- a/src/main/java/org/apache/commons/net/nntp/Threader.java
+++ b/src/main/java/org/apache/commons/net/nntp/Threader.java
@@ -27,7 +27,6 @@
  *
  */
 
-import java.util.Arrays;
 import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
@@ -355,9 +354,11 @@ private void gatherSubjects() {
                 ThreadContainer tail;
                 for (tail = old.child;
                     tail != null && tail.next != null;
-                    tail = tail.next);
+                    tail = tail.next){}
 
-                tail.next = c.child;
+                if (tail != null) { // protect against possible NPE
+                    tail.next = c.child;
+                }
 
                 for (tail = c.child; tail != null; tail = tail.next)
                     tail.parent = old;
