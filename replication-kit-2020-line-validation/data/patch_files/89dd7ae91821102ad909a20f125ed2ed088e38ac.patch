From 89dd7ae91821102ad909a20f125ed2ed088e38ac Mon Sep 17 00:00:00 2001
From: Matthew Jason Benson <mbenson@apache.org>
Date: Fri, 12 Feb 2010 22:12:33 +0000
Subject: [PATCH] [IVY-1171] test

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@909635 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/ivy/ant/IvyPublishTest.java    | 22 ++++++++++++++
 .../org/apache/ivy/ant/ivy-publish-public.xml | 29 +++++++++++++++++++
 2 files changed, 51 insertions(+)
 create mode 100644 test/java/org/apache/ivy/ant/ivy-publish-public.xml

diff --git a/test/java/org/apache/ivy/ant/IvyPublishTest.java b/test/java/org/apache/ivy/ant/IvyPublishTest.java
index 23b6e2d93..183399474 100644
--- a/test/java/org/apache/ivy/ant/IvyPublishTest.java
+++ b/test/java/org/apache/ivy/ant/IvyPublishTest.java
@@ -251,6 +251,28 @@ public void testMultiPatterns() throws Exception {
         assertTrue(new File("test/repositories/1/apache/multi/jars/multi2-1.2.jar").exists());
     }
 
+    public void testPublishPublicConfigsByWildcard() throws Exception {
+        project.setProperty("ivy.dep.file", "test/java/org/apache/ivy/ant/ivy-publish-public.xml");
+        IvyResolve res = new IvyResolve();
+        res.setProject(project);
+        res.execute();
+
+        publish.setPubrevision("1.2");
+        publish.setResolver("1");
+        publish.setConf("*(public)");
+        File art = new File("build/test/publish/publish-public-1.2.jar");
+        FileUtil.copy(new File("test/repositories/1/org1/mod1.1/jars/mod1.1-1.0.jar"), art, null);
+        publish.addArtifactspattern("build/test/publish/[artifact]-[revision].[ext]");
+        publish.execute();
+
+        // should have do the ivy delivering
+        assertTrue(new File("build/test/publish/ivy-1.2.xml").exists());
+        
+        // should have published the files with "1" resolver
+        assertTrue(new File("test/repositories/1/apache/publish-public/ivys/ivy-1.2.xml").exists());
+        assertTrue(new File("test/repositories/1/apache/publish-public/jars/publish-public-1.2.jar").exists());
+    }
+
     public void testCustom() throws Exception {
         project.setProperty("ivy.dep.file", "test/java/org/apache/ivy/ant/ivy-custom.xml");
         IvyResolve res = new IvyResolve();
diff --git a/test/java/org/apache/ivy/ant/ivy-publish-public.xml b/test/java/org/apache/ivy/ant/ivy-publish-public.xml
new file mode 100644
index 000000000..a1e51cae4
--- /dev/null
+++ b/test/java/org/apache/ivy/ant/ivy-publish-public.xml
@@ -0,0 +1,29 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0">
+	<info organisation="apache"
+	       module="publish-public"
+	       revision="1.0"
+	       status="release"
+	/>
+	<configurations>
+		<conf name="default" description="The default dependencies" />
+		<conf name="private" visibility="private"/>
+	</configurations>
+</ivy-module>
