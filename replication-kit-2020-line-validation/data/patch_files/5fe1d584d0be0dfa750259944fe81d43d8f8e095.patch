From 5fe1d584d0be0dfa750259944fe81d43d8f8e095 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Wed, 1 Oct 2008 14:41:39 +0000
Subject: [PATCH] FIX: NullPointerException when Ivy cannot locate pom parent
 (IVY-927)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@700792 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                       |  1 +
 .../parser/m2/PomModuleDescriptorParser.java      | 15 ++++++++-------
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index d51cadbd3..7e7bbb529 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -84,6 +84,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Error messages on use of relative paths can be cyrptic (IVY-909)
 - IMPROVEMENT: Maven accepts illegal XML for its pom's, Ivy not (IVY-921)
 
+- FIX: NullPointerException when Ivy cannot locate pom parent (IVY-927)
 - FIX: Cannot configure items with java.io.File attributes (IVY-905)
 - FIX: Environment properties in ivy settings are no longer resolved (IVY-907)
 - FIX: Resolve failed on certain proxy environment (IVY-911)
diff --git a/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParser.java b/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParser.java
index 7aa1d4e0e..1a5bb83b4 100644
--- a/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParser.java
+++ b/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorParser.java
@@ -137,13 +137,14 @@ public ModuleDescriptor parseDescriptor(ParserSettings ivySettings, URL descript
                    Message.warn("impossible to load parent for " + descriptorURL + "."
                        + " Parent=" + parentModRevID); 
                 }
-                
-                Map parentPomProps = PomModuleDescriptorBuilder.extractPomProperties(
-                                                                parentDescr.getExtraInfo());
-                for (Iterator iter = parentPomProps.entrySet().iterator(); iter.hasNext();) {
-                    Map.Entry prop = (Map.Entry) iter.next();
-                    domReader.setProperty((String) prop.getKey(), (String) prop.getValue());
-                }                    
+                if (parentDescr != null) {
+                    Map parentPomProps = PomModuleDescriptorBuilder.extractPomProperties(
+                        parentDescr.getExtraInfo());
+                    for (Iterator iter = parentPomProps.entrySet().iterator(); iter.hasNext();) {
+                        Map.Entry prop = (Map.Entry) iter.next();
+                        domReader.setProperty((String) prop.getKey(), (String) prop.getValue());
+                    }                    
+                }
             }
                             
             String groupId = domReader.getGroupId();
