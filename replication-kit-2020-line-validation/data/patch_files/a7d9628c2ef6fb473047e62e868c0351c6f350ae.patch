From a7d9628c2ef6fb473047e62e868c0351c6f350ae Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Sat, 13 Mar 2010 21:03:42 +0000
Subject: [PATCH] CONFIGURATION-408: Added a unit test to ensure that with
 commons-lang 2.5 the escaping problem does not occur.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@922677 13f79535-47bb-0310-9956-ffa450edef68
---
 .../configuration/TestPropertiesConfiguration.java | 14 ++++++++++++++
 xdocs/changes.xml                                  |  5 +++++
 2 files changed, 19 insertions(+)

diff --git a/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java b/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java
index a3be6802f3..ec7702ed4c 100644
--- a/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java
+++ b/src/test/org/apache/commons/configuration/TestPropertiesConfiguration.java
@@ -979,6 +979,20 @@ public void testKeepSeparators() throws ConfigurationException, IOException
                 separatorTests.length, foundLines.size());
     }
 
+    /**
+     * Tests whether properties with slashes in their values can be saved. This
+     * test is related to CONFIGURATION-408.
+     */
+    public void testSlashEscaping() throws ConfigurationException
+    {
+        conf.setProperty(PROP_NAME, "http://www.apache.org");
+        StringWriter writer = new StringWriter();
+        conf.save(writer);
+        String s = writer.toString();
+        assertTrue("Value not found: " + s, s.indexOf(PROP_NAME
+                + " = http://www.apache.org") >= 0);
+    }
+
     /**
      * Creates a configuration that can be used for testing copy operations.
      *
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index 8b93a8269a..5c777d29be 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -27,6 +27,11 @@
         HierarchicalINIConfiguration now correctly saves sections whose name
         contains delimiter characters.
       </action>
+      <action dev="oheger" type="update" issue="CONFIGURATION-408">
+        PropertiesConfiguration.save() escaped slashes in properties values.
+        This was caused by a bug in commons-lang 2.4. Updating to the new
+        version commons-lang 2.5 fixed this problem.
+      </action>
       <action dev="oheger" type="fix" issue="CONFIGURATION-407">
         Fixed a potential IllegalStateException in HierarchicalINIConfiguration
         that can be thrown when the global section is requested concurrently.
