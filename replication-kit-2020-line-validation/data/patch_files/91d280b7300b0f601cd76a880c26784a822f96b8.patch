From 91d280b7300b0f601cd76a880c26784a822f96b8 Mon Sep 17 00:00:00 2001
From: Gilles Sadowski <erans@apache.org>
Date: Fri, 12 Jul 2013 11:29:12 +0000
Subject: [PATCH] MATH-1005 Array of length 1 must be handled as a special
 case.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/math/trunk@1502516 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                  | 3 +++
 .../java/org/apache/commons/math3/util/MathArrays.java   | 5 +++++
 .../org/apache/commons/math3/util/MathArraysTest.java    | 9 +++++++++
 3 files changed, 17 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 8124135d84..cededa04e7 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -51,6 +51,9 @@ If the output is not quite correct, check for invisible trailing spaces!
   </properties>
   <body>
     <release version="x.y" date="TBD" description="TBD">
+      <action dev="erans" type="fix" issue="MATH-1005" due-to="Roman Werpachowski">
+        Fixed "MathArrays.linearCombination" when array length is 1.
+      </action>
       <action dev="erans" type="add" issue="MATH-997">
         Implemented Gauss-Hermite quadrature scheme (in package
         "o.a.c.m.analysis.integration.gauss").
diff --git a/src/main/java/org/apache/commons/math3/util/MathArrays.java b/src/main/java/org/apache/commons/math3/util/MathArrays.java
index 1aa56cc7d3..8f83d96a54 100644
--- a/src/main/java/org/apache/commons/math3/util/MathArrays.java
+++ b/src/main/java/org/apache/commons/math3/util/MathArrays.java
@@ -818,6 +818,11 @@ public static double linearCombination(final double[] a, final double[] b)
             throw new DimensionMismatchException(len, b.length);
         }
 
+        if (len == 1) {
+            // Revert to scalar multiplication.
+            return a[0] * b[0];
+        }
+
         final double[] prodHigh = new double[len];
         double prodLowSum = 0;
 
diff --git a/src/test/java/org/apache/commons/math3/util/MathArraysTest.java b/src/test/java/org/apache/commons/math3/util/MathArraysTest.java
index e16afbc411..7d6b8128b8 100644
--- a/src/test/java/org/apache/commons/math3/util/MathArraysTest.java
+++ b/src/test/java/org/apache/commons/math3/util/MathArraysTest.java
@@ -582,6 +582,15 @@ public void testCopyOfDouble3() {
         }
     }
 
+    // MATH-1005
+    @Test
+    public void testLinearCombinationWithSingleElementArray() {
+        final double[] a = { 1.23456789 };
+        final double[] b = { 98765432.1 };
+
+        Assert.assertEquals(a[0] * b[0], MathArrays.linearCombination(a, b), 0d);
+    }
+
     @Test
     public void testLinearCombination1() {
         final double[] a = new double[] {
