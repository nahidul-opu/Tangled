From 6936e82364f0725e2f2e8c83d74697ac81643a12 Mon Sep 17 00:00:00 2001
From: Colm O hEigeartaigh <coheigea@apache.org>
Date: Wed, 8 Feb 2017 14:43:55 +0000
Subject: [PATCH] SANTUARIO-462 - getNodesetBeforeFirstCanonicalization() in
 Reference.java is missing C14N11 canonicalization algorithms

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/2.0.x-fixes@1782190 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/xml/security/signature/Reference.java   | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/xml/security/signature/Reference.java b/src/main/java/org/apache/xml/security/signature/Reference.java
index 6cba6fc480..a68d016cbb 100644
--- a/src/main/java/org/apache/xml/security/signature/Reference.java
+++ b/src/main/java/org/apache/xml/security/signature/Reference.java
@@ -495,14 +495,16 @@ public XMLSignatureInput getNodesetBeforeFirstCanonicalization()
                     if (uri.equals(Transforms.TRANSFORM_C14N_EXCL_OMIT_COMMENTS)
                         || uri.equals(Transforms.TRANSFORM_C14N_EXCL_WITH_COMMENTS)
                         || uri.equals(Transforms.TRANSFORM_C14N_OMIT_COMMENTS)
-                        || uri.equals(Transforms.TRANSFORM_C14N_WITH_COMMENTS)) {
+                        || uri.equals(Transforms.TRANSFORM_C14N_WITH_COMMENTS)
+                        || uri.equals(Transforms.TRANSFORM_C14N11_OMIT_COMMENTS)
+                        || uri.equals(Transforms.TRANSFORM_C14N11_WITH_COMMENTS)) {
                         break;
                     }
 
                     output = t.performTransform(output, null);
                 }
 
-            output.setSourceURI(input.getSourceURI());
+                output.setSourceURI(input.getSourceURI());
             }
             return output;
         } catch (IOException ex) {
