From 760661dfd35d3c51f4aaddf914b32223787ad0c7 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Tue, 10 Jan 2012 19:14:47 +0000
Subject: [PATCH] NET-410 Apache Commons TFTP does not handle RFC 783
 retransmits

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1229692 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                   | 3 +++
 src/main/java/org/apache/commons/net/tftp/TFTPClient.java | 8 ++++----
 2 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index b52221329..29fa71267 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -59,6 +59,9 @@ The <action> type attribute can be add,update,fix,remove.
         <release version="3.1-SNAPSHOT" date="TBA" description="
 TBA
         ">
+            <action issue="NET-410" dev="sebb" type="fix" due-to="Chuck Wolber">
+            Apache Commons TFTP does not handle RFC 783 retransmits
+            </action>
             <action issue="NET-437" dev="sebb" type="fix" due-to="Gavin Camp">
             TelnetInputStream doesn't support non-blocking IO when reader thread is not enabled
             </action>
diff --git a/src/main/java/org/apache/commons/net/tftp/TFTPClient.java b/src/main/java/org/apache/commons/net/tftp/TFTPClient.java
index b5efbc162..f82ce857f 100644
--- a/src/main/java/org/apache/commons/net/tftp/TFTPClient.java
+++ b/src/main/java/org/apache/commons/net/tftp/TFTPClient.java
@@ -164,7 +164,7 @@ public int receiveFile(String filename, int mode, OutputStream output,
                             endBufferedOps();
                             throw new IOException("Connection timed out.");
                         }
-                        continue;
+                        continue _sendPacket;
                     }
                     catch (InterruptedIOException e)
                     {
@@ -173,7 +173,7 @@ public int receiveFile(String filename, int mode, OutputStream output,
                             endBufferedOps();
                             throw new IOException("Connection timed out.");
                         }
-                        continue;
+                        continue _sendPacket;
                     }
                     catch (TFTPPacketException e)
                     {
@@ -416,7 +416,7 @@ public void sendFile(String filename, int mode, InputStream input,
                             endBufferedOps();
                             throw new IOException("Connection timed out.");
                         }
-                        continue;
+                        continue _sendPacket;
                     }
                     catch (InterruptedIOException e)
                     {
@@ -425,7 +425,7 @@ public void sendFile(String filename, int mode, InputStream input,
                             endBufferedOps();
                             throw new IOException("Connection timed out.");
                         }
-                        continue;
+                        continue _sendPacket;
                     }
                     catch (TFTPPacketException e)
                     {
