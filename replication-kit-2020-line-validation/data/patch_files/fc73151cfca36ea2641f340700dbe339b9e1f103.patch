From fc73151cfca36ea2641f340700dbe339b9e1f103 Mon Sep 17 00:00:00 2001
From: Benedikt Ritter <britter@apache.org>
Date: Tue, 5 May 2015 19:17:40 +0200
Subject: [PATCH] LANG-1131: StrBuilder.equals(StrBuilder) doesn't check for
 null inputs

---
 src/changes/changes.xml                                    | 1 +
 .../java/org/apache/commons/lang3/text/StrBuilder.java     | 3 +++
 .../java/org/apache/commons/lang3/text/StrBuilderTest.java | 7 +++++++
 3 files changed, 11 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index f1517456520..20815917a9e 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -22,6 +22,7 @@
   <body>
 
   <release version="3.5" date="tba" description="tba">
+    <action issue="LANG-1131" type="fix" dev="britter">StrBuilder.equals(StrBuilder) doesn't check for null inputs</action>
     <action issue="LANG-1105" type="add" dev="britter" due-to="Hendrik Saly">Add ThreadUtils - A utility class which provides helper methods related to java.lang.Thread</action>
     <action issue="LANG-1031" type="add" dev="britter" due-to="Felipe Adorno">Add annotations to exclude fields from ReflectionEqualsBuilder, ReflectionToStringBuilder and ReflectionHashCodeBuilder</action>
     <action issue="LANG-1127" type="add" dev="chas">Unit test helpers which set and reset default Locale and TimeZone</action>
diff --git a/src/main/java/org/apache/commons/lang3/text/StrBuilder.java b/src/main/java/org/apache/commons/lang3/text/StrBuilder.java
index 26b475ff3f5..7b541a6b278 100644
--- a/src/main/java/org/apache/commons/lang3/text/StrBuilder.java
+++ b/src/main/java/org/apache/commons/lang3/text/StrBuilder.java
@@ -2819,6 +2819,9 @@ public boolean equals(final StrBuilder other) {
         if (this == other) {
             return true;
         }
+        if (other == null) {
+            return false;
+        }
         if (this.size != other.size) {
             return false;
         }
diff --git a/src/test/java/org/apache/commons/lang3/text/StrBuilderTest.java b/src/test/java/org/apache/commons/lang3/text/StrBuilderTest.java
index 2da4cf1efe3..a9c61457066 100644
--- a/src/test/java/org/apache/commons/lang3/text/StrBuilderTest.java
+++ b/src/test/java/org/apache/commons/lang3/text/StrBuilderTest.java
@@ -1850,6 +1850,13 @@ public void testEquals() {
         assertFalse(sb1.equals("abc"));
     }
 
+    @Test
+    public void test_LANG_1131_EqualsWithNullStrBuilder() throws Exception {
+        final StrBuilder sb = new StrBuilder();
+        final StrBuilder other = null;
+        assertFalse(sb.equals(other));
+    }
+
     //-----------------------------------------------------------------------
     @Test
     public void testHashCode() {
