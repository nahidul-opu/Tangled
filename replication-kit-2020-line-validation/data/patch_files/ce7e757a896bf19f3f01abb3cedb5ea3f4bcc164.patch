From ce7e757a896bf19f3f01abb3cedb5ea3f4bcc164 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Thu, 30 Mar 2006 13:45:22 +0000
Subject: [PATCH] IVY-198 test case: seems to work

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/trunk@484257 13f79535-47bb-0310-9956-ffa450edef68
---
 test/java/fr/jayasoft/ivy/ResolveTest.java    | 21 +++++++++++++++++++
 .../fr/jayasoft/ivy/ant/IvyResolveTest.java   | 15 +++++++++++++
 test/java/fr/jayasoft/ivy/ivy-198.xml         |  7 +++++++
 .../yourdep/yoursys/yourmod/ivys/ivy-1.0.xml  | 10 +++++++++
 .../yoursys/yourmod/jars/yourmod-1.0.jar      |  1 +
 5 files changed, 54 insertions(+)
 create mode 100644 test/java/fr/jayasoft/ivy/ivy-198.xml
 create mode 100644 test/repositories/1/yourorg/yourdep/yoursys/yourmod/ivys/ivy-1.0.xml
 create mode 100644 test/repositories/1/yourorg/yourdep/yoursys/yourmod/jars/yourmod-1.0.jar

diff --git a/test/java/fr/jayasoft/ivy/ResolveTest.java b/test/java/fr/jayasoft/ivy/ResolveTest.java
index 05e755c6c..6c93a631d 100644
--- a/test/java/fr/jayasoft/ivy/ResolveTest.java
+++ b/test/java/fr/jayasoft/ivy/ResolveTest.java
@@ -82,6 +82,27 @@ public void testResolveSimple() throws Exception {
         assertTrue(_ivy.getArchiveFileInCache(_cache, "org1", "mod1.2", "2.0", "mod1.2", "jar", "jar").exists());
     }
 
+    public void testResolveWithSlashes() throws Exception {
+        // test case for IVY-198
+        // module depends on mod1.2
+        ResolveReport report = _ivy.resolve(ResolveTest.class.getResource("ivy-198.xml"),
+                null, new String[] {"*"}, _cache, null, true);
+        assertNotNull(report);
+        ModuleDescriptor md = report.getModuleDescriptor();
+        assertNotNull(md);
+        ModuleRevisionId mrid = ModuleRevisionId.newInstance("myorg/mydep", "system/module", "1.0");
+        assertEquals(mrid, md.getModuleRevisionId());
+        
+        assertTrue(_ivy.getResolvedIvyFileInCache(_cache, mrid).exists());
+        
+        // dependencies
+        assertTrue(_ivy.getIvyFileInCache(_cache, ModuleRevisionId.newInstance("org1", "mod1.2", "2.0")).exists());
+        assertTrue(_ivy.getArchiveFileInCache(_cache, "org1", "mod1.2", "2.0", "mod1.2", "jar", "jar").exists());
+
+        assertTrue(_ivy.getIvyFileInCache(_cache, ModuleRevisionId.newInstance("yourorg/yourdep", "yoursys/yourmod", "1.0")).exists());
+        assertTrue(_ivy.getArchiveFileInCache(_cache, "yourorg/yourdep", "yoursys/yourmod", "1.0", "yourmod", "jar", "jar").exists());
+    }
+
     public void testFromCache() throws Exception {
         // mod1.1 depends on mod1.2
         
diff --git a/test/java/fr/jayasoft/ivy/ant/IvyResolveTest.java b/test/java/fr/jayasoft/ivy/ant/IvyResolveTest.java
index 826ad89d2..12bb4a593 100644
--- a/test/java/fr/jayasoft/ivy/ant/IvyResolveTest.java
+++ b/test/java/fr/jayasoft/ivy/ant/IvyResolveTest.java
@@ -57,6 +57,21 @@ public void testSimple() throws Exception {
         assertTrue(getIvy().getArchiveFileInCache(_cache, "org1", "mod1.2", "2.0", "mod1.2", "jar", "jar").exists());
     }
 
+    public void testWithSlashes() throws Exception {
+        _resolve.setFile(new File("test/java/fr/jayasoft/ivy/ivy-198.xml"));
+        _resolve.execute();
+        
+        File resolvedIvyFileInCache = getIvy().getResolvedIvyFileInCache(_cache, ModuleRevisionId.newInstance("myorg/mydep", "system/module", "1.0"));
+        assertTrue(resolvedIvyFileInCache.exists());
+        
+        // dependencies
+        assertTrue(getIvy().getIvyFileInCache(_cache, ModuleRevisionId.newInstance("org1", "mod1.2", "2.0")).exists());
+        assertTrue(getIvy().getArchiveFileInCache(_cache, "org1", "mod1.2", "2.0", "mod1.2", "jar", "jar").exists());
+
+        assertTrue(getIvy().getIvyFileInCache(_cache, ModuleRevisionId.newInstance("yourorg/yourdep", "yoursys/yourmod", "1.0")).exists());
+        assertTrue(getIvy().getArchiveFileInCache(_cache, "yourorg/yourdep", "yoursys/yourmod", "1.0", "yourmod", "jar", "jar").exists());
+    }
+
     public void testDepsChanged() throws Exception {
         _resolve.setFile(new File("test/java/fr/jayasoft/ivy/ant/ivy-simple.xml"));
         _resolve.execute();
diff --git a/test/java/fr/jayasoft/ivy/ivy-198.xml b/test/java/fr/jayasoft/ivy/ivy-198.xml
new file mode 100644
index 000000000..476afb9f1
--- /dev/null
+++ b/test/java/fr/jayasoft/ivy/ivy-198.xml
@@ -0,0 +1,7 @@
+<ivy-module version="1.0">
+    <info organisation="myorg/mydep" module="system/module" revision="1.0"/>
+    <dependencies>
+		<dependency org="yourorg/yourdep" name="yoursys/yourmod" rev="1.0"/>
+		<dependency org="org1" name="mod1.2" rev="2.0"/>
+    </dependencies>
+</ivy-module>
diff --git a/test/repositories/1/yourorg/yourdep/yoursys/yourmod/ivys/ivy-1.0.xml b/test/repositories/1/yourorg/yourdep/yoursys/yourmod/ivys/ivy-1.0.xml
new file mode 100644
index 000000000..e8b1711b6
--- /dev/null
+++ b/test/repositories/1/yourorg/yourdep/yoursys/yourmod/ivys/ivy-1.0.xml
@@ -0,0 +1,10 @@
+<ivy-module version="1.0">
+	<info organisation="yourorg/yourdep"
+	       module="yoursys/yourmod"
+	       revision="1.0"
+	       status="integration"
+	/>
+	<publications>
+		<artifact name="yourmod" type="jar" conf="default"/>
+	</publications>
+</ivy-module>
diff --git a/test/repositories/1/yourorg/yourdep/yoursys/yourmod/jars/yourmod-1.0.jar b/test/repositories/1/yourorg/yourdep/yoursys/yourmod/jars/yourmod-1.0.jar
new file mode 100644
index 000000000..56f3b36e2
--- /dev/null
+++ b/test/repositories/1/yourorg/yourdep/yoursys/yourmod/jars/yourmod-1.0.jar
@@ -0,0 +1 @@
+ 
