From 8630180fffa0e8daf0369f55e9b267307c00e583 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Fri, 24 Jan 2014 16:00:35 +0000
Subject: [PATCH] LANG-954 uncaught PatternSyntaxException in FastDateFormat on
 Android

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/lang/trunk@1561045 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                      | 1 +
 .../java/org/apache/commons/lang3/time/FastDateParser.java   | 5 +++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index b6b325953ac..2e6037d0121 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -49,6 +49,7 @@
 
   <release version="3.2" date="2014-01-01" description="Bug fixes and new features, at least requires Java 6.0">
     <action issue="LANG-934" type="add" dev="mcucchiara">Add removeFinalModifier to FieldUtils</action>
+    <action issue="LANG-954" type="fix" due-to="Michael Keppler" dev="sebb">uncaught PatternSyntaxException in FastDateFormat on Android</action>
     <action issue="LANG-863" type="add" due-to="Daneel S. Yaitskov" dev="sebb">Method returns number of inheritance hops between parent and subclass</action>
     <action issue="LANG-932" type="fix" due-to="Ville SkyttÃ¤" dev="sebb">Spelling fixes</action>
     <action issue="LANG-931" type="update" dev="britter" due-to="Christoph Schneegans">Misleading Javadoc comment in StrBuilderReader class</action>
diff --git a/src/main/java/org/apache/commons/lang3/time/FastDateParser.java b/src/main/java/org/apache/commons/lang3/time/FastDateParser.java
index c88b63ccadd..7cea570d67a 100644
--- a/src/main/java/org/apache/commons/lang3/time/FastDateParser.java
+++ b/src/main/java/org/apache/commons/lang3/time/FastDateParser.java
@@ -648,11 +648,12 @@ boolean isNumber() {
          */
         @Override
         boolean addRegex(final FastDateParser parser, final StringBuilder regex) {
+            // See LANG-954: We use {Nd} rather than {IsNd} because Android does not support the Is prefix
             if(parser.isNextNumber()) {
-                regex.append("(\\p{IsNd}{").append(parser.getFieldWidth()).append("}+)");
+                regex.append("(\\p{Nd}{").append(parser.getFieldWidth()).append("}+)");
             }
             else {
-                regex.append("(\\p{IsNd}++)");
+                regex.append("(\\p{Nd}++)");
             }
             return true;
         }
