From 62df2eba9a9effc160efefc8e7f50c6fa3dc41b5 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Wed, 25 Oct 2006 10:15:10 +0000
Subject: [PATCH] FIX: ChainVersionMatcher doesn't handle IvyAware children
 version matchers (IVY-331)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/trunk@484572 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                       |  1 +
 .../jayasoft/ivy/version/ChainVersionMatcher.java | 15 +++++++++++++++
 2 files changed, 16 insertions(+)

diff --git a/CHANGES.txt b/CHANGES.txt
index c0501dc62..a92de1bda 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -13,6 +13,7 @@ for detailed view of each issue, please consult http://jira.jayasoft.org/
 - FIX: IVY complains about non-existent reports in the cache directory (IVY-315)
 - FIX: Typo in failureproperty attribute of Ant resolve task (IVY-327) (thanks to Jean-Baptiste Quenot)
 - FIX: ivy:resolve useOrigin fails to behave correctly (IVY-???)
+- FIX: ChainVersionMatcher doesn't handle IvyAware children version matchers (IVY-331)
 
 
    version 1.4 - 2006-10-09
diff --git a/src/java/fr/jayasoft/ivy/version/ChainVersionMatcher.java b/src/java/fr/jayasoft/ivy/version/ChainVersionMatcher.java
index ba22f22b6..36d83608b 100644
--- a/src/java/fr/jayasoft/ivy/version/ChainVersionMatcher.java
+++ b/src/java/fr/jayasoft/ivy/version/ChainVersionMatcher.java
@@ -11,6 +11,8 @@
 import java.util.LinkedList;
 import java.util.List;
 
+import fr.jayasoft.ivy.Ivy;
+import fr.jayasoft.ivy.IvyAware;
 import fr.jayasoft.ivy.ModuleDescriptor;
 import fr.jayasoft.ivy.ModuleRevisionId;
 
@@ -23,6 +25,19 @@ public ChainVersionMatcher() {
     
     public void add(VersionMatcher matcher) {
         _matchers.add(0, matcher);
+		if (getIvy() != null && matcher instanceof IvyAware) {
+			((IvyAware) matcher).setIvy(getIvy());
+		}
+    }
+    
+    public void setIvy(Ivy ivy) {
+    	super.setIvy(ivy);
+    	for (Iterator iter = _matchers.iterator(); iter.hasNext();) {
+			VersionMatcher matcher = (VersionMatcher) iter.next();
+			if (matcher instanceof IvyAware) {
+				((IvyAware) matcher).setIvy(ivy);
+			}
+		}
     }
     
     public List getMatchers() {
