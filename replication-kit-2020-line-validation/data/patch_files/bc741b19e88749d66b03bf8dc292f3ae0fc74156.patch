From bc741b19e88749d66b03bf8dc292f3ae0fc74156 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Fri, 21 Feb 2014 13:30:53 +0000
Subject: [PATCH] COMPRESS-264 add a (failing) Unit Test

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/compress/trunk@1570567 13f79535-47bb-0310-9956-ffa450edef68
---
 .../zip/ZipArchiveInputStreamTest.java        |  20 ++++++++++++++++++
 .../compress/archivers/zip/ZipFileTest.java   |  14 ++++++++++++
 src/test/resources/COMPRESS-264.zip           | Bin 0 -> 171 bytes
 3 files changed, 34 insertions(+)
 create mode 100644 src/test/resources/COMPRESS-264.zip

diff --git a/src/test/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStreamTest.java b/src/test/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStreamTest.java
index 9c247fe6933..567b756b455 100644
--- a/src/test/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStreamTest.java
+++ b/src/test/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStreamTest.java
@@ -149,4 +149,24 @@ public void testUnshrinkEntry() throws Exception {
             original.close();
         }
     }
+
+
+    /**
+     * Test case for 
+     * <a href="https://issues.apache.org/jira/browse/COMPRESS-264"
+     * >COMPRESS-264</a>.
+     */
+    //@Test
+    public void testCompress264() throws Exception {
+        ZipArchiveInputStream in = new ZipArchiveInputStream(new FileInputStream(getFile("COMPRESS-264.zip")));
+        
+        try {
+            ZipArchiveEntry ze = in.getNextZipEntry();
+            assertEquals(5, ze.getSize());
+            assertArrayEquals(new byte[] {'d', 'a', 't', 'a', '\n'},
+                              IOUtils.toByteArray(in));
+        } finally {
+            in.close();
+        }
+    }
 }
diff --git a/src/test/java/org/apache/commons/compress/archivers/zip/ZipFileTest.java b/src/test/java/org/apache/commons/compress/archivers/zip/ZipFileTest.java
index 5a861e83990..c4dc01e65dd 100644
--- a/src/test/java/org/apache/commons/compress/archivers/zip/ZipFileTest.java
+++ b/src/test/java/org/apache/commons/compress/archivers/zip/ZipFileTest.java
@@ -258,6 +258,20 @@ public void testUnshrinking() throws Exception {
         }
     }
 
+    /**
+     * Test case for 
+     * <a href="https://issues.apache.org/jira/browse/COMPRESS-264"
+     * >COMPRESS-264</a>.
+     */
+    public void testCompress264() throws Exception {
+        File archive = getFile("COMPRESS-264.zip");
+        zf = new ZipFile(archive);
+        ZipArchiveEntry ze = zf.getEntry("test.txt");
+        assertEquals(5, ze.getSize());
+        assertArrayEquals(new byte[] {'d', 'a', 't', 'a', '\n'},
+                          IOUtils.toByteArray(zf.getInputStream(ze)));
+    }
+
     /*
      * ordertest.zip has been handcrafted.
      *
diff --git a/src/test/resources/COMPRESS-264.zip b/src/test/resources/COMPRESS-264.zip
new file mode 100644
index 0000000000000000000000000000000000000000..75f2be71783f5eaff442b2e916b5c61a01a372d3
GIT binary patch
literal 171
zcmWIWW@h1H00HLei%v~P4?bfBvO$=GL586uwYWsDq@pA=gp+|eENOqBR`UM9(h6<{
zMi$2Zj0`Lt!VC;4i6x0#0p5&Ea?H34k^q^{zzD<(8bK_Cv8)hd(Toi6W@Q7ZV+2A!
KAngv~FaQ8^IUzUz

literal 0
HcmV?d00001

