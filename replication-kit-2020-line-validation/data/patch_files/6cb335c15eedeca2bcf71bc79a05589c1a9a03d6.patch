From 6cb335c15eedeca2bcf71bc79a05589c1a9a03d6 Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Mon, 23 Jul 2012 04:36:17 +0000
Subject: [PATCH] [VFS-430] The SoftRefFilesCache class logs clear text
 password.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1364490 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/vfs2/cache/SoftRefFilesCache.java     | 15 ++++++++++++---
 src/changes/changes.xml                           |  3 +++
 2 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs2/cache/SoftRefFilesCache.java b/core/src/main/java/org/apache/commons/vfs2/cache/SoftRefFilesCache.java
index 53f20aea6d..62af1a9408 100644
--- a/core/src/main/java/org/apache/commons/vfs2/cache/SoftRefFilesCache.java
+++ b/core/src/main/java/org/apache/commons/vfs2/cache/SoftRefFilesCache.java
@@ -161,7 +161,7 @@ public void putFile(final FileObject file)
     {
         if (log.isDebugEnabled())
         {
-            log.debug("putFile: " + file.getName());
+            log.debug("putFile: " + this.getSafeName(file));
         }
 
         Map<FileName, Reference<FileObject>> files = getOrCreateFilesystemCache(file.getFileSystem());
@@ -185,13 +185,22 @@ public void putFile(final FileObject file)
         }
     }
 
+    private String getSafeName(final FileName file)
+    {
+        return file.getFriendlyURI();
+    }
+
+    private String getSafeName(final FileObject file)
+    {
+        return this.getSafeName(file.getName());
+    }
 
     @Override
     public boolean putFileIfAbsent(final FileObject file)
     {
         if (log.isDebugEnabled())
         {
-            log.debug("putFile: " + file.getName());
+            log.debug("putFile: " + this.getSafeName(file));
         }
 
         Map<FileName, Reference<FileObject>> files = getOrCreateFilesystemCache(file.getFileSystem());
@@ -341,7 +350,7 @@ private boolean removeFile(final FileSystemAndNameKey key)
     {
         if (log.isDebugEnabled())
         {
-            log.debug("removeFile: " + key.getFileName());
+            log.debug("removeFile: " + this.getSafeName(key.getFileName()));
         }
 
         Map<?, ?> files = getOrCreateFilesystemCache(key.getFileSystem());
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 428bba801c..91faace0c0 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="2.1" date="TBD" description="New features and bug fix release.">
+      <action issue="VFS-430" dev="ggregory" type="add" due-to="antonin.stefanutti">
+        The SoftRefFilesCache class logs clear text password.
+      </action>
       <action issue="VFS-432" dev="ggregory" type="add" due-to="ggregory">
         [HTTP][WebDAV] Allow HTTP follow redirect.
       </action>
