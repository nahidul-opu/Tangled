From 0dd2e79fbdf14f62db132a837f987fe38f831243 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Sun, 16 Mar 2008 20:19:37 +0000
Subject: [PATCH] NET-201

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@637642 13f79535-47bb-0310-9956-ffa450edef68
---
 src/main/java/org/apache/commons/net/ftp/FTPClient.java   | 4 +++-
 .../apache/commons/net/ftp/parser/UnixFTPEntryParser.java | 2 +-
 .../commons/net/ftp/parser/UnixFTPEntryParserTest.java    | 8 +++++---
 3 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClient.java b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
index d91b514e3..cd641eb07 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClient.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
@@ -2363,7 +2363,9 @@ public String getStatus(String pathname) throws IOException
     
     /**
      * Issue the FTP MDTM command (not supported by all servers to retrieve the last
-     * modification time of a file. The modification string should be in the form "YYYYMMDDhhmmss"
+     * modification time of a file. The modification string should be in the 
+     * ISO 3077 form "YYYYMMDDhhmmss(.xxx)?". The timestamp represented should also be in 
+     * GMT, but not all FTP servers honour this.
      * 
      * @param pathname The file path to query.
      * @return A string representing the last file modification time in <code>YYYYMMDDhhmmss</code> format.
diff --git a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
index e805b3957..2f355769c 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
@@ -87,7 +87,7 @@ public class UnixFTPEntryParser extends ConfigurableFTPFileEntryParserImpl
         + "(\\d+)\\s+"
         + "(?:(\\S+(?:\\s\\S+)*?)\\s+)?"					// owner name (optional spaces)
         + "(?:(\\S+(?:\\s\\S+)*)\\s+)?" 				// group name (optional spaces)
-        + "(\\d+)\\s+"
+        + "(\\d+(?:,\\s*\\d+)?)\\s+"
         
         /*
           numeric or standard format date
diff --git a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
index 3b4fa9189..c162e5772 100644
--- a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
+++ b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
@@ -72,7 +72,9 @@ public class UnixFTPEntryParserTest extends FTPParseTestFramework {
 			"drwxrwx---+ 23 500     500    0 Jan 10 13:09 testACL",
 			"-rw-r--r--   1 1        3518644 May 25 12:12 std",
             "lrwxrwxrwx   1 neeme neeme             23 Mar  2 18:06 macros -> ./../../global/macros/.",
-			"-rw-r--r--   1 ftp      group with spaces in it as allowed in cygwin see bug 38634   83853 Jan 22  2001 zxJDBC-1.2.4.tar.gz"
+			"-rw-r--r--   1 ftp      group with spaces in it as allowed in cygwin see bug 38634   83853 Jan 22  2001 zxJDBC-1.2.4.tar.gz",
+			"crw-r----- 1 root kmem 0, 27 Jan 30 11:42 kmem",  //FreeBSD device
+			"crw-------   1 root     sys      109,767 Jul  2  2004 pci@1c,600000:devctl" //Solaris device
 
 
 		};
@@ -309,8 +311,8 @@ protected void doAdditionalGoodTests(String test, FTPFile f) {
                 int pos = 3*access + perm + 1;
                 char permchar = test.charAt(pos);
                 assertEquals("Permission " + test.substring(1,10), 
-                        f.hasPermission(access, perm), 
-                        permchar != '-' && !Character.isUpperCase(permchar)); 
+                        new Boolean(f.hasPermission(access, perm)), 
+                        new Boolean(permchar != '-' && !Character.isUpperCase(permchar))); 
             }
         }
 
