From 3693b03c87238cc8bdfa81145942c2896b036a5b Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Fri, 12 Apr 2013 20:26:05 +0000
Subject: [PATCH] [CONFIGURATION-524] CompositeConfiguration.clone() now
 ensures that the configuration's interpolator is cloned, too.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/configuration/trunk@1467448 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/configuration/CompositeConfiguration.java |  1 +
 .../configuration/TestCompositeConfiguration.java     | 11 +++++++++++
 2 files changed, 12 insertions(+)

diff --git a/src/main/java/org/apache/commons/configuration/CompositeConfiguration.java b/src/main/java/org/apache/commons/configuration/CompositeConfiguration.java
index aa7bc0cad3..4423d3811f 100644
--- a/src/main/java/org/apache/commons/configuration/CompositeConfiguration.java
+++ b/src/main/java/org/apache/commons/configuration/CompositeConfiguration.java
@@ -441,6 +441,7 @@ public Object clone()
                 }
             }
 
+            copy.cloneInterpolator(this);
             return copy;
         }
         catch (CloneNotSupportedException cnex)
diff --git a/src/test/java/org/apache/commons/configuration/TestCompositeConfiguration.java b/src/test/java/org/apache/commons/configuration/TestCompositeConfiguration.java
index 052ec0dec9..98264a6e4c 100644
--- a/src/test/java/org/apache/commons/configuration/TestCompositeConfiguration.java
+++ b/src/test/java/org/apache/commons/configuration/TestCompositeConfiguration.java
@@ -558,6 +558,17 @@ public void testCloneEventListener()
                 .getConfigurationListeners().isEmpty());
     }
 
+    /**
+     * Tests whether interpolation works as expected after cloning.
+     */
+    @Test
+    public void testCloneInterpolation()
+    {
+        CompositeConfiguration cc2 = (CompositeConfiguration) cc.clone();
+        assertNotSame("Interpolator was not cloned", cc.getInterpolator(),
+                cc2.getInterpolator());
+    }
+
     /**
      * Tests whether add property events are triggered.
      */
