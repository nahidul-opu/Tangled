From 68e0a9c71443738b1842e99925d37bf545f5a151 Mon Sep 17 00:00:00 2001
From: Gintas Grigelionis <gintas@apache.org>
Date: Tue, 30 Jan 2018 15:05:24 +0100
Subject: [PATCH] IVY-1573 do not skip versions with URL encoded characters

---
 .../apache/ivy/util/url/ApacheURLLister.java   | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/src/java/org/apache/ivy/util/url/ApacheURLLister.java b/src/java/org/apache/ivy/util/url/ApacheURLLister.java
index fed36bb4a..c275e0923 100644
--- a/src/java/org/apache/ivy/util/url/ApacheURLLister.java
+++ b/src/java/org/apache/ivy/util/url/ApacheURLLister.java
@@ -21,6 +21,8 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
+import java.net.URI;
+import java.net.URISyntaxException;
 import java.net.URL;
 import java.util.ArrayList;
 import java.util.List;
@@ -140,19 +142,21 @@ public List<URL> retrieveListing(URL url, boolean includeFiles, boolean includeD
 
             text = text.trim();
 
-            // handle complete URL listings
-            if (href.startsWith("http:") || href.startsWith("https:")) {
-                try {
-                    href = new URL(href).getPath();
+            try {
+                // URI methods decode the URL
+                URI uri = new URI(href);
+                href = uri.getPath();
+                // handle complete URL listings
+                if (uri.getScheme() != null) {
                     if (!href.startsWith(url.getPath())) {
                         // ignore URLs which aren't children of the base URL
                         continue;
                     }
                     href = href.substring(url.getPath().length());
-                } catch (Exception ignore) {
-                    // incorrect URL, ignore
-                    continue;
                 }
+            } catch (URISyntaxException e) {
+                // incorrect URL, ignore
+                continue;
             }
 
             if (href.startsWith("../")) {
