From 2fd86662926fa33e110f9e2ba05dc8bb4cb3b790 Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Wed, 8 Feb 2012 10:14:10 +0000
Subject: [PATCH] [SANTUARIO-299] - StringIndexOutOfBoundsException is thrown
 during reference verification (if URI = "#")

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/trunk@1241844 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG.txt                                                  | 1 +
 .../utils/resolver/implementations/ResolverFragment.java       | 3 +--
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG.txt b/CHANGELOG.txt
index 585d1446e8..0313f4cc04 100644
--- a/CHANGELOG.txt
+++ b/CHANGELOG.txt
@@ -1,6 +1,7 @@
 Changelog for "Apache xml-security" <http://santuario.apache.org/>
 
 New in v1.5.1-SNAPSHOT:
+    Fixed SANTUARIO-299 - StringIndexOutOfBoundsException is thrown during reference verification (if URI = "#")
     Fixed SANTUARIO-297 - Exceptions should use a JDK exception cause mechanism
 
 New in v1.5.0:
diff --git a/src/main/java/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java b/src/main/java/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java
index 2d0f121ca3..2b65848d34 100644
--- a/src/main/java/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java
+++ b/src/main/java/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java
@@ -131,8 +131,7 @@ public boolean engineCanResolve(Attr uri, String baseURI) {
 
         String uriNodeValue = uri.getNodeValue();
         if (uriNodeValue.equals("") || 
-            ((uriNodeValue.charAt(0) == '#') 
-                && !((uriNodeValue.charAt(1) == 'x') && uriNodeValue.startsWith("#xpointer(")))
+            ((uriNodeValue.charAt(0) == '#') && !uriNodeValue.startsWith("#xpointer("))
         ) {
             if (log.isDebugEnabled()) {
                 log.debug("State I can resolve reference: \"" + uriNodeValue + "\"");
