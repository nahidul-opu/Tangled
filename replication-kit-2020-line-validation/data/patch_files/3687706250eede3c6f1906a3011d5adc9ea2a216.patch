From 3687706250eede3c6f1906a3011d5adc9ea2a216 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Thu, 19 Mar 2009 22:00:45 +0000
Subject: [PATCH] NET-265: Fix edge case in group name parsing

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@756232 13f79535-47bb-0310-9956-ffa450edef68
---
 .../net/ftp/parser/UnixFTPEntryParser.java    |  4 +---
 .../ftp/parser/UnixFTPEntryParserTest.java    | 20 +++++++++++++++++++
 2 files changed, 21 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
index 98e40d89f..b1471eb2b 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
@@ -88,12 +88,10 @@ public class UnixFTPEntryParser extends ConfigurableFTPFileEntryParserImpl
         + "(?:(\\S+(?:\\s\\S+)*?)\\s+)?"                // owner name (optional spaces)
         + "(?:(\\S+(?:\\s\\S+)*)\\s+)?"                 // group name (optional spaces)
         + "(\\d+(?:,\\s*\\d+)?)\\s+"
-        
         /*
           numeric or standard format date
         */
-        + "((?:\\d+[-/]\\d+[-/]\\d+)|(?:\\S+\\s+\\S+))\\s+"
-        
+        + "((?:\\d+[-/]\\d+[-/]\\d+)|(?:[a-zA-Z]+\\s+\\S+))\\s+"
         /* 
            year (for non-recent standard format) 
            or time (for numeric or recent standard format  
diff --git a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
index 99923203c..d591ea1c4 100644
--- a/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
+++ b/src/test/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
@@ -186,6 +186,26 @@ public void testNoSpacesBeforeFileSize() {
 		assertEquals(f.getGroup(), "chrism");
 		assertEquals(f.getHardLinkCount(), 1464);
 	}
+	
+	public void testCorrectGroupNameParsing() {
+		FTPFile f = getParser().parseFTPEntry("-rw-r--r--   1 ftpuser  ftpusers 12414535 Mar 17 11:07 test 1999 abc.pdf");
+		assertNotNull(f);
+		assertEquals(f.getHardLinkCount(), 1);
+		assertEquals(f.getUser(), "ftpuser");
+		assertEquals(f.getGroup(), "ftpusers");
+		assertEquals(f.getSize(), 12414535);
+		assertEquals(f.getName(), "test 1999 abc.pdf");
+
+
+		Calendar cal = Calendar.getInstance();
+		cal.set(Calendar.MONTH, Calendar.MARCH);
+		cal.set(Calendar.DAY_OF_MONTH, 17);
+		cal.set(Calendar.HOUR_OF_DAY, 11);
+		cal.set(Calendar.MINUTE, 7);
+		cal.set(Calendar.SECOND, 0);
+		cal.set(Calendar.MILLISECOND, 0);
+		assertEquals(cal.getTime(), f.getTimestamp().getTime());
+	}
 
     /**
      * @see org.apache.commons.net.ftp.parser.FTPParseTestFramework#testParseFieldsOnDirectory()
