From 823ff1f8cb318f942700f6e495560c2a304def94 Mon Sep 17 00:00:00 2001
From: Maja Kabiljo <majakabiljo@maja-mbp.thefacebook.com>
Date: Thu, 11 Apr 2013 19:36:45 -0700
Subject: [PATCH] GIRAPH-614: SplitMasterWorker=false is broken (majakabiljo)

---
 CHANGELOG                                     |  2 ++
 .../org/apache/giraph/master/MasterInfo.java  | 20 ++++++++++++++++++-
 2 files changed, 21 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index 2cb8eb379..0012fa70f 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,8 @@
 Giraph Change Log
 
 Release 0.2.0 - unreleased
+  GIRAPH-614: SplitMasterWorker=false is broken (majakabiljo)
+
   GIRAPH-616: Decouple vertices and edges in DiskBackedPartitionStore and avoid writing 
   back edges when the algorithm does not change topology. (claudio)
 
diff --git a/giraph-core/src/main/java/org/apache/giraph/master/MasterInfo.java b/giraph-core/src/main/java/org/apache/giraph/master/MasterInfo.java
index 96e988c0d..90b49c305 100644
--- a/giraph-core/src/main/java/org/apache/giraph/master/MasterInfo.java
+++ b/giraph-core/src/main/java/org/apache/giraph/master/MasterInfo.java
@@ -30,8 +30,26 @@ public class MasterInfo extends TaskInfo {
   public MasterInfo() {
   }
 
+  /**
+   * This taskId is used internally as a unique identification of the
+   * nettyServer which runs on this task. Master is always returning -1
+   * because we need to make sure that the case when option
+   * {@link org.apache.giraph.conf.GiraphConstants#SPLIT_MASTER_WORKER} is
+   * false works correctly (master needs to have different id than the worker
+   * which runs in the same mapper)
+   *
+   * @return -1
+   */
+  @Override
+  public int getTaskId() {
+    return -1;
+  }
+
   @Override
   public String toString() {
-    return "Master(" + super.toString() + ")";
+    return "Master(hostname=" + getHostname() +
+        ", MRtaskID=" + super.getTaskId() +
+        ", port=" + getPort() +
+        ")";
   }
 }
