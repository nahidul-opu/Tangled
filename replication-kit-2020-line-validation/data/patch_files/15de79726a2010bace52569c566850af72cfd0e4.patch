From 15de79726a2010bace52569c566850af72cfd0e4 Mon Sep 17 00:00:00 2001
From: William Colen <colen@apache.org>
Date: Sun, 18 Mar 2012 15:28:41 +0000
Subject: [PATCH] OPENNLP-479: Changed how the abbreviation dictionary features
 are collected. Please review.

git-svn-id: https://svn.apache.org/repos/asf/opennlp/trunk@1302140 13f79535-47bb-0310-9956-ffa450edef68
---
 .../sentdetect/DefaultSDContextGenerator.java | 25 +++++++++++++++----
 1 file changed, 20 insertions(+), 5 deletions(-)

diff --git a/opennlp-tools/src/main/java/opennlp/tools/sentdetect/DefaultSDContextGenerator.java b/opennlp-tools/src/main/java/opennlp/tools/sentdetect/DefaultSDContextGenerator.java
index c9ec7b0c6..3259780a7 100644
--- a/opennlp-tools/src/main/java/opennlp/tools/sentdetect/DefaultSDContextGenerator.java
+++ b/opennlp-tools/src/main/java/opennlp/tools/sentdetect/DefaultSDContextGenerator.java
@@ -145,7 +145,7 @@ public String[] getContext(CharSequence sb, int position) {
       next = new StringBuilder(sb.subSequence(suffixEnd + 1, nextEnd)).toString().trim();
     }
 
-    collectFeatures(prefix,suffix,previous,next);
+    collectFeatures(prefix,suffix,previous,next, sb.charAt(position));
 
     String[] context = new String[collectFeats.size()];
     context = collectFeats.toArray(context);
@@ -156,12 +156,27 @@ public String[] getContext(CharSequence sb, int position) {
   /**
    * Determines some of the features for the sentence detector and adds them to list features.
    *
-   * @param prefix String preceeding the eos character in the eos token.
+   * @param prefix String preceding the eos character in the eos token.
    * @param suffix String following the eos character in the eos token.
-   * @param previous Space delimited token preceeding token containing eos character.
-   * @param next Space delimited token following token containsing eos character.
+   * @param previous Space delimited token preceding token containing eos character.
+   * @param next Space delimited token following token containing eos character.
+   * 
+   * @deprecated use {@link #collectFeatures(String, String, String, String, Character)} instead.
    */
   protected void collectFeatures(String prefix, String suffix, String previous, String next) {
+    collectFeatures(prefix, suffix, previous, next, null);
+  }
+
+  /**
+   * Determines some of the features for the sentence detector and adds them to list features.
+   *
+   * @param prefix String preceding the eos character in the eos token.
+   * @param suffix String following the eos character in the eos token.
+   * @param previous Space delimited token preceding token containing eos character.
+   * @param next Space delimited token following token containing eos character.
+   * @param eosChar the EOS character been analyzed
+   */
+  protected void collectFeatures(String prefix, String suffix, String previous, String next, Character eosChar) {
     buf.append("x=");
     buf.append(prefix);
     collectFeats.add(buf.toString());
@@ -171,7 +186,7 @@ protected void collectFeatures(String prefix, String suffix, String previous, St
       if (isFirstUpper(prefix)) {
         collectFeats.add("xcap");
       }
-      if (inducedAbbreviations.contains(prefix)) {
+      if (eosChar != null && inducedAbbreviations.contains(prefix + eosChar)) {
         collectFeats.add("xabbrev");
       }
     }
