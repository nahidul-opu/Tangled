From 4166ccbbb4a9a553b76148bf53380b450d444cbc Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Mon, 30 Apr 2007 18:02:12 +0000
Subject: [PATCH] FIX: Credentials are shown in build log even if debug is not
 enabled (IVY-486) (thanks to Gilles Scokart)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/core/trunk@533817 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                   |  3 ++-
 src/java/org/apache/ivy/util/Credentials.java | 16 +++++++++++++++-
 2 files changed, 17 insertions(+), 2 deletions(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index cad9a640c..e4fda5254 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -48,7 +48,8 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 =====================================
 - IMPROVEMENT: Allow "main" parameters to be passed directly (instead of using -args flag) (IVY-480) (thanks to Archie Cobbs)
 
-- BUG: ivy:install ant task does not fail on error (IVY-475) (thanks to Jeffrey Blatttman)
+- FIX: ivy:install ant task does not fail on error (IVY-475) (thanks to Jeffrey Blatttman)
+- FIX: Credentials are shown in build log even if debug is not enabled (IVY-486) (thanks to Gilles Scokart)
 
    2.0.0-alpha1-incubating
 =====================================
diff --git a/src/java/org/apache/ivy/util/Credentials.java b/src/java/org/apache/ivy/util/Credentials.java
index 9e19230c9..6c88d9596 100644
--- a/src/java/org/apache/ivy/util/Credentials.java
+++ b/src/java/org/apache/ivy/util/Credentials.java
@@ -56,8 +56,22 @@ public static String buildKey(String realm, String host) {
         }
     }
 
+	/**
+	 * Return a string that can be used for debug purpose.  It contains only stars for each password character.
+	 */
 	public String toString() {
-		return getKey() + " " + getUserName() + "/" + getPasswd();
+		return getKey() + " " + getUserName() + "/" + getPasswdAsStars();
+	}
+
+	private String getPasswdAsStars() {
+		if (_passwd == null) {
+			return null;
+		}
+		StringBuffer sb = new StringBuffer();
+		for (int i = _passwd.length(); i>0; i--) {
+			sb.append('*');
+		}
+		return sb.toString();
 	}
 
 	public boolean equals(Object o) {
