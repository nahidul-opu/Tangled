From 52a6d3e6aa04c977310f0dc46bb18901812e272a Mon Sep 17 00:00:00 2001
From: Claudio Martella <claudio.martella@gmail.com>
Date: Mon, 18 Nov 2013 15:00:06 +0100
Subject: [PATCH] GIRAPH-442

---
 CHANGELOG                                                 | 3 +++
 .../main/java/org/apache/giraph/zk/ZooKeeperManager.java  | 8 ++++++++
 2 files changed, 11 insertions(+)

diff --git a/CHANGELOG b/CHANGELOG
index ffa98646a..2a1d399c9 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,9 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-442: FileNotFoundException: <baseDirectory>/_zkServer is checked before it is created
+  (miteshsjat via claudio)
+
   GIRAPH-796: Site build error with maven 3.1 (armax00 via claudio)
 
   GIRAPH-749: Update documentation according to the new EdgeOutputFormat API 
diff --git a/giraph-core/src/main/java/org/apache/giraph/zk/ZooKeeperManager.java b/giraph-core/src/main/java/org/apache/giraph/zk/ZooKeeperManager.java
index 3364dfd82..b3db28f8f 100644
--- a/giraph-core/src/main/java/org/apache/giraph/zk/ZooKeeperManager.java
+++ b/giraph-core/src/main/java/org/apache/giraph/zk/ZooKeeperManager.java
@@ -289,6 +289,14 @@ public void createCandidateStamp() {
       LOG.error("createCandidateStamp: Failed to mkdirs " +
           baseDirectory);
     }
+    try {
+      fs.mkdirs(serverDirectory);
+      LOG.info("createCandidateStamp: Made the directory " +
+          serverDirectory);
+    } catch (IOException e) {
+      LOG.error("createCandidateStamp: Failed to mkdirs " +
+          serverDirectory);
+    }
     // Check that the base directory exists and is a directory
     try {
       if (!fs.getFileStatus(baseDirectory).isDir()) {
