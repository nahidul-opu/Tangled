From 04cdb74ae592895e01d95332a753028f5b3ef73f Mon Sep 17 00:00:00 2001
From: Colm O Heigeartaigh <coheigea@apache.org>
Date: Wed, 8 Feb 2012 10:30:30 +0000
Subject: [PATCH] [SANTUARIO-299] - StringIndexOutOfBoundsException is thrown
 during reference verification (if URI = "#")

git-svn-id: https://svn.apache.org/repos/asf/santuario/xml-security-java/branches/1.4.x-fixes@1241850 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG.txt                                                | 1 +
 .../utils/resolver/implementations/ResolverFragment.java     | 5 +----
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/CHANGELOG.txt b/CHANGELOG.txt
index ba0141669a..0acaa2f3e1 100644
--- a/CHANGELOG.txt
+++ b/CHANGELOG.txt
@@ -1,6 +1,7 @@
 Changelog for "Apache xml-security" <http://santuario.apache.org/>
 
 New in v.1.4.7-SNAPSHOT:
+    Fixed SANTUARIO-299: StringIndexOutOfBoundsException is thrown during reference verification (if URI = "#")
     Fixed SANTUARIO-295: XMLDSig XPathFilter2Transform bug involving intersect filter
     Fixed SANTUARIO-286: Test case Santuario273.testC14n11Base() tests for a side-effect of canonicalization, rather than the desired effect.
 
diff --git a/src/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java b/src/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java
index 7163b1f50e..0d87453ae6 100644
--- a/src/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java
+++ b/src/org/apache/xml/security/utils/resolver/implementations/ResolverFragment.java
@@ -122,10 +122,7 @@ public boolean engineCanResolve(Attr uri, String BaseURI) {
       String uriNodeValue = uri.getNodeValue();
 
       if  (uriNodeValue.equals("") || 
-             ( 
-            (uriNodeValue.charAt(0)=='#') 
-              && !((uriNodeValue.charAt(1)=='x') && uriNodeValue.startsWith("#xpointer("))
-              )
+             ((uriNodeValue.charAt(0)=='#') && !uriNodeValue.startsWith("#xpointer("))
            ){
          if (log.isDebugEnabled())
          	log.debug("State I can resolve reference: \"" + uriNodeValue + "\"");
