From c06c07e76af2d3d452764042db89ebe36109db4f Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 3 Apr 2014 22:34:33 +0000
Subject: [PATCH] JCS-112 RemoteCacheServer.logUpdateInfo bug updating put
 count

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/jcs/trunk@1584435 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                   | 3 +++
 .../jcs/auxiliary/remote/server/RemoteCacheServer.java    | 8 +++++---
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 72bc5fdca..ff9204048 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -20,6 +20,9 @@
 	</properties>
 	<body>
 		<release version="2.0" date="unreleased" description="JDK 1.6 based major release">
+            <action issue="JCS-112" dev="sebb" type="fix">
+                RemoteCacheServer.logUpdateInfo bug updating put count
+            </action>
             <action dev="tv" type="fix">
                 Fix updating of last access time, add tests for event handling
             </action>
diff --git a/src/java/org/apache/commons/jcs/auxiliary/remote/server/RemoteCacheServer.java b/src/java/org/apache/commons/jcs/auxiliary/remote/server/RemoteCacheServer.java
index 0870b42d9..1a51d8605 100644
--- a/src/java/org/apache/commons/jcs/auxiliary/remote/server/RemoteCacheServer.java
+++ b/src/java/org/apache/commons/jcs/auxiliary/remote/server/RemoteCacheServer.java
@@ -385,10 +385,11 @@ private void processUpdate( ICacheElement<K, V> item, long requesterId )
      */
     private void logUpdateInfo( ICacheElement<K, V> item )
     {
+        // not thread safe, but it doesn't have to be 100% accurate
+        puts++;
+
         if ( log.isInfoEnabled() )
         {
-            // not thread safe, but it doesn't have to be accurate
-            puts++;
             if ( puts % logInterval == 0 )
             {
                 log.info( "puts = " + puts );
@@ -1066,7 +1067,8 @@ private void processRemoveAll( String cacheName, long requesterId )
      * <p>
      * @return puts
      */
-    protected int getPutCount()
+    // Currently only intended for use by unit tests
+    int getPutCount()
     {
         return puts;
     }
