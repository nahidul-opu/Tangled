From 30f5293c15477339ca1f6e5ba60a17da24e08000 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Sat, 8 Mar 2008 19:49:53 +0000
Subject: [PATCH] Add a fix for UNKNOWN Type: L8 SYST messages (NET-169)

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@635059 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/commons/net/ftp/FTPClientConfig.java  | 8 ++++++++
 .../net/ftp/parser/DefaultFTPFileEntryParserFactory.java  | 3 ++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java b/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java
index 89754f012..a01a9de8e 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClientConfig.java
@@ -178,6 +178,14 @@ public class FTPClientConfig
      */
     public static final String SYST_MVS = "MVS";
 
+    /**
+     * Some servers return an "UNKNOWN Type: L8" message
+     * in response to the SYST command. We set these to be a Unix-type system.
+     * This may happen if the ftpd in question was compiled without system
+     * information.
+     */
+    public static final String SYST_L8 = "Type: L8";
+    
     /**
      * Identifier by which an Netware-based ftp server is known throughout
      * the commons-net ftp system.
diff --git a/src/main/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java b/src/main/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java
index 476e69322..f541fc6c7 100644
--- a/src/main/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java
+++ b/src/main/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java
@@ -97,7 +97,8 @@ public FTPFileEntryParser createFileEntryParser(String key)
 	            {
 	                ukey = key.toUpperCase();
 	            }
-	            if (ukey.indexOf(FTPClientConfig.SYST_UNIX) >= 0)
+	            if ((ukey.indexOf(FTPClientConfig.SYST_UNIX) >= 0) 
+	            		|| (ukey.indexOf(FTPClientConfig.SYST_L8) >= 0))
 	            {
 	                parser = createUnixFTPEntryParser();
 	            }
