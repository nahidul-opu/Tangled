From be2bf403641c399d86af3208eb5d18ced980c8fd Mon Sep 17 00:00:00 2001
From: Ralph Goers <rgoers@apache.org>
Date: Fri, 6 Nov 2009 19:56:25 +0000
Subject: [PATCH] Apply patch for VFS-287

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@833538 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/vfs/provider/AbstractFileSystem.java  | 4 ++++
 xdocs/changes.xml                                            | 5 ++++-
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/AbstractFileSystem.java b/core/src/main/java/org/apache/commons/vfs/provider/AbstractFileSystem.java
index 777edb8a7e..75b9f58a34 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/AbstractFileSystem.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/AbstractFileSystem.java
@@ -524,6 +524,10 @@ public void removeListener(final FileObject file,
             if (listeners != null)
             {
                 listeners.remove(listener);
+                if (listeners.isEmpty())
+                {
+                    listenerMap.remove(file.getName());
+                }
             }
         }
     }
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index acbdb2fda1..a059227280 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -23,8 +23,11 @@
 
   <body>
     <release version="2.0" date="in SVN" description="">
+      <action dev="rgoers" type="fix" issue="VFS-287" due-to="Mircea-Eugen Ionica">
+        LocalFileName objects are not released from AbstractFileSystem.listenerMap when all listeners are removed.
+      </action>
       <action dev="rgoers" type="fix" issue="VFS-216" due-to="Reetu Mutti">
-        The FTP Configuration includes an option to set a timeout for the data connection, but not for the socket 
+        The FTP Configuration includes an option to set a timeout for the data connection, but not for the socket
         timeout. This is a problem, as idle sockets can cause your download to hang forever and never timeout.
       </action>
       <action dev="rgoers" type="fix" issue="VFS-289" due-to="Kirill Safonov">
