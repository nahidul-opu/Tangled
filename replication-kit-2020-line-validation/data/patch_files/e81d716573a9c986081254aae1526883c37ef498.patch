From e81d716573a9c986081254aae1526883c37ef498 Mon Sep 17 00:00:00 2001
From: Bernd Eckenfels <ecki@apache.org>
Date: Wed, 23 Sep 2015 19:55:57 +0000
Subject: [PATCH] [VFS-567][ftp] Ignore exceptions on disconnect.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1704927 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/vfs2/provider/ftp/FTPClientWrapper.java | 13 +++++++++++++
 src/changes/changes.xml                             |  3 +++
 2 files changed, 16 insertions(+)

diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/ftp/FTPClientWrapper.java b/core/src/main/java/org/apache/commons/vfs2/provider/ftp/FTPClientWrapper.java
index 32dc1b291b..e73a342d91 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/ftp/FTPClientWrapper.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/ftp/FTPClientWrapper.java
@@ -20,6 +20,8 @@
 import java.io.InputStream;
 import java.io.OutputStream;
 
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
 import org.apache.commons.net.ftp.FTPClient;
 import org.apache.commons.net.ftp.FTPFile;
 import org.apache.commons.net.ftp.FTPReply;
@@ -37,6 +39,9 @@
  */
 public class FTPClientWrapper implements FtpClient
 {
+    
+    private static final Log LOG = LogFactory.getLog(FTPClientWrapper.class);
+    
     protected final FileSystemOptions fileSystemOptions;
     private final GenericFileName root;
     private FTPClient ftpClient;
@@ -112,12 +117,20 @@ public void disconnect() throws IOException
         {
             getFtpClient().quit();
         }
+        catch (IOException e)
+        {
+            LOG.debug("I/O exception while trying to quit, probably it's a timed out connection, ignoring.", e);
+        }
         finally
         {
             try
             {
                 getFtpClient().disconnect();
             }
+            catch (IOException e)
+            {
+                LOG.warn("I/O exception while trying to disconnect, probably it's a closed connection, ignoring.", e);
+            }
             finally
             {
                 ftpClient = null;
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 403c68cfb0..9aa92a8ea4 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -26,6 +26,9 @@
 <!--       <action issue="VFS-443" dev="ggregory" type="update" due-to="nickallen"> -->
 <!--        [Local] Need an easy way to convert from a FileObject to a File. -->
 <!--       </action> -->
+      <action issue="VFS-567" dev="ecki" type="fix" due-to="Antonio Petrelli">
+        [ftp] Ignore exceptions while QUIT/disconnect.
+     </action>
       <action issue="VFS-572" dev="ecki" type="fix" due-to="Sandra Parsick">
         [sftp] better documentation for knownhosts file option.
      </action>
