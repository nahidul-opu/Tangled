From a00c4ecbb2e3e6d0bb200e8109962c5424be570a Mon Sep 17 00:00:00 2001
From: Pavan Kumar <pavanka@fb.com>
Date: Sun, 8 Jun 2014 18:23:22 -0700
Subject: [PATCH] GIRAPH-904: Giraph can hang when hostnames include uppercase
 letters (netj via pavanka)

---
 CHANGELOG                                                       | 2 ++
 .../main/java/org/apache/giraph/conf/GiraphConfiguration.java   | 2 +-
 giraph-core/src/main/java/org/apache/giraph/graph/TaskInfo.java | 2 +-
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG b/CHANGELOG
index fce8fb554..bdc0c10df 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,8 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-904: Giraph can hang when hostnames include uppercase letters (netj via pavanka)
+
   GIRAPH-900: Remove timers for compute method (majakabiljo via pavanka)
 
   GIRAPH-894: make giraphconfiguration available to workercontext (pavanka)
diff --git a/giraph-core/src/main/java/org/apache/giraph/conf/GiraphConfiguration.java b/giraph-core/src/main/java/org/apache/giraph/conf/GiraphConfiguration.java
index a32c93804..d76430760 100644
--- a/giraph-core/src/main/java/org/apache/giraph/conf/GiraphConfiguration.java
+++ b/giraph-core/src/main/java/org/apache/giraph/conf/GiraphConfiguration.java
@@ -1071,7 +1071,7 @@ public boolean useInputSplitLocality() {
   public String getLocalHostname() throws UnknownHostException {
     return DNS.getDefaultHost(
         GiraphConstants.DNS_INTERFACE.get(this),
-        GiraphConstants.DNS_NAMESERVER.get(this));
+        GiraphConstants.DNS_NAMESERVER.get(this)).toLowerCase();
   }
 
   /**
diff --git a/giraph-core/src/main/java/org/apache/giraph/graph/TaskInfo.java b/giraph-core/src/main/java/org/apache/giraph/graph/TaskInfo.java
index 536af0f83..d593204e2 100644
--- a/giraph-core/src/main/java/org/apache/giraph/graph/TaskInfo.java
+++ b/giraph-core/src/main/java/org/apache/giraph/graph/TaskInfo.java
@@ -48,7 +48,7 @@ public TaskInfo() {
    * @return Hostname
    */
   public String getHostname() {
-    return hostname;
+    return hostname.toLowerCase();
   }
 
   /**
