From 5d491d56a253edd8433244f5671d3f3c64d736ac Mon Sep 17 00:00:00 2001
From: Phil Steitz <psteitz@apache.org>
Date: Sun, 9 Mar 2008 06:07:22 +0000
Subject: [PATCH] Made getPool synchronized in PoolableConnectionFactory. Fixes
 inconsistent synchronization accessing _pool. JIRA: DBCP-252

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/dbcp/trunk@635173 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/dbcp/PoolableConnectionFactory.java  | 6 +++++-
 xdocs/changes.xml                                           | 4 ++++
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java b/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java
index 2c13fd0c9e..1530be5805 100644
--- a/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java
+++ b/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java
@@ -244,7 +244,11 @@ synchronized public void setPool(ObjectPool pool) {
         _pool = pool;
     }
 
-    public ObjectPool getPool() {
+    /**
+     * Returns the {@link ObjectPool} in which {@link Connection}s are pooled.
+     * @return the connection pool
+     */
+    synchronized public ObjectPool getPool() {
         return _pool;
     }
 
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index 7d19ebce77..5ac726630b 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -110,6 +110,10 @@ The <action> type attribute can be add,update,fix,remove.
         orphaned when an exception occurs in setUpDefaults or clearWarnings in 
         IntanceKeyDataSource.getConnection.
       </action> 
+      <action dev="psteitz" type="fix" issue="DBCP-252" due-to="FindBugs">
+        Made getPool synchronized in PoolableConnectionFactory.
+        Fixes inconsistent synchronization accessing _pool.
+      </action> 
     </release>
     <release version="1.2.2" date="2007-04-04"
       description="This is a maintenance release containing bug fixes
