From 1f56bd103d53c8c6ba7502c6586c26be01bfdb80 Mon Sep 17 00:00:00 2001
From: pascalschumacher <pascalschumacher@gmx.net>
Date: Tue, 23 Aug 2016 19:22:55 +0200
Subject: [PATCH 1/2] LANG-1261: ArrayUtils#contains and ArrayUtils#indexOf
 should compare objects with different types

---
 .../org/apache/commons/lang3/ArrayUtils.java   |  2 +-
 .../apache/commons/lang3/ArrayUtilsTest.java   | 18 +++++++++++++++++-
 2 files changed, 18 insertions(+), 2 deletions(-)

diff --git a/src/main/java/org/apache/commons/lang3/ArrayUtils.java b/src/main/java/org/apache/commons/lang3/ArrayUtils.java
index 1d33fcf130b..b2f019eda79 100644
--- a/src/main/java/org/apache/commons/lang3/ArrayUtils.java
+++ b/src/main/java/org/apache/commons/lang3/ArrayUtils.java
@@ -3184,7 +3184,7 @@ public static int indexOf(final Object[] array, final Object objectToFind, int s
                     return i;
                 }
             }
-        } else if (array.getClass().getComponentType().isInstance(objectToFind)) {
+        } else {
             for (int i = startIndex; i < array.length; i++) {
                 if (objectToFind.equals(array[i])) {
                     return i;
diff --git a/src/test/java/org/apache/commons/lang3/ArrayUtilsTest.java b/src/test/java/org/apache/commons/lang3/ArrayUtilsTest.java
index a50ed1ab20f..2d137c8224d 100644
--- a/src/test/java/org/apache/commons/lang3/ArrayUtilsTest.java
+++ b/src/test/java/org/apache/commons/lang3/ArrayUtilsTest.java
@@ -2953,7 +2953,23 @@ public void testContains() {
         assertTrue(ArrayUtils.contains(array, null));
         assertFalse(ArrayUtils.contains(array, "notInArray"));
     }
-    
+
+    @Test
+    public void testContains_LANG_1261() {
+        class LANG1261ParentObject {
+            @Override
+            public boolean equals(Object o) {
+                return true;
+            }
+        }
+        class LANG1261ChildObject extends LANG1261ParentObject {
+        }
+
+        Object[] array = new LANG1261ChildObject[] { new LANG1261ChildObject() };
+
+        assertTrue(ArrayUtils.contains(array, new LANG1261ParentObject()));
+    }
+
     //-----------------------------------------------------------------------
     @Test
     public void testIndexOfLong() {

From 556d0fe10ff9d2ffd75185866dc78e259b71d035 Mon Sep 17 00:00:00 2001
From: Benedikt Ritter <britter@apache.org>
Date: Sun, 18 Sep 2016 18:01:02 +0200
Subject: [PATCH 2/2] Add LANG-1261 to changes.xml

---
 src/changes/changes.xml | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index c038ad8b5e7..5bd9589fd5b 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -46,6 +46,7 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
 
   <release version="3.5" date="tba" description="tba">
+    <action issue="LANG-1261" type="fix" dev="pschumacher" >ArrayUtils.contains returns false for instances of subtypes</action>
     <action issue="LANG-1230" type="fix" dev="pschumacher" due-to="Philippe Marschall">Remove unnecessary synchronization from registry lookup in EqualsBuilder and HashCodeBuilder</action>
     <action issue="LANG-1224" type="add" dev="pschumacher" due-to="Caleb Cushing">Extend RandomStringUtils with methods that generate strings between a min and max length</action>
     <action issue="LANG-1214" type="fix" dev="pschumacher" due-to="Henry Tung">Handle "void" in ClassUtils.getClass()</action>
