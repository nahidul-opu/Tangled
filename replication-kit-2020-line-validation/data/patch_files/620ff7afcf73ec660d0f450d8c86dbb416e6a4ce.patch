From 620ff7afcf73ec660d0f450d8c86dbb416e6a4ce Mon Sep 17 00:00:00 2001
From: Oliver Heger <oheger@apache.org>
Date: Mon, 30 Oct 2006 20:50:59 +0000
Subject: [PATCH] Updated SubsetConfiguration to support interpolation for non
 string values, too; fix for CONFIGURATION-235

git-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@469268 13f79535-47bb-0310-9956-ffa450edef68
---
 .../commons/configuration/SubsetConfiguration.java  |  2 +-
 .../configuration/TestBaseConfiguration.java        | 13 +++++++++++++
 xdocs/changes.xml                                   |  4 ++++
 3 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/commons/configuration/SubsetConfiguration.java b/src/java/org/apache/commons/configuration/SubsetConfiguration.java
index 0225ac5893..9ddf8691da 100644
--- a/src/java/org/apache/commons/configuration/SubsetConfiguration.java
+++ b/src/java/org/apache/commons/configuration/SubsetConfiguration.java
@@ -236,7 +236,7 @@ public Object transform(Object obj)
     /**
      * {@inheritDoc}
      */
-    protected String interpolate(String base)
+    protected Object interpolate(Object base)
     {
         if (delimiter == null && "".equals(prefix))
         {
diff --git a/src/test/org/apache/commons/configuration/TestBaseConfiguration.java b/src/test/org/apache/commons/configuration/TestBaseConfiguration.java
index 97c28b8e89..51b219c249 100644
--- a/src/test/org/apache/commons/configuration/TestBaseConfiguration.java
+++ b/src/test/org/apache/commons/configuration/TestBaseConfiguration.java
@@ -661,6 +661,19 @@ public void testInterpolationLoop() throws Exception
         fail("IllegalStateException should have been thrown for looped property references");
     }
 
+    /**
+     * Tests interpolation when a subset configuration is involved.
+     */
+    public void testInterpolationSubset()
+    {
+        config.addProperty("test.a", new Integer(42));
+        config.addProperty("test.b", "${test.a}");
+        assertEquals("Wrong interpolated value", 42, config.getInt("test.b"));
+        Configuration subset = config.subset("test");
+        assertEquals("Wrong string property", "42", subset.getString("b"));
+        assertEquals("Wrong int property", 42, subset.getInt("b"));
+    }
+
     public void testGetHexadecimalValue()
     {
         config.setProperty("number", "0xFF");
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index 38c2801dc3..ab03e46b44 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -23,6 +23,10 @@
 
   <body>
     <release version="1.4-dev" date="in SVN">
+      <action dev="oheger" type="update" issue="CONFIGURATION-235">
+        Interpolation of non string values did not work when SubsetConfiguration
+        was involved. This has now been fixed.
+      </action>
       <action dev="oheger" type="update" issue="CONFIGURATION-227">
         The compatibility of ConfigurationDynaBean with other configuration types
         than those that inherit from BaseConfiguration was improved.
