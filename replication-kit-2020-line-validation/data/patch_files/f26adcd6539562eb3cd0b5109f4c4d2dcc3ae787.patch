From f26adcd6539562eb3cd0b5109f4c4d2dcc3ae787 Mon Sep 17 00:00:00 2001
From: Aaron Smuts <asmuts@apache.org>
Date: Mon, 1 Jun 2009 21:23:03 +0000
Subject: [PATCH] Resolved bug JCS-56.  There was a problem in the chunking
 method.

git-svn-id: https://svn.apache.org/repos/asf/jakarta/jcs/trunk@780834 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/jcs/auxiliary/disk/block/BlockDisk.java | 10 +++-------
 1 file changed, 3 insertions(+), 7 deletions(-)

diff --git a/src/java/org/apache/jcs/auxiliary/disk/block/BlockDisk.java b/src/java/org/apache/jcs/auxiliary/disk/block/BlockDisk.java
index 8e0922e9e..3e459fa48 100644
--- a/src/java/org/apache/jcs/auxiliary/disk/block/BlockDisk.java
+++ b/src/java/org/apache/jcs/auxiliary/disk/block/BlockDisk.java
@@ -132,11 +132,7 @@ public BlockDisk( File file, int blockSizeBytes, IElementSerializer elementSeria
             log.info( "Constructing BlockDisk, blockSizeBytes [" + blockSizeBytes + "]" );
         }
         this.blockSizeBytes = blockSizeBytes;
-        
-        if ( log.isInfoEnabled() )
-        {
-            log.info( "Used default block size [" + DEFAULT_BLOCK_SIZE_BYTES + "]" );
-        }
+
         this.elementSerializer = elementSerializer;   
     }
 
@@ -165,7 +161,7 @@ protected int[] write( Serializable object )
 
         if ( log.isDebugEnabled() )
         {
-            log.debug( "read, total pre-chunking data.length = " + data.length );
+            log.debug( "write, total pre-chunking data.length = " + data.length );
         }
         
         this.addToPutBytes( data.length );
@@ -231,7 +227,7 @@ protected byte[][] getBlockChunks( byte[] complete, int numBlocksNeeded )
             {
                 // use the max that can be written to a block or whatever is left in the original
                 // array
-                int chunkSize = Math.min( totalUsed + maxChunkSize, totalBytes - totalUsed );
+                int chunkSize = Math.min( maxChunkSize, totalBytes - totalUsed );
                 byte[] chunk = new byte[chunkSize];
                 // copy from the used position to the chunk size on the complete array to the chunk
                 // array.
