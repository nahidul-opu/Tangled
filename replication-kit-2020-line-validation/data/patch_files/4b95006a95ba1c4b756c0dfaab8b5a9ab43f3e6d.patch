From 4b95006a95ba1c4b756c0dfaab8b5a9ab43f3e6d Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 3 Mar 2011 13:45:01 +0000
Subject: [PATCH] NET-348 Queue is full TelnetInputStream.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1076624 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                        | 3 +++
 .../java/org/apache/commons/net/telnet/TelnetInputStream.java  | 3 ++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 347c4fb9e..e95d4fbb9 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -54,6 +54,9 @@ The <action> type attribute can be add,update,fix,remove.
 
     <body>
         <release version="3.0" date="TBA" description="TBA">
+            <action issue="NET-348" dev="sebb" type="fix">
+            Queue is full TelnetInputStream.
+            </action>
             <action issue="NET-361" dev="sebb" type="add">
             Implement Telnet Command sender.
             </action>
diff --git a/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java b/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java
index 3e572c582..c00f1f090 100644
--- a/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java
+++ b/src/main/java/org/apache/commons/net/telnet/TelnetInputStream.java
@@ -105,7 +105,6 @@ void _start()
         __thread.setPriority(priority);
         __thread.setDaemon(true);
         __thread.start();
-        __threaded = true;
     }
 
 
@@ -577,6 +576,8 @@ public void run()
     {
         int ch;
 
+        __threaded = true; // tell _processChar that we are running threaded
+
         try
         {
 _outerLoop:
