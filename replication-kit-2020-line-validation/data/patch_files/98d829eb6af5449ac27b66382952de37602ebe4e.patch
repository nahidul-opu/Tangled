From 98d829eb6af5449ac27b66382952de37602ebe4e Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 8 Feb 2018 11:55:10 +0000
Subject: [PATCH] NET-643 NPE when closing telnet stream

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1823550 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                     | 3 +++
 .../java/org/apache/commons/net/telnet/TelnetClient.java    | 6 ++++++
 2 files changed, 9 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 34ff1ef73..bbaf6c2ad 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -74,6 +74,9 @@ This is mainly a bug-fix release. See further details below.
  The examples are not part of the public API, so this does not affect compatibility.
 
 ">
+            <action issue="NET-643" type="fix" dev="sebb" due-to="Vasily">
+            NPE when closing telnet stream
+            </action>
             <action issue="NET-648" type="add" dev="pschumacher">
             Add Automatic-Module-Name MANIFEST entry for Java 9 compatibility
             </action>
diff --git a/src/main/java/org/apache/commons/net/telnet/TelnetClient.java b/src/main/java/org/apache/commons/net/telnet/TelnetClient.java
index ac1e49d59..d11327683 100644
--- a/src/main/java/org/apache/commons/net/telnet/TelnetClient.java
+++ b/src/main/java/org/apache/commons/net/telnet/TelnetClient.java
@@ -100,10 +100,16 @@ public TelnetClient(String termtype, int maxSubnegotiationLength)
 
     void _flushOutputStream() throws IOException
     {
+        if (_output_ == null) {
+            throw new IOException("Stream closed");
+        }
         _output_.flush();
     }
     void _closeOutputStream() throws IOException
     {
+        if (_output_ == null) {
+            return;
+        }
         try {
             _output_.close();
         } finally {
