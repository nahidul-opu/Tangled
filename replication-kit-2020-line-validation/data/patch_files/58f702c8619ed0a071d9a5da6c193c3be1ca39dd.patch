From 58f702c8619ed0a071d9a5da6c193c3be1ca39dd Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 19 Jun 2008 12:10:33 +0000
Subject: [PATCH] NET-223 - the data connection socket is not closed when an
 IOException occurred

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/branches/NET_2_0@669460 13f79535-47bb-0310-9956-ffa450edef68
---
 src/main/java/org/apache/commons/net/ftp/FTPClient.java | 9 ++++++---
 src/site/xdoc/changes.xml                               | 3 +++
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/commons/net/ftp/FTPClient.java b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
index 422919e9d..5d25855bd 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPClient.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPClient.java
@@ -2299,9 +2299,12 @@ private FTPListParseEngine initiateListParsing(
         }
 
 
-        engine.readServerList(socket.getInputStream(), getControlEncoding());
-
-        socket.close();
+        try {
+            engine.readServerList(socket.getInputStream(), getControlEncoding());
+        }
+        finally {
+            socket.close();
+        }
 
         completePendingCommand();
         return engine;
diff --git a/src/site/xdoc/changes.xml b/src/site/xdoc/changes.xml
index 244f1b034..2012d9ae7 100644
--- a/src/site/xdoc/changes.xml
+++ b/src/site/xdoc/changes.xml
@@ -163,6 +163,9 @@ limitations under the License.
             </action>
             <action dev="sebb" type="fix" issue="NET-208">
                 TelnetInputStream swallows interruptedexception as IOException
+            </action>
+            <action dev="sebb" type="fix" issue="NET-223">
+                the data connection socket is not closed when an IOException occurred
             </action>
 		</release>	
 
