From e4658ae28cf7204af2ddfa0abfc8f03c2026ba59 Mon Sep 17 00:00:00 2001
From: Stefan Bodewig <bodewig@apache.org>
Date: Mon, 9 Jan 2017 15:28:13 +0100
Subject: [PATCH] SnappyInputStream was sliding the window too early, leading
 to loss for long offsets

may be related to COMPRESS-358
---
 .../compressors/snappy/SnappyCompressorInputStream.java         | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/compress/compressors/snappy/SnappyCompressorInputStream.java b/src/main/java/org/apache/commons/compress/compressors/snappy/SnappyCompressorInputStream.java
index faeabffd5d9..a9bb94a4c3a 100644
--- a/src/main/java/org/apache/commons/compress/compressors/snappy/SnappyCompressorInputStream.java
+++ b/src/main/java/org/apache/commons/compress/compressors/snappy/SnappyCompressorInputStream.java
@@ -140,7 +140,7 @@ public int read(final byte[] b, final int off, final int len) throws IOException
         }
         System.arraycopy(decompressBuf, readIndex, b, off, readable);
         readIndex += readable;
-        if (readIndex > blockSize) {
+        if (readIndex > 2 * blockSize) {
             slideBuffer();
         }
         return readable;
