From a70f7c8cec33421db2be57525d9b193a32d44fd2 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Thu, 19 Jun 2008 12:10:33 +0000
Subject: [PATCH] NET-223 - the data connection socket is not closed when an
 IOException occurred

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@669460 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/commons/net/ftp/FTPClient.java | 9 ++++++---
 xdocs/changes.xml                                  | 3 +++
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/src/java/org/apache/commons/net/ftp/FTPClient.java b/src/java/org/apache/commons/net/ftp/FTPClient.java
index 9c2b08362..5c8b6fcdc 100644
--- a/src/java/org/apache/commons/net/ftp/FTPClient.java
+++ b/src/java/org/apache/commons/net/ftp/FTPClient.java
@@ -2397,9 +2397,12 @@ private FTPListParseEngine initiateListParsing(
         }
 
 
-        engine.readServerList(socket.getInputStream(), getControlEncoding());
-
-        socket.close();
+        try {
+            engine.readServerList(socket.getInputStream(), getControlEncoding());
+        }
+        finally {
+            socket.close();
+        }
 
         completePendingCommand();
         return engine;
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index 6a309e8e9..bc7a88c13 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -94,6 +94,9 @@ limitations under the License.
             </action>
             <action dev="sebb" type="fix" issue="NET-208">
                 TelnetInputStream swallows interruptedexception as IOException
+            </action>
+            <action dev="sebb" type="fix" issue="NET-223">
+                the data connection socket is not closed when an IOException occurred
             </action>
 		</release> 
 		
