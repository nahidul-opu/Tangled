From c4786e75f22050e5716072b2ce53463c87a076d0 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Fri, 15 Oct 2010 12:46:25 +0000
Subject: [PATCH] NET-334:  FromNetASCIIInputStream can throw a
 NullPointerException

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1022895 13f79535-47bb-0310-9956-ffa450edef68
---
 RELEASE-NOTES.txt                                             | 1 +
 src/changes/changes.xml                                       | 3 +++
 .../org/apache/commons/net/io/FromNetASCIIInputStream.java    | 4 ++++
 3 files changed, 8 insertions(+)

diff --git a/RELEASE-NOTES.txt b/RELEASE-NOTES.txt
index 2c7d65d78..6847cdd80 100644
--- a/RELEASE-NOTES.txt
+++ b/RELEASE-NOTES.txt
@@ -23,6 +23,7 @@ o NET-263:  SubnetUtils / SubNetInfo toString() implementations
 o Javadoc fixes, improvements, and refactoring. 
 
 Fixed Bugs:
+o NET-334:  FromNetASCIIInputStream can throw a NullPointerException 
 o NET-341:  FTPClient.remoteAppend(String filename) uses STOR instead of APPE 
 o NET-339:  Incorrect parsing of timestamp on Windows CE
             Fix parsing to allow for new-style DOS listing using 24hr clock rather than AM/PM 
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 961ac7bff..af773d976 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -61,6 +61,9 @@ This is primarily a maintenance release, but it also includes new features and e
  
   TO BE COMPLETED
 ">
+            <action issue="NET-334" dev="sebb" type="fix">
+            FromNetASCIIInputStream can throw a NullPointerException
+            </action>
             <action issue="NET-341" dev="sebb" type="fix">
             FTPClient.remoteAppend(String filename) uses STOR instead of APPE
             </action>
diff --git a/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java b/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java
index 923bc4b38..da6d7c75a 100644
--- a/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java
+++ b/src/main/java/org/apache/commons/net/io/FromNetASCIIInputStream.java
@@ -190,6 +190,7 @@ public int read(byte buffer[], int offset, int length) throws IOException
 
 
     // PushbackInputStream in JDK 1.1.3 returns the wrong thing
+    // TODO - can we delete this override now?
     /***
      * Returns the number of bytes that can be read without blocking EXCEPT
      * when newline conversions have to be made somewhere within the
@@ -200,6 +201,9 @@ public int read(byte buffer[], int offset, int length) throws IOException
     @Override
     public int available() throws IOException
     {
+        if (in == null) {
+            throw new IOException("Stream closed");
+        }
         return (buf.length - pos) + in.available();
     }
 
