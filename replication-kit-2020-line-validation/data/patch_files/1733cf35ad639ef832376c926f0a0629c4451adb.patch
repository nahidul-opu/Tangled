From 1733cf35ad639ef832376c926f0a0629c4451adb Mon Sep 17 00:00:00 2001
From: Maarten Coene <maartenc@apache.org>
Date: Wed, 1 Oct 2008 21:12:02 +0000
Subject: [PATCH] Added junit test for IVY-924

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@700929 13f79535-47bb-0310-9956-ffa450edef68
---
 .../IvyAntSettingsBuildFileStackOverflow.xml  | 33 +++++++++++++++++++
 .../ivy/ant/IvyAntSettingsBuildFileTest.java  | 11 +++++++
 2 files changed, 44 insertions(+)
 create mode 100644 test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileStackOverflow.xml

diff --git a/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileStackOverflow.xml b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileStackOverflow.xml
new file mode 100644
index 000000000..9a81c9efc
--- /dev/null
+++ b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileStackOverflow.xml
@@ -0,0 +1,33 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<project xmlns:ivy="antlib:org.apache.ivy.ant" basedir="../../../../../..">
+  <target name="setUp">
+    <property name="ivy.cache.repository" value="build/cache" />
+  </target>
+
+  <target name="tearDown">
+  	<delete dir="build/cache" />
+  </target>
+
+  <target name="testStackOverflow">
+  	<ivy:settings id="ivy.instance" file="test/repositories/ivysettings.xml" />
+  	<ivy:resolve settingsRef="ivy.instance" file="test/java/org/apache/ivy/ant/ivy-simple.xml" />
+  </target>
+
+</project>
\ No newline at end of file
diff --git a/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java
index 9738abd1d..2322ed9e9 100644
--- a/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java
+++ b/test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileTest.java
@@ -49,10 +49,21 @@ public void testUnnecessaryDefaultIvyInstance() {
     }
     
     public void testSettingsWithIdIvyInstance() {
+        // IVY-925
         executeTarget("testSettingsWithPropertyAsId");
         ResolveReport report = (ResolveReport) getProject().getReference("ivy.resolved.report");
         assertNotNull(report);
         assertFalse(report.hasError());
         assertEquals(1, report.getDependencies().size());
     }
+    
+    public void testStackOverflow() {
+        // IVY-924
+        configureProject("test/java/org/apache/ivy/ant/IvyAntSettingsBuildFileStackOverflow.xml");
+        executeTarget("testStackOverflow");
+        ResolveReport report = (ResolveReport) getProject().getReference("ivy.resolved.report");
+        assertNotNull(report);
+        assertFalse(report.hasError());
+        assertEquals(1, report.getDependencies().size());
+    }
 }
