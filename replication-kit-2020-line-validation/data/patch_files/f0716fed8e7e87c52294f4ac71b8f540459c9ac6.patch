From f0716fed8e7e87c52294f4ac71b8f540459c9ac6 Mon Sep 17 00:00:00 2001
From: Benedikt Ritter <britter@apache.org>
Date: Sun, 24 Feb 2013 11:29:04 +0000
Subject: [PATCH] [BEANUTILS-426] - ConstructorUtils.invokeConstructor(Class
 klass, Object arg) throws NullPointerException when arg==null

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/beanutils/trunk@1449456 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                     | 4 ++++
 .../java/org/apache/commons/beanutils/ConstructorUtils.java | 3 +++
 .../apache/commons/beanutils/ConstructorUtilsTestCase.java  | 6 ++++++
 3 files changed, 13 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 10ac83852..4d06ed5d1 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -40,6 +40,10 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
 
     <release version="1.8.4" date="in SVN" description="Bug fix for 1.8.3">
+      <action dev="britter" type="fix" issue="BEANUTILS-426" >
+         ConstructorUtils.invokeConstructor(Class klass, Object arg) throws 
+         NullPointerException when arg==null
+      </action>
       <action dev="niallp" type="fix" issue="BEANUTILS-380" due-to="Brendan Nolan">
          BeanMap methods should initialize the root cause of exceptions that are thrown
          when running on JDK 1.4+
diff --git a/src/main/java/org/apache/commons/beanutils/ConstructorUtils.java b/src/main/java/org/apache/commons/beanutils/ConstructorUtils.java
index 42f4e57e2..daca3c188 100644
--- a/src/main/java/org/apache/commons/beanutils/ConstructorUtils.java
+++ b/src/main/java/org/apache/commons/beanutils/ConstructorUtils.java
@@ -82,6 +82,9 @@ public static Object invokeConstructor(Class klass, Object arg)
             InstantiationException {
 
         Object[] args = { arg };
+        if (arg == null) {
+            args = null;
+        }
         return invokeConstructor(klass, args);
     }
 
diff --git a/src/test/java/org/apache/commons/beanutils/ConstructorUtilsTestCase.java b/src/test/java/org/apache/commons/beanutils/ConstructorUtilsTestCase.java
index 5da4655e7..744471ab8 100644
--- a/src/test/java/org/apache/commons/beanutils/ConstructorUtilsTestCase.java
+++ b/src/test/java/org/apache/commons/beanutils/ConstructorUtilsTestCase.java
@@ -88,6 +88,12 @@ public void testInvokeConstructor() throws Exception {
         }
     }
 
+    public void testInvokeConstructorNull() throws Exception {
+        Object obj = ConstructorUtils.invokeConstructor(TestBean.class, (Object) null);
+        assertNotNull(obj);
+        assertTrue(obj instanceof TestBean);
+    }
+
     public void testInvokeConstructorWithArgArray() throws Exception {
         Object[] args = { new Float(17.3f), "TEST" };
         Object obj = ConstructorUtils.invokeConstructor(TestBean.class,args);
