From 2585da8d157bda7a41c316f58fc25e171f5895c6 Mon Sep 17 00:00:00 2001
From: Emmanuel Bourg <ebourg@apache.org>
Date: Mon, 23 Apr 2007 09:39:29 +0000
Subject: [PATCH] Output flushing in INIConfiguration (CONFIGURATION-267) OS
 specific line separator in INIConfiguration

git-svn-id: https://svn.apache.org/repos/asf/jakarta/commons/proper/configuration/trunk@531399 13f79535-47bb-0310-9956-ffa450edef68
---
 .../configuration/INIConfiguration.java       | 25 +++++++++----------
 xdocs/changes.xml                             |  7 ++++++
 2 files changed, 19 insertions(+), 13 deletions(-)

diff --git a/src/java/org/apache/commons/configuration/INIConfiguration.java b/src/java/org/apache/commons/configuration/INIConfiguration.java
index 1b07d47201..9e712f8f6f 100644
--- a/src/java/org/apache/commons/configuration/INIConfiguration.java
+++ b/src/java/org/apache/commons/configuration/INIConfiguration.java
@@ -173,9 +173,6 @@ public class INIConfiguration extends AbstractFileConfiguration
      */
     protected static final String SEPARATOR_CHARS = "=:";
 
-    /** Constant for the used line separator.*/
-    private static final String LINE_SEPARATOR = "\r\n";
-
     /**
      * Create a new empty INI Configuration.
      */
@@ -227,29 +224,31 @@ public INIConfiguration(URL url) throws ConfigurationException
     public void save(Writer writer) throws ConfigurationException
     {
         PrintWriter pw = new PrintWriter(writer);
-        Iterator iter = this.getSections().iterator();
-        while (iter.hasNext())
+        Iterator it = getSections().iterator();
+        while (it.hasNext())
         {
-            String section = (String) iter.next();
+            String section = (String) it.next();
             pw.print("[");
             pw.print(section);
             pw.print("]");
-            pw.print(LINE_SEPARATOR);
+            pw.println();
 
-            Configuration values = this.subset(section);
-            Iterator iterator = values.getKeys();
-            while (iterator.hasNext())
+            Configuration values = subset(section);
+            Iterator keys = values.getKeys();
+            while (keys.hasNext())
             {
-                String key = (String) iterator.next();
+                String key = (String) keys.next();
                 String value = values.getString(key);
                 pw.print(key);
                 pw.print(" = ");
                 pw.print(formatValue(value));
-                pw.print(LINE_SEPARATOR);
+                pw.println();
             }
 
-            pw.print(LINE_SEPARATOR);
+            pw.println();
         }
+
+        pw.flush();
     }
 
     /**
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index f2d3eb3f5c..e4a4ccaa56 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -23,6 +23,13 @@
 
   <body>
     <release version="1.5-SNAPSHOT" date="in SVN" description="">
+      <action dev="ebourg" type="update">
+        INIConfiguration uses the platform's specific line separator instead
+        of the Windows line separator.
+      </action>
+      <action dev="ebourg" type="fix" issue="CONFIGURATION-267">
+        INIConfiguration flushes the output at the end of a save operation.
+      </action>
       <action dev="oheger" type="update" issue="CONFIGURATION-265">
         For hierarchical file-based configurations the auto-save mechanism is
         now also triggered if a subnode configuration is changed. In such a case
