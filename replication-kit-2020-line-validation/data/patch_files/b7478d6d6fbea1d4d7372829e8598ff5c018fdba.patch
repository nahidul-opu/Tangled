From b7478d6d6fbea1d4d7372829e8598ff5c018fdba Mon Sep 17 00:00:00 2001
From: Scokart Gilles <gscokart@apache.org>
Date: Fri, 16 Nov 2007 16:06:37 +0000
Subject: [PATCH] add test case for IVY-644 (commented out because I don't have
 yet a fix)

git-svn-id: https://svn.apache.org/repos/asf/incubator/ivy/core/trunk@595712 13f79535-47bb-0310-9956-ffa450edef68
---
 .../apache/ivy/core/resolve/ResolveTest.java  | 15 ++++++++
 .../1/IVY-644/M1/ivys/ivy-1.0.xml             | 36 +++++++++++++++++++
 .../1/IVY-644/M2/ivys/ivy-1.0.xml             | 34 ++++++++++++++++++
 .../1/IVY-644/M3/ivys/ivy-1.0.xml             | 34 ++++++++++++++++++
 .../1/IVY-644/M4/ivys/ivy-1.0.xml             | 33 +++++++++++++++++
 .../1/IVY-644/M4/ivys/ivy-1.1.xml             | 33 +++++++++++++++++
 .../1/IVY-644/M4/ivys/ivy-1.2.xml             | 33 +++++++++++++++++
 7 files changed, 218 insertions(+)
 create mode 100755 test/repositories/1/IVY-644/M1/ivys/ivy-1.0.xml
 create mode 100755 test/repositories/1/IVY-644/M2/ivys/ivy-1.0.xml
 create mode 100755 test/repositories/1/IVY-644/M3/ivys/ivy-1.0.xml
 create mode 100755 test/repositories/1/IVY-644/M4/ivys/ivy-1.0.xml
 create mode 100755 test/repositories/1/IVY-644/M4/ivys/ivy-1.1.xml
 create mode 100755 test/repositories/1/IVY-644/M4/ivys/ivy-1.2.xml

diff --git a/test/java/org/apache/ivy/core/resolve/ResolveTest.java b/test/java/org/apache/ivy/core/resolve/ResolveTest.java
index 02005bfe8..7089dd01b 100644
--- a/test/java/org/apache/ivy/core/resolve/ResolveTest.java
+++ b/test/java/org/apache/ivy/core/resolve/ResolveTest.java
@@ -18,6 +18,9 @@
 package org.apache.ivy.core.resolve;
 
 import java.io.File;
+import java.io.IOException;
+import java.net.MalformedURLException;
+import java.text.ParseException;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collection;
@@ -55,7 +58,9 @@
 import org.apache.ivy.plugins.resolver.DualResolver;
 import org.apache.ivy.plugins.resolver.FileSystemResolver;
 import org.apache.ivy.util.CacheCleaner;
+import org.apache.ivy.util.DefaultMessageLogger;
 import org.apache.ivy.util.FileUtil;
+import org.apache.ivy.util.Message;
 import org.apache.tools.ant.Project;
 import org.apache.tools.ant.taskdefs.Delete;
 import org.xml.sax.SAXException;
@@ -1748,6 +1753,16 @@ public void testEvictWithConfInMultiConf2() throws Exception {
                 .newInstance("org5", "mod5.1", "4.2")).length);
     }
 
+    /*
+    public void testMultipleEviction() throws Exception {
+        
+        ResolveReport report = ivy.resolve(
+            new File("test/repositories/1/IVY-644/M1/ivys/ivy-1.0.xml").toURL(),
+            getResolveOptions(new String[] {"*"}));
+        assertFalse(report.hasError());
+    }
+    */
+    
     public void testResolveForce() throws Exception {
         // mod4.1 v 4.2 depends on
         // - mod1.2 v 2.0 and forces it
diff --git a/test/repositories/1/IVY-644/M1/ivys/ivy-1.0.xml b/test/repositories/1/IVY-644/M1/ivys/ivy-1.0.xml
new file mode 100755
index 000000000..2f493b440
--- /dev/null
+++ b/test/repositories/1/IVY-644/M1/ivys/ivy-1.0.xml
@@ -0,0 +1,36 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="IVY-644"
+	       module="M1"
+	       revision="1.0"
+	       status="integration"
+	       publication="20041201120000"
+	/>
+	<configurations>
+		<conf name="test" extends="runtime"/>
+		<conf name="runtime"/>
+	</configurations>
+	<publications/>
+	<dependencies>
+		<dependency name="M2" rev="1.0" conf="runtime->runtime"/>
+		<dependency name="M3" rev="1.0" conf="test->runtime"/>
+		<dependency name="M4" rev="1.1" conf="test->runtime"/>
+	</dependencies>
+</ivy-module>
diff --git a/test/repositories/1/IVY-644/M2/ivys/ivy-1.0.xml b/test/repositories/1/IVY-644/M2/ivys/ivy-1.0.xml
new file mode 100755
index 000000000..0fc79ecfc
--- /dev/null
+++ b/test/repositories/1/IVY-644/M2/ivys/ivy-1.0.xml
@@ -0,0 +1,34 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="IVY-644"
+	       module="M2"
+	       revision="1.0"
+	       status="integration"
+	       publication="20041201120000"
+	/>
+	<configurations>
+		<conf name="runtime" extends="compile"/>
+		<conf name="compile"/>
+	</configurations>
+	<publications/>
+	<dependencies>
+		<dependency name="M4" rev="1.0" conf="compile->compile;runtime->runtime"/>
+	</dependencies>
+</ivy-module>
diff --git a/test/repositories/1/IVY-644/M3/ivys/ivy-1.0.xml b/test/repositories/1/IVY-644/M3/ivys/ivy-1.0.xml
new file mode 100755
index 000000000..73fe3a7cc
--- /dev/null
+++ b/test/repositories/1/IVY-644/M3/ivys/ivy-1.0.xml
@@ -0,0 +1,34 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="IVY-644"
+	       module="M3"
+	       revision="1.0"
+	       status="integration"
+	       publication="20041201120000"
+	/>
+	<configurations>
+		<conf name="runtime" extends="compile"/>
+		<conf name="compile"/>
+	</configurations>
+	<publications/>
+	<dependencies>
+		<dependency name="M4" rev="1.2" conf="compile->compile;runtime->runtime"/>
+	</dependencies>
+</ivy-module>
diff --git a/test/repositories/1/IVY-644/M4/ivys/ivy-1.0.xml b/test/repositories/1/IVY-644/M4/ivys/ivy-1.0.xml
new file mode 100755
index 000000000..b90f79bdc
--- /dev/null
+++ b/test/repositories/1/IVY-644/M4/ivys/ivy-1.0.xml
@@ -0,0 +1,33 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="IVY-644"
+	       module="M4"
+	       revision="1.0"
+	       status="integration"
+	       publication="20041201120000"
+	/>
+	<configurations>
+		<conf name="runtime" extends="compile"/>
+		<conf name="compile"/>
+	</configurations>
+	<publications/>
+	<dependencies>
+	</dependencies>
+</ivy-module>
diff --git a/test/repositories/1/IVY-644/M4/ivys/ivy-1.1.xml b/test/repositories/1/IVY-644/M4/ivys/ivy-1.1.xml
new file mode 100755
index 000000000..6d0bf85cf
--- /dev/null
+++ b/test/repositories/1/IVY-644/M4/ivys/ivy-1.1.xml
@@ -0,0 +1,33 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="IVY-644"
+	       module="M4"
+	       revision="1.1"
+	       status="integration"
+	       publication="20041201120000"
+	/>
+	<configurations>
+		<conf name="runtime" extends="compile"/>
+		<conf name="compile"/>
+	</configurations>
+	<publications/>
+	<dependencies>
+	</dependencies>
+</ivy-module>
diff --git a/test/repositories/1/IVY-644/M4/ivys/ivy-1.2.xml b/test/repositories/1/IVY-644/M4/ivys/ivy-1.2.xml
new file mode 100755
index 000000000..7bd93541b
--- /dev/null
+++ b/test/repositories/1/IVY-644/M4/ivys/ivy-1.2.xml
@@ -0,0 +1,33 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one
+   or more contributor license agreements.  See the NOTICE file
+   distributed with this work for additional information
+   regarding copyright ownership.  The ASF licenses this file
+   to you under the Apache License, Version 2.0 (the
+   "License"); you may not use this file except in compliance
+   with the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing,
+   software distributed under the License is distributed on an
+   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+   KIND, either express or implied.  See the License for the
+   specific language governing permissions and limitations
+   under the License.    
+-->
+<ivy-module version="1.0"> 
+	<info organisation="IVY-644"
+	       module="M4"
+	       revision="1.2"
+	       status="integration"
+	       publication="20041201120000"
+	/>
+	<configurations>
+		<conf name="runtime" extends="compile"/>
+		<conf name="compile"/>
+	</configurations>
+	<publications/>
+	<dependencies>
+	</dependencies>
+</ivy-module>
