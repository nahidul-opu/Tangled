From 2ff4c4686bd5f50f0304eaeeb58231d1b8257047 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Wed, 12 Mar 2008 21:03:47 +0000
Subject: [PATCH] Add a fix for UNKNOWN Type: L8 SYST messages (NET-169)

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@636508 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/commons/net/ftp/FTPClientConfig.java  | 8 ++++++++
 .../net/ftp/parser/DefaultFTPFileEntryParserFactory.java  | 3 ++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/java/org/apache/commons/net/ftp/FTPClientConfig.java b/src/java/org/apache/commons/net/ftp/FTPClientConfig.java
index b7876c262..0d7ffe6d3 100644
--- a/src/java/org/apache/commons/net/ftp/FTPClientConfig.java
+++ b/src/java/org/apache/commons/net/ftp/FTPClientConfig.java
@@ -177,6 +177,14 @@ public class FTPClientConfig
      */
     public static final String SYST_MVS = "MVS";
 
+    /**
+     * Some servers return an "UNKNOWN Type: L8" message
+     * in response to the SYST command. We set these to be a Unix-type system.
+     * This may happen if the ftpd in question was compiled without system
+     * information.
+     */
+    public static final String SYST_L8 = "Type: L8";
+
     /**
      * Identifier by which an Netware-based ftp server is known throughout
      * the commons-net ftp system.
diff --git a/src/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java b/src/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java
index eb71d9a89..1ada09286 100644
--- a/src/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java
+++ b/src/java/org/apache/commons/net/ftp/parser/DefaultFTPFileEntryParserFactory.java
@@ -92,7 +92,8 @@ public FTPFileEntryParser createFileEntryParser(String key)
 	            {
 	                ukey = key.toUpperCase();
 	            }
-	            if (ukey.indexOf(FTPClientConfig.SYST_UNIX) >= 0)
+	            if (ukey.indexOf(FTPClientConfig.SYST_UNIX) >= 0
+	                    || (ukey.indexOf(FTPClientConfig.SYST_L8) >= 0))
 	            {
 	                parser = createUnixFTPEntryParser();
 	            }
