From 29db3b8d20363eddc3d63138eb4c171a38026a08 Mon Sep 17 00:00:00 2001
From: Nick Burch <nick@apache.org>
Date: Fri, 27 May 2011 17:03:51 +0000
Subject: [PATCH] VALIDATOR-288 - Update DomainValidator to accept a machine
 name when local addresses are allowed

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/validator/trunk@1128395 13f79535-47bb-0310-9956-ffa450edef68
---
 .../apache/commons/validator/routines/DomainValidator.java | 7 ++++++-
 .../commons/validator/routines/DomainValidatorTest.java    | 2 ++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/apache/commons/validator/routines/DomainValidator.java b/src/main/java/org/apache/commons/validator/routines/DomainValidator.java
index 0830ea2ea..4cab4be0f 100644
--- a/src/main/java/org/apache/commons/validator/routines/DomainValidator.java
+++ b/src/main/java/org/apache/commons/validator/routines/DomainValidator.java
@@ -87,6 +87,11 @@ public class DomainValidator implements Serializable {
      */
     private final RegexValidator domainRegex =
             new RegexValidator(DOMAIN_NAME_REGEX);
+    /**
+     * RegexValidator for matching the a local hostname
+     */
+    private final RegexValidator hostnameRegex =
+            new RegexValidator(DOMAIN_LABEL_REGEX);
 
     /**
      * Returns the singleton instance of this validator. It
@@ -126,7 +131,7 @@ public boolean isValid(String domain) {
         if (groups != null && groups.length > 0) {
             return isValidTld(groups[0]);
         } else if(allowLocal) {
-            if ("localhost".equals(domain)) {
+            if (hostnameRegex.isValid(domain)) {
                return true;
             }
         }
diff --git a/src/test/java/org/apache/commons/validator/routines/DomainValidatorTest.java b/src/test/java/org/apache/commons/validator/routines/DomainValidatorTest.java
index 9f4e2eccd..b089e68f5 100644
--- a/src/test/java/org/apache/commons/validator/routines/DomainValidatorTest.java
+++ b/src/test/java/org/apache/commons/validator/routines/DomainValidatorTest.java
@@ -99,6 +99,8 @@ public void testAllowLocal() {
        // But it may be requested
        assertTrue("localhost.localdomain should validate", allowLocal.isValid("localhost.localdomain"));
        assertTrue("localhost should validate", allowLocal.isValid("localhost"));
+       assertTrue("hostname should validate", allowLocal.isValid("hostname"));
+       assertTrue("machinename should validate", allowLocal.isValid("machinename"));
        
        // Check the localhost one with a few others
        assertTrue("apache.org should validate", allowLocal.isValid("apache.org"));
