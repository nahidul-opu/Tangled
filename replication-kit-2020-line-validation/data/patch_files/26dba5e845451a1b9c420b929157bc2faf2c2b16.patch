From 26dba5e845451a1b9c420b929157bc2faf2c2b16 Mon Sep 17 00:00:00 2001
From: "Gary D. Gregory" <ggregory@apache.org>
Date: Mon, 16 Apr 2012 19:34:53 +0000
Subject: [PATCH] IO-319 document behavior with size > long and stop counting
 when long is < 0.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1326766 13f79535-47bb-0310-9956-ffa450edef68
---
 src/main/java/org/apache/commons/io/FileUtils.java | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/src/main/java/org/apache/commons/io/FileUtils.java b/src/main/java/org/apache/commons/io/FileUtils.java
index 3ea6f56d381..b9372d08a4d 100644
--- a/src/main/java/org/apache/commons/io/FileUtils.java
+++ b/src/main/java/org/apache/commons/io/FileUtils.java
@@ -2353,10 +2353,13 @@ public static long sizeOf(File file) {
 
     /**
      * Counts the size of a directory recursively (sum of the length of all files).
-     *
-     * @param directory  directory to inspect, must not be {@code null}
-     * @return size of directory in bytes, 0 if directory is security restricted
-     * @throws NullPointerException if the directory is {@code null}
+     * 
+     * @param directory
+     *            directory to inspect, must not be {@code null}
+     * @return size of directory in bytes, 0 if directory is security restricted, a negative number when the real total
+     *         is greater than {@link Long#MAX_VALUE}.
+     * @throws NullPointerException
+     *             if the directory is {@code null}
      */
     public static long sizeOfDirectory(File directory) {
         if (!directory.exists()) {
@@ -2377,6 +2380,9 @@ public static long sizeOfDirectory(File directory) {
             try {
                 if (!isSymlink(file)) {
                     size += sizeOf(file);
+                    if (size < 0) {
+                        break;
+                    }
                 }
             } catch (IOException ioe) {
                 // Ignore exceptions caught when asking if a File is a symlink.
