From ea33beff535a67023a743bbade1127bde66191ee Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Mon, 21 Jan 2008 08:38:41 +0000
Subject: [PATCH] FIX: NPE in SshCache during publish with ssh resolver without
 passFile (IVY-709) (thanks to Ruslan Shevchenko)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@613795 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                                  | 2 ++
 src/java/org/apache/ivy/plugins/repository/ssh/SshCache.java | 4 +++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/CHANGES.txt b/CHANGES.txt
index 744155972..c533af3ef 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -51,6 +51,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 	Geoff Reedy
 	Christian Riege
 	Andreas Sahlbach
+	Ruslan Shevchenko
 	John Shields
 	Johan Stuyts
 	Jason Trump
@@ -74,6 +75,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Downgrade Ant version requirement to 1.6 to build Ivy (IVY-687)
 - IMPROVEMENT: In the ResolveReport class, add the possibility to filter the evicted module while getting the list of DownloadArtifact (IVY-704) (thanks to Nicolas Lalevée)
 
+- FIX: NPE in SshCache during publish with ssh resolver without passFile (IVY-709) (thanks to Ruslan Shevchenko)
 - FIX: Update install ivy build file example (IVY-705) (thanks to Benjamin Francisoud)
 - FIX: Ivy swallows ParseException when using a latest strategy requiring module descriptors (IVY-702) (thanks to Nicolas Lalevée)
 - FIX: Problem with cached Ivy files which have extra attributes (IVY-693)
diff --git a/src/java/org/apache/ivy/plugins/repository/ssh/SshCache.java b/src/java/org/apache/ivy/plugins/repository/ssh/SshCache.java
index 9f5415c89..7f05235a1 100644
--- a/src/java/org/apache/ivy/plugins/repository/ssh/SshCache.java
+++ b/src/java/org/apache/ivy/plugins/repository/ssh/SshCache.java
@@ -327,8 +327,10 @@ public Session getSession(String host, int port, String username, String userPas
                 Message.verbose(":: SSH :: connected to " + host + "!");
                 setSession(username, host, port, session);
             } catch (JSchException e) {
-                if (passFile.exists()) {
+                if (passFile!=null) {
+                  if (passFile.exists()) {
                     passFile.delete();
+                  }
                 }
                 IOException ex = new IOException(e.getMessage());
                 ex.initCause(e);
