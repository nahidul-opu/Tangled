From 120091511f4729441541cd764414fb52a34889b2 Mon Sep 17 00:00:00 2001
From: Claudio Martella <claudio.martella@gmail.com>
Date: Wed, 9 Apr 2014 14:48:16 +0200
Subject: [PATCH] GIRAPH-884

---
 CHANGELOG                                                  | 3 +++
 .../main/java/org/apache/giraph/edge/ByteArrayEdges.java   | 7 ++++++-
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index 7c7a0aadc..b1c45d705 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,9 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-884: ByteArrayEdges.iterator() throws NPE when no edges are present
+  (cmuchinsky via claudio)
+
   GIRAPH-872: Minor inconsistencies with netty handler logic after netty 4 upgrade
   (cmuchinsky via claudio)
 
diff --git a/giraph-core/src/main/java/org/apache/giraph/edge/ByteArrayEdges.java b/giraph-core/src/main/java/org/apache/giraph/edge/ByteArrayEdges.java
index b9d1f6cde..3f69c5c73 100644
--- a/giraph-core/src/main/java/org/apache/giraph/edge/ByteArrayEdges.java
+++ b/giraph-core/src/main/java/org/apache/giraph/edge/ByteArrayEdges.java
@@ -18,6 +18,7 @@
 
 package org.apache.giraph.edge;
 
+import com.google.common.collect.Iterators;
 import com.google.common.collect.UnmodifiableIterator;
 import org.apache.giraph.utils.ExtendedDataInput;
 import org.apache.giraph.utils.ExtendedDataOutput;
@@ -164,7 +165,11 @@ public Edge<I, E> next() {
 
   @Override
   public Iterator<Edge<I, E>> iterator() {
-    return new ByteArrayEdgeIterator();
+    if (edgeCount == 0) {
+      return Iterators.emptyIterator();
+    } else {
+      return new ByteArrayEdgeIterator();
+    }
   }
 
   @Override
