From 96e16497119db404a4e59709e022d4f9564d23e6 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Sat, 11 Jun 2016 00:57:57 +0000
Subject: [PATCH] NET-592 plainSocket in FTPSClient is never closed

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@1747829 13f79535-47bb-0310-9956-ffa450edef68
---
 src/changes/changes.xml                                  | 5 +++++
 src/main/java/org/apache/commons/net/ftp/FTPSClient.java | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 6416ac02d..0ca0f59e1 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -63,6 +63,11 @@ The <action> type attribute can be add,update,fix,remove.
      -->
 
     <body>
+        <release version="3.6" date="TBA" description="">
+            <action issue="NET-592" type="fix" dev="sebb" due-to="Mark Ford">
+            plainSocket in FTPSClient is never closed
+            </action>
+        </release>
         <release version="3.5" date="2016-05-05" description="
 This is mainly a bug-fix release. See further details below.
 
diff --git a/src/main/java/org/apache/commons/net/ftp/FTPSClient.java b/src/main/java/org/apache/commons/net/ftp/FTPSClient.java
index 71c0ec239..a0f8b635f 100644
--- a/src/main/java/org/apache/commons/net/ftp/FTPSClient.java
+++ b/src/main/java/org/apache/commons/net/ftp/FTPSClient.java
@@ -747,6 +747,9 @@ public void setEndpointCheckingEnabled(boolean enable)
     public void disconnect() throws IOException
     {
         super.disconnect();
+        if (plainSocket != null) {
+            plainSocket.close();
+        }
         setSocketFactory(null);
         setServerSocketFactory(null);
     }
