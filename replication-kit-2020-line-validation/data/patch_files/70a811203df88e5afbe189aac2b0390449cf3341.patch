From 70a811203df88e5afbe189aac2b0390449cf3341 Mon Sep 17 00:00:00 2001
From: Avery Ching <aching@apache.org>
Date: Sat, 1 Oct 2011 18:25:37 +0000
Subject: [PATCH] GIRAPH-46: Race condition on superstep 1 with RPC servers not
 started by the time that requests are sent. (aching)

git-svn-id: https://svn.apache.org/repos/asf/incubator/giraph/trunk@1178065 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGELOG                                              | 3 +++
 src/main/java/org/apache/giraph/graph/GraphMapper.java | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index baca5ccea..0c71032c1 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -2,6 +2,9 @@ Giraph Change Log
 
 Release 0.70.0 - unreleased
 
+  GIRAPH-46: Race condition on superstep 1 with RPC servers not
+  started by the time that requests are sent. (aching)
+
   GIRAPH-21: Revise CODE_CONVENTIONS. (aching via jghoman)
 
   GIRAPH-39: mvn rat doesn't like .git or .idea. (jghoman)
diff --git a/src/main/java/org/apache/giraph/graph/GraphMapper.java b/src/main/java/org/apache/giraph/graph/GraphMapper.java
index 8525c74e5..850703bcf 100644
--- a/src/main/java/org/apache/giraph/graph/GraphMapper.java
+++ b/src/main/java/org/apache/giraph/graph/GraphMapper.java
@@ -562,7 +562,7 @@ public void map(Object key, Object value, Context context)
                           " maxMem=" + Runtime.getRuntime().maxMemory() +
                           " freeMem=" + Runtime.getRuntime().freeMemory());
             }
-            if ((superstep > BspService.INPUT_SUPERSTEP) &&
+            if ((superstep >= BspService.INPUT_SUPERSTEP) &&
                     (commService == null)) {
                 if (LOG.isInfoEnabled()) {
                     LOG.info("map: Starting communication service on " +
