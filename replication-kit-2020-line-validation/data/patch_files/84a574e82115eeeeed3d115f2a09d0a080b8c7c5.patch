From 84a574e82115eeeeed3d115f2a09d0a080b8c7c5 Mon Sep 17 00:00:00 2001
From: Sebastian Bazley <sebb@apache.org>
Date: Sun, 6 Apr 2008 22:55:39 +0000
Subject: [PATCH] NET-195 - fix incorrect double-checked locking

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@645324 13f79535-47bb-0310-9956-ffa450edef68
---
 .../org/apache/commons/net/ntp/NtpV3Impl.java     | 15 ++++++---------
 1 file changed, 6 insertions(+), 9 deletions(-)

diff --git a/src/java/org/apache/commons/net/ntp/NtpV3Impl.java b/src/java/org/apache/commons/net/ntp/NtpV3Impl.java
index c59e495cb..e388b79fb 100644
--- a/src/java/org/apache/commons/net/ntp/NtpV3Impl.java
+++ b/src/java/org/apache/commons/net/ntp/NtpV3Impl.java
@@ -507,15 +507,12 @@ private void setTimestamp(int index, TimeStamp t)
      *
      * @return a datagram packet.
      */
-    public DatagramPacket getDatagramPacket()
-    {
-        if (dp == null)
-            synchronized(this) {
-                if (dp == null) {
-                    dp = new DatagramPacket(buf, buf.length);
-                    dp.setPort(NTP_PORT);
-                }
-            }
+    public synchronized DatagramPacket getDatagramPacket()
+    {
+        if (dp == null) {
+            dp = new DatagramPacket(buf, buf.length);
+            dp.setPort(NTP_PORT);
+        }
         return dp;
     }
 
