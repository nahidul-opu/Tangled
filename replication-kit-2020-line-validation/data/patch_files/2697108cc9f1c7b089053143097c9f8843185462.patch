From 2697108cc9f1c7b089053143097c9f8843185462 Mon Sep 17 00:00:00 2001
From: Thomas Neidhart <tn@apache.org>
Date: Sat, 17 Mar 2012 18:32:14 +0000
Subject: [PATCH] Added unit test for CODEC-130.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/codec/trunk@1301974 13f79535-47bb-0310-9956-ffa450edef68
---
 .../codec/binary/Base64InputStreamTest.java   | 31 +++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/src/test/java/org/apache/commons/codec/binary/Base64InputStreamTest.java b/src/test/java/org/apache/commons/codec/binary/Base64InputStreamTest.java
index 39f60135b9..7cc02bcd03 100644
--- a/src/test/java/org/apache/commons/codec/binary/Base64InputStreamTest.java
+++ b/src/test/java/org/apache/commons/codec/binary/Base64InputStreamTest.java
@@ -24,13 +24,16 @@
 import static org.junit.Assert.assertTrue;
 import static org.junit.Assert.fail;
 
+import java.io.BufferedInputStream;
 import java.io.BufferedReader;
 import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.util.Arrays;
 
+import org.junit.Ignore;
 import org.junit.Test;
 
 /**
@@ -50,6 +53,34 @@ public class Base64InputStreamTest {
 
     private static final String STRING_FIXTURE = "Hello World";
 
+    /**
+     * Tests the problem reported in CODEC-130. Missing / wrong implementation of skip.
+     */
+    @Test
+    @Ignore
+    public void testCodec130() throws IOException {
+        ByteArrayOutputStream bos = new ByteArrayOutputStream();
+        Base64OutputStream base64os = new Base64OutputStream(bos);
+
+        base64os.write("Hello World!".getBytes());
+
+        ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
+        Base64InputStream ins = new Base64InputStream(bis);
+
+        // we skip the first character read from the reader
+        ins.skip(1);
+        StringBuffer sb = new StringBuffer();
+        int len = 0;
+        byte[] bytes = new byte[10];
+        while ((len = ins.read(bytes)) != -1) {
+            String s = new String(bytes, 0, len, "iso-8859-1");
+            sb.append(s);
+        }
+        String str = sb.toString();
+
+        assertEquals("ello World!", str);
+    }
+
     /**
      * Tests the bug reported in CODEC-105. Bad interactions with InputStream when reading one byte at a time.
      */
