From 5fadda0b684403742e4f41ca811e925a81a246d4 Mon Sep 17 00:00:00 2001
From: Ralph Goers <rgoers@apache.org>
Date: Sun, 25 Sep 2011 22:52:08 +0000
Subject: [PATCH] Fix VFS-355 - The read method of RamFileRandomAccessContent's
 input stream does not return -1 at eof.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@1175615 13f79535-47bb-0310-9956-ffa450edef68
---
 .../vfs2/provider/ram/RamFileRandomAccessContent.java     | 8 ++++++--
 src/changes/changes.xml                                   | 3 +++
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileRandomAccessContent.java b/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileRandomAccessContent.java
index 78461e4fa7..2d51be4dd1 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileRandomAccessContent.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/ram/RamFileRandomAccessContent.java
@@ -121,8 +121,12 @@ public int read(byte[] b) throws IOException
             @Override
             public int read(byte[] b, int off, int len) throws IOException
             {
-                int retLen = Math.min(len, getLeftBytes());
-                RamFileRandomAccessContent.this.readFully(b, off, retLen);
+                int retLen = -1;
+                final int left = getLeftBytes();
+                if (left > 0) {
+                    retLen = Math.min(len, left);
+                    RamFileRandomAccessContent.this.readFully(b, off, retLen);
+                }
                 return retLen;
             }
 
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 7360c65c42..37105a47b4 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="2.1" date="TBD" description="">
+      <action issue="VFS-355" dev="rgoers" type="fix" due-to="Miroslav Pokorny">
+        The read method of RamFileRandomAccessContent's input stream does not return -1 at eof.
+      </action>
       <action issue="VFS-356" dev="rgoers" type="fix">
         Throw an IOException if an attempt is made to seek to a position before the start of the file.
       </action>
