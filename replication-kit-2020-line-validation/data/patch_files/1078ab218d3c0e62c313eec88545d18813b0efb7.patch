From 1078ab218d3c0e62c313eec88545d18813b0efb7 Mon Sep 17 00:00:00 2001
From: Rory Winston <rwinston@apache.org>
Date: Sun, 16 Mar 2008 20:19:52 +0000
Subject: [PATCH] NET-201

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/net/trunk@637643 13f79535-47bb-0310-9956-ffa450edef68
---
 .../apache/commons/net/ftp/parser/UnixFTPEntryParser.java | 2 +-
 .../commons/net/ftp/parser/UnixFTPEntryParserTest.java    | 8 +++++---
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java b/src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
index 5a08a7443..713152563 100644
--- a/src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
+++ b/src/java/org/apache/commons/net/ftp/parser/UnixFTPEntryParser.java
@@ -91,7 +91,7 @@ public class UnixFTPEntryParser extends ConfigurableFTPFileEntryParserImpl
         + "(\\d+)\\s+"
         + "(\\S+)\\s+"
         + "(?:(\\S+(?:\\s\\S+)*)\\s+)?"
-        + "(\\d+)\\s+"
+        + "(\\d+(?:,\\s*\\d+)?)\\s+"
         
         /*
           numeric or standard format date
diff --git a/src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java b/src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
index cc80e032c..aad5421d9 100644
--- a/src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
+++ b/src/test/org/apache/commons/net/ftp/parser/UnixFTPEntryParserTest.java
@@ -72,7 +72,9 @@ public class UnixFTPEntryParserTest extends FTPParseTestFramework {
 			"drwxrwx---+ 23 500     500    0 Jan 10 13:09 testACL",
 			"-rw-r--r--   1 1        3518644 May 25 12:12 std",
             "lrwxrwxrwx   1 neeme neeme             23 Mar  2 18:06 macros -> ./../../global/macros/.",
-			"-rw-r--r--   1 ftp      group with spaces in it as allowed in cygwin see bug 38634   83853 Jan 22  2001 zxJDBC-1.2.4.tar.gz"
+			"-rw-r--r--   1 ftp      group with spaces in it as allowed in cygwin see bug 38634   83853 Jan 22  2001 zxJDBC-1.2.4.tar.gz",
+			"crw-r----- 1 root kmem 0, 27 Jan 30 11:42 kmem",  //FreeBSD device
+			"crw-------   1 root     sys      109,767 Jul  2  2004 pci@1c,600000:devctl" //Solaris device
 
 
 		};
@@ -283,8 +285,8 @@ protected void doAdditionalGoodTests(String test, FTPFile f) {
                 int pos = 3*access + perm + 1;
                 char permchar = test.charAt(pos);
                 assertEquals("Permission " + test.substring(1,10), 
-                        f.hasPermission(access, perm), 
-                        permchar != '-' && !Character.isUpperCase(permchar)); 
+                        new Boolean(f.hasPermission(access, perm)), 
+                        new Boolean(permchar != '-' && !Character.isUpperCase(permchar))); 
             }
         }
 
