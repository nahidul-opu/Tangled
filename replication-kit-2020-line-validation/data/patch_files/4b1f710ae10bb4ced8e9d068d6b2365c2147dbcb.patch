From 4b1f710ae10bb4ced8e9d068d6b2365c2147dbcb Mon Sep 17 00:00:00 2001
From: Ralph Goers <rgoers@apache.org>
Date: Wed, 22 Apr 2009 06:02:32 +0000
Subject: [PATCH] Fix VFS-243. Check that skip worked properly.

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/vfs/trunk@767384 13f79535-47bb-0310-9956-ffa450edef68
---
 .../vfs/provider/http/HttpRandomAccessContent.java     | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/core/src/main/java/org/apache/commons/vfs/provider/http/HttpRandomAccessContent.java b/core/src/main/java/org/apache/commons/vfs/provider/http/HttpRandomAccessContent.java
index 07a2c4eb2f..3ca4a7fb62 100644
--- a/core/src/main/java/org/apache/commons/vfs/provider/http/HttpRandomAccessContent.java
+++ b/core/src/main/java/org/apache/commons/vfs/provider/http/HttpRandomAccessContent.java
@@ -97,7 +97,15 @@ protected DataInputStream getDataInputStream() throws IOException
         // If the range request was ignored
         if (status == HttpURLConnection.HTTP_OK)
         {
-            mis.skip(filePointer);
+            long skipped = mis.skip(filePointer);
+            if (skipped != filePointer)
+            {
+                throw new FileSystemException("vfs.provider.http/get-range.error", new Object[]
+                {
+                    fileObject.getName(),
+                    new Long(filePointer)
+                });
+            }
         }
         dis = new DataInputStream(new FilterInputStream(mis)
         {
