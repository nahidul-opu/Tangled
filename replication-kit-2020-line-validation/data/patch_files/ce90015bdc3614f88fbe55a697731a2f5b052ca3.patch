From ce90015bdc3614f88fbe55a697731a2f5b052ca3 Mon Sep 17 00:00:00 2001
From: Niall Pemberton <niallp@apache.org>
Date: Fri, 30 May 2008 11:06:07 +0000
Subject: [PATCH] IO-167 Fix case-insensitive string handling - thanks to
 Benjamin Bentmann for the patch

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@661646 13f79535-47bb-0310-9956-ffa450edef68
---
 src/java/org/apache/commons/io/FileSystemUtils.java         | 5 +++--
 src/test/org/apache/commons/io/FileSystemUtilsTestCase.java | 5 +++--
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/src/java/org/apache/commons/io/FileSystemUtils.java b/src/java/org/apache/commons/io/FileSystemUtils.java
index 941819dc690..ac26225dcf9 100644
--- a/src/java/org/apache/commons/io/FileSystemUtils.java
+++ b/src/java/org/apache/commons/io/FileSystemUtils.java
@@ -24,6 +24,7 @@
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
+import java.util.Locale;
 import java.util.StringTokenizer;
 
 /**
@@ -76,7 +77,7 @@ public class FileSystemUtils {
             if (osName == null) {
                 throw new IOException("os.name not found");
             }
-            osName = osName.toLowerCase();
+            osName = osName.toLowerCase(Locale.ENGLISH);
             // match
             if (osName.indexOf("windows") != -1) {
                 os = WINDOWS;
@@ -417,7 +418,7 @@ List<String> performCommand(String[] cmdAttribs, int max) throws IOException {
             inr = new BufferedReader(new InputStreamReader(in));
             String line = inr.readLine();
             while (line != null && lines.size() < max) {
-                line = line.toLowerCase().trim();
+                line = line.toLowerCase(Locale.ENGLISH).trim();
                 lines.add(line);
                 line = inr.readLine();
             }
diff --git a/src/test/org/apache/commons/io/FileSystemUtilsTestCase.java b/src/test/org/apache/commons/io/FileSystemUtilsTestCase.java
index 840bfbe81d3..9613a12729c 100644
--- a/src/test/org/apache/commons/io/FileSystemUtilsTestCase.java
+++ b/src/test/org/apache/commons/io/FileSystemUtilsTestCase.java
@@ -23,6 +23,7 @@
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.io.OutputStream;
+import java.util.Locale;
 
 import junit.framework.Test;
 import junit.framework.TestSuite;
@@ -68,7 +69,7 @@ public void testGetFreeSpace_String() throws Exception {
             // have to figure out unix block size
             String[] cmd = null;
             String osName = System.getProperty("os.name");
-            osName = osName.toLowerCase();
+            osName = osName.toLowerCase(Locale.ENGLISH);
 
             if (osName.indexOf("hp-ux") >= 0 || osName.indexOf("aix") >= 0) {
                 cmd = new String[] {"df", "-P", "/"};
@@ -84,7 +85,7 @@ public void testGetFreeSpace_String() throws Exception {
             try {
                 r = new BufferedReader(new InputStreamReader(proc.getInputStream()));
                 String line = r.readLine();
-                if (line.toLowerCase().indexOf("512") >= 0) {
+                if (line.indexOf("512") >= 0) {
                     kilobyteBlock = false;
                 }
             } finally {
