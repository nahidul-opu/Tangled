From 02852f48243245666c0ccf4d0b8dd455d2747fd3 Mon Sep 17 00:00:00 2001
From: Romain Manni-Bucau <rmannibucau@apache.org>
Date: Fri, 23 Jun 2017 15:36:24 +0000
Subject: [PATCH] JCS-180 if there is no argument we don't want to fail with a
 npe in CacheInvocationContextImpl

git-svn-id: https://svn.apache.org/repos/asf/commons/proper/jcs/trunk@1799682 13f79535-47bb-0310-9956-ffa450edef68
---
 .../jcs/jcache/cdi/CacheInvocationContextImpl.java       | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/commons-jcs-jcache/src/main/java/org/apache/commons/jcs/jcache/cdi/CacheInvocationContextImpl.java b/commons-jcs-jcache/src/main/java/org/apache/commons/jcs/jcache/cdi/CacheInvocationContextImpl.java
index 27fe8c08a..8cf4614a9 100644
--- a/commons-jcs-jcache/src/main/java/org/apache/commons/jcs/jcache/cdi/CacheInvocationContextImpl.java
+++ b/commons-jcs-jcache/src/main/java/org/apache/commons/jcs/jcache/cdi/CacheInvocationContextImpl.java
@@ -18,16 +18,18 @@
  */
 package org.apache.commons.jcs.jcache.cdi;
 
-import java.lang.annotation.Annotation;
-import java.util.HashSet;
 import javax.cache.annotation.CacheInvocationContext;
 import javax.cache.annotation.CacheInvocationParameter;
 import javax.interceptor.InvocationContext;
+import java.lang.annotation.Annotation;
+import java.util.HashSet;
 
 import static java.util.Arrays.asList;
 
 public class CacheInvocationContextImpl<A extends Annotation> extends CacheMethodDetailsImpl<A> implements CacheInvocationContext<A>
 {
+    private static final Object[] EMPTY_ARGS = new Object[0];
+
     private CacheInvocationParameter[] parameters = null;
 
     public CacheInvocationContextImpl(final InvocationContext delegate, final A cacheAnnotation, final String cacheName)
@@ -63,7 +65,8 @@ public <T> T unwrap(final Class<T> cls)
 
     protected CacheInvocationParameter[] doGetAllParameters(final Integer[] indexes)
     {
-        final Object[] args = delegate.getParameters();
+        final Object[] parameters = delegate.getParameters();
+        final Object[] args = parameters == null ? EMPTY_ARGS : parameters;
         final Class<?>[] parameterTypes = getMethod().getParameterTypes();
         final Annotation[][] parameterAnnotations = getMethod().getParameterAnnotations();
 
