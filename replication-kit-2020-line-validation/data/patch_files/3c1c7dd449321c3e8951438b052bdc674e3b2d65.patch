From 3c1c7dd449321c3e8951438b052bdc674e3b2d65 Mon Sep 17 00:00:00 2001
From: Xavier Hanin <xavier@apache.org>
Date: Sat, 26 Jan 2008 11:37:13 +0000
Subject: [PATCH] FIX: NPE when calling retrieve if some artifacts are not
 available locally (IVY-712)

git-svn-id: https://svn.apache.org/repos/asf/ant/ivy/core/trunk@615446 13f79535-47bb-0310-9956-ffa450edef68
---
 CHANGES.txt                                               | 1 +
 src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/CHANGES.txt b/CHANGES.txt
index 3d94d9745..92652df03 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -76,6 +76,7 @@ for detailed view of each issue, please consult http://issues.apache.org/jira/br
 - IMPROVEMENT: Downgrade Ant version requirement to 1.6 to build Ivy (IVY-687)
 - IMPROVEMENT: In the ResolveReport class, add the possibility to filter the evicted module while getting the list of DownloadArtifact (IVY-704) (thanks to Nicolas Lalevée)
 
+- FIX: NPE when calling retrieve if some artifacts are not available locally (IVY-712)
 - FIX: When in ssh plugin we does not set username in scheme, Ivy always try to connect with guest username, even if we change one in panel. (IVY-710) (thanks to Ruslan Shevchenko)
 - FIX: NPE in SshCache during publish with ssh resolver without passFile (IVY-709) (thanks to Ruslan Shevchenko)
 - FIX: Update install ivy build file example (IVY-705) (thanks to Benjamin Francisoud)
diff --git a/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java b/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java
index 17eabb816..2f346b10e 100644
--- a/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java
+++ b/src/java/org/apache/ivy/core/retrieve/RetrieveEngine.java
@@ -107,6 +107,10 @@ public int retrieve(ModuleRevisionId mrid, String destFilePattern, RetrieveOptio
             for (Iterator iter = artifactsToCopy.keySet().iterator(); iter.hasNext();) {
                 ArtifactDownloadReport artifact = (ArtifactDownloadReport) iter.next();
                 File archive = artifact.getLocalFile();
+                if (archive == null) {
+                    Message.verbose("\tno local file available for " + artifact + ": skipping");
+                    continue;
+                }
                 Set dest = (Set) artifactsToCopy.get(artifact);
                 Message.verbose("\tretrieving " + archive);
                 for (Iterator it2 = dest.iterator(); it2.hasNext();) {
