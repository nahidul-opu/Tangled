From 38f1f179361105f925106c5a17e9cb54a068b682 Mon Sep 17 00:00:00 2001
From: Maja Kabiljo <majakabiljo@maja-mbp.thefacebook.com>
Date: Mon, 15 Apr 2013 12:20:11 -0700
Subject: [PATCH] GIRAPH-634: InternalGiraphRunner with TestGraph is broken
 (majakabiljo)

---
 CHANGELOG                                                     | 1 +
 .../java/org/apache/giraph/utils/InternalVertexRunner.java    | 4 +++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/CHANGELOG b/CHANGELOG
index 98d5490fc..149eb7e84 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -3,6 +3,7 @@ Giraph Change Log
 Release 1.0.1 - unreleased
   
 Release 1.0.0 - 2013-04-12
+  GIRAPH-634: InternalGiraphRunner with TestGraph is broken (majakabiljo)
 
   GIRAPH-630: Convergence detection broken in
   o.a.g.examples.PageRankVertex. (ssc via aching)
diff --git a/giraph-core/src/main/java/org/apache/giraph/utils/InternalVertexRunner.java b/giraph-core/src/main/java/org/apache/giraph/utils/InternalVertexRunner.java
index bb604367a..029cb5dcd 100644
--- a/giraph-core/src/main/java/org/apache/giraph/utils/InternalVertexRunner.java
+++ b/giraph-core/src/main/java/org/apache/giraph/utils/InternalVertexRunner.java
@@ -221,8 +221,10 @@ M extends Writable> TestGraph<I, V, E, M> run(
       File zkMgrDir = FileUtils.createTempDir(tmpDir, "_defaultZkManagerDir");
       File checkpointsDir = FileUtils.createTempDir(tmpDir, "_checkpoints");
 
+      conf.setVertexInputFormatClass(InMemoryVertexInputFormat.class);
+
       // Create and configure the job to run the vertex
-      GiraphJob job = new GiraphJob(conf.getVertexClass().getName());
+      GiraphJob job = new GiraphJob(conf, conf.getVertexClass().getName());
 
       InMemoryVertexInputFormat.setGraph(graph);
 
