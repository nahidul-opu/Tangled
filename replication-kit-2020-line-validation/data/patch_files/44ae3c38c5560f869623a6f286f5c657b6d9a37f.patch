From 44ae3c38c5560f869623a6f286f5c657b6d9a37f Mon Sep 17 00:00:00 2001
From: Claudio Martella <claudio@apache.org>
Date: Thu, 15 Aug 2013 16:46:29 +0200
Subject: [PATCH] GIRAPH-740

---
 CHANGELOG                                                      | 3 +++
 .../main/java/org/apache/giraph/utils/ArrayListWritable.java   | 2 ++
 2 files changed, 5 insertions(+)

diff --git a/CHANGELOG b/CHANGELOG
index 1e5865ea7..e79a04d3b 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,9 @@
 Giraph Change Log
 
 Release 1.1.0 - unreleased
+  GIRAPH-740: ArrayListWritable object is not cleared in readFields()
+  (korlando via claudio)
+
   GIRAPH-692: Add Bracha Toueg Deadlock Detection in the examples 
   (aarmax00 via claudio)
 
diff --git a/giraph-core/src/main/java/org/apache/giraph/utils/ArrayListWritable.java b/giraph-core/src/main/java/org/apache/giraph/utils/ArrayListWritable.java
index 9d8f4f1e6..2d9928a75 100644
--- a/giraph-core/src/main/java/org/apache/giraph/utils/ArrayListWritable.java
+++ b/giraph-core/src/main/java/org/apache/giraph/utils/ArrayListWritable.java
@@ -95,6 +95,8 @@ public void readFields(DataInput in) throws IOException {
     if (this.refClass == null) {
       setClass();
     }
+
+    clear();                              // clear list before storing values
     int numValues = in.readInt();            // read number of values
     ensureCapacity(numValues);
     for (int i = 0; i < numValues; i++) {
